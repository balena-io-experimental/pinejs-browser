{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///external \"lodash\"","webpack:///./node_modules/@balena/sbvr-types/out/type-utils.js","webpack:///./node_modules/es5-ext/object/valid-callable.js","webpack:///./node_modules/d/index.js","webpack:///./node_modules/es5-ext/object/valid-value.js","webpack:///./src/sbvr-api/sbvr-utils.ts","webpack:///./node_modules/es5-ext/object/is-value.js","webpack:///./node_modules/safe-buffer/index.js","webpack:///./node_modules/ometa-js/lib/ometajs/core.js","webpack:///./node_modules/es5-ext/number/to-pos-integer.js","webpack:///./node_modules/es6-symbol/index.js","webpack:///./src/config-loader/env.ts","webpack:///./node_modules/@balena/sbvr-types/out/index.js","webpack:///./node_modules/inherits/inherits.js","webpack:///./node_modules/sha.js/hash.js","webpack:///./node_modules/@balena/odata-to-abstract-sql/out/odata-to-abstract-sql.js","webpack:///./node_modules/memoizee/index.js","webpack:///./node_modules/type/value/is.js","webpack:///./src/sbvr-api/permissions.ts","webpack:///./src/sbvr-api/errors.ts","webpack:///external \"bluebird\"","webpack:///./node_modules/es5-ext/array/from/index.js","webpack:///./node_modules/@balena/abstract-sql-compiler/out/AbstractSQLCompiler.js","webpack:///./node_modules/es5-ext/object/normalize-options.js","webpack:///./node_modules/es5-ext/object/for-each.js","webpack:///./node_modules/es5-ext/object/assign/index.js","webpack:///./node_modules/es5-ext/function/_define-length.js","webpack:///./node_modules/ext/global-this/index.js","webpack:///./node_modules/es5-ext/function/is-arguments.js","webpack:///./node_modules/es5-ext/string/is-string.js","webpack:///./src/sbvr-api/hooks.ts","webpack:///./node_modules/memoizee/weak.js","webpack:///./src/server-glue/module.ts","webpack:///external \"typed-error\"","webpack:///external \"fs\"","webpack:///./node_modules/@balena/abstract-sql-compiler/out/AbstractSQLOptimiser.js","webpack:///./node_modules/@balena/sbvr-parser/sbvr-libs.js","webpack:///./node_modules/memoizee/lib/resolve-length.js","webpack:///./node_modules/es5-ext/object/is-object.js","webpack:///./node_modules/type/object/is.js","webpack:///./node_modules/es5-ext/array/#/e-index-of.js","webpack:///./node_modules/es5-ext/object/map.js","webpack:///./node_modules/next-tick/index.js","webpack:///./node_modules/deep-freeze/index.js","webpack:///./node_modules/es5-ext/object/set-prototype-of/index.js","webpack:///./src/database-layer/db.ts","webpack:///./node_modules/@balena/abstract-sql-compiler/out/AbstractSQLRules2SQL.js","webpack:///external \"crypto\"","webpack:///./node_modules/sha.js/sha256.js","webpack:///./node_modules/sha.js/sha512.js","webpack:///./node_modules/@balena/lf-to-abstract-sql/sbvr-compiler-libs.js","webpack:///./node_modules/es5-ext/error/custom.js","webpack:///./node_modules/es5-ext/object/mixin.js","webpack:///./node_modules/type/plain-function/is.js","webpack:///./node_modules/es5-ext/string/#/contains/index.js","webpack:///./node_modules/memoizee/lib/resolve-resolve.js","webpack:///./node_modules/es6-symbol/validate-symbol.js","webpack:///./node_modules/memoizee/lib/resolve-normalize.js","webpack:///./node_modules/es5-ext/object/is-callable.js","webpack:///./node_modules/is-promise/index.js","webpack:///./node_modules/randomstring/index.js","webpack:///./src/extended-sbvr-parser/extended-sbvr-parser.ts","webpack:///./src/migrator/migrator.ts","webpack:///./node_modules/@balena/odata-parser/odata-parser.js","webpack:///./src/sbvr-api/control-flow.ts","webpack:///./src/sbvr-api/uri-parser.ts","webpack:///./node_modules/es5-ext/object/copy.js","webpack:///./node_modules/es5-ext/object/set-prototype-of/is-implemented.js","webpack:///./node_modules/es5-ext/object/set-prototype-of/shim.js","webpack:///./node_modules/es6-iterator/get.js","webpack:///./node_modules/es6-iterator/index.js","webpack:///./node_modules/type/lib/resolve-exception.js","webpack:///./src/sbvr-api/abstract-sql.ts","webpack:///./src/server-glue/server.ts","webpack:///./src/server-glue/sbvr-loader.ts","webpack:///./node_modules/eventemitter3/index.js","webpack:///external \"pg\"","webpack:///./node_modules/pg-connection-string/index.js","webpack:///external \"url\"","webpack:///external \"mysql\"","webpack:///./src/config-loader/config-loader.ts","webpack:///external \"path\"","webpack:///./src/sbvr-api/cached-compile.ts","webpack:///./node_modules/@balena/sbvr-types/out/types/big-integer.js","webpack:///./node_modules/@balena/sbvr-types/out/types/boolean.js","webpack:///./node_modules/@balena/sbvr-types/out/types/case-insensitive-text.js","webpack:///./node_modules/@balena/sbvr-types/out/types/color.js","webpack:///./node_modules/@balena/sbvr-types/out/types/concept-type.js","webpack:///./node_modules/@balena/sbvr-types/out/types/date.js","webpack:///./node_modules/@balena/sbvr-types/out/types/date-time.js","webpack:///./node_modules/@balena/sbvr-types/out/types/file.js","webpack:///./node_modules/@balena/sbvr-types/out/types/foreign-key.js","webpack:///./node_modules/@balena/sbvr-types/out/types/hashed.js","webpack:///external \"bcrypt\"","webpack:///external \"bcryptjs\"","webpack:///./node_modules/@balena/sbvr-types/out/types/integer.js","webpack:///./node_modules/@balena/sbvr-types/out/types/interval.js","webpack:///./node_modules/@balena/sbvr-types/out/types/json.js","webpack:///./node_modules/@balena/sbvr-types/out/types/real.js","webpack:///./node_modules/@balena/sbvr-types/out/types/serial.js","webpack:///./node_modules/@balena/sbvr-types/out/types/sha.js","webpack:///./node_modules/sha.js/index.js","webpack:///./node_modules/sha.js/sha.js","webpack:///external \"util\"","webpack:///./node_modules/inherits/inherits_browser.js","webpack:///external \"buffer\"","webpack:///./node_modules/sha.js/sha1.js","webpack:///./node_modules/sha.js/sha224.js","webpack:///./node_modules/sha.js/sha384.js","webpack:///./node_modules/@balena/sbvr-types/out/types/short-text.js","webpack:///./node_modules/@balena/sbvr-types/out/types/text.js","webpack:///./node_modules/@balena/sbvr-types/out/types/time.js","webpack:///./node_modules/@balena/abstract-sql-compiler/out/AbstractSQLSchemaOptimiser.js","webpack:///./node_modules/@balena/abstract-sql-compiler/out/referenced-fields.js","webpack:///./node_modules/@balena/lf-to-abstract-sql/index.js","webpack:///./node_modules/@balena/lf-to-abstract-sql/lf-to-abstract-sql-prep.js","webpack:///./node_modules/@balena/sbvr-parser/lf-optimiser.js","webpack:///./node_modules/@balena/sbvr-parser/lf-validator.js","webpack:///./node_modules/@balena/lf-to-abstract-sql/lf-to-abstract-sql.js","webpack:///./node_modules/es5-ext/function/noop.js","webpack:///./node_modules/es5-ext/number/to-integer.js","webpack:///./node_modules/es5-ext/math/sign/index.js","webpack:///./node_modules/es5-ext/math/sign/is-implemented.js","webpack:///./node_modules/es5-ext/math/sign/shim.js","webpack:///./node_modules/memoizee/plain.js","webpack:///./node_modules/es5-ext/object/_iterate.js","webpack:///./node_modules/memoizee/lib/configure-map.js","webpack:///./node_modules/es5-ext/object/assign/is-implemented.js","webpack:///./node_modules/es5-ext/object/assign/shim.js","webpack:///./node_modules/es5-ext/object/keys/index.js","webpack:///./node_modules/es5-ext/object/keys/is-implemented.js","webpack:///./node_modules/es5-ext/object/keys/shim.js","webpack:///./node_modules/type/function/is.js","webpack:///./node_modules/type/prototype/is.js","webpack:///./node_modules/es5-ext/string/#/contains/is-implemented.js","webpack:///./node_modules/es5-ext/string/#/contains/shim.js","webpack:///./node_modules/event-emitter/index.js","webpack:///./node_modules/es5-ext/array/to-array.js","webpack:///./node_modules/es5-ext/array/from/is-implemented.js","webpack:///./node_modules/es5-ext/array/from/shim.js","webpack:///./node_modules/es6-symbol/is-implemented.js","webpack:///./node_modules/ext/global-this/is-implemented.js","webpack:///./node_modules/ext/global-this/implementation.js","webpack:///./node_modules/es6-symbol/polyfill.js","webpack:///./node_modules/es6-symbol/is-symbol.js","webpack:///./node_modules/es6-symbol/lib/private/generate-name.js","webpack:///./node_modules/es6-symbol/lib/private/setup/standard-symbols.js","webpack:///./node_modules/es6-symbol/lib/private/setup/symbol-registry.js","webpack:///./node_modules/es5-ext/function/is-function.js","webpack:///./node_modules/memoizee/normalizers/primitive.js","webpack:///./node_modules/memoizee/normalizers/get-primitive-fixed.js","webpack:///./node_modules/memoizee/normalizers/get.js","webpack:///./node_modules/es5-ext/number/is-nan/index.js","webpack:///./node_modules/es5-ext/number/is-nan/is-implemented.js","webpack:///./node_modules/es5-ext/number/is-nan/shim.js","webpack:///./node_modules/memoizee/normalizers/get-1.js","webpack:///./node_modules/memoizee/normalizers/get-fixed.js","webpack:///./node_modules/memoizee/ext/async.js","webpack:///./node_modules/memoizee/ext/promise.js","webpack:///./node_modules/es5-ext/object/primitive-set.js","webpack:///./node_modules/es5-ext/object/validate-stringifiable-value.js","webpack:///./node_modules/es5-ext/object/validate-stringifiable.js","webpack:///./node_modules/es5-ext/to-short-string-representation.js","webpack:///./node_modules/es5-ext/safe-to-string.js","webpack:///./node_modules/memoizee/ext/dispose.js","webpack:///./node_modules/memoizee/ext/max-age.js","webpack:///./node_modules/timers-ext/valid-timeout.js","webpack:///./node_modules/timers-ext/max-timeout.js","webpack:///./node_modules/memoizee/ext/max.js","webpack:///./node_modules/lru-queue/index.js","webpack:///./node_modules/memoizee/ext/ref-counter.js","webpack:///./node_modules/randomstring/lib/randomstring.js","webpack:///./node_modules/randomstring/lib/charset.js","webpack:///./node_modules/array-uniq/index.js","webpack:///external \"pinejs-client-core\"","webpack:///./node_modules/@balena/sbvr-parser/sbvr-parser.js","webpack:///./node_modules/@balena/sbvr-parser/inflection.js","webpack:///./node_modules/@balena/sbvr-types/Type.sbvr","webpack:///./src/migrator/migrations.sbvr","webpack:///./src/odata-metadata/odata-metadata-generator.ts","webpack:///./src/sbvr-api/dev.sbvr","webpack:///./node_modules/memoizee/lib/weak.js","webpack:///./node_modules/es5-ext/function/#/partial.js","webpack:///./node_modules/es6-weak-map/index.js","webpack:///./node_modules/es6-weak-map/is-implemented.js","webpack:///./node_modules/es6-weak-map/polyfill.js","webpack:///./node_modules/es5-ext/object/create.js","webpack:///./node_modules/es5-ext/object/valid-object.js","webpack:///./node_modules/es5-ext/string/random-uniq.js","webpack:///./node_modules/es6-iterator/array.js","webpack:///./node_modules/es5-ext/array/#/clear.js","webpack:///./node_modules/d/auto-bind.js","webpack:///./node_modules/type/value/ensure.js","webpack:///./node_modules/type/string/coerce.js","webpack:///./node_modules/type/lib/to-short-string.js","webpack:///./node_modules/type/lib/safe-to-string.js","webpack:///./node_modules/type/plain-function/ensure.js","webpack:///./node_modules/es6-iterator/string.js","webpack:///./node_modules/es6-iterator/valid-iterable.js","webpack:///./node_modules/es6-iterator/is-iterable.js","webpack:///./node_modules/es6-iterator/for-of.js","webpack:///./node_modules/es6-weak-map/is-native-implemented.js","webpack:///./src/sbvr-api/user.sbvr","webpack:///./src/sbvr-api/odata-response.ts","webpack:///./src/config-loader sync","webpack:///./src/pinejs-session-store/pinejs-session-store.ts","webpack:///external \"express-session\"","webpack:///./src/data-server/sbvr-server.js","webpack:///./src/http-transactions/transactions.js","webpack:///./src/http-transactions/transaction.sbvr","webpack:///./src/passport-pinejs/passport-pinejs.ts","webpack:///./src/express-emulator/express.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","getDefault","getModuleExports","object","property","prototype","hasOwnProperty","p","s","require","validate","nativeFactTypeTemplates","equality","from","to","checkRequired","validateFn","async","runCheck","required","Error","equals","comparison","integer","processedValue","parseInt","Number","isNaN","text","length","date","processedDate","Date","getTime","fn","TypeError","isValue","isPlainFunction","assign","normalizeOpts","contains","dscr","e","w","options","desc","arguments","configurable","writable","gs","set","undefined","sbvrTypes","devModel","addPureHook","addSideEffectHook","db","resolveOdataBind","LF2AbstractSQLTranslator","LF2AbstractSQL","createTranslator","LF2AbstractSQLTranslatorVersion","models","memoizedResolvedSynonym","memoizeWeak","abstractSqlModel","resourceName","sqlName","odataNameToSqlName","_","split","map","namePart","synonym","synonyms","join","primitive","resolveSynonym","request","getAbstractSqlModel","memoizedResolveNavigationResource","navigationName","navigation","flatMap","concat","resolvedResourceName","mapping","relationships","sqlNameToODataName","tables","resolveNavigationResource","prettifyConstraintError","err","ConstraintError","matches","UniqueConstraintError","engine","exec","message","RegExp","columns","ForeignKeyConstraintError","tableName","CheckConstraintError","table","checks","checkName","check","find","description","BadRequestError","validateModel","tx","modelName","Promise","all","sql","rules","rule","isRuleAffected","values","getAndCheckBindValues","vocabulary","odataBinds","bindings","result","await","v","executeSql","rows","SbvrValidationError","structuredEnglish","generateLfModel","seModel","cachedCompile","ExtendedSBVRParser","version","matchAll","generateAbstractSqlModel","lfModel","generateSqlModel","abstractSql","targetDatabaseEngine","AbstractSQLCompiler","compileSchema","generateModels","model","apiRoot","vocab","modelText","se","maybeAbstractSql","lf","console","error","odataMetadata","generateODataMetadata","executeModel","executeModels","execModels","compiledModels","migrator","run","compiledModel","createStatement","createSchema","promise","catch","warn","postRun","odataResponse","prepareModel","deepFreeze","api","PinejsClient","logger","logging","defaultSetting","default","k","keys","noop","updateModel","modelType","dev","delete","resource","passthrough","req","permissions","root","$filter","is_of__vocabulary","model_type","rootRead","$select","method","uri","body","model_value","id","runURI","cleanupModel","deleteModel","transaction","dropStatements","dropSchema","dropStatement","isWhereNode","x","isEqualsNode","getID","abstractSqlQuery","idField","whereClause","slice","runRule","LF2AbstractSQLPrepHack","LF2AbstractSQLPrep","_extend","this","_pred","translator","createInstance","addTypes","slfModel","ruleLF","pop","match","push","reset","formulationType","fetchingViolators","ruleAbs","last","ruleBody","node","wantNonViolators","queryPart","compiledRule","compileRule","Array","isArray","query","odataIdField","ids","row","filter","uniq","odataResult","__formulationType","__resourceName","PinejsClientCore","url","custom","InternalRequestError","user","apiKey","isObject","stack","actor","forEach","emulatedReq","on","params","runODataRequest","response","isError","responseBody","status","ErrorClass","statusCodeToError","HttpError","getIdField","getAffectedIds","args","affectedIds","pendingAffectedIds","$getAffectedIds","uriParser","parseOData","resourceTable","odataQuery","properties","$expand","addPermissions","translateUri","compileRequest","runQuery","runTransaction","newTx","env","DEBUG","log","reqHooks","getHooks","transactions","tryCancelRequest","isClosed","rollback","rollbackRequestHooks","mapSeries","controlFlow","getMappingFn","headers","runHooks","requests","batch","data","prepareRequest","$request","hooks","translatedRequest","results","responses","requestPart","Bluebird","changeSetResults","reduce","runChangeSet","Map","runRequest","convertToHttpError","handleODataRequest","res","next","getResponseBody","headerValue","headerName","json","sendStatus","sendMulti","PermissionError","UnauthorizedError","ConflictError","SqlCompilationError","TranslationError","ParsingError","PermissionParsingError","DatabaseError","NotFoundError","runGet","runPost","runPut","runDelete","SyntaxError","EvalError","RangeError","ReferenceError","URIError","prepareResponse","updateBinds","_defer","tag","ref","parseId","respondGet","respondPost","respondPut","respondDelete","respondOptions","MethodNotAllowedError","callback","queryIndex","returningIdField","sqlQuery","sqlResult","_req","format","$format","metadata","process","includeMetadata","contentType","rowsAffected","insertId","location","resourceURI","includes","returnResource","Location","executeStandardModels","migrations","config","info","setup","_app","$db","exit","_undefined","val","buffer","Buffer","copyProps","src","dst","alloc","allocUnsafe","allocUnsafeSlow","SafeBuffer","arg","encodingOrOffset","size","fill","encoding","buf","SlowBuffer","fail","OMeta","child","objectThatDelegatesTo","obj","props","clone","isSequenceable","getTag","_id_","isImmutable","lookup","success","fallback","always","after","identity","ans","returnTrue","returnFalse","throwFail","OMInputStream","hd","tl","memo","lst","idx","head","tail","type","constructor","upTo","that","curr","String","OMInputStreamEnd","ListOMInputStream","makeListOMInputStream","makeOMInputStreamProxy","target","_fail","_enableTokens","rulesToTrack","_tokensEnabled","_addToken","startInput","endInput","ruleArgs","indexOf","tokens","_enableBranchTracking","branches","_addBranch","input","_getBranches","_not","self","origInput","origAddBranch","origAddToken","_apply","memoRec","nextInput","failer","sentinel","lookupFunc","_superApply","recv","_applyWithArgs","ruleFn","ruleFnArity","Math","min","_prependInput","apply","_superApplyWithArgs","_disablePrependingInput","memoizeParameterizedRules","newInput","b","_lookahead","_or","argIdx","_xor","ruleName","disableXORs","_opt","_many","y","resetAndReturnFalse","_many1","_form","anything","_consumedBy","_idxConsumedBy","fromIdx","toIdx","_interleave","currInput","allDone","f","_currIdx","lowerCaseAnything","toLowerCase","end","pos","empty","foreign","grammar","grammarInstance","exactly","wanted","number","string","space","charCodeAt","spaces","digit","lower","upper","letter","letterOrDigit","firstAndRest","first","rest","seq","xs","notLast","listOf","delim","token","cs","fromTo","hexDigit","escapedChar","fromCharCode","initialize","matchFailed","listyObj","setInput","inputHead","realArgs","source","char","start","line","col","charAt","aRule","enableReusingMemoizations","sideEffectingRules","previousText","divergencePoint","test","cleanInput","secondaryDivergencePoint","memoTokens","ruleNames","duplicateTokens","splice","factory","toInteger","max","cache","permissionsLookup","parsePermissions","odataToAbstractSql","abstractSqlCompiler","timeoutMS","TRANSACTION_TIMEOUT_MS","poolSize","idleTimeoutMillis","statementTimeout","queryTimeout","connectionTimeoutMillis","keepAlive","rollbackTimeout","lockTimeout","lockFailDelay","BigInteger","Boolean","CaseInsensitiveText","Color","ConceptType","DateTime","File","ForeignKey","Hashed","Integer","Interval","JSON","Real","Serial","SHA","ShortText","Text","Time","util","inherits","Hash","blockSize","finalSize","_block","_finalSize","_blockSize","_len","update","enc","block","accum","offset","assigned","remainder","_update","digest","rem","bits","writeUInt32BE","lowBits","highBits","hash","_hash","toString","OData2AbstractSQL","isBindReference","rewriteBinds","memoize","randomstring","convertToModernDefinition","definition","binds","extraBinds","eq","ne","gt","ge","lt","le","operations","add","sub","mul","div","rewriteComputed","computed","tableAlias","rewrittenComputed","cloneDeep","modifyAbstractSql","referencedField","containsQueryOption","opts","Query","select","where","extras","otherQuery","bypassDefinition","rewriteDefinition","extraBindVars","bindVarsLength","queryType","compiled","replace","odataName","abstractSqlComponent","existingBinds","inc","maybeBind","addBodyKey","fieldName","bodyKeys","extraBodyVars","qualifiedIDField","clientModel","methods","resourceAliases","MAX_ALIAS_LENGTH","RANDOM_ALIAS_LENGTH","shortAliases","generateShortAliases","checkAlias","alias","aliasLength","part","shortAlias","part2","part3","shortPart2","shortPart","randStr","generate","path","savedMethods","tree","isEmpty","PathSegment","putReset","insertQuery","compile","_a","hasQueryOpts","Resource","defaultResource","fromResource","referencedIdField","pathKeyWhere","PathKey","addPathKey","bindVars","Expands","childQuery","merge","NavigateResources","link","linkResource","aliasedField","FieldContainedIn","ReferencedField","Bind","resourceMapping","ResourceMapping","BindVars","entries","subQuery","bindVar","bindVarSelectQuery","fields","field","dataType","unionResource","isTable","found","AddQueryOptions","count","AddCountField","AddSelectFields","fieldNames","sqlFieldNames","sort","resourceField","index","indexes","some","isEqual","namedKeys","optional","AddExtraFroms","BooleanMatch","orderby","OrderByProperties","orderings","ordering","ReferencedProperty","order","toUpperCase","mappedFieldName","compact","parentResource","resourceAlias","relationshipMapping","ResolveRelationship","Synonym","resourceAlias2","verb","resourceMappings","relationship","resourceRelations","relationshipPath","$","odataFieldNames","prop","Property","differenceWith","a","AliasSelectField","op1","Operand","op2","capitalize","bool","FunctionMatch","matcher","NullMatch","NumberMatch","TextMatch","DateMatch","DurationMatch","lambda","AddNavigation","identifier","expression","Method","Lambda","propResource","AliasedFunction","_optional","isDate","duration","pick","omitBy","isNil","omit","expands","expand","expandResource","nestedExpandQuery","expandQuery","SelectFilter","$orderby","OrderBy","$top","limit","$skip","linkedResource","linkedTableAlias","nextProp","extraResource","rewrittenDefinition","referencedResource","subDefinition","computedFieldQuery","addAliases","origAliasParts","trie","buildTrie","aliasPart","$suffix","traverseNodes","str","lowerCaseAliasParts","origAliasPart","getRelationships","nestedRelationships","relationshipKeys","aliasParts","union","reject","resolveLength","plain","normalizer","dispose","maxAge","refCounter","userModel","DEFAULT_ACTOR_BIND","DEFAULT_ACTOR_BIND_REGEX","escapeRegExp","methodPermissions","GET","PUT","and","POST","PATCH","MERGE","DELETE","$parsePermissions","ODataParser","parse","startRule","bindsLength","cloneDeepWith","isInteger","odata","isAnd","isOr","nestedCheck","stringCallback","subcheck","checkTypes","checkType","or","collapsePermissionFilters","namespaceRelationships","getPermissionsLookup","permission","condition","$checkPermissions","actionList","checkObject","permissionCheck","resourcePermission","vocabularyPermission","vocabularyResourcePermission","maybeVocabularyPermission","maybeVocabularyResourcePermission","conditionalPermissions","convertToLambda","replaceObject","element","rewriteSubPermissionBindings","counter","rewrite","buildODataPermission","conditionalPerms","constrainedPermissionError","permissionFilters","collapsedPermissionFilters","generateConstrainedAbstractSql","abstractSQLModel","sbvrUtils","memoizedParseOdata","lambdaAlias","canAccessTrace","canAccessFunction","targetResource","targetResourceName","parentOdata","collapsedParentPermissionFilters","lambdaId","memoizedGetOData2AbstractSQL","canAccess","selectIndex","findIndex","selectField","maybeField","fieldType","onceGetter","propName","nullableFn","thrownErr","deepFreezeExceptDefinition","freeze","getOwnPropertyNames","createBypassDefinition","endsWith","getAlias","permissionsJSON","rewriteRelationship","odata2AbstractSQL","escapedName","possibleTargetResourceName","targetResourceEscaped","foundCanAccessLink","targetResourceAST","currentResourceName","rewriteRelationships","originalAbstractSQLModel","newRelationships","forOwn","stringifiedGetPermissions","stringify","getBoundConstrainedMemoizer","constrainedAbstractSqlModel","origSynonyms","Proxy","permissionSynonym","canonicalForm","origRelationships","bypassResourceName","permissionResourceName","permissionsTable","memoizedGetConstrainedModel","getCheckPasswordQuery","once","Auth","prepare","username","checkPassword","password","userId","actorId","compare","getUserPermissions","getUserPermissionsQuery","$or","is_of__user","$any","$alias","$expr","uhp","expiry_date","$gt","$now","is_of__role","rhp","role","uhr","isFinite","getApiKeyPermissionsQuery","is_of__api_key","khp","api_key","khr","getApiKeyPermissions","getApiKeyActorIdQuery","apiActorPermissionError","getApiKeyActorId","apiKeyResult","apiKeyActorID","is_of__actor","__id","checkApiKey","customAuthorizationMiddleware","expectedScheme","_res","auth","header","parts","scheme","authorizationMiddleware","customApiKeyMiddleware","paramName","apiKeyMiddleware","checkPermissions","getReqPermissions","checkPermissionsMiddleware","action","allowed","getGuestPermissions","guestPermissions","actorIndex","addActorPermissions","actorPermissions","actorBind","actorPermission","isMetadataEndpoint","metadataEndpoints","permissionType","methodPermission","customServerCode","addHook","sideEffects","readOnlyTx","PREPARSE","POSTPARSE","isAction","PRERESPOND","post","POSTRUN","TypedError","super","PaymentRequired","ForbiddenError","NotAcceptableError","ProxyAuthenticationRequiredError","RequestTimeoutError","GoneError","LengthRequiredError","PreconditionFailedError","PayloadTooLargeError","URITooLongError","UnsupportedMediaTypeError","RequestedRangeNotSatisfiableError","ExpectationFailedError","MisdirectedRequestError","UnprocessableEntityError","LockedError","FailedDependencyError","UpgradeRequiredError","PreconditionRequiredError","TooManyRequestsError","RequestHeaderFieldsTooLargeError","UnavailableForLegalReasonsError","NotImplementedError","BadGatewayError","ServiceUnavailableError","GatewayTimeoutError","HTTPVersionNotSupportedError","VariantAlsoNegotiatesError","InsufficientStorageError","LoopDetectedError","NotExtendedError","NetworkAuthenticationRequiredError","400","401","402","403","404","405","406","407","408","409","410","411","412","413","414","415","416","417","421","422","423","424","426","428","429","431","451","500","501","502","503","504","505","506","507","508","510","511","websql","mysql","postgres","isResourceNode","isTableNode","isFromNode","Engines","AbstractSQLOptimiser_1","AbstractSQLRules2SQL_1","AbstractSQLSchemaOptimiser_1","referenced_fields_1","validateTypes","mapValues","dataTypeValidate","dataTypeGen","defaultValue","_b","requiredStr","checksString","dbType","types","containsNode","checkNodeTypeFn","abstractSQL","noBinds","AbstractSQLOptimiser","AbstractSQLRules2SQL","ifNotExists","ifNotExistsStr","orReplaceStr","createSchemaStatements","alterSchemaStatements","dropSchemaStatements","fns","functions","fnName","fnDefinition","language","hasDependants","schemaDependencyMap","definitionAbstractSql","createSQL","dropSQL","depends","foreignKeys","createSqlElements","references","referencedTable","fkDefinition","schemaInfo","comment","constraintName","createTriggers","dropTriggers","triggers","trigger","triggerName","when","operation","level","resourceNames","unsolvedDependency","dependency","reverse","ruleStatements","ruleBodyNode","ruleSENode","ruleSE","ruleSQL","ruleBindings","referencedFields","ruleReferencedFields","getReferencedFields","getRuleReferencedFields","generateExport","optimizeSchema","getModifiedFields","opts1","toPosInt","arg1","arg2","mixin","ignore","Function","globalThis","objToString","hookNames","isValidHook","Hook","hook","hookFn","SideEffectHook","rollbackFns","rolledBack","try","settleMapSeries","instantiateHooks","typeHooks","mergeHooks","mergeWith","getResourceHooks","vocabHooks","getVocabHooks","methodHooks","getMethodHooks","apiHooks","clear","OPTIONS","origResourceName","apiRootHooks","resourceHooks","blueprintedHooks","hookName","hookType","defineApi","hooksList","readOnlyArgs","asReadOnly","PinejsSessionStore","envDatabaseOptions","dbModule","engines","databaseURL","DATABASE_URL","init","app","databaseOptions","connect","cfgLoader","configLoader","loadConfig","promises","sbvrServer","then","addModelHooks","isAbstractSqlQuery","getAbstractSqlQuery","checkArgs","checkMinArgs","isNotNullable","escapeForLike","helped","Helper","isEmptySelectQuery","maybeBool","rewriteMatch","matchers","rewriteFn","matchArgs","tryMatches","AnyValue","typeRules","isJSONValue","isDateValue","isTextValue","isNumericValue","isBooleanValue","isDurationValue","UnknownValue","MatchValue","TextValue","NumericValue","BooleanValue","DateValue","DurationValue","isFieldValue","Field","AnyNotNullValue","FieldOp","FieldEquals","FieldNotEquals","Comparison","mathOps","MathOp","ExtractNumericDatePart","Concatenate","Value","FromMatch","MaybeAlias","matchFn","Lower","Upper","JoinMatch","joinType","UnionQuery","SelectQuery","groups","Where","GroupBy","Limit","Offset","Select","From","Join","LeftJoin","RightJoin","FullJoin","CrossJoin","Count","Average","Sum","Cast","EmbeddedText","Null","Now","AggregateJSON","Equals","valueIndex","NotEquals","GreaterThan","GreaterThanOrEqual","LessThan","LessThanOrEqual","Like","IsNotDistinctFrom","IsDistinctFrom","Add","Subtract","Multiply","Divide","Year","Month","Day","Hour","Minute","Second","Fractionalseconds","Totalseconds","Concat","Replace","CharacterLength","StrPos","Substring","nums","Right","Tolower","ToLower","Toupper","ToUpper","Trim","Round","Floor","Ceiling","ToDate","ToTime","Coalesce","Case","resultValue","And","maybeHelped","conditions","containsFalse","fieldBuckets","others","fieldBool","fieldRef","fieldBucket","Or","containsTrue","Duration","Exists","NotExists","Not","NotIn","In","vals","InsertQuery","valuesArray","valuesType","valuesRest","UpdateQuery","DeleteQuery","Contains","haystack","needle","Substringof","Startswith","Endswith","IndexOf","Indexof","$noBinds","updateQuery","SBVRLibs","currentVocabulary","vocabularies","factTypes","ApplyFirstExisting","IdentifiersEqual","FollowConceptType","conceptTypes","ConceptTypes","AddVocabulary","baseSynonym","Term","Name","IdentifierChildren","formatFactType","factType","AddFactType","realFactType","mappedFactType","matchingFactTypes","realFactTypePart","mappingFound","j","factTypePart","_traverseFactType","$elf","traverseRecurse","currentFactTypePart","remainingFactType","currentLevel","__valid","finalLevel","finalLevels","optsLength","fnLength","isAsync","function","possibleTypes","numberIsNaN","objHasOwnProperty","abs","floor","searchElement","fromIndex","callable","cb","thisArg","targetObj","ensureCallable","byObserver","Observer","document","createTextNode","queue","currentQueue","shift","observe","characterData","nextTick","queueMicrotask","MutationObserver","WebKitMutationObserver","setImmediate","setTimeout","isFrozen","setPrototypeOf","metrics","EventEmitter","isSqlError","code","TransactionClosedError","ReadOnlyViolationError","wrapDatabaseError","emit","alwaysExport","atomicExecuteSql","asyncTryFn","resolve","getRejectedFunctions","rejectionValue","rejectFn","onEnd","onRollback","AutomaticClose","stackTraceErr","pending","automaticClose","automaticCloseTimeout","clearTimeout","Tx","readOnly","closed","listeners","cancelPending","$executeSql","incrementPending","t0","now","_executeSql","decrementPending","queryTime","_rollback","closeTransaction","clearListeners","_commit","ifExists","ifExistsStr","getStackTraceErr","createTransaction","createFunc","maybePg","maybeMysql","pg","connectString","PG_UNIQUE_VIOLATION","PG_FOREIGN_KEY_VIOLATION","PG_CHECK_CONSTRAINT_VIOLATION","pgConnectionString","statement_timeout","query_timeout","pool","Pool","PG_SCHEMA","client","createResult","rowCount","PostgresTx","addReturning","queryQueue","handleError","connection","timeout","release","extraWhereClause","readTransaction","MYSQL_UNIQUE_VIOLATION","MYSQL_FOREIGN_KEY_VIOLATION","MYSQL_CHECK_CONSTRAINT_VIOLATION","createPool","getConnectionAsync","promisify","getConnection","context","affectedRows","MySqlTx","close","fromCallback","database","window","openDatabase","databaseName","WEBSQL_CONSTRAINT_ERR","getInsertId","item","WebSqlTx","commit","WebSqlWrapper","running","asyncRecurse","debug","successCallback","_tx","errorCallback","comparisons","fieldOrderings","fieldOrderingsLookup","NestedIndent","indent","escapeField","nestedIndent","isNotDistinctFrom","aSql","bSql","aIsNotNullable","bIsNotNullable","isNotNullChecks","orBothNull","sqlJoinType","fractionalSecondsFormat","websqlBasicDateFormat","websqlDateFormats","basicDateFormat","dateFormats","AddBind","matchName","num","SelectMatch","nestedindent","existingBindIndex","nextID","joins","joinStr","boolNode","typeName","castType","comparators","replacement","clauses","negative","day","hour","minute","second","toLocaleString","minimumFractionDigits","sets","toSqlResult","$engine","insertSql","insert","updateSql","K","W","Sha256","_w","_c","_d","_e","_f","_g","_h","ch","z","maj","sigma0","sigma1","gamma0","gamma1","M","g","h","readInt32BE","T1","T2","H","writeInt32BE","Sha512","_ah","_bh","_ch","_dh","_eh","_fh","_gh","_hh","_al","_bl","_cl","_dl","_el","_fl","_gl","_hl","Ch","xl","Gamma0","Gamma0l","Gamma1","Gamma1l","getCarry","ah","bh","dh","eh","fh","gh","hh","al","bl","cl","dl","el","fl","gl","hl","xh","gamma0l","gamma1l","Wi7h","Wi7l","Wi16h","Wi16l","Wil","Wih","majh","majl","sigma0h","sigma0l","sigma1h","sigma1l","Kih","Kil","chh","chl","t1l","t1h","t2l","t2h","writeInt64BE","SBVRCompilerLibs","ResolveSynonym","_fromIdx","TYPE_VOCAB","IsPrimitive","term","IsChild","parent","MappedFactType","traverseInfo","UnmappedFactType","GetResourceName","termOrFactType","GetTable","termNameOrFactType","GetTableID","GetTableField","fieldID","GetTableFieldID","tableFields","captureStackTrace","ext","getOwnPropertyDescriptor","getOwnPropertySymbols","sourceObject","symbol","isFunction","classRe","functionToString","toArray","resolveArgs","resolvers","isSymbol","userNormalizer","isPromise","Types","SBVRParser","AddCustomAttribute","AddBuiltInVocab","MigrationError","strings","bindNums","initSql","exists","checkModelAlreadyExists","using","lockMigrations","setExecutedMigrations","executedMigrations","getExecutedMigrations","pendingMigrations","filterAndSortPendingMigrations","newlyExecutedMigrations","executeMigrations","tableList","executed_migrations","stringifiedMigrations","toPairs","sortBy","migrationKey","delay","disposer","migration","executeMigration","peg$subclass","C","peg$SyntaxError","expected","buildMessage","DESCRIBE_EXPECTATION_FNS","literal","expectation","literalEscape","class","escapedParts","classEscape","inverted","any","other","not","describeExpectation","hex","describeExpected","descriptions","describeFound","peg$parse","peg$FAILED","peg$startRuleFunctions","Process","peg$parseProcess","ProcessRule","peg$parseProcessRule","peg$startRuleFunction","peg$c0","peg$c1","peg$c2","peg$c3","peg$c4","peg$c5","peg$c6","peg$c7","peg$c8","peg$c9","peg$c10","peg$c11","peg$c12","peg$c13","peg$c14","peg$c15","peg$c16","peg$c17","peg$c18","peg$c19","peg$c20","peg$c21","peg$c22","peg$c23","peg$c24","peg$c25","peg$c26","peg$c27","peg$c28","peg$c29","peg$c30","peg$c31","peg$c32","peg$c33","peg$c34","peg$c35","peg$c36","peg$c37","peg$c38","peg$c39","peg$c40","peg$c41","peg$c42","peg$c43","peg$c44","peg$c45","peg$c46","peg$c47","peg$c48","peg$c49","peg$c50","peg$c51","peg$c52","peg$c53","peg$c54","peg$c55","peg$c56","peg$c57","peg$c58","peg$c59","peg$c60","peg$c61","peg$c62","peg$c63","peg$c64","peg$c65","peg$c66","peg$c67","peg$c68","peg$c69","peg$c70","peg$c71","peg$c72","peg$c73","peg$c74","peg$c75","peg$c76","peg$c77","peg$c78","peg$c79","peg$c80","peg$c81","peg$c82","peg$c83","peg$c84","peg$c85","peg$c86","peg$c87","peg$c88","peg$c89","peg$c90","peg$c91","peg$c92","peg$c93","peg$c94","peg$c95","peg$c96","peg$c97","peg$c98","peg$c99","peg$c100","peg$c101","peg$c102","peg$r0","peg$r1","peg$r2","peg$r3","peg$r4","peg$e0","peg$literalExpectation","peg$e1","peg$e2","peg$e3","peg$otherExpectation","peg$e4","peg$e5","peg$e6","peg$e7","peg$e8","peg$e9","peg$e10","peg$e11","peg$e12","peg$e13","peg$e14","peg$e15","peg$e16","peg$e17","peg$e18","peg$e19","peg$e20","peg$classExpectation","peg$e21","peg$e22","peg$e23","peg$e24","peg$e25","peg$e26","peg$e27","peg$e28","peg$e29","peg$e30","peg$e31","peg$e32","peg$e33","peg$e34","peg$e35","peg$e36","peg$e37","peg$e38","peg$e39","peg$e40","peg$e41","peg$e42","peg$e43","peg$e44","peg$e45","peg$e46","peg$e47","peg$e48","peg$e49","peg$e50","peg$e51","peg$e52","peg$e53","peg$e54","peg$e55","peg$e56","peg$e57","peg$e58","peg$e59","peg$e60","peg$e61","peg$e62","peg$e63","peg$e64","peg$e65","peg$e66","peg$e67","peg$e68","peg$e69","peg$e70","peg$e71","peg$e72","peg$e73","peg$e74","peg$e75","peg$e76","peg$e77","peg$e78","peg$e79","peg$e80","peg$e81","peg$e82","peg$e83","peg$e84","peg$e85","peg$e86","peg$e87","peg$e88","peg$e89","peg$e90","peg$e91","peg$e92","peg$e93","peg$e94","peg$e95","peg$e96","peg$e97","peg$e98","peg$e99","peg$e100","peg$e101","peg$e102","peg$e103","peg$e104","peg$anyExpectation","peg$e105","peg$e106","peg$e107","peg$e108","peg$f0","peg$f1","peg$f2","eval","peg$f3","peg$f4","peg$f5","peg$f6","option","CollapseObjectArray","peg$f7","peg$f8","peg$f9","peg$f10","peg$f11","peg$f12","peg$f13","peg$f14","peg$f15","peg$f16","peg$f17","peg$f18","peg$f19","peg$f20","peg$f21","peg$f22","peg$f23","peg$f24","expr","peg$f25","peg$f26","peg$f27","precedence","peg$f28","peg$f29","minPrecedence","peg$f30","lhs","op","operatorPrecedence","peg$f31","rhs","peg$f32","peg$f33","peg$f34","peg$f35","peg$parseFilterByExpressionLoop","peg$f36","peg$f37","methodName","peg$f38","peg$f39","peg$f40","peg$f41","peg$f42","paths","peg$f43","peg$f44","peg$f45","peg$f46","peg$f47","peg$f48","optionsObj","peg$f49","peg$f50","peg$f51","peg$f52","keyBind","keyBinds","peg$f53","peg$f54","peg$f55","peg$f56","peg$f57","peg$f58","peg$f59","peg$f60","peg$f61","decodeURIComponent","peg$f62","sign","peg$f63","peg$f64","peg$f65","peg$f66","peg$f67","peg$f68","peg$f69","time","peg$f70","peg$f71","peg$f72","peg$f73","peg$f74","peg$f75","peg$f76","param","peg$f77","peg$f78","peg$f79","peg$f80","peg$f81","peg$f82","peg$f83","peg$f84","peg$f85","peg$f86","peg$currPos","peg$savedPos","peg$posDetailsCache","column","peg$expected","peg$silentFails","peg$resultsCache","peg$result","ignoreCase","peg$endExpectation","peg$computePosDetails","details","peg$computeLocation","startPos","endPos","loc","startPosDetails","endPosDetails","peg$begin","variants","peg$expect","top","peg$end","invert","peg$buildSimpleError","peg$buildStructuredError","peg$buildError","failPos","s0","s1","s2","rule$expects","cached","rule$expectations","nextPos","expectations","peg$parseOData","peg$parsePathSegment","substr","peg$parseQueryOptions","s3","s4","s5","peg$parseQueryOption","peg$parseDollar","peg$parseSelectOption","peg$parseFilterByOption","peg$parseExpandOption","peg$parseSortOption","peg$parseTopOption","peg$parseSkipOption","peg$parseCountOption","peg$parseInlineCountOption","peg$parseFormatOption","peg$parseOperationParam","peg$parseParameterAliasOption","peg$parseText","peg$parseNumber","peg$parseBoolean","peg$parseQuotedText","peg$parseDate","s6","peg$parseSortProperty","peg$parsePropertyPath","peg$parsespaces","peg$parseUnsignedInteger","peg$parseExpandPropertyPathList","peg$parsePropertyPathList","peg$parseFilterByExpression","peg$parseContentType","s7","s8","substring","s9","peg$parseFilterByValue","peg$parseFilterByOperand","peg$parseGroupedPrimitive","peg$parseGroupedPrecedenceExpression","peg$parseFilterMethodCallExpression","peg$parseFilterNegateExpression","peg$parseParameterAlias","peg$parsePrimitive","peg$parseQuotedTextBind","peg$parseNumberBind","peg$parseBooleanBind","peg$parseNull","peg$parseDateBind","peg$parseDuration","peg$parseLambdaPropertyPath","s10","s11","peg$parseLambdaMethodCall","peg$parseResourceName","peg$parseResourceMethodCall","peg$parseExpandPropertyPath","peg$parseKey","peg$parseKeyBind","peg$parseNamedKeyBind","peg$parseLinks","peg$parseSubPathSegment","peg$parseContentReference","peg$parseSign","s12","peg$parseApostrophe","peg$parseDurationNumber","cast","ceiling","endswith","fractionalseconds","indexof","isof","maxdatetime","mindatetime","month","round","startswith","substringof","tolower","totaloffsetminutes","totalseconds","toupper","trim","year","mod","ensureError","mapTill","prefer","parseOdata","_memoizedParseOdata","queryParamsIndex","parameterAliases","URLSearchParams","queryParams","startsWith","append","parameterAliasesString","parsed","parsedParams","memoizedOdata2AbstractSQL","$memoizedOdata2AbstractSQL","existingBindVarsLength","_abstractSqlModel","sortedBody","_isChangeSet","changeSet","sortedCS","csReferences","parseODataChangeset","splitApiRoot","contentId","mustExtractHeader","has","defer","parseResult","urlParts","aFrom","copy","propertyNames","propertyName","ensure","getPrototypeOf","plainObject","customCreate","objIsPrototypeOf","isPrototypeOf","nullDesc","__proto__","isNullBase","nullPolyfill","tmpObj1","tmpObj2","isArguments","isString","ArrayIterator","StringIterator","iterable","iteratorSymbol","iterator","autoBind","defineProperties","Iterator","list","__list__","__context__","__nextIndex__","_onAdd","_onDelete","_onClear","_next","__redo__","_unBind","_createResult","done","_resolve","off","redo","stringCoerce","toShortString","resolveMessage","defaultMessage","inputOptions","isOptional","errorMessage","getMemoizedCompileRule","modifiedFields","sqlModelTables","binding","bindValue","referencedName","sqlTableName","sqlFieldName","checkModifiedFields","refs","intersection","partial","express","initialised","Pinejs","passportPinejs","DISABLE_DEFAULT_AUTH","login","xhr","redirect","logout","listen","PORT","prefix","Events","EE","addListener","emitter","event","listener","evt","_events","_eventsCount","clearEvent","eventNames","names","events","handlers","ee","listenerCount","a1","a2","a3","a4","a5","len","removeListener","removeAllListeners","prefixed","fs","host","encodeURI","port","protocol","decodeURI","pathname","client_encoding","hostname","pathnameSplit","ssl","sslcert","sslkey","sslrootcert","sslmode","cert","readFileSync","ca","rejectUnauthorized","getOrCreate","authApiTx","uniqueFields","extraFields","getOrCreatePermission","permissionName","users","permissionsCache","userID","permissionID","apiRoute","modelFile","customCode","nodeRequire","loadConfigFile","configPath","loadApplicationConfig","configObj","argv","__dirname","dirname","cwd","resolvePath","isAbsolute","readFile","migrationsPath","fileNames","readdir","filename","filePath","extname","initSqlPath","cacheFile","PINEJS_CACHE_FILE","SAVE_DEBOUNCE_TIME","saveCache","debounce","writeFile","clearCache","nativeFactTypes","TypeUtils","fetchProcessing","typeFunc","necessity","originalValue","nativeProperties","complexType","component","componentValue","nativeNames","isBuffer","bcrypt","salt","genSalt","parseFloat","mysqlType","websqlType","validateSync","sha256","crypto","createHash","shajs","algorithm","Algorithm","sha","sha1","sha224","sha384","sha512","Sha","rotl5","rotl30","ft","ctor","superCtor","super_","TempCtor","Sha1","rotl1","Sha224","SHA512","Sha384","Length","toLocaleTimeString","AbstractSQLCompiler_1","countFroms","selectQueryNodes","every","fromNode","whereNodes","whereNode","convertReferencedFieldsToFields","getScope","rulePart","scope","fromNodes","nested","$getReferencedFields","dealiasTableNode","deletable","Set","refFields","checkQuery","froms","translate","LFOptimiser","AttrConceptType","termName","conceptType","primitives","AttrDatabaseAttribute","attrVal","newAttrVal","attributes","AttrDatabasePrimitive","AttrTermForm","termForms","UniversalQuantification","AtMostNQuantification","maxCard","CardinalityOptimisation2","v1","actualFactType","atomicForm","card","v2","uniqueKeys","CardinalityOptimisation","NecessityOptimisation","ObligationOptimisation","Rule","defaultAttributes","attrsFound","attrs","SetHelped","Unique","___MISMATCHED_UNIQUE_KEY___","die","___MISMATCHED_FOREIGN_KEY___","LFValidator","Helped","AtLeastNQuantification","NumericalRangeQuantification","LogicalNegation","ExactQuantification","_didSomething","trans","letters","Model","FactType","Vocabulary","Verb","negated","Disjunction","Conjunction","addAttributes","attrName","DefaultAttr","tableID","AttrDefinition","AttrNecessity","AttrSynonymousForm","synForm","StructuredEnglish","ObligationFormulation","NecessityFormulation","PossibilityFormulation","PermissibilityFormulation","quant","ExistentialQuantification","Cardinality","MinimumCardinality","MaximumCardinality","Variable","RoleBinding","bindIdentifier","AtomicFormulation","termOrVerb","updateModifiedAt","LINK_RESOLVE_QUEUED","LINK_RESOLVE_DONE","Identifier","IdentifierName","identifierName","Attributes","attrOrder","attributeName","attributeVals","each","conceptTable","conceptTerm","identifierTable","referenceScheme","AttrDatabaseIDField","AttrReferenceScheme","AttrDatabaseTableName","baseTable","linkResourceName","attributeTable","AttrForeignKey","factTypeResourceName","fkName","fkTable","foreignTerm","synonymousForms","AddRelationship","synResourceName","reverseReferences","GetReference","AttrUnique","uniqueField","AttrSynonym","fromTable","linkRef","linkTable","termForm","linkVerb","hasFactType","extraFactType","termTable","FactTypeFieldName","linkHasFactType","linkVerbFactType","cardinality","checkConceptTypeResolver","selectBody","varNum","whereBody","bindAttributes","RoleBindings","baseTermName","baseBind","conceptTypeResolver","conceptTypeResolvers","used","NativeNameBinding","ReconstructIdentifier","NativeProperty","operator","NativeFactType","secondPrimitive","___NativeFactTypeMatchingFailed___","LinkTableAlias","bindNumbers","identifierType","partAlias","LinkTable","baseIdentifierName","partName","CreateLinkTableResolver","bindFrom","bindTo","tableTo","___ForeignKeyMatchingFailed___","BooleanAttribute","___BooleanAttributeMatchingFailed___","Attribute","bindAttr","bindReal","___AttributeMatchingFailed___","AtLeast","minCard","variable","Exactly","Range","Negation","RulePart","RuleBody","ProcessAtomicFormulations","bindAttributeDepth","nonPrimitiveExists","ProcessAtomicFormulationsRecurse","depth","unmappedFactType","ProcessAtomicFormulationsNonPrimitive","ProcessAtomicFormulationsAttributes","attrBinding","attrFieldName","baseAttrFactType","baseBinding","bindNumber","ProcessAtomicFormulationsNativeProperties","ruleText","trigger_update_modified_at","CreateTable","AddTableField","AddTableTrigger","forceHas","strippedFactType","relationReference","AddWhereClause","CreateConceptTypesResolver","parentAlias","concept","conceptTypeResolutions","untilConcept","conceptAlias","ResolveLinkTable","linkTableResolvers","linkTableAlias","linkTableResolver","existingLinkTableResolver","ResetRuleState","extensions","configure","conf","force","extFn","__profiler__","updateEnv","memoized","objPropertyIsEnumerable","propertyIsEnumerable","defVal","compareFn","customError","defineLength","resolveResolve","resolveNormalize","original","memLength","del","extDel","extGet","extHas","getListeners","setListeners","deleteListeners","profileName","oldCache","__memoized__","_get","_has","foo","bar","trzy","dest","isPrototype","searchString","descriptor","descriptors","base","__eeOnceListener__","__ee__","candidate","arrayLike","arr","validValue","mapFn","Context","getIterator","global","validTypes","toPrimitive","naiveFallback","__global__","validateSymbol","NativeSymbol","generateName","setupStandardSymbols","setupSymbolRegistry","SymbolPolyfill","HiddenSymbol","isNativeSafe","__description__","__name__","valueOf","objPrototype","created","postfix","ie11BugWorkaround","hasInstance","isConcatSpreadable","search","species","unscopables","registry","for","keyFor","isFunctionStringTag","currentLength","lastId","NaN","argsMap","objectMap","tbi","waiting","currentCallback","currentContext","currentArgs","origCb","primitiveSet","ensureString","supportedModes","isFailed","onSuccess","onFailure","resolvedMode","nextTickFailure","finally","ensureValue","stringifiable","isCallable","safeToString","reNewLine","resultArray","timeouts","preFetchAge","preFetchTimeouts","unref","preFetch","maxTimeout","toPosInteger","lruQueue","hit","oldIndex","nuIndex","deleteRef","getRefCount","Charset","safeRandomBytes","randomBytes","charset","chars","capitalization","setType","setcapitalization","readable","removeUnreadable","removeDuplicates","charsLen","maxByte","ceil","randomByte","readUInt8","arrayUniq","numbers","charsLower","charsUpper","hexChars","unreadableChars","charMap","uniqNoSet","ret","uniqSet","seen","uniqSetWithForEach","doesForEachActuallyWork","EOL","EOLSpaces","eol","IdentifierKey","identifierKey","varNumber","ruleVars","toSBVREOL","toEOL","AddIdentifier","_AddIdentifier","InformalIdentifier","factTypeSoFar","noAutoComplete","FindIdentifier","quote","FindIdentifierNest","identifierSoFar","longestIdentifier","FindVocabulary","bracket","FindVocabularyNest","vocabularySoFar","IdentifierPart","addVerb","FindVerb","bracketed","verbSoFar","_verbForm","JoiningQuantifier","Quantifier","Keyword","word","noToken","addThat","addThe","DisableCommas","disableCommas","addComma","CreateVar","ruleVarsCount","EmbedVar","IsAtomicFormulation","ClosedProjection","TermEntity","thatLF","varLF","parentIdentifier","parentBind","termEntity","VerbContinuation","Modifier","JunctionType","SerialCommaCheck","UpcomingCommaJunction","SimpleJunction","junctioned","Junction","commaSeparated","upcoming","StartRule","NewRule","StartFactType","NewFactType","synFactType","StartVocabulary","StartTerm","StartName","NewIdentifier","func","NewAttribute","attrValOrFunc","currentLine","lines","lastLine","AllowedAttrs","identifierVocab","termVocab","moreValues","AttrGuidanceType","StartComment","NewComment","EOLTerminator","Terminator","Line","ClearSuggestions","builtInVocab","builtInVocabInputHead","allowedAttrLists","defaultAllowedAttrLists","_sideEffectingRules","pluralize","BaseSynonym","identifiers","singularize","IsFactTypeIdentifier","baseIdentifier","IsVerb","IsFactType","removeRegex","getValidFactTypeParts","factTypeParts","followChildrenChain","factTypePartVocabulary","origInputHead","attachedTo","matchForAny","matchForAll","InflectionJS","uncountable_words","plural_rules","singular_rules","non_titlecased_words","id_suffix","underbar","space_or_underbar","uppercase","underbar_prefix","apply_rules","skip","compareFunc","_uncountable_words","_plural_rules","_singular_rules","_non_titlecased_words","plural","thisString","singular","camelize","lowFirstLetter","str_path","str_arr","initX","underscore","humanize","dasherize","titleize","demodulize","tableize","classify","foreign_key","dropIdUbar","ordinalize","ltd","ld","suf","getResourceName","forEachUniqueTable","usedTableNames","complexTypes","resolveDataType","associations","_key","ends","WeakMap","memoizer","weakMap","randomUniq","forOf","toStringTagSymbol","isNative","WeakMapPoly","__weakMapData__","shim","nullObject","polyProps","generated","random","kind","__kind__","ensurePlainFunction","normalizeOptions","define","dgs","overwriteDefinition","resolveContext","resolveException","is","objectToString","valueToString","error2","__length__","isIterable","doBreak","broken","checkForExpansion","parentResourceName","mappingResourceName","expandedField","__deferred","encodeURIComponent","getLocalFields","localFields","getFetchProcessingFields","fetchProcessingFields","fromPairs","$count","sqlResourceName","processedFields","expandableFields","__metadata","webpackEmptyContext","Store","sessionModel","asCallback","$err","sid","session","session_id","expiry_time","cookie","expires","put","destroy","$ge","sessions","uiModel","isServerOnAir","$resolve","serverIsOnAir","onAir","uiApi","ui","devApi","setupModels","uiApiTx","instance","patch","is_disabled","dropTable","queries","exported","insQuery","currRow","notFirst","valQuery","transactionModel","endTransaction","transactionID","placeholders","getLockedRow","lockID","getFieldsObject","conditionalResourceID","fieldsObject","field_name","fieldValue","field_value","modelField","resolvedID","conditionalResources","conditionalResource","placeholder","$reject","lock","doCleanup","resource_type","conditional_type","lockedResult","lockedRow","resource_id","transactionURI","conditionalResourceURI","conditionalFieldURI","lockURI","transactionLockURI","lockResourceURI","exclusiveLockURI","commitTransactionURI","loggedIn","loggedInUser","use","GLOBAL_PERMISSIONS","ready","enabled","appVars","USE","addHandler","handlerName","middleware","newMatch","paramMatch","flattenDeep","_user","statusCode","methodHandlers","route","checkMethodHandlers"],"mappings":"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","file":"out/pine.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 75);\n","module.exports = require(\"lodash\");","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.validate = exports.nativeFactTypeTemplates = void 0;\nconst equality = (from, to) => ['Equals', from, to];\nconst checkRequired = (validateFn) => {\n    async function runCheck(value, required) {\n        if (value == null) {\n            if (required) {\n                throw new Error('cannot be null');\n            }\n            return null;\n        }\n        return validateFn(value);\n    }\n    return runCheck;\n};\nexports.nativeFactTypeTemplates = {\n    equality: {\n        'is equal to': equality,\n        equals: equality,\n    },\n    comparison: {\n        'is greater than': (from, to) => ['GreaterThan', from, to],\n        'is greater than or equal to': (from, to) => [\n            'GreaterThanOrEqual',\n            from,\n            to,\n        ],\n        'is less than': (from, to) => ['LessThan', from, to],\n        'is less than or equal to': (from, to) => [\n            'LessThanOrEqual',\n            from,\n            to,\n        ],\n        'is equal to': equality,\n        equals: equality,\n    },\n};\nexports.validate = {\n    checkRequired,\n    integer: checkRequired((value) => {\n        const processedValue = parseInt(value, 10);\n        if (Number.isNaN(processedValue)) {\n            throw new Error('is not a number: ' + value);\n        }\n        return processedValue;\n    }),\n    text: (length) => checkRequired((value) => {\n        if (typeof value !== 'string') {\n            throw new Error('is not a string: ' + value);\n        }\n        if (length != null && value.length > length) {\n            throw new Error('longer than ' + length + ' characters (' + value.length + ')');\n        }\n        return value;\n    }),\n    date: checkRequired((value) => {\n        let processedValue = Number(value);\n        if (Number.isNaN(processedValue)) {\n            processedValue = value;\n        }\n        const processedDate = new Date(processedValue);\n        if (Number.isNaN(processedDate.getTime())) {\n            throw new Error('is not a valid date: ' + value);\n        }\n        return processedDate;\n    }),\n};\n//# sourceMappingURL=type-utils.js.map","\"use strict\";\n\nmodule.exports = function (fn) {\n\tif (typeof fn !== \"function\") throw new TypeError(fn + \" is not a function\");\n\treturn fn;\n};\n","\"use strict\";\n\nvar isValue         = require(\"type/value/is\")\n  , isPlainFunction = require(\"type/plain-function/is\")\n  , assign          = require(\"es5-ext/object/assign\")\n  , normalizeOpts   = require(\"es5-ext/object/normalize-options\")\n  , contains        = require(\"es5-ext/string/#/contains\");\n\nvar d = (module.exports = function (dscr, value/*, options*/) {\n\tvar c, e, w, options, desc;\n\tif (arguments.length < 2 || typeof dscr !== \"string\") {\n\t\toptions = value;\n\t\tvalue = dscr;\n\t\tdscr = null;\n\t} else {\n\t\toptions = arguments[2];\n\t}\n\tif (isValue(dscr)) {\n\t\tc = contains.call(dscr, \"c\");\n\t\te = contains.call(dscr, \"e\");\n\t\tw = contains.call(dscr, \"w\");\n\t} else {\n\t\tc = w = true;\n\t\te = false;\n\t}\n\n\tdesc = { value: value, configurable: c, enumerable: e, writable: w };\n\treturn !options ? desc : assign(normalizeOpts(options), desc);\n});\n\nd.gs = function (dscr, get, set/*, options*/) {\n\tvar c, e, options, desc;\n\tif (typeof dscr !== \"string\") {\n\t\toptions = set;\n\t\tset = get;\n\t\tget = dscr;\n\t\tdscr = null;\n\t} else {\n\t\toptions = arguments[3];\n\t}\n\tif (!isValue(get)) {\n\t\tget = undefined;\n\t} else if (!isPlainFunction(get)) {\n\t\toptions = get;\n\t\tget = set = undefined;\n\t} else if (!isValue(set)) {\n\t\tset = undefined;\n\t} else if (!isPlainFunction(set)) {\n\t\toptions = set;\n\t\tset = undefined;\n\t}\n\tif (isValue(dscr)) {\n\t\tc = contains.call(dscr, \"c\");\n\t\te = contains.call(dscr, \"e\");\n\t} else {\n\t\tc = true;\n\t\te = false;\n\t}\n\n\tdesc = { get: get, set: set, configurable: c, enumerable: e };\n\treturn !options ? desc : assign(normalizeOpts(options), desc);\n};\n","\"use strict\";\n\nvar isValue = require(\"./is-value\");\n\nmodule.exports = function (value) {\n\tif (!isValue(value)) throw new TypeError(\"Cannot use null or undefined\");\n\treturn value;\n};\n","import type * as Express from 'express';\r\nimport type * as Db from '../database-layer/db';\r\nimport type { Model } from '../config-loader/config-loader';\r\nimport type { AnyObject, RequiredField } from './common-types';\r\n\r\ndeclare global {\r\n\tnamespace Express {\r\n\t\texport interface Request {\r\n\t\t\ttx?: Db.Tx;\r\n\t\t\tbatch?: uriParser.UnparsedRequest[];\r\n\t\t}\r\n\t}\r\n}\r\n\r\nimport * as Bluebird from 'bluebird';\r\nimport * as _ from 'lodash';\r\n\r\nimport { TypedError } from 'typed-error';\r\nimport { cachedCompile } from './cached-compile';\r\n\r\ntype LFModel = any[];\r\nimport * as AbstractSQLCompiler from '@balena/abstract-sql-compiler';\r\nimport { version as AbstractSQLCompilerVersion } from '@balena/abstract-sql-compiler/package.json';\r\nimport * as LF2AbstractSQL from '@balena/lf-to-abstract-sql';\r\n\r\nimport {\r\n\todataNameToSqlName,\r\n\tsqlNameToODataName,\r\n\tSupportedMethod,\r\n} from '@balena/odata-to-abstract-sql';\r\nimport * as sbvrTypes from '@balena/sbvr-types';\r\nimport deepFreeze = require('deep-freeze');\r\nimport { PinejsClientCore, PromiseResultTypes } from 'pinejs-client-core';\r\n\r\nimport { ExtendedSBVRParser } from '../extended-sbvr-parser/extended-sbvr-parser';\r\n\r\nimport * as migrator from '../migrator/migrator';\r\nimport { generateODataMetadata } from '../odata-metadata/odata-metadata-generator';\r\n\r\n// tslint:disable-next-line:no-var-requires\r\nconst devModel = require('./dev.sbvr');\r\nimport * as permissions from './permissions';\r\nimport {\r\n\tBadRequestError,\r\n\tConflictError,\r\n\tHttpError,\r\n\tInternalRequestError,\r\n\tMethodNotAllowedError,\r\n\tNotFoundError,\r\n\tParsingError,\r\n\tPermissionError,\r\n\tPermissionParsingError,\r\n\tSbvrValidationError,\r\n\tSqlCompilationError,\r\n\tstatusCodeToError,\r\n\tTranslationError,\r\n\tUnauthorizedError,\r\n} from './errors';\r\nimport * as uriParser from './uri-parser';\r\nimport {\r\n\tHookReq,\r\n\tHookArgs,\r\n\trollbackRequestHooks,\r\n\tgetHooks,\r\n\trunHooks,\r\n} from './hooks';\r\nexport {\r\n\tHookReq,\r\n\tHookArgs,\r\n\tHookResponse,\r\n\tHooks,\r\n\taddPureHook,\r\n\taddSideEffectHook,\r\n} from './hooks';\r\n// TODO-MAJOR: Remove\r\nexport type HookRequest = uriParser.ODataRequest;\r\n\r\nimport memoizeWeak = require('memoizee/weak');\r\nimport * as controlFlow from './control-flow';\r\n\r\nexport let db = (undefined as any) as Db.Database;\r\n\r\nexport { sbvrTypes };\r\n\r\nimport { version as LF2AbstractSQLVersion } from '@balena/lf-to-abstract-sql/package.json';\r\nimport { version as sbvrTypesVersion } from '@balena/sbvr-types/package.json';\r\nimport {\r\n\tcompileRequest,\r\n\tgetAndCheckBindValues,\r\n\tisRuleAffected,\r\n} from './abstract-sql';\r\nexport { resolveOdataBind } from './abstract-sql';\r\nimport * as odataResponse from './odata-response';\r\nimport { env } from '../server-glue/module';\r\n\r\nconst LF2AbstractSQLTranslator = LF2AbstractSQL.createTranslator(sbvrTypes);\r\nconst LF2AbstractSQLTranslatorVersion = `${LF2AbstractSQLVersion}+${sbvrTypesVersion}`;\r\n\r\nexport type ExecutableModel =\r\n\t| RequiredField<Model, 'apiRoot' | 'modelText'>\r\n\t| RequiredField<Model, 'apiRoot' | 'abstractSql'>;\r\n\r\ninterface CompiledModel {\r\n\tvocab: string;\r\n\tse?: string;\r\n\tlf?: LFModel;\r\n\tabstractSql: AbstractSQLCompiler.AbstractSqlModel;\r\n\tsql: AbstractSQLCompiler.SqlModel;\r\n\todataMetadata: ReturnType<typeof generateODataMetadata>;\r\n}\r\nconst models: {\r\n\t[vocabulary: string]: CompiledModel;\r\n} = {};\r\n\r\nexport interface Actor {\r\n\tpermissions?: string[];\r\n}\r\n\r\nexport interface User extends Actor {\r\n\tid: number;\r\n\tactor: number;\r\n}\r\n\r\nexport interface ApiKey extends Actor {\r\n\tkey: string;\r\n\tactor?: number;\r\n}\r\n\r\ninterface Response {\r\n\tstatus?: number;\r\n\theaders?: {\r\n\t\t[headerName: string]: any;\r\n\t};\r\n\tbody?: AnyObject | string;\r\n}\r\n\r\nconst memoizedResolvedSynonym = memoizeWeak(\r\n\t(\r\n\t\tabstractSqlModel: AbstractSQLCompiler.AbstractSqlModel,\r\n\t\tresourceName: string,\r\n\t): string => {\r\n\t\tconst sqlName = odataNameToSqlName(resourceName);\r\n\t\treturn _(sqlName)\r\n\t\t\t.split('-')\r\n\t\t\t.map((namePart) => {\r\n\t\t\t\tconst synonym = abstractSqlModel.synonyms[namePart];\r\n\t\t\t\tif (synonym != null) {\r\n\t\t\t\t\treturn synonym;\r\n\t\t\t\t}\r\n\t\t\t\treturn namePart;\r\n\t\t\t})\r\n\t\t\t.join('-');\r\n\t},\r\n\t{ primitive: true },\r\n);\r\n\r\nexport const resolveSynonym = (\r\n\trequest: Pick<\r\n\t\turiParser.ODataRequest,\r\n\t\t'abstractSqlModel' | 'resourceName' | 'vocabulary'\r\n\t>,\r\n): string => {\r\n\tconst abstractSqlModel = getAbstractSqlModel(request);\r\n\treturn memoizedResolvedSynonym(abstractSqlModel, request.resourceName);\r\n};\r\n\r\nconst memoizedResolveNavigationResource = memoizeWeak(\r\n\t(\r\n\t\tabstractSqlModel: AbstractSQLCompiler.AbstractSqlModel,\r\n\t\tresourceName: string,\r\n\t\tnavigationName: string,\r\n\t): string => {\r\n\t\tconst navigation = _(odataNameToSqlName(navigationName))\r\n\t\t\t.split('-')\r\n\t\t\t.flatMap((namePart) =>\r\n\t\t\t\tmemoizedResolvedSynonym(abstractSqlModel, namePart).split('-'),\r\n\t\t\t)\r\n\t\t\t.concat('$')\r\n\t\t\t.value();\r\n\t\tconst resolvedResourceName = memoizedResolvedSynonym(\r\n\t\t\tabstractSqlModel,\r\n\t\t\tresourceName,\r\n\t\t);\r\n\t\tconst mapping = _.get(\r\n\t\t\tabstractSqlModel.relationships[resolvedResourceName],\r\n\t\t\tnavigation,\r\n\t\t) as undefined | AbstractSQLCompiler.RelationshipMapping;\r\n\t\tif (mapping == null) {\r\n\t\t\tthrow new Error(\r\n\t\t\t\t`Cannot navigate from '${resourceName}' to '${navigationName}'`,\r\n\t\t\t);\r\n\t\t}\r\n\t\tif (mapping.length < 2) {\r\n\t\t\tthrow new Error(\r\n\t\t\t\t`'${resourceName}' to '${navigationName}' is a field not a navigation`,\r\n\t\t\t);\r\n\t\t}\r\n\t\t// we do check the length above, but typescript thinks the second\r\n\t\t// element could be undefined\r\n\t\treturn sqlNameToODataName(abstractSqlModel.tables[mapping[1]![0]].name);\r\n\t},\r\n\t{ primitive: true },\r\n);\r\nexport const resolveNavigationResource = (\r\n\trequest: Pick<\r\n\t\turiParser.ODataRequest,\r\n\t\t'resourceName' | 'vocabulary' | 'abstractSqlModel'\r\n\t>,\r\n\tnavigationName: string,\r\n): string => {\r\n\tconst abstractSqlModel = getAbstractSqlModel(request);\r\n\treturn memoizedResolveNavigationResource(\r\n\t\tabstractSqlModel,\r\n\t\trequest.resourceName,\r\n\t\tnavigationName,\r\n\t);\r\n};\r\n\r\n// TODO: Clean this up and move it into the db module.\r\nconst prettifyConstraintError = (\r\n\terr: Error | TypedError,\r\n\trequest: uriParser.ODataRequest,\r\n) => {\r\n\tif (err instanceof db.ConstraintError) {\r\n\t\tlet matches: RegExpExecArray | null = null;\r\n\t\tif (err instanceof db.UniqueConstraintError) {\r\n\t\t\tswitch (db.engine) {\r\n\t\t\t\tcase 'mysql':\r\n\t\t\t\t\tmatches = /ER_DUP_ENTRY: Duplicate entry '.*?[^\\\\]' for key '(.*?[^\\\\])'/.exec(\r\n\t\t\t\t\t\terr.message,\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'postgres':\r\n\t\t\t\t\tconst resourceName = resolveSynonym(request);\r\n\t\t\t\t\tconst abstractSqlModel = getAbstractSqlModel(request);\r\n\t\t\t\t\tmatches = new RegExp(\r\n\t\t\t\t\t\t'\"' + abstractSqlModel.tables[resourceName].name + '_(.*?)_key\"',\r\n\t\t\t\t\t).exec(err.message);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\t// We know it's the right error type, so if matches exists just throw a generic error message, since we have failed to get the info for a more specific one.\r\n\t\t\tif (matches == null) {\r\n\t\t\t\tthrow new db.UniqueConstraintError('Unique key constraint violated');\r\n\t\t\t}\r\n\t\t\tconst columns = matches[1].split('_');\r\n\t\t\tthrow new db.UniqueConstraintError(\r\n\t\t\t\t'\"' +\r\n\t\t\t\t\tcolumns.map(sqlNameToODataName).join('\" and \"') +\r\n\t\t\t\t\t'\" must be unique.',\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tif (err instanceof db.ForeignKeyConstraintError) {\r\n\t\t\tswitch (db.engine) {\r\n\t\t\t\tcase 'mysql':\r\n\t\t\t\t\tmatches = /ER_ROW_IS_REFERENCED_: Cannot delete or update a parent row: a foreign key constraint fails \\(\".*?\"\\.(\".*?\").*/.exec(\r\n\t\t\t\t\t\terr.message,\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'postgres':\r\n\t\t\t\t\tconst resourceName = resolveSynonym(request);\r\n\t\t\t\t\tconst abstractSqlModel = getAbstractSqlModel(request);\r\n\t\t\t\t\tconst tableName = abstractSqlModel.tables[resourceName].name;\r\n\t\t\t\t\tmatches = new RegExp(\r\n\t\t\t\t\t\t'\"' +\r\n\t\t\t\t\t\t\ttableName +\r\n\t\t\t\t\t\t\t'\" violates foreign key constraint \".*?\" on table \"(.*?)\"',\r\n\t\t\t\t\t).exec(err.message);\r\n\t\t\t\t\tif (matches == null) {\r\n\t\t\t\t\t\tmatches = new RegExp(\r\n\t\t\t\t\t\t\t'\"' +\r\n\t\t\t\t\t\t\t\ttableName +\r\n\t\t\t\t\t\t\t\t'\" violates foreign key constraint \"' +\r\n\t\t\t\t\t\t\t\ttableName +\r\n\t\t\t\t\t\t\t\t'_(.*?)_fkey\"',\r\n\t\t\t\t\t\t).exec(err.message);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\t// We know it's the right error type, so if no matches exists just throw a generic error message,\r\n\t\t\t// since we have failed to get the info for a more specific one.\r\n\t\t\tif (matches == null) {\r\n\t\t\t\tthrow new db.ForeignKeyConstraintError(\r\n\t\t\t\t\t'Foreign key constraint violated',\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\tthrow new db.ForeignKeyConstraintError(\r\n\t\t\t\t'Data is referenced by ' + sqlNameToODataName(matches[1]) + '.',\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tif (err instanceof db.CheckConstraintError) {\r\n\t\t\tconst resourceName = resolveSynonym(request);\r\n\t\t\tconst abstractSqlModel = getAbstractSqlModel(request);\r\n\t\t\tconst table = abstractSqlModel.tables[resourceName];\r\n\t\t\tif (table.checks) {\r\n\t\t\t\tswitch (db.engine) {\r\n\t\t\t\t\tcase 'postgres':\r\n\t\t\t\t\t\tmatches = new RegExp(\r\n\t\t\t\t\t\t\t'new row for relation \"' +\r\n\t\t\t\t\t\t\t\ttable.name +\r\n\t\t\t\t\t\t\t\t'\" violates check constraint \"(.*?)\"',\r\n\t\t\t\t\t\t).exec(err.message);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (matches != null) {\r\n\t\t\t\tconst checkName = matches[1];\r\n\t\t\t\tconst check = table.checks!.find((c) => c.name === checkName);\r\n\t\t\t\tif (check?.description != null) {\r\n\t\t\t\t\tthrow new BadRequestError(check.description);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// We know it's the right error type, so just throw a generic error message\r\n\t\t\t// if we have failed to get the info for a more specific one.\r\n\t\t\tthrow new BadRequestError('Check constraint violated');\r\n\t\t}\r\n\r\n\t\t// Override the error message so we don't leak any internal db info\r\n\t\terr.message = 'Constraint failed';\r\n\t\tthrow err;\r\n\t}\r\n};\r\n\r\nexport const validateModel = async (\r\n\ttx: Db.Tx,\r\n\tmodelName: string,\r\n\trequest?: uriParser.ODataRequest,\r\n): Promise<void> => {\r\n\tawait Promise.all(\r\n\t\tmodels[modelName].sql.rules.map(async (rule) => {\r\n\t\t\tif (!isRuleAffected(rule, request)) {\r\n\t\t\t\t// If none of the fields intersect we don't need to run the rule! :D\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst values = await getAndCheckBindValues(\r\n\t\t\t\t{\r\n\t\t\t\t\tvocabulary: modelName,\r\n\t\t\t\t\todataBinds: [],\r\n\t\t\t\t\tvalues: {},\r\n\t\t\t\t\tengine: db.engine,\r\n\t\t\t\t},\r\n\t\t\t\trule.bindings,\r\n\t\t\t);\r\n\t\t\tconst result = await tx.executeSql(rule.sql, values);\r\n\r\n\t\t\tconst v = result.rows[0].result;\r\n\t\t\tif (v === false || v === 0 || v === '0') {\r\n\t\t\t\tthrow new SbvrValidationError(rule.structuredEnglish);\r\n\t\t\t}\r\n\t\t}),\r\n\t);\r\n};\r\n\r\nexport const generateLfModel = (seModel: string): LFModel =>\r\n\tcachedCompile('lfModel', ExtendedSBVRParser.version, seModel, () =>\r\n\t\tExtendedSBVRParser.matchAll(seModel, 'Process'),\r\n\t);\r\n\r\nexport const generateAbstractSqlModel = (\r\n\tlfModel: LFModel,\r\n): AbstractSQLCompiler.AbstractSqlModel =>\r\n\tcachedCompile(\r\n\t\t'abstractSqlModel',\r\n\t\tLF2AbstractSQLTranslatorVersion,\r\n\t\tlfModel,\r\n\t\t() => LF2AbstractSQLTranslator(lfModel, 'Process'),\r\n\t);\r\n\r\nexport const generateSqlModel = (\r\n\tabstractSql: AbstractSQLCompiler.AbstractSqlModel,\r\n\ttargetDatabaseEngine: AbstractSQLCompiler.Engines,\r\n): AbstractSQLCompiler.SqlModel =>\r\n\tcachedCompile(\r\n\t\t'sqlModel',\r\n\t\tAbstractSQLCompilerVersion + '+' + targetDatabaseEngine,\r\n\t\tabstractSql,\r\n\t\t() => AbstractSQLCompiler[targetDatabaseEngine].compileSchema(abstractSql),\r\n\t);\r\n\r\nexport const generateModels = (\r\n\tmodel: ExecutableModel,\r\n\ttargetDatabaseEngine: AbstractSQLCompiler.Engines,\r\n): CompiledModel => {\r\n\tconst { apiRoot: vocab, modelText: se } = model;\r\n\tlet { abstractSql: maybeAbstractSql } = model;\r\n\r\n\tlet lf: ReturnType<typeof generateLfModel> | undefined;\r\n\tif (se) {\r\n\t\ttry {\r\n\t\t\tlf = generateLfModel(se);\r\n\t\t} catch (e) {\r\n\t\t\tconsole.error(`Error parsing model '${vocab}':`, e);\r\n\t\t\tthrow new Error(`Error parsing model '${vocab}': ` + e);\r\n\t\t}\r\n\r\n\t\ttry {\r\n\t\t\tmaybeAbstractSql = generateAbstractSqlModel(lf);\r\n\t\t} catch (e) {\r\n\t\t\tconsole.error(`Error translating model '${vocab}':`, e);\r\n\t\t\tthrow new Error(`Error translating model '${vocab}': ` + e);\r\n\t\t}\r\n\t}\r\n\tconst abstractSql = maybeAbstractSql!;\r\n\r\n\tconst odataMetadata = cachedCompile(\r\n\t\t'metadata',\r\n\t\tgenerateODataMetadata.version,\r\n\t\t{ vocab, abstractSqlModel: abstractSql },\r\n\t\t() => generateODataMetadata(vocab, abstractSql),\r\n\t);\r\n\r\n\tlet sql: ReturnType<AbstractSQLCompiler.EngineInstance['compileSchema']>;\r\n\ttry {\r\n\t\tsql = generateSqlModel(abstractSql, targetDatabaseEngine);\r\n\t} catch (e) {\r\n\t\tconsole.error(`Error compiling model '${vocab}':`, e);\r\n\t\tthrow new Error(`Error compiling model '${vocab}': ` + e);\r\n\t}\r\n\r\n\treturn { vocab, se, lf, abstractSql, sql, odataMetadata };\r\n};\r\n\r\nexport const executeModel = (\r\n\ttx: Db.Tx,\r\n\tmodel: ExecutableModel,\r\n): Promise<void> => executeModels(tx, [model]);\r\n\r\nexport const executeModels = async (\r\n\ttx: Db.Tx,\r\n\texecModels: ExecutableModel[],\r\n): Promise<void> => {\r\n\ttry {\r\n\t\tconst compiledModels = await Promise.all(\r\n\t\t\texecModels.map(async (model) => {\r\n\t\t\t\tconst { apiRoot } = model;\r\n\r\n\t\t\t\tawait migrator.run(tx, model);\r\n\t\t\t\tconst compiledModel = generateModels(model, db.engine);\r\n\r\n\t\t\t\t// Create tables related to terms and fact types\r\n\t\t\t\t// Run statements sequentially, as the order of the CREATE TABLE statements matters (eg. for foreign keys).\r\n\t\t\t\tfor (const createStatement of compiledModel.sql.createSchema) {\r\n\t\t\t\t\tconst promise = tx.executeSql(createStatement);\r\n\t\t\t\t\tif (db.engine === 'websql') {\r\n\t\t\t\t\t\tpromise.catch((err) => {\r\n\t\t\t\t\t\t\tconsole.warn(\r\n\t\t\t\t\t\t\t\t\"Ignoring errors in the create table statements for websql as it doesn't support CREATE IF NOT EXISTS\",\r\n\t\t\t\t\t\t\t\terr,\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\tawait promise;\r\n\t\t\t\t}\r\n\t\t\t\tawait migrator.postRun(tx, model);\r\n\r\n\t\t\t\todataResponse.prepareModel(compiledModel.abstractSql);\r\n\t\t\t\tdeepFreeze(compiledModel.abstractSql);\r\n\t\t\t\tmodels[apiRoot] = compiledModel;\r\n\r\n\t\t\t\t// Validate the [empty] model according to the rules.\r\n\t\t\t\t// This may eventually lead to entering obligatory data.\r\n\t\t\t\t// For the moment it blocks such models from execution.\r\n\t\t\t\tawait validateModel(tx, apiRoot);\r\n\r\n\t\t\t\t// TODO: Can we do this without the cast?\r\n\t\t\t\tapi[apiRoot] = new PinejsClient('/' + apiRoot + '/') as LoggingClient;\r\n\t\t\t\tapi[apiRoot].logger = { ...console };\r\n\t\t\t\tif (model.logging != null) {\r\n\t\t\t\t\tconst defaultSetting = model.logging?.default ?? true;\r\n\t\t\t\t\tfor (const k of Object.keys(model.logging)) {\r\n\t\t\t\t\t\tconst key = k as keyof Console;\r\n\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\ttypeof api[apiRoot].logger[key] === 'function' &&\r\n\t\t\t\t\t\t\t!(model.logging?.[key] ?? defaultSetting)\r\n\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\tapi[apiRoot].logger[key] = _.noop;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn compiledModel;\r\n\t\t\t\t// Only update the dev models once all models have finished executing.\r\n\t\t\t}),\r\n\t\t);\r\n\t\tawait Promise.all(\r\n\t\t\tcompiledModels.map(async (model: CompiledModel) => {\r\n\t\t\t\tconst updateModel = async (modelType: keyof CompiledModel) => {\r\n\t\t\t\t\tif (model[modelType] == null) {\r\n\t\t\t\t\t\treturn await api.dev.delete({\r\n\t\t\t\t\t\t\tresource: 'model',\r\n\t\t\t\t\t\t\tpassthrough: {\r\n\t\t\t\t\t\t\t\ttx,\r\n\t\t\t\t\t\t\t\treq: permissions.root,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\toptions: {\r\n\t\t\t\t\t\t\t\t$filter: {\r\n\t\t\t\t\t\t\t\t\tis_of__vocabulary: model.vocab,\r\n\t\t\t\t\t\t\t\t\tmodel_type: modelType,\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst result = (await api.dev.get({\r\n\t\t\t\t\t\tresource: 'model',\r\n\t\t\t\t\t\tpassthrough: {\r\n\t\t\t\t\t\t\ttx,\r\n\t\t\t\t\t\t\treq: permissions.rootRead,\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\toptions: {\r\n\t\t\t\t\t\t\t$select: 'id',\r\n\t\t\t\t\t\t\t$filter: {\r\n\t\t\t\t\t\t\t\tis_of__vocabulary: model.vocab,\r\n\t\t\t\t\t\t\t\tmodel_type: modelType,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t})) as Array<{ id: number }>;\r\n\r\n\t\t\t\t\tlet method: SupportedMethod = 'POST';\r\n\t\t\t\t\tlet uri = '/dev/model';\r\n\t\t\t\t\tconst body: AnyObject = {\r\n\t\t\t\t\t\tis_of__vocabulary: model.vocab,\r\n\t\t\t\t\t\tmodel_value: model[modelType],\r\n\t\t\t\t\t\tmodel_type: modelType,\r\n\t\t\t\t\t};\r\n\t\t\t\t\tconst id = result?.[0]?.id;\r\n\t\t\t\t\tif (id != null) {\r\n\t\t\t\t\t\turi += '(' + id + ')';\r\n\t\t\t\t\t\tmethod = 'PATCH';\r\n\t\t\t\t\t\tbody.id = id;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\turi += '?returnResource=false';\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn await runURI(method, uri, body, tx, permissions.root);\r\n\t\t\t\t};\r\n\r\n\t\t\t\tawait Promise.all(\r\n\t\t\t\t\t['se', 'lf', 'abstractSql', 'sql', 'odataMetadata'].map(updateModel),\r\n\t\t\t\t);\r\n\t\t\t}),\r\n\t\t);\r\n\t} catch (err) {\r\n\t\tawait Promise.all(\r\n\t\t\texecModels.map(async ({ apiRoot }) => {\r\n\t\t\t\tawait cleanupModel(apiRoot);\r\n\t\t\t}),\r\n\t\t);\r\n\t\tthrow err;\r\n\t}\r\n};\r\n\r\nconst cleanupModel = (vocab: string) => {\r\n\tdelete models[vocab];\r\n\tdelete api[vocab];\r\n};\r\n\r\nexport const deleteModel = async (vocabulary: string) => {\r\n\tawait db.transaction(async (tx) => {\r\n\t\tconst dropStatements: Array<Promise<any>> = models[\r\n\t\t\tvocabulary\r\n\t\t].sql.dropSchema.map((dropStatement) => tx.executeSql(dropStatement));\r\n\t\tawait Promise.all(\r\n\t\t\tdropStatements.concat([\r\n\t\t\t\tapi.dev.delete({\r\n\t\t\t\t\tresource: 'model',\r\n\t\t\t\t\tpassthrough: {\r\n\t\t\t\t\t\ttx,\r\n\t\t\t\t\t\treq: permissions.root,\r\n\t\t\t\t\t},\r\n\t\t\t\t\toptions: {\r\n\t\t\t\t\t\t$filter: {\r\n\t\t\t\t\t\t\tis_of__vocabulary: vocabulary,\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t},\r\n\t\t\t\t}),\r\n\t\t\t]),\r\n\t\t);\r\n\t});\r\n\tawait cleanupModel(vocabulary);\r\n};\r\n\r\nconst isWhereNode = (\r\n\tx: AbstractSQLCompiler.AbstractSqlType,\r\n): x is AbstractSQLCompiler.WhereNode => x[0] === 'Where';\r\nconst isEqualsNode = (\r\n\tx: AbstractSQLCompiler.AbstractSqlType,\r\n): x is AbstractSQLCompiler.EqualsNode => x[0] === 'Equals';\r\nexport const getID = (vocab: string, request: uriParser.ODataRequest) => {\r\n\tif (request.abstractSqlQuery == null) {\r\n\t\tthrow new Error('Can only get the id if an abstractSqlQuery is provided');\r\n\t}\r\n\tconst { idField } = models[vocab].abstractSql.tables[request.resourceName];\r\n\tfor (const whereClause of request.abstractSqlQuery) {\r\n\t\tif (isWhereNode(whereClause)) {\r\n\t\t\tfor (const comparison of whereClause.slice(1)) {\r\n\t\t\t\tif (isEqualsNode(comparison)) {\r\n\t\t\t\t\tif (comparison[1][2] === idField) {\r\n\t\t\t\t\t\treturn comparison[2][1];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (comparison[2][2] === idField) {\r\n\t\t\t\t\t\treturn comparison[1][1];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn 0;\r\n};\r\n\r\nexport const runRule = (() => {\r\n\tconst LF2AbstractSQLPrepHack = LF2AbstractSQL.LF2AbstractSQLPrep._extend({\r\n\t\tCardinalityOptimisation() {\r\n\t\t\tthis._pred(false);\r\n\t\t},\r\n\t});\r\n\tconst translator = LF2AbstractSQL.LF2AbstractSQL.createInstance();\r\n\ttranslator.addTypes(sbvrTypes);\r\n\treturn async (vocab: string, rule: string) => {\r\n\t\tconst seModel = models[vocab].se;\r\n\t\tconst { logger } = api[vocab];\r\n\t\tlet lfModel: LFModel;\r\n\t\tlet slfModel: LFModel;\r\n\t\tlet abstractSqlModel: AbstractSQLCompiler.AbstractSqlModel;\r\n\r\n\t\ttry {\r\n\t\t\tlfModel = ExtendedSBVRParser.matchAll(\r\n\t\t\t\tseModel + '\\nRule: ' + rule,\r\n\t\t\t\t'Process',\r\n\t\t\t);\r\n\t\t} catch (e) {\r\n\t\t\tlogger.error('Error parsing rule', rule, e);\r\n\t\t\tthrow new Error(`Error parsing rule'${rule}': ${e}`);\r\n\t\t}\r\n\r\n\t\tconst ruleLF = lfModel.pop();\r\n\r\n\t\ttry {\r\n\t\t\tslfModel = LF2AbstractSQL.LF2AbstractSQLPrep.match(lfModel, 'Process');\r\n\t\t\tslfModel.push(ruleLF);\r\n\t\t\tslfModel = LF2AbstractSQLPrepHack.match(slfModel, 'Process');\r\n\r\n\t\t\ttranslator.reset();\r\n\t\t\tabstractSqlModel = translator.match(slfModel, 'Process');\r\n\t\t} catch (e) {\r\n\t\t\tlogger.error('Error compiling rule', rule, e);\r\n\t\t\tthrow new Error(`Error compiling rule '${rule}': ${e}`);\r\n\t\t}\r\n\r\n\t\tconst formulationType = ruleLF[1][0];\r\n\t\tlet resourceName: string;\r\n\t\tif (ruleLF[1][1][0] === 'LogicalNegation') {\r\n\t\t\tresourceName = ruleLF[1][1][1][1][2][1];\r\n\t\t} else {\r\n\t\t\tresourceName = ruleLF[1][1][1][2][1];\r\n\t\t}\r\n\r\n\t\tlet fetchingViolators = false;\r\n\t\tconst ruleAbs = _.last(abstractSqlModel.rules);\r\n\t\tif (ruleAbs == null) {\r\n\t\t\tthrow new Error('Unable to generate rule');\r\n\t\t}\r\n\t\tconst ruleBody = ruleAbs.find((node) => node[0] === 'Body') as [\r\n\t\t\t'Body',\r\n\t\t\t...any[]\r\n\t\t];\r\n\t\tif (\r\n\t\t\truleBody[1][0] === 'Not' &&\r\n\t\t\truleBody[1][1][0] === 'Exists' &&\r\n\t\t\truleBody[1][1][1][0] === 'SelectQuery'\r\n\t\t) {\r\n\t\t\t// Remove the not exists\r\n\t\t\truleBody[1] = ruleBody[1][1][1];\r\n\t\t\tfetchingViolators = true;\r\n\t\t} else if (\r\n\t\t\truleBody[1][0] === 'Exists' &&\r\n\t\t\truleBody[1][1][0] === 'SelectQuery'\r\n\t\t) {\r\n\t\t\t// Remove the exists\r\n\t\t\truleBody[1] = ruleBody[1][1];\r\n\t\t} else {\r\n\t\t\tthrow new Error('Unsupported rule formulation');\r\n\t\t}\r\n\r\n\t\tconst wantNonViolators =\r\n\t\t\tformulationType in\r\n\t\t\t['PossibilityFormulation', 'PermissibilityFormulation'];\r\n\t\tif (wantNonViolators === fetchingViolators) {\r\n\t\t\t// What we want is the opposite of what we're getting, so add a not to the where clauses\r\n\t\t\truleBody[1] = ruleBody[1].map(\r\n\t\t\t\t(queryPart: AbstractSQLCompiler.AbstractSqlQuery) => {\r\n\t\t\t\t\tif (queryPart[0] !== 'Where') {\r\n\t\t\t\t\t\treturn queryPart;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (queryPart.length > 2) {\r\n\t\t\t\t\t\tthrow new Error('Unsupported rule formulation');\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn ['Where', ['Not', queryPart[1]]];\r\n\t\t\t\t},\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\t// Select all\r\n\t\truleBody[1] = ruleBody[1].map(\r\n\t\t\t(queryPart: AbstractSQLCompiler.AbstractSqlQuery) => {\r\n\t\t\t\tif (queryPart[0] !== 'Select') {\r\n\t\t\t\t\treturn queryPart;\r\n\t\t\t\t}\r\n\t\t\t\treturn ['Select', '*'];\r\n\t\t\t},\r\n\t\t);\r\n\t\tconst compiledRule = AbstractSQLCompiler[db.engine].compileRule(ruleBody);\r\n\t\tif (Array.isArray(compiledRule)) {\r\n\t\t\tthrow new Error('Unexpected query generated');\r\n\t\t}\r\n\t\tconst values = await getAndCheckBindValues(\r\n\t\t\t{\r\n\t\t\t\tvocabulary: vocab,\r\n\t\t\t\todataBinds: [],\r\n\t\t\t\tvalues: {},\r\n\t\t\t\tengine: db.engine,\r\n\t\t\t},\r\n\t\t\tcompiledRule.bindings,\r\n\t\t);\r\n\t\tconst result = await db.executeSql(compiledRule.query, values);\r\n\r\n\t\tconst table = models[vocab].abstractSql.tables[resourceName];\r\n\t\tconst odataIdField = sqlNameToODataName(table.idField);\r\n\t\tlet ids = result.rows.map((row) => row[table.idField]);\r\n\t\tids = _.uniq(ids);\r\n\t\tids = ids.map((id) => odataIdField + ' eq ' + id);\r\n\t\tlet filter: string;\r\n\t\tif (ids.length > 0) {\r\n\t\t\tfilter = ids.join(' or ');\r\n\t\t} else {\r\n\t\t\tfilter = '0 eq 1';\r\n\t\t}\r\n\t\tconst odataResult = (await runURI(\r\n\t\t\t'GET',\r\n\t\t\t'/' +\r\n\t\t\t\tvocab +\r\n\t\t\t\t'/' +\r\n\t\t\t\tsqlNameToODataName(table.resourceName) +\r\n\t\t\t\t'?$filter=' +\r\n\t\t\t\tfilter,\r\n\t\t\tundefined,\r\n\t\t\tundefined,\r\n\t\t\tpermissions.rootRead,\r\n\t\t)) as AnyObject;\r\n\r\n\t\todataResult.__formulationType = formulationType;\r\n\t\todataResult.__resourceName = resourceName;\r\n\t\treturn odataResult;\r\n\t};\r\n})();\r\n\r\nexport type Passthrough = AnyObject & {\r\n\treq?: {\r\n\t\tuser?: User;\r\n\t};\r\n\ttx?: Db.Tx;\r\n};\r\n\r\nexport class PinejsClient extends PinejsClientCore<PinejsClient> {\r\n\tpublic passthrough: Passthrough;\r\n\tpublic async _request({\r\n\t\tmethod,\r\n\t\turl,\r\n\t\tbody,\r\n\t\ttx,\r\n\t\treq,\r\n\t\tcustom,\r\n\t}: {\r\n\t\tmethod: string;\r\n\t\turl: string;\r\n\t\tbody?: AnyObject;\r\n\t\ttx?: Db.Tx;\r\n\t\treq?: permissions.PermissionReq;\r\n\t\tcustom?: AnyObject;\r\n\t}) {\r\n\t\treturn (await runURI(method, url, body, tx, req, custom)) as {};\r\n\t}\r\n}\r\n\r\nexport type LoggingClient = PinejsClient & {\r\n\tlogger: Console;\r\n};\r\nexport const api: {\r\n\t[vocab: string]: LoggingClient;\r\n} = {};\r\n\r\n// We default to guest only permissions if no req object is passed in\r\nexport const runURI = async (\r\n\tmethod: string,\r\n\turi: string,\r\n\tbody: AnyObject = {},\r\n\ttx?: Db.Tx,\r\n\treq?: permissions.PermissionReq,\r\n\tcustom?: AnyObject,\r\n): Promise<PromiseResultTypes> => {\r\n\tconst [, apiRoot] = uri.split('/', 2);\r\n\tif (apiRoot == null || models[apiRoot] == null) {\r\n\t\tthrow new InternalRequestError();\r\n\t}\r\n\r\n\tlet user: User | undefined;\r\n\tlet apiKey: ApiKey | undefined;\r\n\r\n\tif (req != null && _.isObject(req)) {\r\n\t\tuser = req.user;\r\n\t\tapiKey = req.apiKey;\r\n\t} else {\r\n\t\tif (req != null) {\r\n\t\t\tconsole.warn('Non-object req passed to runURI?', req, new Error().stack);\r\n\t\t}\r\n\t\tuser = {\r\n\t\t\tid: 0,\r\n\t\t\tactor: 0,\r\n\t\t\tpermissions: [],\r\n\t\t};\r\n\t}\r\n\r\n\t// Remove undefined values from the body, as normally they would be removed by the JSON conversion\r\n\t_.forEach(body, (v, k) => {\r\n\t\tif (v === undefined) {\r\n\t\t\tdelete body[k];\r\n\t\t}\r\n\t});\r\n\r\n\tconst emulatedReq: Express.Request = {\r\n\t\ton: _.noop,\r\n\t\tcustom,\r\n\t\tuser,\r\n\t\tapiKey,\r\n\t\tmethod,\r\n\t\turl: uri,\r\n\t\tbody,\r\n\t\tparams: {},\r\n\t\tquery: {},\r\n\t\ttx,\r\n\t} as any;\r\n\r\n\tconst { promise } = runODataRequest(emulatedReq, apiRoot);\r\n\r\n\tconst [response] = await promise;\r\n\r\n\tif (_.isError(response)) {\r\n\t\tthrow response;\r\n\t}\r\n\r\n\tconst { body: responseBody, status } = response as Response;\r\n\r\n\tif (status != null && status >= 400) {\r\n\t\tconst ErrorClass =\r\n\t\t\tstatusCodeToError[status as keyof typeof statusCodeToError];\r\n\t\tif (ErrorClass != null) {\r\n\t\t\tthrow new ErrorClass(undefined, responseBody);\r\n\t\t}\r\n\t\tthrow new HttpError(status, undefined, responseBody);\r\n\t}\r\n\r\n\treturn responseBody as AnyObject | undefined;\r\n};\r\n\r\nexport const getAbstractSqlModel = (\r\n\trequest: Pick<uriParser.ODataRequest, 'vocabulary' | 'abstractSqlModel'>,\r\n): AbstractSQLCompiler.AbstractSqlModel => {\r\n\treturn (request.abstractSqlModel ??= models[request.vocabulary].abstractSql);\r\n};\r\n\r\nconst getIdField = (\r\n\trequest: Pick<\r\n\t\turiParser.ODataRequest,\r\n\t\t'vocabulary' | 'abstractSqlModel' | 'resourceName'\r\n\t>,\r\n) => getAbstractSqlModel(request).tables[resolveSynonym(request)].idField;\r\n\r\nexport const getAffectedIds = async (\r\n\targs: HookArgs & {\r\n\t\ttx: Db.Tx;\r\n\t},\r\n): Promise<number[]> => {\r\n\tconst { request } = args;\r\n\tif (request.affectedIds) {\r\n\t\treturn request.affectedIds;\r\n\t}\r\n\r\n\t// We keep the affected ids promise so we only have to fetch them once per request\r\n\tif (request.pendingAffectedIds != null) {\r\n\t\treturn request.pendingAffectedIds;\r\n\t}\r\n\trequest.pendingAffectedIds = $getAffectedIds(args);\r\n\r\n\t// Keep the affected ids and let the promise to be GCed sooner.\r\n\trequest.affectedIds = await request.pendingAffectedIds;\r\n\tdelete request.pendingAffectedIds;\r\n\r\n\treturn request.affectedIds;\r\n};\r\n\r\nconst $getAffectedIds = async ({\r\n\treq,\r\n\trequest,\r\n\ttx,\r\n}: HookArgs & {\r\n\ttx: Db.Tx;\r\n}): Promise<number[]> => {\r\n\tif (request.method === 'GET') {\r\n\t\t// GET requests don't affect anything so passing one to this method is a mistake\r\n\t\tthrow new Error('Cannot call `getAffectedIds` with a GET request');\r\n\t}\r\n\t// We reparse to make sure we get a clean odataQuery, without permissions already added\r\n\t// And we use the request's url rather than the req for things like batch where the req url is ../$batch\r\n\trequest = await uriParser.parseOData({\r\n\t\tmethod: request.method,\r\n\t\turl: `/${request.vocabulary}${request.url}`,\r\n\t});\r\n\r\n\trequest.engine = db.engine;\r\n\tconst abstractSqlModel = getAbstractSqlModel(request);\r\n\tconst resourceName = resolveSynonym(request);\r\n\tconst resourceTable = abstractSqlModel.tables[resourceName];\r\n\tif (resourceTable == null) {\r\n\t\tthrow new Error('Unknown resource: ' + request.resourceName);\r\n\t}\r\n\tconst { idField } = resourceTable;\r\n\r\n\trequest.odataQuery.options ??= {};\r\n\trequest.odataQuery.options.$select = {\r\n\t\tproperties: [{ name: idField }],\r\n\t};\r\n\r\n\t// Delete any $expand that might exist as they're ignored on non-GETs but we're converting this request to a GET\r\n\tdelete request.odataQuery.options.$expand;\r\n\r\n\tawait permissions.addPermissions(req, request);\r\n\r\n\trequest.method = 'GET';\r\n\r\n\trequest = uriParser.translateUri(request);\r\n\trequest = compileRequest(request);\r\n\r\n\tlet result;\r\n\tif (tx != null) {\r\n\t\tresult = await runQuery(tx, request);\r\n\t} else {\r\n\t\tresult = await runTransaction(req, (newTx) => runQuery(newTx, request));\r\n\t}\r\n\treturn result.rows.map((row) => row[idField]);\r\n};\r\n\r\nconst runODataRequest = (req: Express.Request, vocabulary: string) => {\r\n\tif (env.DEBUG) {\r\n\t\tapi[vocabulary].logger.log('Parsing', req.method, req.url);\r\n\t}\r\n\r\n\t// Get the hooks for the current method/vocabulary as we know it,\r\n\t// in order to run PREPARSE hooks, before parsing gets us more info\r\n\tconst reqHooks = getHooks({\r\n\t\tmethod: req.method as SupportedMethod,\r\n\t\tvocabulary,\r\n\t});\r\n\r\n\tconst transactions: Db.Tx[] = [];\r\n\tconst tryCancelRequest = () => {\r\n\t\ttransactions.forEach(async (tx) => {\r\n\t\t\tif (tx.isClosed()) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\ttry {\r\n\t\t\t\tawait tx.rollback();\r\n\t\t\t} catch {\r\n\t\t\t\t// Ignore issues rolling back/cancelling transactions\r\n\t\t\t}\r\n\t\t});\r\n\t\t// Clear the list\r\n\t\ttransactions.length = 0;\r\n\t\trollbackRequestHooks(reqHooks);\r\n\t};\r\n\r\n\treq.on('close', tryCancelRequest);\r\n\r\n\tif (req.tx != null) {\r\n\t\ttransactions.push(req.tx);\r\n\t\treq.tx.on('rollback', tryCancelRequest);\r\n\t}\r\n\r\n\tconst mapSeries = controlFlow.getMappingFn(req.headers);\r\n\r\n\treturn {\r\n\t\ttryCancelRequest,\r\n\t\tpromise: (async () => {\r\n\t\t\tawait runHooks('PREPARSE', reqHooks, { req, tx: req.tx });\r\n\t\t\tlet requests: uriParser.UnparsedRequest[];\r\n\t\t\t// Check if it is a single request or a batch\r\n\t\t\tif (req.batch != null && req.batch.length > 0) {\r\n\t\t\t\trequests = req.batch;\r\n\t\t\t} else {\r\n\t\t\t\tconst { method, url, body } = req;\r\n\t\t\t\trequests = [{ method, url, data: body }];\r\n\t\t\t}\r\n\r\n\t\t\tconst prepareRequest = async ($request: uriParser.ODataRequest) => {\r\n\t\t\t\t$request.engine = db.engine;\r\n\t\t\t\t// Get the full hooks list now that we can.\r\n\t\t\t\t$request.hooks = getHooks($request);\r\n\t\t\t\t// Add/check the relevant permissions\r\n\t\t\t\ttry {\r\n\t\t\t\t\tawait runHooks('POSTPARSE', $request.hooks, {\r\n\t\t\t\t\t\treq,\r\n\t\t\t\t\t\trequest: $request,\r\n\t\t\t\t\t\ttx: req.tx,\r\n\t\t\t\t\t});\r\n\t\t\t\t\tconst translatedRequest = await uriParser.translateUri($request);\r\n\t\t\t\t\treturn await compileRequest(translatedRequest);\r\n\t\t\t\t} catch (err) {\r\n\t\t\t\t\trollbackRequestHooks(reqHooks);\r\n\t\t\t\t\trollbackRequestHooks($request.hooks);\r\n\t\t\t\t\tthrow err;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\t// Parse the OData requests\r\n\t\t\tconst results = await mapSeries(requests, async (requestPart) => {\r\n\t\t\t\tlet request = await uriParser.parseOData(requestPart);\r\n\r\n\t\t\t\tif (Array.isArray(request)) {\r\n\t\t\t\t\trequest = await Bluebird.mapSeries(request, prepareRequest);\r\n\t\t\t\t} else {\r\n\t\t\t\t\trequest = await prepareRequest(request);\r\n\t\t\t\t}\r\n\t\t\t\t// Run the request in its own transaction\r\n\t\t\t\treturn await runTransaction<Response | Response[]>(req, async (tx) => {\r\n\t\t\t\t\ttransactions.push(tx);\r\n\t\t\t\t\ttx.on('rollback', () => {\r\n\t\t\t\t\t\trollbackRequestHooks(reqHooks);\r\n\t\t\t\t\t\tif (Array.isArray(request)) {\r\n\t\t\t\t\t\t\trequest.forEach(({ hooks }) => {\r\n\t\t\t\t\t\t\t\trollbackRequestHooks(hooks);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\trollbackRequestHooks(request.hooks);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (Array.isArray(request)) {\r\n\t\t\t\t\t\tconst changeSetResults = await Bluebird.reduce(\r\n\t\t\t\t\t\t\trequest,\r\n\t\t\t\t\t\t\trunChangeSet(req, tx),\r\n\t\t\t\t\t\t\tnew Map<number, Response>(),\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\treturn Array.from(changeSetResults.values());\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn await runRequest(req, tx, request);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\tconst responses = results.map((result) => {\r\n\t\t\t\tif (_.isError(result)) {\r\n\t\t\t\t\treturn convertToHttpError(result);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (\r\n\t\t\t\t\t\t!Array.isArray(result) &&\r\n\t\t\t\t\t\tresult.body == null &&\r\n\t\t\t\t\t\tresult.status == null\r\n\t\t\t\t\t) {\r\n\t\t\t\t\t\tconsole.error('No status or body set', req.url, responses);\r\n\t\t\t\t\t\treturn new InternalRequestError();\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn result;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn responses;\r\n\t\t})(),\r\n\t};\r\n};\r\n\r\nexport const handleODataRequest: Express.Handler = async (req, res, next) => {\r\n\tconst [, apiRoot] = req.url.split('/', 2);\r\n\tif (apiRoot == null || models[apiRoot] == null) {\r\n\t\treturn next('route');\r\n\t}\r\n\r\n\ttry {\r\n\t\tconst { tryCancelRequest, promise } = runODataRequest(req, apiRoot);\r\n\r\n\t\tres.on('close', tryCancelRequest);\r\n\r\n\t\tconst responses = await promise;\r\n\r\n\t\tres.set('Cache-Control', 'no-cache');\r\n\t\t// If we are dealing with a single request unpack the response and respond normally\r\n\t\tif (req.batch == null || req.batch.length === 0) {\r\n\t\t\tlet [response] = responses;\r\n\t\t\tif (_.isError(response)) {\r\n\t\t\t\tresponse = {\r\n\t\t\t\t\tstatus: response.status,\r\n\t\t\t\t\tbody: response.getResponseBody(),\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tconst { body, headers, status } = response as Response;\r\n\t\t\tif (status) {\r\n\t\t\t\tres.status(status);\r\n\t\t\t}\r\n\t\t\t_.forEach(headers, (headerValue, headerName) => {\r\n\t\t\t\tres.set(headerName, headerValue);\r\n\t\t\t});\r\n\r\n\t\t\tif (!body) {\r\n\t\t\t\tres.sendStatus(status!);\r\n\t\t\t} else {\r\n\t\t\t\tif (status != null) {\r\n\t\t\t\t\tres.status(status);\r\n\t\t\t\t}\r\n\t\t\t\tres.json(body);\r\n\t\t\t}\r\n\r\n\t\t\t// Otherwise its a multipart request and we reply with the appropriate multipart response\r\n\t\t} else {\r\n\t\t\t(res.status(200) as any).sendMulti(\r\n\t\t\t\tresponses.map((response) => {\r\n\t\t\t\t\tif (_.isError(response)) {\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tstatus: response.status,\r\n\t\t\t\t\t\t\tbody: response.getResponseBody(),\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn response;\r\n\t\t\t\t\t}\r\n\t\t\t\t}),\r\n\t\t\t);\r\n\t\t}\r\n\t} catch (e) {\r\n\t\t// If an error bubbles here it must have happened in the last then block\r\n\t\t// We just respond with 500 as there is probably not much we can do to recover\r\n\t\tconsole.error('An error occurred while constructing the response', e);\r\n\t\tres.sendStatus(500);\r\n\t}\r\n};\r\n\r\n// Reject the error to use the nice catch syntax\r\nconst convertToHttpError = (err: any): HttpError => {\r\n\tif (err instanceof HttpError) {\r\n\t\treturn err;\r\n\t}\r\n\tif (err instanceof SbvrValidationError) {\r\n\t\treturn new BadRequestError(err);\r\n\t}\r\n\tif (err instanceof PermissionError) {\r\n\t\treturn new UnauthorizedError(err);\r\n\t}\r\n\tif (err instanceof db.ConstraintError) {\r\n\t\treturn new ConflictError(err);\r\n\t}\r\n\tif (\r\n\t\terr instanceof SqlCompilationError ||\r\n\t\terr instanceof TranslationError ||\r\n\t\terr instanceof ParsingError ||\r\n\t\terr instanceof PermissionParsingError ||\r\n\t\terr instanceof db.DatabaseError\r\n\t) {\r\n\t\treturn new InternalRequestError();\r\n\t}\r\n\r\n\tconsole.error('Unexpected response error type', err);\r\n\treturn new NotFoundError(err);\r\n};\r\n\r\nconst runRequest = async (\r\n\treq: Express.Request,\r\n\ttx: Db.Tx,\r\n\trequest: uriParser.ODataRequest,\r\n): Promise<Response> => {\r\n\tconst { logger } = api[request.vocabulary];\r\n\r\n\tif (env.DEBUG) {\r\n\t\tlogger.log('Running', req.method, req.url);\r\n\t}\r\n\tlet result: Db.Result | number | undefined;\r\n\r\n\ttry {\r\n\t\ttry {\r\n\t\t\t// Forward each request to the correct method handler\r\n\t\t\tawait runHooks('PRERUN', request.hooks, { req, request, tx });\r\n\r\n\t\t\tswitch (request.method) {\r\n\t\t\t\tcase 'GET':\r\n\t\t\t\t\tresult = await runGet(req, request, tx);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'POST':\r\n\t\t\t\t\tresult = await runPost(req, request, tx);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'PUT':\r\n\t\t\t\tcase 'PATCH':\r\n\t\t\t\tcase 'MERGE':\r\n\t\t\t\t\tresult = await runPut(req, request, tx);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'DELETE':\r\n\t\t\t\t\tresult = await runDelete(req, request, tx);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t} catch (err) {\r\n\t\t\tif (err instanceof db.DatabaseError) {\r\n\t\t\t\tprettifyConstraintError(err, request);\r\n\t\t\t\tlogger.error(err);\r\n\t\t\t\t// Override the error message so we don't leak any internal db info\r\n\t\t\t\terr.message = 'Database error';\r\n\t\t\t\tthrow err;\r\n\t\t\t}\r\n\t\t\tif (\r\n\t\t\t\terr instanceof uriParser.SyntaxError ||\r\n\t\t\t\terr instanceof EvalError ||\r\n\t\t\t\terr instanceof RangeError ||\r\n\t\t\t\terr instanceof ReferenceError ||\r\n\t\t\t\terr instanceof SyntaxError ||\r\n\t\t\t\terr instanceof TypeError ||\r\n\t\t\t\terr instanceof URIError\r\n\t\t\t) {\r\n\t\t\t\tlogger.error(err);\r\n\t\t\t\tthrow new InternalRequestError();\r\n\t\t\t}\r\n\t\t\tthrow err;\r\n\t\t}\r\n\r\n\t\tawait runHooks('POSTRUN', request.hooks, { req, request, result, tx });\r\n\t} catch (err) {\r\n\t\tawait runHooks('POSTRUN-ERROR', request.hooks, {\r\n\t\t\treq,\r\n\t\t\trequest,\r\n\t\t\ttx,\r\n\t\t\terror: err,\r\n\t\t});\r\n\t\tthrow err;\r\n\t}\r\n\treturn await prepareResponse(req, request, result, tx);\r\n};\r\n\r\nconst runChangeSet = (req: Express.Request, tx: Db.Tx) => async (\r\n\tchangeSetResults: Map<number, Response>,\r\n\trequest: uriParser.ODataRequest,\r\n): Promise<Map<number, Response>> => {\r\n\trequest = updateBinds(changeSetResults, request);\r\n\tconst result = await runRequest(req, tx, request);\r\n\tif (request.id == null) {\r\n\t\tthrow new Error('No request id');\r\n\t}\r\n\tresult.headers ??= {};\r\n\tresult.headers['Content-Id'] = request.id;\r\n\tchangeSetResults.set(request.id, result);\r\n\treturn changeSetResults;\r\n};\r\n\r\n// Requests inside a changeset may refer to resources created inside the\r\n// changeset, the generation of the sql query for those requests must be\r\n// deferred untill the request they reference is run and returns an insert ID.\r\n// This function compiles the sql query of a request which has been deferred\r\nconst updateBinds = (\r\n\tchangeSetResults: Map<number, Response>,\r\n\trequest: uriParser.ODataRequest,\r\n) => {\r\n\tif (request._defer) {\r\n\t\trequest.odataBinds = request.odataBinds.map(([tag, id]) => {\r\n\t\t\tif (tag === 'ContentReference') {\r\n\t\t\t\tconst ref = changeSetResults.get(id);\r\n\t\t\t\tif (\r\n\t\t\t\t\tref?.body == null ||\r\n\t\t\t\t\ttypeof ref.body === 'string' ||\r\n\t\t\t\t\tref.body.id === undefined\r\n\t\t\t\t) {\r\n\t\t\t\t\tthrow new BadRequestError(\r\n\t\t\t\t\t\t'Reference to a non existing resource in Changeset',\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t\treturn uriParser.parseId(ref.body.id);\r\n\t\t\t}\r\n\t\t\treturn [tag, id];\r\n\t\t});\r\n\t}\r\n\treturn request;\r\n};\r\n\r\nconst prepareResponse = async (\r\n\treq: Express.Request,\r\n\trequest: uriParser.ODataRequest,\r\n\tresult: any,\r\n\ttx: Db.Tx,\r\n): Promise<Response> => {\r\n\tswitch (request.method) {\r\n\t\tcase 'GET':\r\n\t\t\treturn await respondGet(req, request, result, tx);\r\n\t\tcase 'POST':\r\n\t\t\treturn await respondPost(req, request, result, tx);\r\n\t\tcase 'PUT':\r\n\t\tcase 'PATCH':\r\n\t\tcase 'MERGE':\r\n\t\t\treturn await respondPut(req, request, result, tx);\r\n\t\tcase 'DELETE':\r\n\t\t\treturn await respondDelete(req, request, result, tx);\r\n\t\tcase 'OPTIONS':\r\n\t\t\treturn await respondOptions(req, request, result, tx);\r\n\t\tdefault:\r\n\t\t\tthrow new MethodNotAllowedError();\r\n\t}\r\n};\r\n\r\n// This is a helper method to handle using a passed in req.tx when available, or otherwise creating a new tx and cleaning up after we're done.\r\nconst runTransaction = async <T>(\r\n\treq: HookReq,\r\n\tcallback: (tx: Db.Tx) => Promise<T>,\r\n): Promise<T> => {\r\n\tif (req.tx != null) {\r\n\t\t// If an existing tx was passed in then use it.\r\n\t\treturn await callback(req.tx);\r\n\t} else {\r\n\t\t// Otherwise create a new transaction and handle tidying it up.\r\n\t\treturn await db.transaction(callback);\r\n\t}\r\n};\r\n\r\n// This is a helper function that will check and add the bind values to the SQL query and then run it.\r\nconst runQuery = async (\r\n\ttx: Db.Tx,\r\n\trequest: uriParser.ODataRequest,\r\n\tqueryIndex?: number,\r\n\treturningIdField?: string,\r\n): Promise<Db.Result> => {\r\n\tconst { vocabulary } = request;\r\n\tlet { sqlQuery } = request;\r\n\tif (sqlQuery == null) {\r\n\t\tthrow new InternalRequestError('No SQL query available to run');\r\n\t}\r\n\tif (request.engine == null) {\r\n\t\tthrow new InternalRequestError('No database engine specified');\r\n\t}\r\n\tif (Array.isArray(sqlQuery)) {\r\n\t\tif (queryIndex == null) {\r\n\t\t\tthrow new InternalRequestError(\r\n\t\t\t\t'Received a query index to run but the query is not an array',\r\n\t\t\t);\r\n\t\t}\r\n\t\tsqlQuery = sqlQuery[queryIndex];\r\n\t}\r\n\r\n\tconst { query, bindings } = sqlQuery;\r\n\tconst values = await getAndCheckBindValues(\r\n\t\trequest as RequiredField<typeof request, 'engine'>,\r\n\t\tbindings,\r\n\t);\r\n\r\n\tif (env.DEBUG) {\r\n\t\tapi[vocabulary].logger.log(query, values);\r\n\t}\r\n\r\n\tconst sqlResult = await tx.executeSql(query, values, returningIdField);\r\n\r\n\tif (returningIdField) {\r\n\t\trequest.affectedIds = sqlResult.rows.map((row) => row[returningIdField]);\r\n\t}\r\n\r\n\treturn sqlResult;\r\n};\r\n\r\nconst runGet = async (\r\n\t_req: Express.Request,\r\n\trequest: uriParser.ODataRequest,\r\n\ttx: Db.Tx,\r\n) => {\r\n\tif (request.sqlQuery != null) {\r\n\t\treturn await runQuery(tx, request);\r\n\t}\r\n};\r\n\r\nconst respondGet = async (\r\n\treq: Express.Request,\r\n\trequest: uriParser.ODataRequest,\r\n\tresult: any,\r\n\ttx: Db.Tx,\r\n): Promise<Response> => {\r\n\tconst vocab = request.vocabulary;\r\n\tif (request.sqlQuery != null) {\r\n\t\tconst format = request.odataQuery.options?.$format;\r\n\t\tconst metadata =\r\n\t\t\tformat != null && typeof format === 'object'\r\n\t\t\t\t? format.metadata\r\n\t\t\t\t: undefined;\r\n\t\tconst d = await odataResponse.process(\r\n\t\t\tvocab,\r\n\t\t\tgetAbstractSqlModel(request),\r\n\t\t\trequest.resourceName,\r\n\t\t\tresult.rows,\r\n\t\t\t{ includeMetadata: metadata === 'full' },\r\n\t\t);\r\n\r\n\t\tawait runHooks('PRERESPOND', request.hooks, {\r\n\t\t\treq,\r\n\t\t\trequest,\r\n\t\t\tresult,\r\n\t\t\tdata: d,\r\n\t\t\ttx,\r\n\t\t});\r\n\t\treturn { body: { d }, headers: { contentType: 'application/json' } };\r\n\t} else {\r\n\t\tif (request.resourceName === '$metadata') {\r\n\t\t\treturn {\r\n\t\t\t\tbody: models[vocab].odataMetadata,\r\n\t\t\t\theaders: { contentType: 'xml' },\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\t// TODO: request.resourceName can be '$serviceroot' or a resource and we should return an odata xml document based on that\r\n\t\t\treturn {\r\n\t\t\t\tstatus: 404,\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n};\r\n\r\nconst runPost = async (\r\n\t_req: Express.Request,\r\n\trequest: uriParser.ODataRequest,\r\n\ttx: Db.Tx,\r\n): Promise<number | undefined> => {\r\n\tconst { rowsAffected, insertId } = await runQuery(\r\n\t\ttx,\r\n\t\trequest,\r\n\t\tundefined,\r\n\t\tgetIdField(request),\r\n\t);\r\n\tif (rowsAffected === 0) {\r\n\t\tthrow new PermissionError();\r\n\t}\r\n\tawait validateModel(tx, request.vocabulary, request);\r\n\r\n\treturn insertId;\r\n};\r\n\r\nconst respondPost = async (\r\n\treq: Express.Request,\r\n\trequest: uriParser.ODataRequest,\r\n\tid: number,\r\n\ttx: Db.Tx,\r\n): Promise<Response> => {\r\n\tconst vocab = request.vocabulary;\r\n\tconst location = odataResponse.resourceURI(vocab, request.resourceName, id);\r\n\tif (env.DEBUG) {\r\n\t\tapi[vocab].logger.log('Insert ID: ', request.resourceName, id);\r\n\t}\r\n\r\n\tlet result: AnyObject = { d: [{ id }] };\r\n\tif (\r\n\t\tlocation != null &&\r\n\t\t!['0', 'false'].includes(\r\n\t\t\trequest?.odataQuery?.options?.returnResource as string,\r\n\t\t)\r\n\t) {\r\n\t\ttry {\r\n\t\t\tresult = (await runURI('GET', location, undefined, tx, req)) as AnyObject;\r\n\t\t} catch {\r\n\t\t\t// If we failed to fetch the created resource then we use just the id as default.\r\n\t\t}\r\n\t}\r\n\r\n\tawait runHooks('PRERESPOND', request.hooks, {\r\n\t\treq,\r\n\t\trequest,\r\n\t\tresult,\r\n\t\ttx,\r\n\t});\r\n\r\n\treturn {\r\n\t\tstatus: 201,\r\n\t\tbody: result.d[0],\r\n\t\theaders: {\r\n\t\t\tcontentType: 'application/json',\r\n\t\t\tLocation: location,\r\n\t\t},\r\n\t};\r\n};\r\n\r\nconst runPut = async (\r\n\t_req: Express.Request,\r\n\trequest: uriParser.ODataRequest,\r\n\ttx: Db.Tx,\r\n): Promise<undefined> => {\r\n\tconst idField = getIdField(request);\r\n\r\n\tlet rowsAffected: number;\r\n\t// If request.sqlQuery is an array it means it's an UPSERT, ie two queries: [InsertQuery, UpdateQuery]\r\n\tif (Array.isArray(request.sqlQuery)) {\r\n\t\t// Run the update query first\r\n\t\t({ rowsAffected } = await runQuery(tx, request, 1, idField));\r\n\t\tif (rowsAffected === 0) {\r\n\t\t\t// Then run the insert query if nothing was updated\r\n\t\t\t({ rowsAffected } = await runQuery(tx, request, 0, idField));\r\n\t\t}\r\n\t} else {\r\n\t\t({ rowsAffected } = await runQuery(tx, request, undefined, idField));\r\n\t}\r\n\tif (rowsAffected > 0) {\r\n\t\tawait validateModel(tx, request.vocabulary, request);\r\n\t}\r\n\treturn undefined;\r\n};\r\n\r\nconst respondPut = async (\r\n\treq: Express.Request,\r\n\trequest: uriParser.ODataRequest,\r\n\tresult: any,\r\n\ttx: Db.Tx,\r\n): Promise<Response> => {\r\n\tawait runHooks('PRERESPOND', request.hooks, {\r\n\t\treq,\r\n\t\trequest,\r\n\t\tresult,\r\n\t\ttx,\r\n\t});\r\n\treturn {\r\n\t\tstatus: 200,\r\n\t\theaders: {},\r\n\t};\r\n};\r\nconst respondDelete = respondPut;\r\nconst respondOptions = respondPut;\r\n\r\nconst runDelete = async (\r\n\t_req: Express.Request,\r\n\trequest: uriParser.ODataRequest,\r\n\ttx: Db.Tx,\r\n): Promise<undefined> => {\r\n\tconst { rowsAffected } = await runQuery(\r\n\t\ttx,\r\n\t\trequest,\r\n\t\tundefined,\r\n\t\tgetIdField(request),\r\n\t);\r\n\tif (rowsAffected > 0) {\r\n\t\tawait validateModel(tx, request.vocabulary, request);\r\n\t}\r\n\r\n\treturn undefined;\r\n};\r\n\r\nexport const executeStandardModels = async (tx: Db.Tx): Promise<void> => {\r\n\ttry {\r\n\t\t// dev model must run first\r\n\t\tawait executeModel(tx, {\r\n\t\t\tapiRoot: 'dev',\r\n\t\t\tmodelText: devModel,\r\n\t\t\tlogging: {\r\n\t\t\t\tlog: false,\r\n\t\t\t},\r\n\t\t\tmigrations: {\r\n\t\t\t\t'11.0.0-modified-at': `\r\n\t\t\t\t\tALTER TABLE \"model\"\r\n\t\t\t\t\tADD COLUMN IF NOT EXISTS \"modified at\" TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL;\r\n\t\t\t\t`,\r\n\t\t\t},\r\n\t\t});\r\n\t\tawait executeModels(tx, permissions.config.models);\r\n\t\tconsole.info('Successfully executed standard models.');\r\n\t} catch (err) {\r\n\t\tconsole.error('Failed to execute standard models.', err);\r\n\t\tthrow err;\r\n\t}\r\n};\r\n\r\nexport const setup = async (\r\n\t_app: Express.Application,\r\n\t$db: Db.Database,\r\n): Promise<void> => {\r\n\texports.db = db = $db;\r\n\ttry {\r\n\t\tawait db.transaction(async (tx) => {\r\n\t\t\tawait executeStandardModels(tx);\r\n\t\t\tawait permissions.setup();\r\n\t\t});\r\n\t} catch (err) {\r\n\t\tconsole.error('Could not execute standard models', err);\r\n\t\tprocess.exit(1);\r\n\t}\r\n\ttry {\r\n\t\tawait db.executeSql(\r\n\t\t\t'CREATE UNIQUE INDEX \"uniq_model_model_type_vocab\" ON \"model\" (\"is of-vocabulary\", \"model type\");',\r\n\t\t);\r\n\t} catch {\r\n\t\t// we can't use IF NOT EXISTS on all dbs, so we have to ignore the error raised if this index already exists\r\n\t}\r\n};\r\n","\"use strict\";\n\nvar _undefined = require(\"../function/noop\")(); // Support ES3 engines\n\nmodule.exports = function (val) { return val !== _undefined && val !== null; };\n","/* eslint-disable node/no-deprecated-api */\nvar buffer = require('buffer')\nvar Buffer = buffer.Buffer\n\n// alternative to using Object.keys for old browsers\nfunction copyProps (src, dst) {\n  for (var key in src) {\n    dst[key] = src[key]\n  }\n}\nif (Buffer.from && Buffer.alloc && Buffer.allocUnsafe && Buffer.allocUnsafeSlow) {\n  module.exports = buffer\n} else {\n  // Copy properties from require('buffer')\n  copyProps(buffer, exports)\n  exports.Buffer = SafeBuffer\n}\n\nfunction SafeBuffer (arg, encodingOrOffset, length) {\n  return Buffer(arg, encodingOrOffset, length)\n}\n\n// Copy static methods from Buffer\ncopyProps(Buffer, SafeBuffer)\n\nSafeBuffer.from = function (arg, encodingOrOffset, length) {\n  if (typeof arg === 'number') {\n    throw new TypeError('Argument must not be a number')\n  }\n  return Buffer(arg, encodingOrOffset, length)\n}\n\nSafeBuffer.alloc = function (size, fill, encoding) {\n  if (typeof size !== 'number') {\n    throw new TypeError('Argument must be a number')\n  }\n  var buf = Buffer(size)\n  if (fill !== undefined) {\n    if (typeof encoding === 'string') {\n      buf.fill(fill, encoding)\n    } else {\n      buf.fill(fill)\n    }\n  } else {\n    buf.fill(0)\n  }\n  return buf\n}\n\nSafeBuffer.allocUnsafe = function (size) {\n  if (typeof size !== 'number') {\n    throw new TypeError('Argument must be a number')\n  }\n  return Buffer(size)\n}\n\nSafeBuffer.allocUnsafeSlow = function (size) {\n  if (typeof size !== 'number') {\n    throw new TypeError('Argument must be a number')\n  }\n  return buffer.SlowBuffer(size)\n}\n","(function (root, factory) {\r\n\tif (typeof define === 'function' && define.amd) {\r\n\t\t// AMD. Register as an anonymous module.\r\n\t\tdefine('ometa-core', function () {\r\n\t\t\treturn (root.OMeta = factory());\r\n\t\t});\r\n\t} else if (typeof exports === 'object') {\r\n\t\t// Node. Does not work with strict CommonJS, but\r\n\t\t// only CommonJS-like enviroments that support module.exports,\r\n\t\t// like Node.\r\n\t\tmodule.exports = factory();\r\n\t} else {\r\n\t\t// Browser globals\r\n\t\troot.OMeta = factory();\r\n\t}\r\n}(this, function () {\r\n\t\"use strict\";\r\n\t/*\r\n\t\tnew syntax:\r\n\t\t\t#foo and `foo\tmatch the string object 'foo' (it's also accepted in my JS)\r\n\t\t\t'abc'\t\tmatch the string object 'abc'\r\n\t\t\t'c'\t\t\tmatch the string object 'c'\r\n\t\t\t``abc''\t\tmatch the sequence of string objects 'a', 'b', 'c'\r\n\t\t\t\"abc\"\t\ttoken('abc')\r\n\t\t\t[1 2 3]\t\tmatch the array object [1, 2, 3]\r\n\t\t\tfoo(bar)\t\tapply rule foo with argument bar\r\n\t\t\t-> ...\t\tsemantic actions written in JS (see OMetaParser's atomicHostExpr rule)\r\n\t*/\r\n\r\n\t/*\r\n\tometa M {\r\n\t\tnumber =\r\n\t\t\t\tnumber:n digit:d\r\n\t\t\t\t-> { n * 10 + parseInt(d, 10) }\r\n\t\t\t|\tdigit:d\r\n\t\t\t\t-> { parseInt(d, 10) }\r\n\t}\r\n\r\n\tcompiles into...\r\n\r\n\tM = objectThatDelegatesTo(OMeta, {\r\n\t\tnumber: function() {\r\n\t\t\treturn this._or(function() {\r\n\t\t\t\t\tvar n = this._apply(\"number\"),\r\n\t\t\t\t\t\td = this._apply(\"digit\");\r\n\t\t\t\t\treturn n * 10 + parseInt(d, 10);\r\n\t\t\t\t},\r\n\t\t\t\tfunction() {\r\n\t\t\t\t\tvar d = this._apply(\"digit\");\r\n\t\t\t\t\treturn parseInt(d, 10)\r\n\t\t\t\t}\r\n\t\t\t)\r\n\t\t}\r\n\t})\r\n\tM.matchAll(\"123456789\", \"number\")\r\n\t*/\r\n\r\n\t//\r\n\t// failure exception\r\n\t//\r\n\tvar fail = function fail() {\r\n\t\treturn fail.error;\r\n\t};\r\n\tfail.error = new SyntaxError('match failed');\r\n\tfail.error._extend = function(child) {\r\n\t\treturn objectThatDelegatesTo(this, child);\r\n\t};\r\n\r\n\t//\r\n\t// ### function objectThatDelegatesTo(obj, props)\r\n\t// #### @obj {Object} parent object\r\n\t// #### @props {Object} object to merge result with\r\n\t// Returns object with merged properties of `obj` and `props`\r\n\t//\r\n\tfunction objectThatDelegatesTo(obj, props) {\r\n\t\tvar clone = Object.create(obj || {});\r\n\r\n\t\tfor (var key in props) {\r\n\t\t\tif (props.hasOwnProperty(key)) {\r\n\t\t\t\tclone[key] = props[key];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn clone;\r\n\t}\r\n\r\n\t//\r\n\t// ### function isSequenceable(o)\r\n\t// #### @o {any} object to perform check against\r\n\t// Returns true if object is sequenceable\r\n\t//\r\n\tfunction isSequenceable(o) {\r\n\t\treturn typeof o === 'string' || Array.isArray(o);\r\n\t}\r\n\r\n\t//\r\n\t// ### function getTag(o)\r\n\t// #### @o {Object} input\r\n\t// unique tags for objects (useful for making \"hash tables\")\r\n\t//\r\n\tfunction getTag(o) {\r\n\t\tif (o == null) {\r\n\t\t\treturn 'null';\r\n\t\t}\r\n\r\n\t\tswitch (typeof o) {\r\n\t\t\tcase \"boolean\":\r\n\t\t\t\treturn o === true ? \"Btrue\" : \"Bfalse\";\r\n\t\t\tcase \"string\":\r\n\t\t\t\treturn \"S\" + o;\r\n\t\t\tcase \"number\":\r\n\t\t\t\treturn \"N\" + o;\r\n\t\t\tdefault:\r\n\t\t\t\tif (!o.hasOwnProperty(\"_id_\")) {\r\n\t\t\t\t\to._id_ = getTag.id++;\r\n\t\t\t\t}\r\n\t\t\t\treturn \"R\" + o._id_;\r\n\t\t}\r\n\t}\r\n\tgetTag.id = 0;\r\n\r\n\t//\r\n\t// ### function isImmutable(o)\r\n\t// #### @o {any} object to perform check against\r\n\t// Returns true if object is immutable\r\n\t//\r\n\tfunction isImmutable(o) {\r\n\t\treturn o == null ||\r\n\t\t\ttypeof o === 'boolean' || typeof o === 'number' ||\r\n\t\t\ttypeof o === 'string';\r\n\t}\r\n\r\n\t//\r\n\t// ### function lookup (fn, success, fallback)\r\n\t// #### @fn {Function} function that may throw\r\n\t// #### @success {Function} call if function hasn't thrown\r\n\t// #### @fallback {Function} call if function thrown fail()\r\n\t//\r\n\tfunction lookup(fn, success, fallback) {\r\n\t\tvar value;\r\n\t\ttry {\r\n\t\t\tvalue = fn();\r\n\t\t} catch (e) {\r\n\t\t\tif (!(e instanceof SyntaxError)) {\r\n\t\t\t\tthrow e;\r\n\t\t\t}\r\n\t\t\treturn fallback && fallback(e);\r\n\t\t}\r\n\r\n\t\treturn success && success(value);\r\n\t}\r\n\r\n\tfunction always(fn, after) {\r\n\t\ttry {\r\n\t\t\treturn fn();\r\n\t\t} finally {\r\n\t\t\tafter();\r\n\t\t}\r\n\t}\r\n\r\n\tfunction identity(ans) {\r\n\t\treturn ans;\r\n\t}\r\n\r\n\tfunction returnTrue() {\r\n\t\treturn true;\r\n\t}\r\n\r\n\tfunction returnFalse() {\r\n\t\treturn false;\r\n\t}\r\n\r\n\tfunction throwFail() {\r\n\t\tthrow fail();\r\n\t}\r\n\r\n\tfunction noop() {}\r\n\r\n\t//\r\n\t// ### function OMInputStream(hd, tl)\r\n\t// #### @hd {any} Head\r\n\t// #### @tl {Object} Tail\r\n\t// Streams and memoization\r\n\t//\r\n\tfunction OMInputStream(hd, tl) {\r\n\t\tthis.memo = {};\r\n\t\tthis.lst = tl.lst;\r\n\t\tthis.idx = tl.idx;\r\n\t\tthis.hd = hd;\r\n\t\tthis.tl = tl;\r\n\t}\r\n\r\n\t//\r\n\t// ### function head ()\r\n\t// Returns stream's `hd` property\r\n\t//\r\n\tOMInputStream.prototype.head = function() { return this.hd; };\r\n\r\n\t//\r\n\t// ### function tail ()\r\n\t// Returns stream's `tl` property\r\n\t//\r\n\tOMInputStream.prototype.tail = function() { return this.tl; };\r\n\r\n\t//\r\n\t// ### function type ()\r\n\t// Returns stream's `lst` property constructor\r\n\t//\r\n\tOMInputStream.prototype.type = function() { return this.lst.constructor; };\r\n\r\n\t//\r\n\t// ### function upTo (that)\r\n\t// #### @that {Object} target object\r\n\t// Visit all tails and join all met heads and return string or array\r\n\t// (depending on `.lst` type)\r\n\t//\r\n\tOMInputStream.prototype.upTo = function(that) {\r\n\t\tvar r = [], curr = this;\r\n\t\twhile (curr !== that) {\r\n\t\t\tr.push(curr.head());\r\n\t\t\tcurr = curr.tail();\r\n\t\t}\r\n\t\treturn this.type() === String ? r.join('') : r;\r\n\t};\r\n\r\n\t//\r\n\t// ### function OMInputStreamEnd (lst, idx)\r\n\t// #### @lst {Array} list\r\n\t// #### @idx {Number} index\r\n\t// Internal class\r\n\t//\r\n\tfunction OMInputStreamEnd(lst, idx) {\r\n\t\tthis.memo = {};\r\n\t\tthis.lst = lst;\r\n\t\tthis.idx = idx;\r\n\t}\r\n\tOMInputStreamEnd.prototype = objectThatDelegatesTo(OMInputStream.prototype);\r\n\r\n\t//\r\n\t// ### function head ()\r\n\t// Not implemented\r\n\t//\r\n\tOMInputStreamEnd.prototype.head = throwFail;\r\n\r\n\t//\r\n\t// ### function tail ()\r\n\t// Not implemented\r\n\t//\r\n\tOMInputStreamEnd.prototype.tail = throwFail;\r\n\r\n\t//\r\n\t// ### function ListOMInputStream (lst, idx)\r\n\t// #### @lst {Array} list\r\n\t// #### @idx {Number} index\r\n\t// Returns self-expanding stream\r\n\t//\r\n\tfunction ListOMInputStream(lst, idx) {\r\n\t\tthis.memo = { };\r\n\t\tthis.lst = lst;\r\n\t\tthis.idx = idx;\r\n\t\tthis.hd = lst[idx];\r\n\t}\r\n\tListOMInputStream.prototype = objectThatDelegatesTo(OMInputStream.prototype);\r\n\r\n\t//\r\n\t// ### function head ()\r\n\t// Returns stream's `hd` property's value\r\n\t//\r\n\tListOMInputStream.prototype.head = function() { return this.hd; };\r\n\r\n\t//\r\n\t// ### function tail ()\r\n\t// Returns or creates stream's tail\r\n\t//\r\n\tListOMInputStream.prototype.tail = function() {\r\n\t\treturn this.tl || (this.tl = makeListOMInputStream(this.lst, this.idx + 1));\r\n\t};\r\n\r\n\t//\r\n\t// ### function makeListOMInputStream (lst, idx)\r\n\t// #### @lst {Array} List\r\n\t// #### @idx {Number} index\r\n\t// Returns either ListOMInputStream's or OMInputStreamEnd's instance\r\n\t//\r\n\tfunction makeListOMInputStream(lst, idx) {\r\n\t\tif (idx < lst.length) {\r\n\t\t\treturn new ListOMInputStream(lst, idx);\r\n\t\t} else {\r\n\t\t\treturn new OMInputStreamEnd(lst, idx);\r\n\t\t}\r\n\t}\r\n\r\n\t//\r\n\t// ### function makeOMInputStreamProxy (target)\r\n\t// #### @target {any} Delegate's constructor\r\n\t// Returns object with stream's properties\r\n\t// (has self-expanding tail)\r\n\t//\r\n\tfunction makeOMInputStreamProxy(target) {\r\n\t\treturn {\r\n\t\t\tmemo: {},\r\n\t\t\ttarget: target,\r\n\t\t\tidx: target.idx,\r\n\t\t\ttl: undefined,\r\n\t\t\ttype: function() {\r\n\t\t\t\treturn String;\r\n\t\t\t},\r\n\t\t\tupTo: OMInputStream.prototype.upTo,\r\n\t\t\thead: function() {\r\n\t\t\t\treturn target.head();\r\n\t\t\t},\r\n\t\t\ttail: function() {\r\n\t\t\t\treturn this.tl || (this.tl = makeOMInputStreamProxy(target.tail()));\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n\t//\r\n\t// ### OMeta\r\n\t// the OMeta \"class\" and basic functionality\r\n\t//\r\n\tvar OMeta;\r\n\treturn OMeta = {\r\n\t\t_extend: function(child) {\r\n\t\t\treturn objectThatDelegatesTo(this, child);\r\n\t\t},\r\n\t\t_fail: fail,\r\n\t\t_enableTokens: function(rulesToTrack) {\r\n\t\t\tif(rulesToTrack == null) {\r\n\t\t\t\t// No rules to track were supplied and it wasn't even a reference they could be added to.\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis._enableTokens = function() {\r\n\t\t\t\tthrow 'Can only enable tokens once';\r\n\t\t\t};\r\n\t\t\tthis._tokensEnabled = returnTrue;\r\n\t\t\tthis._addToken = function(startInput, endInput, rule, ruleArgs) {\r\n\t\t\t\tif(rulesToTrack.indexOf(rule) !== -1 && startInput !== endInput) {\r\n\t\t\t\t\twhile(startInput.hasOwnProperty('target')) {\r\n\t\t\t\t\t\tstartInput = startInput.target;\r\n\t\t\t\t\t}\r\n\t\t\t\t\twhile(endInput.hasOwnProperty('target')) {\r\n\t\t\t\t\t\tendInput = endInput.target;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(!startInput.hasOwnProperty('tokens')) {\r\n\t\t\t\t\t\tstartInput.tokens = [];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tstartInput.tokens.push([endInput.idx, rule, ruleArgs]);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t},\r\n\t\t_addToken: noop,\r\n\t\t_tokensEnabled: returnFalse,\r\n\r\n\t\t_enableBranchTracking: function(rulesToTrack) {\r\n\t\t\tvar branches = [];\r\n\t\t\tthis._enableBranchTracking = function() {\r\n\t\t\t\tthrow 'Can only enable tokens once';\r\n\t\t\t};\r\n\t\t\tthis._addBranch = function(rule, ruleArgs) {\r\n\t\t\t\tif(rulesToTrack.hasOwnProperty(rule)) {\r\n\t\t\t\t\tvar idx = this.input.idx;\r\n\t\t\t\t\tif(branches[idx] === undefined) {\r\n\t\t\t\t\t\tbranches[idx] = {};\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbranches[idx][rule] = ruleArgs;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tthis._getBranches = function() {\r\n\t\t\t\treturn branches;\r\n\t\t\t};\r\n\t\t\tthis._not = function(x) {\r\n\t\t\t\tvar self = this,\r\n\t\t\t\t\torigInput = this.input,\r\n\t\t\t\t\torigAddBranch = this._addBranch,\r\n\t\t\t\t\torigAddToken = this._addToken;\r\n\t\t\t\treturn always(function() {\r\n\t\t\t\t\treturn lookup(function() {\r\n\t\t\t\t\t\tx.call(self);\r\n\t\t\t\t\t}, throwFail, function() {\r\n\t\t\t\t\t\tself.input = origInput;\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t});\r\n\t\t\t\t}, function() {\r\n\t\t\t\t\tself._addBranch = origAddBranch;\r\n\t\t\t\t\tself._addToken = origAddToken;\r\n\t\t\t\t});\r\n\t\t\t};\r\n\t\t},\r\n\t\t_addBranch: noop,\r\n\t\t_getBranches: noop,\r\n\r\n\t\t_apply: function(rule) {\r\n\t\t\tvar memo = this.input.memo,\r\n\t\t\t\tmemoRec = memo[rule],\r\n\t\t\t\torigInput = this.input;\r\n\t\t\tthis._addBranch(rule, []);\r\n\t\t\tif (memoRec === undefined) {\r\n\r\n\t\t\t\tmemo[rule] = false;\r\n\t\t\t\tmemoRec = {\r\n\t\t\t\t\tans: this[rule](),\r\n\t\t\t\t\tnextInput: this.input\r\n\t\t\t\t};\r\n\t\t\t\tvar failer = memo[rule];\r\n\t\t\t\tmemo[rule] = memoRec;\r\n\r\n\t\t\t\t// If we tried to match this rule again without progressing the input at all\r\n\t\t\t\t// then retry matching it now that we have an answer for it, this allows for rules like `A = A 'x' | 'x'`\r\n\t\t\t\tif (failer === true) {\r\n\t\t\t\t\tvar self = this,\r\n\t\t\t\t\t\tsentinel = this.input,\r\n\t\t\t\t\t\tlookupFunc = function() {\r\n\t\t\t\t\t\t\tself.input = origInput;\r\n\t\t\t\t\t\t\tvar ans = self[rule]();\r\n\r\n\t\t\t\t\t\t\tif (self.input === sentinel) {\r\n\t\t\t\t\t\t\t\tthrow fail();\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tmemoRec.ans = ans;\r\n\t\t\t\t\t\t\tmemoRec.nextInput = self.input;\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\twhile (lookup(lookupFunc, returnTrue, returnFalse));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if (typeof memoRec === 'boolean') {\r\n\t\t\t\tmemo[rule] = true;\r\n\t\t\t\tthrow fail();\r\n\t\t\t}\r\n\t\t\tthis.input = memoRec.nextInput;\r\n\t\t\tthis._addToken(origInput, this.input, rule, []);\r\n\t\t\treturn memoRec.ans;\r\n\t\t},\r\n\t\t_superApply: function(recv, rule) {\r\n\t\t\tvar origInput = recv.input;\r\n\t\t\tthis._addBranch(rule, []);\r\n\t\t\tvar ans = this[rule].call(recv);\r\n\t\t\tthis._addToken(origInput, recv.input, rule, []);\r\n\t\t\treturn ans;\r\n\t\t},\r\n\r\n\t\t// note: _applyWithArgs and _superApplyWithArgs are not memoized, so they can't be left-recursive\r\n\t\t_applyWithArgs: function(rule) {\r\n\t\t\tvar origInput = this.input,\r\n\t\t\t\truleFn = this[rule],\r\n\t\t\t\truleFnArity = ruleFn.length,\r\n\t\t\t\truleArgs = new Array(Math.min(arguments.length - 1, ruleFnArity));\r\n\t\t\tfor(var i = 0; i < ruleArgs.length; ++i) {\r\n\t\t\t\truleArgs[i] = arguments[i + 1];\r\n\t\t\t}\r\n\t\t\tfor (var idx = arguments.length - 1; idx > ruleFnArity; idx--) { // prepend \"extra\" arguments in reverse order\r\n\t\t\t\tthis._prependInput(arguments[idx]);\r\n\t\t\t}\r\n\t\t\tthis._addBranch(rule, ruleArgs);\r\n\t\t\tvar ans = ruleFnArity === 0 ?\r\n\t\t\t\truleFn.call(this) :\r\n\t\t\t\truleFn.apply(this, ruleArgs);\r\n\t\t\tthis._addToken(origInput, this.input, rule, ruleArgs);\r\n\t\t\treturn ans;\r\n\t\t},\r\n\t\t_superApplyWithArgs: function(recv, rule) {\r\n\t\t\tvar origInput = recv.input,\r\n\t\t\t\truleFn = this[rule],\r\n\t\t\t\truleFnArity = ruleFn.length,\r\n\t\t\t\truleArgs = new Array(Math.min(arguments.length - 2, ruleFnArity));\r\n\t\t\tfor(var i = 0; i < ruleArgs.length; ++i) {\r\n\t\t\t\truleArgs[i] = arguments[i + 2];\r\n\t\t\t}\r\n\t\t\tfor (var idx = arguments.length - 1; idx > ruleFnArity + 1; idx--) { // prepend \"extra\" arguments in reverse order\r\n\t\t\t\trecv._prependInput(arguments[idx]);\r\n\t\t\t}\r\n\t\t\tthis._addBranch(rule, ruleArgs);\r\n\t\t\tvar ans = ruleFnArity === 0 ?\r\n\t\t\t\truleFn.call(recv) :\r\n\t\t\t\truleFn.apply(recv, ruleArgs);\r\n\t\t\tthis._addToken(origInput, recv.input, rule, ruleArgs);\r\n\t\t\treturn ans;\r\n\t\t},\r\n\t\t_prependInput: function(v) {\r\n\t\t\tthis.input = new OMInputStream(v, this.input);\r\n\t\t},\r\n\r\n\t\t// Use this if you want to disable prepending to the input (increases performances but requires using `Rule :param1 :param2 =` style parameter binding at all times)\r\n\t\t_disablePrependingInput: function() {\r\n\t\t\tthis._applyWithArgs = function(rule) {\r\n\t\t\t\tvar origInput = this.input,\r\n\t\t\t\t\truleArgs = new Array(arguments.length - 1);\r\n\t\t\t\tfor(var i = 0; i < ruleArgs.length; ++i) {\r\n\t\t\t\t\truleArgs[i] = arguments[i + 1];\r\n\t\t\t\t}\r\n\t\t\t\tthis._addBranch(rule, ruleArgs);\r\n\t\t\t\tvar ans = this[rule].apply(this, ruleArgs);\r\n\t\t\t\tthis._addToken(origInput, this.input, rule, ruleArgs);\r\n\t\t\t\treturn ans;\r\n\t\t\t};\r\n\t\t\tthis._superApplyWithArgs = function(recv, rule) {\r\n\t\t\t\tvar origInput = recv.input,\r\n\t\t\t\t\truleArgs = new Array(arguments.length - 2);\r\n\t\t\t\tfor(var i = 0; i < ruleArgs.length; ++i) {\r\n\t\t\t\t\truleArgs[i] = arguments[i + 2];\r\n\t\t\t\t}\r\n\t\t\t\tthis._addBranch(rule, ruleArgs);\r\n\t\t\t\tvar ans = this[rule].apply(recv, ruleArgs);\r\n\t\t\t\tthis._addToken(origInput, recv.input, rule, ruleArgs);\r\n\t\t\t\treturn ans;\r\n\t\t\t};\r\n\t\t},\r\n\r\n\t\t// if you want your grammar (and its subgrammars) to memoize parameterized rules, invoke this method on it:\r\n\t\tmemoizeParameterizedRules: function() {\r\n\t\t\tthis._prependInput = function(v) {\r\n\t\t\t\tvar newInput;\r\n\t\t\t\tif (isImmutable(v)) {\r\n\t\t\t\t\tnewInput = this.input[getTag(v)];\r\n\t\t\t\t\tif (!newInput) {\r\n\t\t\t\t\t\tnewInput = new OMInputStream(v, this.input);\r\n\t\t\t\t\t\tthis.input[getTag(v)] = newInput;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tnewInput = new OMInputStream(v, this.input);\r\n\t\t\t\t}\r\n\t\t\t\tthis.input = newInput;\r\n\t\t\t};\r\n\t\t\tthis._applyWithArgs = function(rule) {\r\n\t\t\t\tvar origInput = this.input,\r\n\t\t\t\t\truleFn = this[rule],\r\n\t\t\t\t\truleFnArity = ruleFn.length,\r\n\t\t\t\t\truleArgs = new Array(Math.min(arguments.length - 1, ruleFnArity));\r\n\t\t\t\tfor(var i = 0; i < ruleArgs.length; ++i) {\r\n\t\t\t\t\truleArgs[i] = arguments[i + 1];\r\n\t\t\t\t}\r\n\t\t\t\tfor (var idx = arguments.length - 1; idx > ruleFnArity; idx--) { // prepend \"extra\" arguments in reverse order\r\n\t\t\t\t\tthis._prependInput(arguments[idx]);\r\n\t\t\t\t}\r\n\t\t\t\tthis._addBranch(rule, ruleArgs);\r\n\t\t\t\tvar ans = ruleFnArity === 0 ?\r\n\t\t\t\t\truleFn.call(this) :\r\n\t\t\t\t\truleFn.apply(this, ruleArgs);\r\n\t\t\t\tthis._addToken(origInput, this.input, rule, ruleArgs);\r\n\t\t\t\treturn ans;\r\n\t\t\t};\r\n\t\t},\r\n\r\n\t\t_pred: function(b) {\r\n\t\t\tif (b) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\tthrow fail();\r\n\t\t},\r\n\t\t_not: function(x) {\r\n\t\t\tvar self = this,\r\n\t\t\t\torigInput = this.input;\r\n\t\t\treturn lookup(function() {\r\n\t\t\t\tx.call(self);\r\n\t\t\t}, throwFail, function() {\r\n\t\t\t\tself.input = origInput;\r\n\t\t\t\treturn true;\r\n\t\t\t});\r\n\t\t},\r\n\t\t_lookahead: function(x) {\r\n\t\t\tvar origInput = this.input,\r\n\t\t\t\tr = x.call(this);\r\n\t\t\tthis.input = origInput;\r\n\t\t\treturn r;\r\n\t\t},\r\n\t\t_or: function() {\r\n\t\t\tvar self = this,\r\n\t\t\t\torigInput = this.input,\r\n\t\t\t\targIdx = -1,\r\n\t\t\t\targs = new Array(arguments.length),\r\n\t\t\t\tlookupFunc = function() {\r\n\t\t\t\t\tself.input = origInput;\r\n\t\t\t\t\treturn args[argIdx].call(self);\r\n\t\t\t\t},\r\n\t\t\t\tnext = function() {\r\n\t\t\t\t\targIdx++;\r\n\t\t\t\t\tif (argIdx >= args.length) {\r\n\t\t\t\t\t\tthrow fail();\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn lookup(lookupFunc, identity, next);\r\n\t\t\t\t};\r\n\t\t\tfor(var i = 0; i < args.length; ++i) {\r\n\t\t\t\targs[i] = arguments[i];\r\n\t\t\t};\r\n\t\t\treturn next();\r\n\t\t},\r\n\t\t_xor: function(ruleName) {\r\n\t\t\tvar self = this,\r\n\t\t\t\torigInput = this.input,\r\n\t\t\t\tidx = 1,\r\n\t\t\t\tnewInput,\r\n\t\t\t\tans,\r\n\t\t\t\targ,\r\n\t\t\t\tlookupFunc = function() {\r\n\t\t\t\t\tself.input = origInput;\r\n\t\t\t\t\tans = arg.call(self);\r\n\t\t\t\t\tif (newInput) {\r\n\t\t\t\t\t\tthrow 'more than one choice matched by \"exclusive-OR\" in ' + ruleName;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tnewInput = self.input;\r\n\t\t\t\t};\r\n\r\n\t\t\twhile (idx < arguments.length) {\r\n\t\t\t\targ = arguments[idx];\r\n\r\n\t\t\t\tlookup(lookupFunc);\r\n\t\t\t\tidx++;\r\n\t\t\t}\r\n\r\n\t\t\tif (newInput) {\r\n\t\t\t\tthis.input = newInput;\r\n\t\t\t\treturn ans;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthrow fail();\r\n\t\t\t}\r\n\t\t},\r\n\t\tdisableXORs: function() {\r\n\t\t\tthis._xor = function() {\r\n\t\t\t\tvar self = this,\r\n\t\t\t\t\torigInput = this.input,\r\n\t\t\t\t\tref = {},\r\n\t\t\t\t\tresult = ref,\r\n\t\t\t\t\tlookupFunc = function() {\r\n\t\t\t\t\t\tself.input = origInput;\r\n\t\t\t\t\t\tresult = arg.call(self);\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\tfor (var idx = 1; idx < arguments.length; idx++) {\r\n\t\t\t\t\tvar arg = arguments[idx];\r\n\r\n\t\t\t\t\tlookup(lookupFunc);\r\n\r\n\t\t\t\t\tif (result !== ref) {\r\n\t\t\t\t\t\treturn result;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthrow fail();\r\n\t\t\t};\r\n\t\t},\r\n\t\t_opt: function(x) {\r\n\t\t\tvar self = this,\r\n\t\t\t\torigInput = this.input,\r\n\t\t\t\tans;\r\n\r\n\t\t\tlookup(function() {\r\n\t\t\t\tans = x.call(self);\r\n\t\t\t}, noop, function() {\r\n\t\t\t\tself.input = origInput;\r\n\t\t\t});\r\n\r\n\t\t\treturn ans;\r\n\t\t},\r\n\t\t_many: function(x, y) {\r\n\t\t\tvar self = this,\r\n\t\t\t\torigInput,\r\n\t\t\t\tans = y !== undefined ? [y] : [],\r\n\t\t\t\tresetAndReturnFalse = function () {\r\n\t\t\t\t\tself.input = origInput;\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t},\r\n\t\t\t\tlookupFunc = function() {\r\n\t\t\t\t\torigInput = self.input;\r\n\t\t\t\t\tans.push(x.call(self));\r\n\t\t\t\t};\r\n\r\n\t\t\twhile (lookup(lookupFunc, returnTrue, resetAndReturnFalse));\r\n\r\n\t\t\treturn ans;\r\n\t\t},\r\n\t\t_many1: function(x) {\r\n\t\t\treturn this._many(x, x.call(this));\r\n\t\t},\r\n\t\t_form: function(x) {\r\n\t\t\tvar v = this.anything(),\r\n\t\t\t\torigInput = this.input;\r\n\t\t\tthis._pred(isSequenceable(v));\r\n\t\t\tthis.input = makeListOMInputStream(v, 0);\r\n\t\t\tx.call(this);\r\n\t\t\tthis._apply(\"end\");\r\n\t\t\tthis.input = origInput;\r\n\t\t\treturn v;\r\n\t\t},\r\n\t\t_consumedBy: function(x) {\r\n\t\t\tvar origInput = this.input;\r\n\t\t\tx.call(this);\r\n\t\t\treturn origInput.upTo(this.input);\r\n\t\t},\r\n\t\t_idxConsumedBy: function(x) {\r\n\t\t\tvar origInput = this.input;\r\n\t\t\tx.call(this);\r\n\t\t\treturn {fromIdx: origInput.idx, toIdx: this.input.idx};\r\n\t\t},\r\n\t\t_interleave: function(/* mode1, part1, mode2, part2 ..., moden, partn */) {\r\n\t\t\tvar currInput = this.input, ans = [], idx, args = new Array(arguments.length);\r\n\t\t\tfor(var i = 0; i < args.length; ++i) {\r\n\t\t\t\targs[i] = arguments[i];\r\n\t\t\t}\r\n\t\t\tfor (idx = 0; idx < args.length; idx += 2) {\r\n\t\t\t\tans[idx / 2] = (args[idx] === \"*\" || args[idx] === \"+\") ? [] : undefined;\r\n\t\t\t}\r\n\t\t\twhile (true) {\r\n\t\t\t\tvar allDone = true;\r\n\t\t\t\tidx = 0;\r\n\t\t\t\twhile (idx < args.length) {\r\n\t\t\t\t\tif (args[idx] !== \"0\") {\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tthis.input = currInput;\r\n\t\t\t\t\t\t\tswitch (args[idx]) {\r\n\t\t\t\t\t\t\t\tcase \"*\":\r\n\t\t\t\t\t\t\t\t\tans[idx / 2].push(args[idx + 1].call(this));\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\tcase \"+\":\r\n\t\t\t\t\t\t\t\t\tans[idx / 2].push(args[idx + 1].call(this));\r\n\t\t\t\t\t\t\t\t\targs[idx] = \"*\";\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\tcase \"?\":\r\n\t\t\t\t\t\t\t\t\tans[idx / 2] = args[idx + 1].call(this);\r\n\t\t\t\t\t\t\t\t\targs[idx] = \"0\";\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\tcase \"1\":\r\n\t\t\t\t\t\t\t\t\tans[idx / 2] = args[idx + 1].call(this);\r\n\t\t\t\t\t\t\t\t\targs[idx] = \"0\";\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\tthrow \"invalid mode '\" + args[idx] + \"' in OMeta._interleave\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tcurrInput = this.input;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tcatch (f) {\r\n\t\t\t\t\t\t\tif (!(f instanceof SyntaxError)) {\r\n\t\t\t\t\t\t\t\tthrow f;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t// if this (failed) part's mode is \"1\" or \"+\", we're not done yet\r\n\t\t\t\t\t\t\tallDone = allDone && (args[idx] === \"*\" || args[idx] === \"?\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tidx += 2;\r\n\t\t\t\t}\r\n\t\t\t\tif (idx === args.length) {\r\n\t\t\t\t\tif (allDone) {\r\n\t\t\t\t\t\treturn ans;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tthrow fail();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t_currIdx: function() {\r\n\t\t\treturn this.input.idx;\r\n\t\t},\r\n\r\n\t\t// some basic rules\r\n\t\tanything: function() {\r\n\t\t\tvar r = this.input.head();\r\n\t\t\tthis.input = this.input.tail();\r\n\t\t\treturn r;\r\n\t\t},\r\n\t\t// This is useful for case insensitive matching, as the `.toLowerCase()` will be memoised.\r\n\t\tlowerCaseAnything: function() {\r\n\t\t\treturn this.anything().toLowerCase();\r\n\t\t},\r\n\t\tend: function() {\r\n\t\t\treturn this._not(this.anything);\r\n\t\t},\r\n\t\tpos: function() {\r\n\t\t\treturn this.input.idx;\r\n\t\t},\r\n\t\tempty: returnTrue,\r\n\t\tapply: function(r) {\r\n\t\t\treturn this._apply(r);\r\n\t\t},\r\n\t\tforeign: function(grammar, ruleName) {\r\n\t\t\tvar ans,\r\n\t\t\t\tgrammarInstance = grammar._extend({input: makeOMInputStreamProxy(this.input)});\r\n\t\t\tif(this._tokensEnabled()) {\r\n\t\t\t\tgrammarInstance._enableTokens();\r\n\t\t\t}\r\n\t\t\tans = grammarInstance._apply(ruleName);\r\n\t\t\t// No need to merge tokens as they will automatically have been placed on the root target.\r\n\t\t\tthis.input = grammarInstance.input.target;\r\n\t\t\treturn ans;\r\n\t\t},\r\n\r\n\t\t// some useful \"derived\" rules\r\n\t\texactly: function(wanted) {\r\n\t\t\tthis._pred(wanted === this.anything());\r\n\t\t\treturn wanted;\r\n\t\t},\r\n\t\t\"true\": function() {\r\n\t\t\tvar r = this.anything();\r\n\t\t\tthis._pred(r === true);\r\n\t\t\treturn r;\r\n\t\t},\r\n\t\t\"false\": function() {\r\n\t\t\tvar r = this.anything();\r\n\t\t\tthis._pred(r === false);\r\n\t\t\treturn r;\r\n\t\t},\r\n\t\t\"undefined\": function() {\r\n\t\t\tvar r = this.anything();\r\n\t\t\tthis._pred(r === undefined);\r\n\t\t\treturn r;\r\n\t\t},\r\n\t\tnumber: function() {\r\n\t\t\tvar r = this.anything();\r\n\t\t\tthis._pred(typeof r === \"number\");\r\n\t\t\treturn r;\r\n\t\t},\r\n\t\tstring: function() {\r\n\t\t\tvar r = this.anything();\r\n\t\t\tthis._pred(typeof r === \"string\");\r\n\t\t\treturn r;\r\n\t\t},\r\n\t\t\"char\": function() {\r\n\t\t\tvar r = this.anything();\r\n\t\t\tthis._pred(typeof r === \"string\" && r.length === 1);\r\n\t\t\treturn r;\r\n\t\t},\r\n\t\tspace: function() {\r\n\t\t\tvar r = this._apply(\"char\");\r\n\t\t\tthis._pred(r.charCodeAt(0) <= 32);\r\n\t\t\treturn r;\r\n\t\t},\r\n\t\tspaces: function() {\r\n\t\t\treturn this._many(function() {\r\n\t\t\t\treturn this._apply(\"space\");\r\n\t\t\t});\r\n\t\t},\r\n\t\tdigit: function() {\r\n\t\t\tvar r = this._apply(\"char\");\r\n\t\t\tthis._pred(r >= \"0\" && r <= \"9\");\r\n\t\t\treturn r;\r\n\t\t},\r\n\t\tlower: function() {\r\n\t\t\tvar r = this._apply(\"char\");\r\n\t\t\tthis._pred(r >= \"a\" && r <= \"z\");\r\n\t\t\treturn r;\r\n\t\t},\r\n\t\tupper: function() {\r\n\t\t\tvar r = this._apply(\"char\");\r\n\t\t\tthis._pred(r >= \"A\" && r <= \"Z\");\r\n\t\t\treturn r;\r\n\t\t},\r\n\t\tletter: function() {\r\n\t\t\tvar r = this._apply(\"char\");\r\n\t\t\tthis._pred(r >= \"a\" && r <= \"z\" || r >= \"A\" && r <= \"Z\");\r\n\t\t\treturn r;\r\n\t\t\t// Note: The following code will potentially make use of more memoisations,\r\n\t\t\t// however it will have more overhead and it is unlikely that letter/upper/lower calls will be mixed in a memoisable way.\r\n\t\t\t// return this._or(function() { return this._apply(\"lower\"); },\r\n\t\t\t\t\t\t\t\t\t\t\t// function() { return this._apply(\"upper\"); });\r\n\t\t},\r\n\t\tletterOrDigit: function() {\r\n\t\t\treturn this._or(function() { return this._apply(\"letter\"); },\r\n\t\t\t\tfunction() { return this._apply(\"digit\"); });\r\n\t\t},\r\n\t\tfirstAndRest: function(first, rest) {\r\n\t\t\treturn this._many(function() {\r\n\t\t\t\treturn this._apply(rest);\r\n\t\t\t}, this._apply(first));\r\n\t\t},\r\n\t\tseq: function(xs) {\r\n\t\t\tfor (var idx = 0; idx < xs.length; idx++) {\r\n\t\t\t\tthis._applyWithArgs(\"exactly\", xs[idx]);\r\n\t\t\t}\r\n\t\t\treturn xs;\r\n\t\t},\r\n\t\tnotLast: function(rule) {\r\n\t\t\tvar r = this._apply(rule);\r\n\t\t\tthis._lookahead(function() { return this._apply(rule); });\r\n\t\t\treturn r;\r\n\t\t},\r\n\t\tlistOf: function(rule, delim) {\r\n\t\t\treturn this._or(function() {\r\n\t\t\t\t\tvar r = this._apply(rule);\r\n\t\t\t\t\treturn this._many(function() {\r\n\t\t\t\t\t\t\tthis._applyWithArgs(\"token\", delim);\r\n\t\t\t\t\t\t\treturn this._apply(rule);\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tr\r\n\t\t\t\t\t);\r\n\t\t\t\t},\r\n\t\t\t\tfunction() {\r\n\t\t\t\t\treturn [];\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t},\r\n\t\ttoken: function(cs) {\r\n\t\t\tthis._apply(\"spaces\");\r\n\t\t\treturn this._applyWithArgs(\"seq\", cs);\r\n\t\t},\r\n\t\tfromTo: function (x, y) {\r\n\t\t\treturn this._consumedBy(function() {\r\n\t\t\t\tthis._applyWithArgs(\"seq\", x);\r\n\t\t\t\tthis._many(function() {\r\n\t\t\t\t\tthis._not(function() { this._applyWithArgs(\"seq\", y); });\r\n\t\t\t\t\tthis._apply(\"char\");\r\n\t\t\t\t});\r\n\t\t\t\tthis._applyWithArgs(\"seq\", y);\r\n\t\t\t});\r\n\t\t},\r\n\t\thexDigit: function() {\r\n\t\t\tvar v, c;\r\n\t\t\tc = this._apply(\"char\");\r\n\t\t\tv = \"0123456789abcdef\".indexOf(c.toLowerCase());\r\n\t\t\tif(v === -1) {\r\n\t\t\t\tthrow this._fail();\r\n\t\t\t}\r\n\t\t\treturn v;\r\n\t\t},\r\n\t\tescapedChar: function() {\r\n\t\t\tvar s, c;\r\n\t\t\tthis._applyWithArgs(\"exactly\", \"\\\\\");\r\n\t\t\tc = this.anything();\r\n\t\t\tswitch (c) {\r\n\t\t\t\tcase \"'\":\treturn \"'\";\r\n\t\t\t\tcase '\"':\treturn '\"';\r\n\t\t\t\tcase '\\\\':\treturn '\\\\';\r\n\t\t\t\tcase 'b':\treturn '\\b';\r\n\t\t\t\tcase 'f':\treturn '\\f';\r\n\t\t\t\tcase 'n':\treturn '\\n';\r\n\t\t\t\tcase 'r':\treturn '\\r';\r\n\t\t\t\tcase 't':\treturn '\\t';\r\n\t\t\t\tcase 'v':\treturn '\\v';\r\n\t\t\t\tcase \"u\":\r\n\t\t\t\t\ts = this._consumedBy(function() {\r\n\t\t\t\t\t\tthis._apply(\"hexDigit\");\r\n\t\t\t\t\t\tthis._apply(\"hexDigit\");\r\n\t\t\t\t\t\tthis._apply(\"hexDigit\");\r\n\t\t\t\t\t\tthis._apply(\"hexDigit\");\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn String.fromCharCode(parseInt(s, 16));\r\n\t\t\t\tcase \"x\":\r\n\t\t\t\t\ts = this._consumedBy(function() {\r\n\t\t\t\t\t\tthis._apply(\"hexDigit\");\r\n\t\t\t\t\t\tthis._apply(\"hexDigit\");\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn String.fromCharCode(parseInt(s, 16));\r\n\t\t\t\tdefault:\r\n\t\t\t\t\treturn c;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tinitialize: noop,\r\n\t\t// match and matchAll are a grammar's \"public interface\"\r\n\t\tmatch: function(obj, rule, args, matchFailed) {\r\n\t\t\treturn this.matchAll([obj], rule, args, matchFailed);\r\n\t\t},\r\n\t\tmatchAll: function(listyObj, rule, args, matchFailed) {\r\n\t\t\tvar m = this.createInstance();\r\n\t\t\treturn m.matchAll(listyObj, rule, args, matchFailed);\r\n\t\t},\r\n\t\tcreateInstance: function() {\r\n\t\t\tvar m = objectThatDelegatesTo(this);\r\n\t\t\tm.setInput = function(listyObj) {\r\n\t\t\t\treturn this.inputHead = this.input = makeListOMInputStream(listyObj, 0);\r\n\t\t\t};\r\n\t\t\tm.matchAll = function(listyObj, rule, args, matchFailed) {\r\n\t\t\t\tif (args == null) {\r\n\t\t\t\t\targs = [];\r\n\t\t\t\t}\r\n\t\t\t\tvar realArgs = [rule];\r\n\t\t\t\tfor (var idx = 0; idx < args.length; idx++) {\r\n\t\t\t\t\trealArgs.push(args[idx]);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.setInput(listyObj);\r\n\t\t\t\treturn lookup(function() {\r\n\t\t\t\t\treturn realArgs.length === 1 ?\r\n\t\t\t\t\t\t\tm._apply.call(m, realArgs[0]) :\r\n\t\t\t\t\t\t\tm._applyWithArgs.apply(m, realArgs);\r\n\t\t\t\t}, function(value) {\r\n\t\t\t\t\treturn value;\r\n\t\t\t\t}, function(err) {\r\n\t\t\t\t\terr.OMeta = {};\r\n\t\t\t\t\tvar input = m.input;\r\n\t\t\t\t\tif (input.idx !== undefined) {\r\n\t\t\t\t\t\twhile (input.tl !== undefined && input.tl.idx !== undefined) {\r\n\t\t\t\t\t\t\tinput = input.tl;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\terr.OMeta.idx = input.idx - 1;\r\n\t\t\t\t\t\tif(typeof input.lst == 'string') {\r\n\t\t\t\t\t\t\tvar source = input.lst,\r\n\t\t\t\t\t\t\t\ti = 0,\r\n\t\t\t\t\t\t\t\tchar,\r\n\t\t\t\t\t\t\t\tstart;\r\n\t\t\t\t\t\t\terr.OMeta.line = 1;\r\n\t\t\t\t\t\t\terr.OMeta.col = 0;\r\n\t\t\t\t\t\t\tfor(; i < err.OMeta.idx; i++) {\r\n\t\t\t\t\t\t\t\tchar = source.charAt(i);\r\n\t\t\t\t\t\t\t\terr.OMeta.col++;\r\n\t\t\t\t\t\t\t\tif(char === '\\n') {\r\n\t\t\t\t\t\t\t\t\terr.OMeta.line++;\r\n\t\t\t\t\t\t\t\t\terr.OMeta.col = 0;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (typeof matchFailed === 'function') {\r\n\t\t\t\t\t\treturn matchFailed(m, err);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthrow err;\r\n\t\t\t\t});\r\n\t\t\t};\r\n\t\t\tm.match = function(obj, aRule, args, matchFailed) {\r\n\t\t\t\treturn this.matchAll([obj], aRule, args, matchFailed);\r\n\t\t\t};\r\n\t\t\t// This will reuse memoisations when possible, currently only works for string inputs.\r\n\t\t\tm.enableReusingMemoizations = function(sideEffectingRules) {\r\n\t\t\t\tsideEffectingRules = sideEffectingRules || [];\r\n\t\t\t\tthis.setInput = function(listyObj) {\r\n\t\t\t\t\tvar input = this.inputHead;\r\n\t\t\t\t\tif(input && typeof input.lst === 'string' && typeof listyObj === 'string') {\r\n\t\t\t\t\t\tvar previousText = input.lst;\r\n\t\t\t\t\t\tfor(var divergencePoint = 0, l = Math.min(listyObj.length, previousText.length); divergencePoint < l; divergencePoint++) {\r\n\t\t\t\t\t\t\tif(listyObj.charAt(divergencePoint) !== previousText.charAt(divergencePoint)) {\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// We will have stepped one past the divergence point, so decrement to correct.\r\n\t\t\t\t\t\tdivergencePoint--;\r\n\t\t\t\t\t\t// Step back to the start of any white space to minimise issues with keeping no longer correct memoisations\r\n\t\t\t\t\t\twhile(/\\s/.test(listyObj.charAt(divergencePoint))) {\r\n\t\t\t\t\t\t\tdivergencePoint--;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(divergencePoint > 0) {\r\n\t\t\t\t\t\t\t// If we diverge after the first character then fixup the memoisations.\r\n\t\t\t\t\t\t\tvar cleanInput = function(divergencePoint) {\r\n\t\t\t\t\t\t\t\tvar secondaryDivergencePoint = 0;\r\n\t\t\t\t\t\t\t\tdo {\r\n\t\t\t\t\t\t\t\t\tvar memo = input.memo,\r\n\t\t\t\t\t\t\t\t\t\tmemoTokens = input.tokens,\r\n\t\t\t\t\t\t\t\t\t\truleNames = Object.keys(memo);\r\n\t\t\t\t\t\t\t\t\t// For each memoised rule, delete it if it is a boolean (failer - it may now parse)\r\n\t\t\t\t\t\t\t\t\t// or if it is a rule with side effects.\r\n\t\t\t\t\t\t\t\t\t// or if it ends on or after the point of divergence (the nextInput is guaranteed to be wrong,\r\n\t\t\t\t\t\t\t\t\t// even if the rule will still pass - for the ending on the divergence point then it might be a case that with the change the rule will now encompass more)\r\n\t\t\t\t\t\t\t\t\t// There should be no need to update the memoised new inputs - as we traverse through inputs by idx they should be updated (as they should be references).\r\n\t\t\t\t\t\t\t\t\tfor(var i = 0; i < ruleNames.length; i++) {\r\n\t\t\t\t\t\t\t\t\t\tvar ruleName = ruleNames[i];\r\n\t\t\t\t\t\t\t\t\t\tif(typeof memo[ruleName] === 'boolean'\r\n\t\t\t\t\t\t\t\t\t\t\t|| sideEffectingRules.indexOf(ruleName) !== -1\r\n\t\t\t\t\t\t\t\t\t\t\t|| memo[ruleName].nextInput.idx >= divergencePoint) {\r\n\t\t\t\t\t\t\t\t\t\t\tdelete memo[ruleName];\r\n\t\t\t\t\t\t\t\t\t\t} else if(input.idx > secondaryDivergencePoint && !OMeta.hasOwnProperty(ruleName)) {\r\n\t\t\t\t\t\t\t\t\t\t\tsecondaryDivergencePoint = input.idx;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t// Remove tokens that end on or after the divergence point, similar to memoisation\r\n\t\t\t\t\t\t\t\t\tif(memoTokens != null) {\r\n\t\t\t\t\t\t\t\t\t\tvar duplicateTokens = {};\r\n\t\t\t\t\t\t\t\t\t\tfor(var i = memoTokens.length - 1; i >= 0; i--) {\r\n\t\t\t\t\t\t\t\t\t\t\tif(memoTokens[i][0] >= divergencePoint || duplicateTokens[memoTokens[i][1]]) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tmemoTokens.splice(i, 1);\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\t\t\t\tduplicateTokens[memoTokens[i][1]] = true;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tinput.lst = listyObj;\r\n\t\t\t\t\t\t\t\t} while(input.idx < divergencePoint && (input = input.tail()));\r\n\t\t\t\t\t\t\t\treturn secondaryDivergencePoint;\r\n\t\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\t\tvar secondaryDivergencePoint = cleanInput(divergencePoint);\r\n\r\n\t\t\t\t\t\t\tif(secondaryDivergencePoint > 0) {\r\n\t\t\t\t\t\t\t\tif (secondaryDivergencePoint < divergencePoint) {\r\n\t\t\t\t\t\t\t\t\t// If the secondary divergence (based on last \"real\" rule success) is earlier than the first\r\n\t\t\t\t\t\t\t\t\t// then we need to go back and clean the input for the new divergence point\r\n\t\t\t\t\t\t\t\t\tcleanInput(secondaryDivergencePoint);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tdelete input.tl;\r\n\t\t\t\t\t\t\t\treturn this.input = this.inputHead;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// If we couldn't reuse memoisations for whatever reason then just create a new input.\r\n\t\t\t\t\treturn this.input = this.inputHead = makeListOMInputStream(listyObj, 0);\r\n\t\t\t\t};\r\n\t\t\t};\r\n\r\n\t\t\tm.initialize();\r\n\t\t\treturn m;\r\n\t\t}\r\n\t};\r\n}));","\"use strict\";\n\nvar toInteger = require(\"./to-integer\")\n  , max       = Math.max;\n\nmodule.exports = function (value) { return max(0, toInteger(value)); };\n","\"use strict\";\n\nmodule.exports = require(\"./is-implemented\")()\n\t? require(\"ext/global-this\").Symbol\n\t: require(\"./polyfill\");\n","export const { DEBUG } = process.env;\r\n\r\nexport const cache = {\r\n\tpermissionsLookup: {\r\n\t\tmax: 5000,\r\n\t},\r\n\tparsePermissions: {\r\n\t\tmax: 100000,\r\n\t},\r\n\tparseOData: {\r\n\t\tmax: 100000,\r\n\t},\r\n\todataToAbstractSql: {\r\n\t\tmax: 10000,\r\n\t},\r\n\tabstractSqlCompiler: {\r\n\t\tmax: 10000,\r\n\t},\r\n};\r\n\r\nlet timeoutMS: number;\r\nif (process.env.TRANSACTION_TIMEOUT_MS) {\r\n\ttimeoutMS = parseInt(process.env.TRANSACTION_TIMEOUT_MS, 10);\r\n\tif (Number.isNaN(timeoutMS) || timeoutMS <= 0) {\r\n\t\tthrow new Error(\r\n\t\t\t`Invalid valid for TRANSACTION_TIMEOUT_MS: ${process.env.TRANSACTION_TIMEOUT_MS}`,\r\n\t\t);\r\n\t}\r\n} else {\r\n\ttimeoutMS = 10000;\r\n}\r\n\r\nexport const db = {\r\n\tpoolSize: 50,\r\n\tidleTimeoutMillis: 30000 as number | undefined,\r\n\tstatementTimeout: undefined as number | undefined,\r\n\tqueryTimeout: undefined as number | undefined,\r\n\tconnectionTimeoutMillis: 30000 as number | undefined,\r\n\tkeepAlive: true as boolean | undefined,\r\n\trollbackTimeout: 30000,\r\n\ttimeoutMS,\r\n};\r\n\r\nexport const migrator = {\r\n\tlockTimeout: 5 * 60 * 1000,\r\n\t// Used to delay the failure on lock taking, to avoid spam taking\r\n\tlockFailDelay: 20 * 1000,\r\n};\r\n","\"use strict\";\nconst BigInteger = require(\"./types/big-integer\");\nconst Boolean = require(\"./types/boolean\");\nconst CaseInsensitiveText = require(\"./types/case-insensitive-text\");\nconst Color = require(\"./types/color\");\nconst ConceptType = require(\"./types/concept-type\");\nconst Date = require(\"./types/date\");\nconst DateTime = require(\"./types/date-time\");\nconst File = require(\"./types/file\");\nconst ForeignKey = require(\"./types/foreign-key\");\nconst Hashed = require(\"./types/hashed\");\nconst Integer = require(\"./types/integer\");\nconst Interval = require(\"./types/interval\");\nconst JSON = require(\"./types/json\");\nconst Real = require(\"./types/real\");\nconst Serial = require(\"./types/serial\");\nconst SHA = require(\"./types/sha\");\nconst ShortText = require(\"./types/short-text\");\nconst Text = require(\"./types/text\");\nconst Time = require(\"./types/time\");\nmodule.exports = {\n    'Big Integer': BigInteger,\n    Boolean,\n    'Case Insensitive Text': CaseInsensitiveText,\n    Color,\n    ConceptType,\n    'Date Time': DateTime,\n    Date,\n    File,\n    ForeignKey,\n    Hashed,\n    Integer,\n    Interval,\n    JSON,\n    Real,\n    Serial,\n    SHA,\n    'Short Text': ShortText,\n    Text,\n    Time,\n};\n//# sourceMappingURL=index.js.map","try {\n  var util = require('util');\n  /* istanbul ignore next */\n  if (typeof util.inherits !== 'function') throw '';\n  module.exports = util.inherits;\n} catch (e) {\n  /* istanbul ignore next */\n  module.exports = require('./inherits_browser.js');\n}\n","var Buffer = require('safe-buffer').Buffer\n\n// prototype class for hash functions\nfunction Hash (blockSize, finalSize) {\n  this._block = Buffer.alloc(blockSize)\n  this._finalSize = finalSize\n  this._blockSize = blockSize\n  this._len = 0\n}\n\nHash.prototype.update = function (data, enc) {\n  if (typeof data === 'string') {\n    enc = enc || 'utf8'\n    data = Buffer.from(data, enc)\n  }\n\n  var block = this._block\n  var blockSize = this._blockSize\n  var length = data.length\n  var accum = this._len\n\n  for (var offset = 0; offset < length;) {\n    var assigned = accum % blockSize\n    var remainder = Math.min(length - offset, blockSize - assigned)\n\n    for (var i = 0; i < remainder; i++) {\n      block[assigned + i] = data[offset + i]\n    }\n\n    accum += remainder\n    offset += remainder\n\n    if ((accum % blockSize) === 0) {\n      this._update(block)\n    }\n  }\n\n  this._len += length\n  return this\n}\n\nHash.prototype.digest = function (enc) {\n  var rem = this._len % this._blockSize\n\n  this._block[rem] = 0x80\n\n  // zero (rem + 1) trailing bits, where (rem + 1) is the smallest\n  // non-negative solution to the equation (length + 1 + (rem + 1)) === finalSize mod blockSize\n  this._block.fill(0, rem + 1)\n\n  if (rem >= this._finalSize) {\n    this._update(this._block)\n    this._block.fill(0)\n  }\n\n  var bits = this._len * 8\n\n  // uint32\n  if (bits <= 0xffffffff) {\n    this._block.writeUInt32BE(bits, this._blockSize - 4)\n\n  // uint64\n  } else {\n    var lowBits = (bits & 0xffffffff) >>> 0\n    var highBits = (bits - lowBits) / 0x100000000\n\n    this._block.writeUInt32BE(highBits, this._blockSize - 8)\n    this._block.writeUInt32BE(lowBits, this._blockSize - 4)\n  }\n\n  this._update(this._block)\n  var hash = this._hash()\n\n  return enc ? hash.toString(enc) : hash\n}\n\nHash.prototype._update = function () {\n  throw new Error('_update must be implemented by subclass')\n}\n\nmodule.exports = Hash\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.OData2AbstractSQL = exports.isBindReference = exports.rewriteBinds = exports.odataNameToSqlName = exports.sqlNameToODataName = void 0;\nconst _ = require(\"lodash\");\nconst memoize = require(\"memoizee\");\nconst randomstring = require(\"randomstring\");\nconst convertToModernDefinition = (definition) => {\n    if ('abstractSql' in definition) {\n        return definition;\n    }\n    return {\n        binds: definition.extraBinds,\n        abstractSql: definition.abstractSqlQuery,\n    };\n};\nconst comparison = {\n    eq: 'IsNotDistinctFrom',\n    ne: 'IsDistinctFrom',\n    gt: 'GreaterThan',\n    ge: 'GreaterThanOrEqual',\n    lt: 'LessThan',\n    le: 'LessThanOrEqual',\n};\nconst operations = {\n    add: 'Add',\n    sub: 'Subtract',\n    mul: 'Multiply',\n    div: 'Divide',\n};\nconst rewriteComputed = (computed, tableName, tableAlias) => {\n    const rewrittenComputed = _.cloneDeep(computed);\n    modifyAbstractSql('ReferencedField', rewrittenComputed, (referencedField) => {\n        if (referencedField[1] === tableName) {\n            referencedField[1] = tableAlias;\n        }\n    });\n    return rewrittenComputed;\n};\nconst containsQueryOption = (opts) => {\n    if (opts == null) {\n        return false;\n    }\n    for (const key in opts) {\n        if (key[0] === '$') {\n            return true;\n        }\n    }\n    return false;\n};\nclass Query {\n    constructor() {\n        this.select = [];\n        this.from = [];\n        this.where = [];\n        this.extras = [];\n    }\n    merge(otherQuery) {\n        this.select = this.select.concat(otherQuery.select);\n        this.from = this.from.concat(otherQuery.from);\n        this.where = this.where.concat(otherQuery.where);\n        this.extras = this.extras.concat(otherQuery.extras);\n    }\n    fromResource(odataToAbstractSql, resource, args = odataToAbstractSql, bypassDefinition) {\n        if (bypassDefinition !== true && resource.definition) {\n            const definition = odataToAbstractSql.rewriteDefinition(resource.definition, args.extraBindVars, args.bindVarsLength);\n            this.from.push(['Alias', definition.abstractSql, resource.tableAlias]);\n        }\n        else if (resource.name !== resource.tableAlias) {\n            this.from.push(['Alias', ['Table', resource.name], resource.tableAlias]);\n        }\n        else {\n            this.from.push(['Table', resource.name]);\n        }\n    }\n    compile(queryType) {\n        const compiled = [];\n        let where = this.where;\n        if (queryType === 'SelectQuery') {\n            compiled.push(['Select', this.select]);\n        }\n        this.from.forEach((tableName) => {\n            compiled.push(['From', tableName]);\n        });\n        if (where.length > 0) {\n            if (where.length > 1) {\n                where = [['And', ...where]];\n            }\n            compiled.push(['Where', ...where]);\n        }\n        return [queryType, ...compiled, ...this.extras];\n    }\n}\nexports.sqlNameToODataName = memoize((sqlName) => sqlName.replace(/-/g, '__').replace(/ /g, '_'), { primitive: true });\nexports.odataNameToSqlName = memoize((odataName) => odataName.replace(/__/g, '-').replace(/_/g, ' '), { primitive: true });\nconst modifyAbstractSql = (match, abstractSql, fn) => {\n    if (Array.isArray(abstractSql)) {\n        if (abstractSql[0] === match) {\n            fn(abstractSql);\n        }\n        else {\n            abstractSql.forEach((abstractSqlComponent) => {\n                modifyAbstractSql(match, abstractSqlComponent, fn);\n            });\n        }\n    }\n};\nconst rewriteBinds = (definition, existingBinds, inc = 0) => {\n    const { binds } = definition;\n    if (binds == null || binds.length === 0) {\n        return;\n    }\n    inc += existingBinds.length;\n    modifyAbstractSql('Bind', definition.abstractSql, (bind) => {\n        if (typeof bind[1] === 'number') {\n            bind[1] += inc;\n        }\n    });\n    existingBinds.push(...binds);\n};\nexports.rewriteBinds = rewriteBinds;\nconst isBindReference = (maybeBind) => {\n    return (maybeBind != null &&\n        'bind' in maybeBind &&\n        (typeof maybeBind.bind === 'string' || typeof maybeBind.bind === 'number'));\n};\nexports.isBindReference = isBindReference;\nconst addBodyKey = (resourceName, fieldName, bind, bodyKeys, extraBodyVars) => {\n    const qualifiedIDField = resourceName + '.' + fieldName;\n    if (!bodyKeys.includes(qualifiedIDField) && !bodyKeys.includes(fieldName)) {\n        bodyKeys.push(qualifiedIDField);\n        extraBodyVars[qualifiedIDField] = bind;\n    }\n};\nclass OData2AbstractSQL {\n    constructor(clientModel, methods = {}) {\n        this.clientModel = clientModel;\n        this.methods = methods;\n        this.extraBodyVars = {};\n        this.extraBindVars = [];\n        this.resourceAliases = {};\n        this.bindVarsLength = 0;\n        const MAX_ALIAS_LENGTH = 63;\n        const RANDOM_ALIAS_LENGTH = 12;\n        const shortAliases = generateShortAliases(clientModel);\n        this.checkAlias = memoize((alias) => {\n            let aliasLength = alias.length;\n            if (aliasLength <= MAX_ALIAS_LENGTH) {\n                return alias;\n            }\n            alias = _(alias)\n                .split('.')\n                .map((part) => {\n                if (aliasLength <= MAX_ALIAS_LENGTH) {\n                    return part;\n                }\n                aliasLength -= part.length;\n                const shortAlias = _(part)\n                    .split('-')\n                    .map((part2) => {\n                    part2 = _(part2)\n                        .split(' ')\n                        .map((part3) => {\n                        const shortPart2 = shortAliases[part3];\n                        if (shortPart2) {\n                            return shortPart2;\n                        }\n                        return part3;\n                    })\n                        .join(' ');\n                    const shortPart = shortAliases[part2];\n                    if (shortPart) {\n                        return shortPart;\n                    }\n                    return part2;\n                })\n                    .join('-');\n                aliasLength += shortAlias.length;\n                return shortAlias;\n            })\n                .join('.');\n            if (aliasLength <= MAX_ALIAS_LENGTH) {\n                return alias;\n            }\n            const randStr = randomstring.generate(RANDOM_ALIAS_LENGTH) + '$';\n            return (randStr + alias.slice(randStr.length + alias.length - MAX_ALIAS_LENGTH));\n        });\n    }\n    match(path, method, bodyKeys, bindVarsLength, methods) {\n        const savedMethods = this.methods;\n        try {\n            if (methods != null) {\n                this.methods = methods;\n            }\n            this.reset();\n            this.bindVarsLength = bindVarsLength;\n            let tree;\n            if (_.isEmpty(path)) {\n                tree = ['$serviceroot'];\n            }\n            else if (['$metadata', '$serviceroot'].includes(path.resource)) {\n                tree = [path.resource];\n            }\n            else {\n                const query = this.PathSegment(method, bodyKeys, path);\n                switch (method) {\n                    case 'PUT':\n                        this.putReset();\n                        const insertQuery = this.PathSegment('PUT-INSERT', bodyKeys, path);\n                        tree = [\n                            'UpsertQuery',\n                            insertQuery.compile('InsertQuery'),\n                            query.compile('UpdateQuery'),\n                        ];\n                        break;\n                    case 'GET':\n                        tree = query.compile('SelectQuery');\n                        break;\n                    case 'PATCH':\n                    case 'MERGE':\n                        tree = query.compile('UpdateQuery');\n                        break;\n                    case 'POST':\n                        tree = query.compile('InsertQuery');\n                        break;\n                    case 'DELETE':\n                        tree = query.compile('DeleteQuery');\n                        break;\n                    default:\n                        throw new SyntaxError(`Unknown method \"${method}\"`);\n                }\n            }\n            return {\n                tree,\n                extraBodyVars: this.extraBodyVars,\n                extraBindVars: this.extraBindVars,\n            };\n        }\n        finally {\n            this.methods = savedMethods;\n        }\n    }\n    PathSegment(method, bodyKeys, path) {\n        var _a;\n        if (!path.resource) {\n            throw new SyntaxError('Path segment must contain a resource');\n        }\n        const hasQueryOpts = containsQueryOption(path.options);\n        const resource = this.Resource(path.resource, this.defaultResource);\n        this.defaultResource = resource;\n        const query = new Query();\n        const bypassDefinition = method !== 'GET';\n        query.fromResource(this, resource, this, bypassDefinition);\n        const referencedIdField = [\n            'ReferencedField',\n            resource.tableAlias,\n            resource.idField,\n        ];\n        const pathKeyWhere = this.PathKey(method, path, resource, bodyKeys);\n        let addPathKey = true;\n        if (hasQueryOpts && ((_a = path.options) === null || _a === void 0 ? void 0 : _a.$expand)) {\n            this.Expands(resource, query, path.options.$expand.properties);\n        }\n        let bindVars;\n        if (path.property) {\n            const childQuery = this.PathSegment(method, bodyKeys, path.property);\n            query.merge(childQuery);\n            if (!path.property.resource) {\n                throw new SyntaxError('PathSegment has a property without a resource?');\n            }\n            const navigation = this.NavigateResources(resource, path.property.resource);\n            query.where.push(navigation.where);\n        }\n        else if (path.link) {\n            if (!path.link.resource) {\n                throw new SyntaxError('PathSegment has a link without a resource?');\n            }\n            const linkResource = this.Resource(path.link.resource, resource);\n            let aliasedField;\n            let referencedField;\n            if (this.FieldContainedIn(linkResource.resourceName, resource)) {\n                referencedField = this.ReferencedField(resource, linkResource.resourceName);\n                aliasedField = ['Alias', referencedField, linkResource.resourceName];\n            }\n            else if (this.FieldContainedIn(resource.resourceName, linkResource)) {\n                referencedField = this.ReferencedField(linkResource, resource.resourceName);\n                aliasedField = ['Alias', referencedField, resource.resourceName];\n            }\n            else {\n                throw new Error('Cannot navigate links');\n            }\n            if (path.link.key != null) {\n                if (exports.isBindReference(path.link.key)) {\n                    query.where.push([\n                        comparison.eq,\n                        referencedField,\n                        this.Bind(path.link.key),\n                    ]);\n                }\n                else {\n                    throw new SyntaxError('Cannot use named keys with $links');\n                }\n            }\n            query.select.push(aliasedField);\n        }\n        else if (method === 'PUT' ||\n            method === 'PUT-INSERT' ||\n            method === 'POST' ||\n            method === 'PATCH' ||\n            method === 'MERGE') {\n            const resourceMapping = this.ResourceMapping(resource);\n            bindVars = this.BindVars(method, bodyKeys, resource.resourceName, Object.entries(resourceMapping));\n            query.extras.push(['Fields', bindVars.map((b) => b[0])]);\n            if ((hasQueryOpts || resource.definition || pathKeyWhere != null) &&\n                (method === 'POST' || method === 'PUT-INSERT')) {\n                const subQuery = new Query();\n                subQuery.select = bindVars.map((bindVar) => [\n                    'ReferencedField',\n                    resource.tableAlias,\n                    bindVar[0],\n                ]);\n                const bindVarSelectQuery = [\n                    'SelectQuery',\n                    [\n                        'Select',\n                        resource.fields.map((field) => {\n                            const alias = field.fieldName;\n                            const bindVar = bindVars === null || bindVars === void 0 ? void 0 : bindVars.find((v) => v[0] === alias);\n                            const value = bindVar ? bindVar[1] : 'Null';\n                            return ['Alias', ['Cast', value, field.dataType], alias];\n                        }),\n                    ],\n                ];\n                const unionResource = { ...resource };\n                if (unionResource.definition == null ||\n                    !_.isObject(unionResource.definition)) {\n                    unionResource.definition = {\n                        binds: [],\n                        abstractSql: bindVarSelectQuery,\n                    };\n                }\n                else {\n                    unionResource.definition = {\n                        ...convertToModernDefinition(unionResource.definition),\n                    };\n                    if (unionResource.definition.abstractSql[0] !== 'SelectQuery') {\n                        throw new Error('Only select query definitions supported for inserts');\n                    }\n                    const isTable = (part) => part[0] === 'Table' && part[1] === unionResource.name;\n                    if (isTable(unionResource.definition.abstractSql)) {\n                        unionResource.definition.abstractSql = bindVarSelectQuery;\n                    }\n                    else {\n                        let found = false;\n                        unionResource.definition.abstractSql = unionResource.definition.abstractSql.map((part) => {\n                            if (part[0] === 'From') {\n                                if (isTable(part[1])) {\n                                    found = true;\n                                    return [\n                                        'From',\n                                        ['Alias', bindVarSelectQuery, unionResource.name],\n                                    ];\n                                }\n                                else if (part[1][0] === 'Alias' && isTable(part[1][1])) {\n                                    found = true;\n                                    return ['From', ['Alias', bindVarSelectQuery, part[1][2]]];\n                                }\n                            }\n                            return part;\n                        });\n                        if (!found) {\n                            throw new Error('Could not replace table entry in definition for insert');\n                        }\n                    }\n                }\n                if (hasQueryOpts) {\n                    this.AddQueryOptions(resource, path, subQuery);\n                }\n                subQuery.fromResource(this, unionResource);\n                addPathKey = false;\n                if (pathKeyWhere != null) {\n                    subQuery.where.push(pathKeyWhere);\n                }\n                query.extras.push([\n                    'Values',\n                    subQuery.compile('SelectQuery'),\n                ]);\n            }\n            else {\n                query.extras.push(['Values', bindVars.map((b) => b[1])]);\n            }\n        }\n        else if (path.count) {\n            this.AddCountField(path, query);\n        }\n        else {\n            this.AddSelectFields(path, query, resource);\n        }\n        if (addPathKey && pathKeyWhere != null) {\n            query.where.push(pathKeyWhere);\n        }\n        if ((hasQueryOpts || resource.definition) &&\n            (method === 'PUT' ||\n                method === 'PATCH' ||\n                method === 'MERGE' ||\n                method === 'DELETE')) {\n            const subQuery = new Query();\n            subQuery.select.push(referencedIdField);\n            subQuery.fromResource(this, resource);\n            if (hasQueryOpts) {\n                this.AddQueryOptions(resource, path, subQuery);\n            }\n            query.where.push([\n                'In',\n                referencedIdField,\n                subQuery.compile('SelectQuery'),\n            ]);\n        }\n        else if (hasQueryOpts && method === 'GET') {\n            this.AddQueryOptions(resource, path, query);\n        }\n        return query;\n    }\n    PathKey(method, path, resource, bodyKeys) {\n        const { key } = path;\n        if (key != null) {\n            if (method === 'PUT' || method === 'PUT-INSERT' || method === 'POST') {\n                if (exports.isBindReference(key)) {\n                    addBodyKey(resource.resourceName, resource.idField, key, bodyKeys, this.extraBodyVars);\n                }\n                else {\n                    for (const [fieldName, bind] of Object.entries(key)) {\n                        addBodyKey(resource.resourceName, fieldName, bind, bodyKeys, this.extraBodyVars);\n                    }\n                }\n            }\n            if (exports.isBindReference(key)) {\n                const bind = this.Bind(key);\n                const referencedField = [\n                    'ReferencedField',\n                    resource.tableAlias,\n                    resource.idField,\n                ];\n                return [comparison.eq, referencedField, bind];\n            }\n            const fieldNames = Object.keys(key);\n            const sqlFieldNames = fieldNames.map(exports.odataNameToSqlName).sort();\n            const fields = sqlFieldNames.map((fieldName) => {\n                const resourceField = resource.fields.find((f) => f.fieldName === fieldName);\n                if (resourceField == null) {\n                    throw new SyntaxError('Specified non-existent field for path key');\n                }\n                return resourceField;\n            });\n            if (!(fields.length === 1 &&\n                (fields[0].index === 'UNIQUE' || fields[0].index === 'PRIMARY KEY')) &&\n                !resource.indexes.some((index) => {\n                    return ((index.type === 'UNIQUE' || index.type === 'PRIMARY KEY') &&\n                        sqlFieldNames.length === index.fields.length &&\n                        _.isEqual(index.fields.slice().sort(), sqlFieldNames));\n                })) {\n                throw new SyntaxError('Specified fields for path key that are not directly unique');\n            }\n            const namedKeys = fieldNames.map((fieldName) => {\n                const bind = this.Bind(key[fieldName]);\n                const referencedField = this.ReferencedField(resource, fieldName);\n                return [comparison.eq, referencedField, bind];\n            });\n            if (namedKeys.length === 1) {\n                return namedKeys[0];\n            }\n            return ['And', ...namedKeys];\n        }\n    }\n    Bind(bind, optional = false) {\n        if (exports.isBindReference(bind)) {\n            return ['Bind', bind.bind];\n        }\n        if (optional) {\n            return;\n        }\n        throw new SyntaxError(`Could not match bind reference`);\n    }\n    SelectFilter(filter, query, resource) {\n        this.AddExtraFroms(query, resource, filter);\n        const where = this.BooleanMatch(filter);\n        query.where.push(where);\n    }\n    OrderBy(orderby, query, resource) {\n        this.AddExtraFroms(query, resource, orderby.properties);\n        query.extras.push([\n            'OrderBy',\n            ...this.OrderByProperties(orderby.properties),\n        ]);\n    }\n    OrderByProperties(orderings) {\n        return orderings.map((ordering) => {\n            const field = this.ReferencedProperty(ordering);\n            return [ordering.order.toUpperCase(), field];\n        });\n    }\n    BindVars(method, bodyKeys, resourceName, match) {\n        const fields = match.map((field) => {\n            const [fieldName, [, mappedFieldName]] = field;\n            if (bodyKeys.includes(fieldName) ||\n                bodyKeys.includes(resourceName + '.' + fieldName)) {\n                return [mappedFieldName, ['Bind', resourceName, fieldName]];\n            }\n            if (method === 'PUT') {\n                return [mappedFieldName, 'Default'];\n            }\n        });\n        return _.compact(fields);\n    }\n    Resource(resourceName, parentResource) {\n        const resourceAlias = this.resourceAliases[resourceName];\n        if (resourceAlias) {\n            return resourceAlias;\n        }\n        let resource;\n        if (parentResource) {\n            const relationshipMapping = this.ResolveRelationship(parentResource, resourceName);\n            resource = this.clientModel.tables[relationshipMapping[1][0]];\n        }\n        else {\n            let sqlName = exports.odataNameToSqlName(resourceName);\n            sqlName = this.Synonym(sqlName);\n            resource = this.clientModel.tables[sqlName];\n        }\n        if (!resource) {\n            throw new SyntaxError('Could not match resource');\n        }\n        let tableAlias;\n        if (parentResource) {\n            let resourceAlias2;\n            if (resourceName.includes('__') && !resource.name.includes('-')) {\n                const verb = exports.odataNameToSqlName(resourceName).split('-')[0];\n                resourceAlias2 = verb + '-' + resource.name;\n            }\n            else {\n                resourceAlias2 = resource.name;\n            }\n            tableAlias = parentResource.tableAlias + '.' + resourceAlias2;\n        }\n        else {\n            tableAlias = resource.name;\n        }\n        return {\n            ...resource,\n            tableAlias: this.checkAlias(tableAlias),\n        };\n    }\n    FieldContainedIn(fieldName, resource) {\n        try {\n            this.ResolveRelationship(resource, fieldName);\n            return true;\n        }\n        catch (e) {\n            if (e instanceof SyntaxError) {\n                return false;\n            }\n            throw e;\n        }\n    }\n    ResourceMapping(resource) {\n        const tableAlias = resource.tableAlias\n            ? resource.tableAlias\n            : resource.name;\n        const resourceMappings = {};\n        for (const { fieldName } of resource.fields) {\n            resourceMappings[exports.sqlNameToODataName(fieldName)] = [tableAlias, fieldName];\n        }\n        return resourceMappings;\n    }\n    ResolveRelationship(resource, relationship) {\n        let resourceName;\n        if (typeof resource === 'object') {\n            resourceName = resource.resourceName;\n        }\n        else if (this.resourceAliases[resource]) {\n            resourceName = this.resourceAliases[resource].resourceName;\n        }\n        else {\n            resourceName = resource;\n        }\n        resourceName = this.Synonym(resourceName);\n        const resourceRelations = this.clientModel.relationships[resourceName];\n        if (!resourceRelations) {\n            throw new SyntaxError(`Could not resolve relationship for '${resourceName}'`);\n        }\n        const relationshipPath = _(relationship)\n            .split('__')\n            .map(exports.odataNameToSqlName)\n            .flatMap((sqlName) => this.Synonym(sqlName).split('-'))\n            .value();\n        const relationshipMapping = _.get(resourceRelations, relationshipPath);\n        if (!relationshipMapping || !relationshipMapping.$) {\n            throw new SyntaxError(`Could not resolve relationship mapping from '${resourceName}' to '${relationshipPath}'`);\n        }\n        return relationshipMapping.$;\n    }\n    AddCountField(path, query) {\n        if (path.count) {\n            query.select.push(['Alias', ['Count', '*'], '$count']);\n        }\n    }\n    AddSelectFields(path, query, resource) {\n        let odataFieldNames;\n        if (path.options &&\n            path.options.$select &&\n            path.options.$select.properties) {\n            this.AddExtraFroms(query, resource, path.options.$select.properties);\n            odataFieldNames = path.options.$select.properties.map((prop) => {\n                const field = this.Property(prop);\n                const sqlName = exports.odataNameToSqlName(field.name);\n                const resourceField = field.resource.fields.find(({ fieldName }) => fieldName === sqlName);\n                return [field.resource, field.name, resourceField === null || resourceField === void 0 ? void 0 : resourceField.computed];\n            });\n        }\n        else {\n            odataFieldNames = resource.fields.map((field) => [\n                resource,\n                exports.sqlNameToODataName(field.fieldName),\n                field.computed,\n            ]);\n        }\n        const fields = _.differenceWith(odataFieldNames, query.select, (a, b) => a[1] === _.last(b)).map((args) => this.AliasSelectField(...args));\n        query.select = query.select.concat(fields);\n    }\n    AliasSelectField(resource, fieldName, computed, alias = fieldName) {\n        if (computed) {\n            if (resource.tableAlias != null &&\n                resource.tableAlias !== resource.name) {\n                computed = rewriteComputed(computed, resource.name, resource.tableAlias);\n            }\n            return ['Alias', computed, alias];\n        }\n        const referencedField = this.ReferencedField(resource, fieldName);\n        if (referencedField[2] === alias) {\n            return referencedField;\n        }\n        return ['Alias', referencedField, alias];\n    }\n    ReferencedField(resource, resourceField) {\n        const mapping = this.ResourceMapping(resource);\n        if (mapping[resourceField]) {\n            return [\n                'ReferencedField',\n                mapping[resourceField][0],\n                mapping[resourceField][1],\n            ];\n        }\n        else {\n            const relationshipMapping = this.ResolveRelationship(resource, resourceField);\n            const tableAlias = resource.tableAlias\n                ? resource.tableAlias\n                : resource.name;\n            if (relationshipMapping.length > 1 &&\n                relationshipMapping[0] === resource.idField) {\n                throw new SyntaxError('Attempted to directly fetch a virtual field: \"' +\n                    resourceField +\n                    '\"');\n            }\n            return ['ReferencedField', tableAlias, relationshipMapping[0]];\n        }\n    }\n    BooleanMatch(match, optional = false) {\n        switch (match) {\n            case true:\n            case false:\n                return ['Boolean', match];\n            default:\n                if (Array.isArray(match)) {\n                    const [type, ...rest] = match;\n                    switch (type) {\n                        case 'eq':\n                        case 'ne':\n                        case 'gt':\n                        case 'ge':\n                        case 'lt':\n                        case 'le':\n                            const op1 = this.Operand(rest[0]);\n                            const op2 = this.Operand(rest[1]);\n                            return [\n                                comparison[type],\n                                op1,\n                                op2,\n                            ];\n                        case 'and':\n                        case 'or':\n                            return [\n                                _.capitalize(type),\n                                ...rest.map((v) => this.BooleanMatch(v)),\n                            ];\n                        case 'not':\n                            const bool = this.BooleanMatch(rest[0]);\n                            return ['Not', bool];\n                        case 'in':\n                            return [\n                                'In',\n                                this.Operand(rest[0]),\n                                ...rest[1].map((v) => this.Operand(v)),\n                            ];\n                        case 'call':\n                            const { method } = match[1];\n                            switch (method) {\n                                case 'contains':\n                                case 'endswith':\n                                case 'startswith':\n                                case 'isof':\n                                case 'substringof':\n                                    return this.FunctionMatch(method, match);\n                                default:\n                                    if (optional) {\n                                        return;\n                                    }\n                                    throw new SyntaxError(`${method} is not a boolean function`);\n                            }\n                        default:\n                            if (optional) {\n                                return;\n                            }\n                            throw new SyntaxError(`Boolean does not support ${type}`);\n                    }\n                }\n                else {\n                    try {\n                        return this.ReferencedProperty(match);\n                    }\n                    catch (e) {\n                        if (optional) {\n                            return;\n                        }\n                        throw e;\n                    }\n                }\n        }\n    }\n    AliasedFunction(odataName, sqlName, match) {\n        const fn = this.FunctionMatch(odataName, match);\n        return [sqlName, ...fn.slice(1)];\n    }\n    FunctionMatch(name, match) {\n        if (!Array.isArray(match) || match[0] !== 'call') {\n            throw new SyntaxError('Not a function call');\n        }\n        const properties = match[1];\n        if (properties.method !== name) {\n            throw new SyntaxError('Unexpected function name');\n        }\n        const args = properties.args.map((v) => this.Operand(v));\n        return [_.capitalize(name), ...args];\n    }\n    Operand(match) {\n        for (const matcher of [\n            this.Bind,\n            this.NullMatch,\n            this.BooleanMatch,\n            this.NumberMatch,\n            this.TextMatch,\n            this.DateMatch,\n            this.DurationMatch,\n            this.Math,\n        ]) {\n            const result = matcher.call(this, match, true);\n            if (result) {\n                return result;\n            }\n        }\n        throw new SyntaxError('Could not match operand');\n    }\n    Math(match) {\n        const [type, ...rest] = match;\n        switch (type) {\n            case 'add':\n            case 'sub':\n            case 'mul':\n            case 'div':\n                return [\n                    operations[type],\n                    this.Operand(rest[0]),\n                    this.Operand(rest[1]),\n                ];\n            default:\n                return;\n        }\n    }\n    Lambda(resourceName, lambda) {\n        const resourceAliases = this.resourceAliases;\n        const defaultResource = this.defaultResource;\n        try {\n            const query = new Query();\n            const resource = this.AddNavigation(query, this.defaultResource, resourceName);\n            this.resourceAliases = { ...this.resourceAliases };\n            this.resourceAliases[lambda.identifier] = resource;\n            this.defaultResource = resource;\n            this.AddExtraFroms(query, resource, lambda.expression);\n            const filter = this.BooleanMatch(lambda.expression);\n            if (lambda.method === 'any') {\n                query.where.push(filter);\n                return ['Exists', query.compile('SelectQuery')];\n            }\n            else if (lambda.method === 'all') {\n                query.where.push(['Not', filter]);\n                return [\n                    'Not',\n                    ['Exists', query.compile('SelectQuery')],\n                ];\n            }\n            else {\n                throw new SyntaxError(`Lambda method does not support ${lambda.method}`);\n            }\n        }\n        finally {\n            this.resourceAliases = resourceAliases;\n            this.defaultResource = defaultResource;\n        }\n    }\n    ReferencedProperty(match) {\n        const prop = this.Property(match);\n        if (Array.isArray(prop)) {\n            return prop;\n        }\n        else {\n            return this.ReferencedField(prop.resource, prop.name);\n        }\n    }\n    Method(prop) {\n        if (!prop.method) {\n            throw new SyntaxError('Method is missing method entry');\n        }\n        if (prop.method[0] !== 'call') {\n            throw new SyntaxError(`Invalid value for method invocation: ${prop.method[0]}`);\n        }\n        if (typeof prop.method[1] !== 'object') {\n            throw new SyntaxError(`Invalid value for method invocation: ${prop.method[1]} should be an object`);\n        }\n        const { method } = prop.method[1];\n        if (!this.methods.hasOwnProperty(method)) {\n            throw new SyntaxError(`Method ${method} is unknown`);\n        }\n        return this.methods[method].call(this, prop);\n    }\n    Property(prop) {\n        if (!prop.name) {\n            throw new SyntaxError('Property is missing name');\n        }\n        if (prop.property) {\n            const defaultResource = this.defaultResource;\n            let propResource;\n            try {\n                propResource = this.Resource(prop.name, this.defaultResource);\n            }\n            catch (_a) {\n            }\n            if (propResource) {\n                try {\n                    this.defaultResource = propResource;\n                    return this.Property(prop.property);\n                }\n                finally {\n                    this.defaultResource = defaultResource;\n                }\n            }\n            else {\n                return this.Property(prop.property);\n            }\n        }\n        else if (prop.method) {\n            return this.Method(prop);\n        }\n        else if (prop.lambda) {\n            return this.Lambda(prop.name, prop.lambda);\n        }\n        else if (prop.count) {\n            const query = new Query();\n            query.select.push(['Count', '*']);\n            this.AddNavigation(query, this.defaultResource, prop.name);\n            return query.compile('SelectQuery');\n        }\n        else {\n            return { resource: this.defaultResource, name: prop.name };\n        }\n    }\n    NumberMatch(match, optional = false) {\n        if (typeof match === 'number') {\n            return ['Number', match];\n        }\n        else if (Array.isArray(match) && match[0] === 'call') {\n            const { method } = match[1];\n            switch (method) {\n                case 'indexof':\n                case 'year':\n                case 'month':\n                case 'day':\n                case 'day':\n                case 'hour':\n                case 'minute':\n                case 'second':\n                case 'fractionalseconds':\n                case 'totaloffsetminutes':\n                case 'totalseconds':\n                case 'round':\n                case 'floor':\n                case 'ceiling':\n                    return this.FunctionMatch(method, match);\n                case 'length':\n                    return this.AliasedFunction('length', 'CharacterLength', match);\n                default:\n                    if (optional) {\n                        return;\n                    }\n                    throw new SyntaxError(`${method} is not a number function`);\n            }\n        }\n        else if (optional) {\n            return;\n        }\n        else {\n            throw new SyntaxError('Failed to match a Number entry');\n        }\n    }\n    NullMatch(match, _optional) {\n        if (match === null) {\n            return ['Null'];\n        }\n    }\n    TextMatch(match, optional = false) {\n        if (typeof match === 'string') {\n            return ['Text', match];\n        }\n        else if (Array.isArray(match) && match[0] === 'call') {\n            const { method } = match[1];\n            switch (method) {\n                case 'tolower':\n                case 'toupper':\n                case 'trim':\n                case 'concat':\n                case 'replace':\n                    return this.FunctionMatch(method, match);\n                case 'date':\n                    return this.AliasedFunction('date', 'ToDate', match);\n                case 'time':\n                    return this.AliasedFunction('time', 'ToTime', match);\n                case 'substring':\n                    const fn = this.FunctionMatch(method, match);\n                    fn[2] = ['Add', fn[2], ['Number', 1]];\n                    return fn;\n                default:\n                    if (optional) {\n                        return;\n                    }\n                    throw new SyntaxError(`${method} is not a number function`);\n            }\n        }\n        else if (optional) {\n            return;\n        }\n        else {\n            throw new SyntaxError('Failed to match a Text entry');\n        }\n    }\n    DateMatch(match, optional = false) {\n        if (_.isDate(match)) {\n            return ['Date', match];\n        }\n        else if (Array.isArray(match) && match[0] === 'call') {\n            const { method } = match[1];\n            switch (method) {\n                case 'now':\n                case 'maxdatetime':\n                case 'mindatetime':\n                    return this.FunctionMatch(method, match);\n                default:\n                    if (optional) {\n                        return;\n                    }\n                    throw new SyntaxError(`${method} is not a date function`);\n            }\n        }\n        else if (optional) {\n            return;\n        }\n        else {\n            throw new SyntaxError('Failed to match a Date entry');\n        }\n    }\n    DurationMatch(match) {\n        if (!_.isObject(match)) {\n            return;\n        }\n        const duration = _(match)\n            .pick('negative', 'day', 'hour', 'minute', 'second')\n            .omitBy(_.isNil)\n            .value();\n        if (_(duration).omit('negative').isEmpty()) {\n            return;\n        }\n        return ['Duration', duration];\n    }\n    Expands(resource, query, expands) {\n        const defaultResource = this.defaultResource;\n        for (const expand of expands) {\n            const navigation = this.NavigateResources(resource, expand.name);\n            const expandResource = navigation.resource;\n            {\n                this.defaultResource = expandResource;\n            }\n            const nestedExpandQuery = new Query();\n            if (expand.property) {\n                this.Expands(expandResource, nestedExpandQuery, [expand.property]);\n            }\n            if (expand.options && expand.options.$expand) {\n                this.Expands(expandResource, nestedExpandQuery, expand.options.$expand.properties);\n            }\n            nestedExpandQuery.fromResource(this, expandResource);\n            if (expand.count) {\n                this.AddCountField(expand, nestedExpandQuery);\n            }\n            else {\n                this.AddSelectFields(expand, nestedExpandQuery, expandResource);\n            }\n            this.AddQueryOptions(expandResource, expand, nestedExpandQuery);\n            this.defaultResource = defaultResource;\n            nestedExpandQuery.where.push(navigation.where);\n            const expandQuery = new Query();\n            expandQuery.select.push([\n                'Alias',\n                ['AggregateJSON', [expandResource.tableAlias, '*']],\n                expand.name,\n            ]);\n            expandQuery.from.push([\n                'Alias',\n                nestedExpandQuery.compile('SelectQuery'),\n                expandResource.tableAlias,\n            ]);\n            query.select.push([\n                'Alias',\n                expandQuery.compile('SelectQuery'),\n                expand.name,\n            ]);\n        }\n    }\n    AddQueryOptions(resource, path, query) {\n        if (!path.options) {\n            return;\n        }\n        if (path.options.$filter) {\n            this.SelectFilter(path.options.$filter, query, resource);\n        }\n        if (!path.count) {\n            if (path.options.$orderby) {\n                this.OrderBy(path.options.$orderby, query, resource);\n            }\n            if (path.options.$top) {\n                const limit = this.NumberMatch(path.options.$top);\n                query.extras.push(['Limit', limit]);\n            }\n            if (path.options.$skip) {\n                const offset = this.NumberMatch(path.options.$skip);\n                query.extras.push(['Offset', offset]);\n            }\n        }\n    }\n    NavigateResources(resource, navigation) {\n        const relationshipMapping = this.ResolveRelationship(resource, navigation);\n        const linkedResource = this.Resource(navigation, resource);\n        const tableAlias = resource.tableAlias\n            ? resource.tableAlias\n            : resource.name;\n        const linkedTableAlias = linkedResource.tableAlias\n            ? linkedResource.tableAlias\n            : linkedResource.name;\n        return {\n            resource: linkedResource,\n            where: [\n                'Equals',\n                ['ReferencedField', tableAlias, relationshipMapping[0]],\n                ['ReferencedField', linkedTableAlias, relationshipMapping[1][1]],\n            ],\n        };\n    }\n    AddExtraFroms(query, parentResource, match) {\n        try {\n            if (Array.isArray(match)) {\n                match.forEach((v) => this.AddExtraFroms(query, parentResource, v));\n            }\n            else {\n                let nextProp = match;\n                let prop;\n                while ((prop = nextProp) &&\n                    prop.name &&\n                    prop.property &&\n                    prop.property.name) {\n                    nextProp = prop.property;\n                    const resourceAlias = this.resourceAliases[prop.name];\n                    if (resourceAlias) {\n                        parentResource = resourceAlias;\n                    }\n                    else {\n                        parentResource = this.AddNavigation(query, parentResource, prop.name);\n                    }\n                }\n                if (nextProp && nextProp.args) {\n                    this.AddExtraFroms(query, parentResource, prop.args);\n                }\n            }\n        }\n        catch (_a) {\n        }\n    }\n    AddNavigation(query, resource, extraResource) {\n        const navigation = this.NavigateResources(resource, extraResource);\n        if (!query.from.some((from) => (from[0] === 'Table' && from[1] === navigation.resource.tableAlias) ||\n            (from[0] === 'Alias' && from[2] === navigation.resource.tableAlias))) {\n            query.fromResource(this, navigation.resource);\n            query.where.push(navigation.where);\n            return navigation.resource;\n        }\n        else {\n            throw new SyntaxError(`Could not navigate resources '${resource.name}' and '${extraResource}'`);\n        }\n    }\n    reset() {\n        this.putReset();\n        this.extraBodyVars = {};\n        this.extraBindVars = [];\n    }\n    putReset() {\n        this.resourceAliases = {};\n        this.defaultResource = undefined;\n    }\n    Synonym(sqlName) {\n        return _(sqlName)\n            .split('-')\n            .map((namePart) => {\n            const synonym = this.clientModel.synonyms[namePart];\n            if (synonym) {\n                return synonym;\n            }\n            return namePart;\n        })\n            .join('-');\n    }\n    rewriteDefinition(definition, extraBindVars, bindVarsLength) {\n        const rewrittenDefinition = _.cloneDeep(convertToModernDefinition(definition));\n        exports.rewriteBinds(rewrittenDefinition, extraBindVars, bindVarsLength);\n        modifyAbstractSql('Resource', rewrittenDefinition.abstractSql, (resource) => {\n            const resourceName = resource[1];\n            const referencedResource = this.clientModel.tables[resourceName];\n            if (!referencedResource) {\n                throw new Error(`Could not resolve resource ${resourceName}`);\n            }\n            if (referencedResource.definition) {\n                const subDefinition = this.rewriteDefinition(referencedResource.definition, extraBindVars, bindVarsLength);\n                resource.splice(0, resource.length, ...subDefinition.abstractSql);\n            }\n            else if (referencedResource.fields.some((field) => field.computed != null)) {\n                const computedFieldQuery = new Query();\n                computedFieldQuery.select = referencedResource.fields.map((field) => this.AliasSelectField(referencedResource, exports.sqlNameToODataName(field.fieldName), field.computed, field.fieldName));\n                computedFieldQuery.fromResource(this, {\n                    ...referencedResource,\n                    tableAlias: referencedResource.name,\n                });\n                resource.splice(0, resource.length, ...computedFieldQuery.compile('SelectQuery'));\n            }\n            else {\n                resource.splice(0, resource.length, ...['Table', referencedResource.name]);\n            }\n        });\n        return rewrittenDefinition;\n    }\n}\nexports.OData2AbstractSQL = OData2AbstractSQL;\nconst addAliases = (shortAliases, origAliasParts) => {\n    const trie = {};\n    const buildTrie = (aliasPart) => {\n        let node = trie;\n        for (let i = 0; i < aliasPart.length; i++) {\n            if (node.$suffix) {\n                node[node.$suffix[0]] = {\n                    $suffix: node.$suffix.slice(1),\n                };\n                delete node.$suffix;\n            }\n            const c = aliasPart[i];\n            if (node[c]) {\n                node = node[c];\n            }\n            else {\n                node[c] = {\n                    $suffix: aliasPart.slice(i + 1),\n                };\n                return;\n            }\n        }\n    };\n    const traverseNodes = (str, node) => {\n        if (node.$suffix) {\n            const index = lowerCaseAliasParts.indexOf(str + node.$suffix);\n            const origAliasPart = origAliasParts[index];\n            shortAliases[origAliasPart] = origAliasPart.slice(0, str.length);\n        }\n        else {\n            _.forEach(node, (value, key) => {\n                traverseNodes(str + key, value);\n            });\n        }\n    };\n    const lowerCaseAliasParts = origAliasParts.map((origAliasPart) => origAliasPart.toLowerCase());\n    lowerCaseAliasParts.slice().sort().forEach(buildTrie);\n    traverseNodes('', trie);\n};\nconst getRelationships = (relationships, nestedRelationships = []) => {\n    const relationshipKeys = Object.keys(relationships);\n    for (const key of relationshipKeys) {\n        if (key !== '$') {\n            nestedRelationships.push(key);\n            getRelationships(relationships[key], nestedRelationships);\n        }\n    }\n    return nestedRelationships;\n};\nconst generateShortAliases = (clientModel) => {\n    const shortAliases = {};\n    const aliasParts = _(getRelationships(clientModel.relationships))\n        .union(Object.keys(clientModel.synonyms))\n        .reject((key) => key === '$')\n        .value();\n    let origAliasParts = _(aliasParts)\n        .flatMap((aliasPart) => aliasPart.split(/-| /))\n        .uniq()\n        .value();\n    addAliases(shortAliases, origAliasParts);\n    origAliasParts = _(aliasParts)\n        .flatMap((aliasPart) => aliasPart.split('-'))\n        .filter((aliasPart) => aliasPart.includes(' '))\n        .map((aliasPart) => aliasPart\n        .split(' ')\n        .map((part) => shortAliases[part])\n        .join(' '))\n        .uniq()\n        .value();\n    addAliases(shortAliases, origAliasParts);\n    origAliasParts = _(aliasParts)\n        .filter((aliasPart) => aliasPart.includes('-'))\n        .map((aliasPart) => aliasPart\n        .split('-')\n        .map((part) => shortAliases[part])\n        .join('-'))\n        .uniq()\n        .value();\n    addAliases(shortAliases, origAliasParts);\n    return shortAliases;\n};\n//# sourceMappingURL=odata-to-abstract-sql.js.map","\"use strict\";\n\nvar normalizeOpts = require(\"es5-ext/object/normalize-options\")\n  , resolveLength = require(\"./lib/resolve-length\")\n  , plain         = require(\"./plain\");\n\nmodule.exports = function (fn/*, options*/) {\n\tvar options = normalizeOpts(arguments[1]), length;\n\n\tif (!options.normalizer) {\n\t\tlength = options.length = resolveLength(options.length, fn.length, options.async);\n\t\tif (length !== 0) {\n\t\t\tif (options.primitive) {\n\t\t\t\tif (length === false) {\n\t\t\t\t\toptions.normalizer = require(\"./normalizers/primitive\");\n\t\t\t\t} else if (length > 1) {\n\t\t\t\t\toptions.normalizer = require(\"./normalizers/get-primitive-fixed\")(length);\n\t\t\t\t}\n\t\t\t} else if (length === false) options.normalizer = require(\"./normalizers/get\")();\n\t\t\t\telse if (length === 1) options.normalizer = require(\"./normalizers/get-1\")();\n\t\t\t\telse options.normalizer = require(\"./normalizers/get-fixed\")(length);\n\t\t}\n\t}\n\n\t// Assure extensions\n\tif (options.async) require(\"./ext/async\");\n\tif (options.promise) require(\"./ext/promise\");\n\tif (options.dispose) require(\"./ext/dispose\");\n\tif (options.maxAge) require(\"./ext/max-age\");\n\tif (options.max) require(\"./ext/max\");\n\tif (options.refCounter) require(\"./ext/ref-counter\");\n\n\treturn plain(fn, options);\n};\n","\"use strict\";\n\n// ES3 safe\nvar _undefined = void 0;\n\nmodule.exports = function (value) { return value !== _undefined && value !== null; };\n","import type {\r\n\tAbstractSqlModel,\r\n\tAbstractSqlType,\r\n\tAliasNode,\r\n\tRelationship,\r\n\tRelationshipInternalNode,\r\n\tRelationshipLeafNode,\r\n\tRelationshipMapping,\r\n\tSelectNode,\r\n} from '@balena/abstract-sql-compiler';\r\nimport type * as Express from 'express';\r\nimport type {\r\n\tODataBinds,\r\n\tODataQuery,\r\n\tSupportedMethod,\r\n} from '@balena/odata-parser';\r\nimport type { ApiKey, User } from '../sbvr-api/sbvr-utils';\r\nimport type { AnyObject } from './common-types';\r\n\r\nimport {\r\n\tDefinition,\r\n\tOData2AbstractSQL,\r\n\todataNameToSqlName,\r\n\tResourceFunction,\r\n\tsqlNameToODataName,\r\n} from '@balena/odata-to-abstract-sql';\r\nimport * as ODataParser from '@balena/odata-parser';\r\n\r\nimport * as _ from 'lodash';\r\nimport * as memoize from 'memoizee';\r\nimport * as randomstring from 'randomstring';\r\nimport * as env from '../config-loader/env';\r\nimport * as sbvrUtils from '../sbvr-api/sbvr-utils';\r\nimport { HookReq, addPureHook, addHook } from './hooks';\r\nimport {\r\n\tBadRequestError,\r\n\tPermissionError,\r\n\tPermissionParsingError,\r\n} from './errors';\r\nimport {\r\n\tmemoizedGetOData2AbstractSQL,\r\n\tmemoizedParseOdata,\r\n\tmetadataEndpoints,\r\n\tODataRequest,\r\n} from './uri-parser';\r\nimport memoizeWeak = require('memoizee/weak');\r\n\r\n// tslint:disable-next-line:no-var-requires\r\nconst userModel: string = require('./user.sbvr');\r\n\r\nconst DEFAULT_ACTOR_BIND = '@__ACTOR_ID';\r\nconst DEFAULT_ACTOR_BIND_REGEX = new RegExp(\r\n\t_.escapeRegExp(DEFAULT_ACTOR_BIND),\r\n\t'g',\r\n);\r\n\r\nexport { PermissionError, PermissionParsingError };\r\nexport interface PermissionReq {\r\n\tuser?: User;\r\n\tapiKey?: ApiKey;\r\n}\r\nexport const root: PermissionReq = {\r\n\tuser: {\r\n\t\tid: 0,\r\n\t\tactor: 0,\r\n\t\tpermissions: ['resource.all'],\r\n\t},\r\n};\r\nexport const rootRead: PermissionReq = {\r\n\tuser: {\r\n\t\tid: 0,\r\n\t\tactor: 0,\r\n\t\tpermissions: ['resource.read'],\r\n\t},\r\n};\r\n\r\ninterface NestedCheckOr<T> {\r\n\tor: NestedCheckArray<T>;\r\n}\r\ninterface NestedCheckAnd<T> {\r\n\tand: NestedCheckArray<T>;\r\n}\r\ninterface NestedCheckArray<T> extends Array<NestedCheck<T>> {}\r\ntype NestedCheck<T> =\r\n\t| NestedCheckOr<T>\r\n\t| NestedCheckAnd<T>\r\n\t| NestedCheckArray<T>\r\n\t| T;\r\ntype PermissionCheck = NestedCheck<string>;\r\n\r\ntype MappedType<I, O> = O extends NestedCheck<infer T>\r\n\t? Exclude<Exclude<I, string> | T, boolean>\r\n\t: Exclude<Exclude<I, string> | O, boolean>;\r\ntype MappedNestedCheck<\r\n\tT extends NestedCheck<I>,\r\n\tI,\r\n\tO\r\n> = T extends NestedCheckOr<I>\r\n\t? NestedCheckOr<MappedType<I, O>>\r\n\t: T extends NestedCheckAnd<I>\r\n\t? NestedCheckAnd<MappedType<I, O>>\r\n\t: T extends NestedCheckArray<I>\r\n\t? NestedCheckArray<MappedType<I, O>>\r\n\t: Exclude<I, string> | O;\r\n\r\nconst methodPermissions: {\r\n\t[method in Exclude<SupportedMethod, 'OPTIONS'>]: PermissionCheck;\r\n} & { OPTIONS?: PermissionCheck } = {\r\n\tGET: 'read',\r\n\tPUT: {\r\n\t\tand: ['create', 'update'],\r\n\t},\r\n\tPOST: 'create',\r\n\tPATCH: 'update',\r\n\tMERGE: 'update',\r\n\tDELETE: 'delete',\r\n};\r\n\r\nconst $parsePermissions = memoize(\r\n\t(filter: string) => {\r\n\t\tconst { tree, binds } = ODataParser.parse(filter, {\r\n\t\t\tstartRule: 'ProcessRule',\r\n\t\t\trule: 'FilterByExpression',\r\n\t\t});\r\n\t\treturn {\r\n\t\t\ttree,\r\n\t\t\textraBinds: binds,\r\n\t\t};\r\n\t},\r\n\t{\r\n\t\tprimitive: true,\r\n\t\tmax: env.cache.parsePermissions.max,\r\n\t},\r\n);\r\n\r\nconst rewriteBinds = (\r\n\t{ tree, extraBinds }: { tree: ODataQuery; extraBinds: ODataBinds },\r\n\todataBinds: ODataBinds,\r\n): ODataQuery => {\r\n\t// Add the extra binds we parsed onto our existing list of binds vars.\r\n\tconst bindsLength = odataBinds.length;\r\n\todataBinds.push(...extraBinds);\r\n\t// Clone the tree so the cached version can't be mutated and at the same time fix the bind numbers\r\n\treturn _.cloneDeepWith(tree, (value) => {\r\n\t\tif (value != null) {\r\n\t\t\tconst bind = value.bind;\r\n\t\t\tif (Number.isInteger(bind)) {\r\n\t\t\t\treturn { bind: value.bind + bindsLength };\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n};\r\n\r\nconst parsePermissions = (\r\n\tfilter: string,\r\n\todataBinds: ODataBinds,\r\n): ODataQuery => {\r\n\tconst odata = $parsePermissions(filter);\r\n\treturn rewriteBinds(odata, odataBinds);\r\n};\r\n\r\n// Traverses all values in `check`, actions for the following data types:\r\n// string: Calls `stringCallback` and uses the value returned instead\r\n// boolean: Used as-is\r\n// array: Treated as an AND of all elements\r\n// object: Must have only one key of either `AND` or `OR`, with an array value that will be treated according to the key.\r\nconst isAnd = <T>(x: any): x is NestedCheckAnd<T> =>\r\n\t_.isObject(x) && 'and' in x;\r\nconst isOr = <T>(x: any): x is NestedCheckOr<T> =>\r\n\ttypeof x === 'object' && 'or' in x;\r\nexport function nestedCheck<I, O>(\r\n\tcheck: string,\r\n\tstringCallback: (s: string) => O,\r\n): O;\r\nexport function nestedCheck<I, O>(\r\n\tcheck: boolean,\r\n\tstringCallback: (s: string) => O,\r\n): boolean;\r\nexport function nestedCheck<I, O>(\r\n\tcheck: NestedCheck<I>,\r\n\tstringCallback: (s: string) => O,\r\n): Exclude<I, string> | O | MappedNestedCheck<typeof check, I, O>;\r\nexport function nestedCheck<I, O>(\r\n\tcheck: NestedCheck<I>,\r\n\tstringCallback: (s: string) => O,\r\n): boolean | Exclude<I, string> | O | MappedNestedCheck<typeof check, I, O> {\r\n\tif (typeof check === 'string') {\r\n\t\treturn stringCallback(check);\r\n\t}\r\n\tif (typeof check === 'boolean') {\r\n\t\treturn check;\r\n\t}\r\n\tif (Array.isArray(check)) {\r\n\t\tlet results: any[] = [];\r\n\t\tfor (const subcheck of check) {\r\n\t\t\tconst result = nestedCheck(subcheck, stringCallback);\r\n\t\t\tif (typeof result === 'boolean') {\r\n\t\t\t\tif (result === false) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t} else if (isAnd(result)) {\r\n\t\t\t\tresults = results.concat(result.and);\r\n\t\t\t} else {\r\n\t\t\t\tresults.push(result);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (results.length === 1) {\r\n\t\t\treturn results[0];\r\n\t\t}\r\n\t\tif (results.length > 1) {\r\n\t\t\treturn {\r\n\t\t\t\tand: _.uniq(results),\r\n\t\t\t};\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\tif (typeof check === 'object') {\r\n\t\tconst checkTypes = Object.keys(check);\r\n\t\tif (checkTypes.length > 1) {\r\n\t\t\tthrow new Error('More than one check type: ' + checkTypes);\r\n\t\t}\r\n\t\tconst checkType = checkTypes[0];\r\n\t\tswitch (checkType.toUpperCase()) {\r\n\t\t\tcase 'AND':\r\n\t\t\t\tconst and = (check as NestedCheckAnd<I>)[checkType as 'and'];\r\n\t\t\t\treturn nestedCheck(and, stringCallback);\r\n\t\t\tcase 'OR':\r\n\t\t\t\tconst or = (check as NestedCheckOr<I>)[checkType as 'or'];\r\n\t\t\t\tlet results: any[] = [];\r\n\t\t\t\tfor (const subcheck of or) {\r\n\t\t\t\t\tconst result = nestedCheck(subcheck, stringCallback);\r\n\t\t\t\t\tif (typeof result === 'boolean') {\r\n\t\t\t\t\t\tif (result === true) {\r\n\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (isOr(result)) {\r\n\t\t\t\t\t\tresults = results.concat(result.or);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tresults.push(result);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (results.length === 1) {\r\n\t\t\t\t\treturn results[0];\r\n\t\t\t\t}\r\n\t\t\t\tif (results.length > 1) {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tor: _.uniq(results),\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\treturn false;\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error('Cannot parse required checking logic: ' + checkType);\r\n\t\t}\r\n\t}\r\n\tthrow new Error('Cannot parse required checks: ' + check);\r\n}\r\n\r\ninterface CollapsedFilter<T> extends Array<string | T | CollapsedFilter<T>> {\r\n\t0: string;\r\n}\r\n\r\nconst collapsePermissionFilters = <T>(\r\n\tv: NestedCheck<{ filter: T }>,\r\n): T | CollapsedFilter<T> => {\r\n\tif (Array.isArray(v)) {\r\n\t\treturn collapsePermissionFilters({ or: v });\r\n\t}\r\n\tif (typeof v === 'object') {\r\n\t\tif ('filter' in v) {\r\n\t\t\treturn v.filter;\r\n\t\t}\r\n\t\tif ('and' in v) {\r\n\t\t\treturn ['and', ...v.and.map(collapsePermissionFilters)];\r\n\t\t}\r\n\t\tif ('or' in v) {\r\n\t\t\treturn ['or', ...v.or.map(collapsePermissionFilters)];\r\n\t\t}\r\n\t\tthrow new Error(\r\n\t\t\t'Permission filter objects must have `filter` or `and` or `or` keys',\r\n\t\t);\r\n\t}\r\n\treturn v;\r\n};\r\n\r\nconst namespaceRelationships = (\r\n\trelationships: Relationship,\r\n\talias: string,\r\n): void => {\r\n\t_.forEach(relationships, (relationship: Relationship, key) => {\r\n\t\tif (key === '$') {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet mapping = (relationship as RelationshipLeafNode).$;\r\n\t\tif (mapping != null && mapping.length === 2) {\r\n\t\t\tmapping = _.cloneDeep(mapping);\r\n\t\t\t// we do check the length above, but typescript thinks the second\r\n\t\t\t// element could be undefined\r\n\t\t\tmapping[1]![0] = `${mapping[1]![0]}$${alias}`;\r\n\t\t\t(relationships as RelationshipInternalNode)[`${key}$${alias}`] = {\r\n\t\t\t\t$: mapping,\r\n\t\t\t};\r\n\t\t}\r\n\t\tnamespaceRelationships(relationship, alias);\r\n\t});\r\n};\r\n\r\ntype PermissionLookup = _.Dictionary<true | string[]>;\r\n\r\nconst getPermissionsLookup = memoize(\r\n\t(permissions: string[]): PermissionLookup => {\r\n\t\tconst permissionsLookup: PermissionLookup = {};\r\n\t\tfor (const permission of permissions) {\r\n\t\t\tconst [target, condition] = permission.split('?');\r\n\t\t\tif (condition == null) {\r\n\t\t\t\t// We have unconditional permission\r\n\t\t\t\tpermissionsLookup[target] = true;\r\n\t\t\t} else if (permissionsLookup[target] !== true) {\r\n\t\t\t\tif (permissionsLookup[target] == null) {\r\n\t\t\t\t\tpermissionsLookup[target] = [];\r\n\t\t\t\t}\r\n\t\t\t\t(permissionsLookup[target] as Exclude<\r\n\t\t\t\t\tPermissionLookup[typeof target],\r\n\t\t\t\t\ttrue\r\n\t\t\t\t>).push(condition);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn permissionsLookup;\r\n\t},\r\n\t{\r\n\t\tprimitive: true,\r\n\t\tmax: env.cache.permissionsLookup.max,\r\n\t},\r\n);\r\n\r\nconst $checkPermissions = (\r\n\tpermissionsLookup: PermissionLookup,\r\n\tactionList: PermissionCheck,\r\n\tvocabulary?: string,\r\n\tresourceName?: string,\r\n): boolean | NestedCheck<string> => {\r\n\tconst checkObject: PermissionCheck = {\r\n\t\tor: ['all', actionList],\r\n\t};\r\n\treturn nestedCheck(checkObject, (permissionCheck):\r\n\t\t| boolean\r\n\t\t| string\r\n\t\t| NestedCheckOr<string> => {\r\n\t\tconst resourcePermission = permissionsLookup['resource.' + permissionCheck];\r\n\t\tlet vocabularyPermission: string[] | undefined;\r\n\t\tlet vocabularyResourcePermission: string[] | undefined;\r\n\t\tif (resourcePermission === true) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tif (vocabulary != null) {\r\n\t\t\tconst maybeVocabularyPermission =\r\n\t\t\t\tpermissionsLookup[vocabulary + '.' + permissionCheck];\r\n\t\t\tif (maybeVocabularyPermission === true) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tvocabularyPermission = maybeVocabularyPermission;\r\n\t\t\tif (resourceName != null) {\r\n\t\t\t\tconst maybeVocabularyResourcePermission =\r\n\t\t\t\t\tpermissionsLookup[\r\n\t\t\t\t\t\tvocabulary + '.' + resourceName + '.' + permissionCheck\r\n\t\t\t\t\t];\r\n\t\t\t\tif (maybeVocabularyResourcePermission === true) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t\tvocabularyResourcePermission = maybeVocabularyResourcePermission;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Get the unique permission set, ignoring undefined sets.\r\n\t\tconst conditionalPermissions = _.union(\r\n\t\t\tresourcePermission,\r\n\t\t\tvocabularyPermission,\r\n\t\t\tvocabularyResourcePermission,\r\n\t\t);\r\n\r\n\t\tif (conditionalPermissions.length === 1) {\r\n\t\t\treturn conditionalPermissions[0];\r\n\t\t}\r\n\t\tif (conditionalPermissions.length > 1) {\r\n\t\t\treturn {\r\n\t\t\t\tor: conditionalPermissions,\r\n\t\t\t};\r\n\t\t}\r\n\t\treturn false;\r\n\t});\r\n};\r\n\r\nconst convertToLambda = (filter: AnyObject, identifier: string) => {\r\n\t// We need to inject all occurences of properties for the new lambda function\r\n\t// for example if there is an `or` operator, where different properties of\r\n\t// the target resource are used, we need to change all occurences of these.\r\n\t// We do this in a recursive way to also cover all nested cases like or [ and, and ]\r\n\tconst replaceObject = (object: AnyObject) => {\r\n\t\tif (typeof object === 'string') {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (Array.isArray(object)) {\r\n\t\t\tobject.forEach((element) => {\r\n\t\t\t\treplaceObject(element);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif (object.hasOwnProperty('name')) {\r\n\t\t\tobject.property = { ...object };\r\n\t\t\tobject.name = identifier;\r\n\t\t\tdelete object.lambda;\r\n\t\t}\r\n\t};\r\n\r\n\treplaceObject(filter);\r\n};\r\n\r\nconst rewriteSubPermissionBindings = (filter: AnyObject, counter: number) => {\r\n\tconst rewrite = (object: AnyObject) => {\r\n\t\tif (object == null) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (typeof object.bind === 'number') {\r\n\t\t\tobject.bind = counter + object.bind;\r\n\t\t}\r\n\r\n\t\tif (Array.isArray(object) || _.isObject(object)) {\r\n\t\t\t_.forEach(object, (v) => {\r\n\t\t\t\trewrite(v);\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\trewrite(filter);\r\n};\r\n\r\nconst buildODataPermission = (\r\n\tpermissionsLookup: PermissionLookup,\r\n\tactionList: PermissionCheck,\r\n\tvocabulary: string,\r\n\tresourceName: string,\r\n\todata: {\r\n\t\ttree: ODataParser.ODataQuery;\r\n\t\tbinds: ODataParser.ODataBinds;\r\n\t},\r\n) => {\r\n\tconst conditionalPerms = $checkPermissions(\r\n\t\tpermissionsLookup,\r\n\t\tactionList,\r\n\t\tvocabulary,\r\n\t\tresourceName,\r\n\t);\r\n\tif (conditionalPerms === false) {\r\n\t\t// We reuse a constant permission error here as it will be cached, and\r\n\t\t// using a single error instance can drastically reduce the memory used\r\n\t\tthrow constrainedPermissionError;\r\n\t}\r\n\tif (conditionalPerms === true) {\r\n\t\t// If we have full access then no need to provide a constrained definition\r\n\t\treturn false;\r\n\t}\r\n\r\n\tconst permissionFilters = nestedCheck(conditionalPerms, (permissionCheck) => {\r\n\t\ttry {\r\n\t\t\t// We use an object with filter key to avoid collapsing our filters later.\r\n\t\t\treturn {\r\n\t\t\t\tfilter: parsePermissions(permissionCheck, odata.binds),\r\n\t\t\t};\r\n\t\t} catch (e) {\r\n\t\t\tconsole.warn(\r\n\t\t\t\t'Failed to parse conditional permissions: ',\r\n\t\t\t\tpermissionCheck,\r\n\t\t\t);\r\n\t\t\tthrow new PermissionParsingError(e);\r\n\t\t}\r\n\t});\r\n\r\n\tconst collapsedPermissionFilters = collapsePermissionFilters(\r\n\t\tpermissionFilters,\r\n\t);\r\n\r\n\treturn collapsedPermissionFilters;\r\n};\r\n\r\nconst constrainedPermissionError = new PermissionError();\r\nconst generateConstrainedAbstractSql = (\r\n\tpermissionsLookup: PermissionLookup,\r\n\tactionList: PermissionCheck,\r\n\tvocabulary: string,\r\n\tresourceName: string,\r\n) => {\r\n\tconst abstractSQLModel = sbvrUtils.getAbstractSqlModel({\r\n\t\tvocabulary,\r\n\t});\r\n\tconst odata = memoizedParseOdata(`/${resourceName}`);\r\n\r\n\tconst collapsedPermissionFilters = buildODataPermission(\r\n\t\tpermissionsLookup,\r\n\t\tactionList,\r\n\t\tvocabulary,\r\n\t\tresourceName,\r\n\t\todata,\r\n\t);\r\n\r\n\t_.set(odata, ['tree', 'options', '$filter'], collapsedPermissionFilters);\r\n\r\n\tconst lambdaAlias = randomstring.generate(20);\r\n\tlet inc = 0;\r\n\r\n\t// We need to trace the processed resources, to be able to break\r\n\t// permissions circles.\r\n\tconst canAccessTrace: string[] = [resourceName];\r\n\r\n\tconst canAccessFunction: ResourceFunction = function (property: AnyObject) {\r\n\t\t// remove method property so that we won't loop back here again at this point\r\n\t\tdelete property.method;\r\n\r\n\t\tif (!this.defaultResource) {\r\n\t\t\tthrow new Error(`No resource selected in AST.`);\r\n\t\t}\r\n\r\n\t\tconst targetResource = this.NavigateResources(\r\n\t\t\tthis.defaultResource,\r\n\t\t\tproperty.name,\r\n\t\t);\r\n\r\n\t\tconst targetResourceName = sqlNameToODataName(targetResource.resource.name);\r\n\r\n\t\tif (canAccessTrace.includes(targetResourceName)) {\r\n\t\t\t// we don't want to allow permission loops for now, therefore we are\r\n\t\t\t// throwing the exception here. If we ever want to allow permission\r\n\t\t\t// loops return a false AST statement here (like true eq false), to\r\n\t\t\t// not recursivley follow query branches in a deep first search.\r\n\t\t\tthrow new PermissionError(\r\n\t\t\t\t`Permissions for ${resourceName} form a circle by the following path: ${canAccessTrace.join(\r\n\t\t\t\t\t' -> ',\r\n\t\t\t\t)} -> ${targetResourceName}`,\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tconst parentOdata = memoizedParseOdata(`/${targetResourceName}`);\r\n\r\n\t\tconst collapsedParentPermissionFilters = buildODataPermission(\r\n\t\t\tpermissionsLookup,\r\n\t\t\tactionList,\r\n\t\t\tvocabulary,\r\n\t\t\ttargetResourceName,\r\n\t\t\tparentOdata,\r\n\t\t);\r\n\r\n\t\tif (collapsedParentPermissionFilters === false) {\r\n\t\t\t// We reuse a constant permission error here as it will be cached, and\r\n\t\t\t// using a single error instance can drastically reduce the memory used\r\n\t\t\tthrow constrainedPermissionError;\r\n\t\t}\r\n\r\n\t\tconst lambdaId = `${lambdaAlias}+${inc}`;\r\n\t\tinc = inc + 1;\r\n\t\trewriteSubPermissionBindings(\r\n\t\t\tcollapsedParentPermissionFilters,\r\n\t\t\tthis.bindVarsLength + this.extraBindVars.length,\r\n\t\t);\r\n\t\tconvertToLambda(collapsedParentPermissionFilters, lambdaId);\r\n\t\tproperty.lambda = {\r\n\t\t\tmethod: 'any',\r\n\t\t\tidentifier: lambdaId,\r\n\t\t\texpression: collapsedParentPermissionFilters,\r\n\t\t};\r\n\r\n\t\tthis.extraBindVars.push(...parentOdata.binds);\r\n\r\n\t\tcanAccessTrace.push(targetResourceName);\r\n\t\ttry {\r\n\t\t\treturn this.Property(property);\r\n\t\t} finally {\r\n\t\t\tcanAccessTrace.pop();\r\n\t\t}\r\n\t};\r\n\r\n\tconst { tree, extraBindVars } = memoizedGetOData2AbstractSQL(\r\n\t\tabstractSQLModel,\r\n\t).match(odata.tree, 'GET', [], odata.binds.length, {\r\n\t\tcanAccess: canAccessFunction,\r\n\t});\r\n\r\n\todata.binds.push(...extraBindVars);\r\n\tconst odataBinds = odata.binds;\r\n\r\n\tconst abstractSqlQuery = [...tree];\r\n\t// Remove aliases from the top level select\r\n\tconst selectIndex = abstractSqlQuery.findIndex((v) => v[0] === 'Select');\r\n\tconst select = (abstractSqlQuery[selectIndex] = [\r\n\t\t...abstractSqlQuery[selectIndex],\r\n\t] as SelectNode);\r\n\tselect[1] = select[1].map(\r\n\t\t(selectField): AbstractSqlType => {\r\n\t\t\tif (selectField[0] === 'Alias') {\r\n\t\t\t\tconst maybeField = (selectField as AliasNode<any>)[1];\r\n\t\t\t\tconst fieldType = maybeField[0];\r\n\t\t\t\tif (fieldType === 'ReferencedField' || fieldType === 'Field') {\r\n\t\t\t\t\treturn maybeField;\r\n\t\t\t\t}\r\n\t\t\t\treturn [\r\n\t\t\t\t\t'Alias',\r\n\t\t\t\t\tmaybeField,\r\n\t\t\t\t\todataNameToSqlName((selectField as AliasNode<any>)[2]),\r\n\t\t\t\t];\r\n\t\t\t}\r\n\t\t\tif (selectField.length === 2 && Array.isArray(selectField[0])) {\r\n\t\t\t\treturn selectField[0];\r\n\t\t\t}\r\n\t\t\treturn selectField;\r\n\t\t},\r\n\t);\r\n\r\n\treturn { extraBinds: odataBinds, abstractSqlQuery };\r\n};\r\n\r\n// Call the function once and either return the same result or throw the same error on subsequent calls\r\nconst onceGetter = (obj: AnyObject, propName: string, fn: () => any) => {\r\n\t// We have `nullableFn` to keep fn required but still allow us to clear the fn reference\r\n\t// after we have called fn\r\n\tlet nullableFn: undefined | typeof fn = fn;\r\n\tlet thrownErr: Error | undefined;\r\n\tObject.defineProperty(obj, propName, {\r\n\t\tenumerable: true,\r\n\t\tconfigurable: true,\r\n\t\tget() {\r\n\t\t\tif (thrownErr != null) {\r\n\t\t\t\tthrow thrownErr;\r\n\t\t\t}\r\n\t\t\ttry {\r\n\t\t\t\tconst result = nullableFn!();\r\n\t\t\t\t// We need the delete first as the current property is read-only\r\n\t\t\t\t// and the delete removes that restriction\r\n\t\t\t\tdelete this[propName];\r\n\t\t\t\treturn (this[propName] = result);\r\n\t\t\t} catch (e) {\r\n\t\t\t\tthrownErr = e;\r\n\t\t\t\tthrow thrownErr;\r\n\t\t\t} finally {\r\n\t\t\t\tnullableFn = undefined;\r\n\t\t\t}\r\n\t\t},\r\n\t});\r\n};\r\n\r\nconst deepFreezeExceptDefinition = (obj: AnyObject) => {\r\n\tObject.freeze(obj);\r\n\r\n\tObject.getOwnPropertyNames(obj).forEach((prop) => {\r\n\t\t// We skip the definition because we know it's a property we've defined that will throw an error in some cases\r\n\t\tif (\r\n\t\t\tprop !== 'definition' &&\r\n\t\t\tobj.hasOwnProperty(prop) &&\r\n\t\t\tobj[prop] !== null &&\r\n\t\t\t!['object', 'function'].includes(typeof obj[prop])\r\n\t\t) {\r\n\t\t\tdeepFreezeExceptDefinition(obj);\r\n\t\t}\r\n\t});\r\n};\r\n\r\nconst createBypassDefinition = (definition: Definition) =>\r\n\t_.cloneDeepWith(definition, (abstractSql) => {\r\n\t\tif (\r\n\t\t\tArray.isArray(abstractSql) &&\r\n\t\t\tabstractSql[0] === 'Resource' &&\r\n\t\t\t!abstractSql[1].endsWith('$bypass')\r\n\t\t) {\r\n\t\t\treturn ['Resource', `${abstractSql[1]}$bypass`];\r\n\t\t}\r\n\t});\r\n\r\nconst getAlias = (name: string) => {\r\n\t// TODO-MAJOR: Change $bypass to $permissionbypass or similar\r\n\tif (name.endsWith('$bypass')) {\r\n\t\treturn 'bypass';\r\n\t}\r\n\tconst [, permissionsJSON] = name.split('permissions');\r\n\tif (!permissionsJSON) {\r\n\t\treturn;\r\n\t}\r\n\treturn `permissions${permissionsJSON}`;\r\n};\r\n\r\nconst rewriteRelationship = memoizeWeak(\r\n\t(\r\n\t\tvalue: Relationship,\r\n\t\tname: string,\r\n\t\tabstractSqlModel: AbstractSqlModel,\r\n\t\tpermissionsLookup: PermissionLookup,\r\n\t\tvocabulary: string,\r\n\t\todata2AbstractSQL: OData2AbstractSQL,\r\n\t) => {\r\n\t\tlet escapedName = sqlNameToODataName(name);\r\n\t\tif (abstractSqlModel.tables[name]) {\r\n\t\t\tescapedName = sqlNameToODataName(abstractSqlModel.tables[name].name);\r\n\t\t}\r\n\r\n\t\tconst rewrite = (object: Relationship | RelationshipMapping) => {\r\n\t\t\tif ('$' in object && Array.isArray(object.$)) {\r\n\t\t\t\t// object is in the form of\r\n\t\t\t\t// { \"$\": [\"actor\", [\"actor\", \"id\"]] } or { \"$\": [\"device type\"] }\r\n\t\t\t\t// we are only interested in the first case, since this is a relationship\r\n\t\t\t\t// to a different resource\r\n\t\t\t\tconst mapping = object.$;\r\n\t\t\t\tif (\r\n\t\t\t\t\tmapping.length === 2 &&\r\n\t\t\t\t\tArray.isArray(mapping[1]) &&\r\n\t\t\t\t\tmapping[1].length === 2 &&\r\n\t\t\t\t\ttypeof mapping[1][0] === 'string'\r\n\t\t\t\t) {\r\n\t\t\t\t\t// now have ensured that mapping looks like [\"actor\", [\"actor\", \"id\"]]\r\n\t\t\t\t\t// this relations ship means that:\r\n\t\t\t\t\t//   mapping[0] is the local field\r\n\t\t\t\t\t//   mapping[1] is the reference to the other resource, that joins this resource\r\n\t\t\t\t\t//   mapping[1][0] is the name of the other resource (actor in the example)\r\n\t\t\t\t\t//   mapping[1][1] is the name of the field on the other resource\r\n\t\t\t\t\t//\r\n\t\t\t\t\t// this therefore defines that the local field `actor` needs\r\n\t\t\t\t\t// to match the `id` of the `actor` resources for the join\r\n\r\n\t\t\t\t\tconst possibleTargetResourceName = mapping[1][0];\r\n\r\n\t\t\t\t\t// Skip this if we already shortcut this connection\r\n\t\t\t\t\tif (possibleTargetResourceName.endsWith('$bypass')) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tconst targetResourceEscaped = sqlNameToODataName(\r\n\t\t\t\t\t\tabstractSqlModel.tables[possibleTargetResourceName]?.name ??\r\n\t\t\t\t\t\t\tpossibleTargetResourceName,\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\t// This is either a translated or bypassed resource we don't\r\n\t\t\t\t\t// mess with these\r\n\t\t\t\t\tif (targetResourceEscaped.includes('$')) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet foundCanAccessLink = false;\r\n\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tconst odata = memoizedParseOdata(`/${targetResourceEscaped}`);\r\n\r\n\t\t\t\t\t\tconst collapsedPermissionFilters = buildODataPermission(\r\n\t\t\t\t\t\t\tpermissionsLookup,\r\n\t\t\t\t\t\t\tmethodPermissions.GET,\r\n\t\t\t\t\t\t\tvocabulary,\r\n\t\t\t\t\t\t\ttargetResourceEscaped,\r\n\t\t\t\t\t\t\todata,\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\t_.set(\r\n\t\t\t\t\t\t\todata,\r\n\t\t\t\t\t\t\t['tree', 'options', '$filter'],\r\n\t\t\t\t\t\t\tcollapsedPermissionFilters,\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\tconst canAccessFunction: ResourceFunction = function (\r\n\t\t\t\t\t\t\tproperty: AnyObject,\r\n\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t// remove method property so that we won't loop back here again at this point\r\n\t\t\t\t\t\t\tdelete property.method;\r\n\r\n\t\t\t\t\t\t\tif (!this.defaultResource) {\r\n\t\t\t\t\t\t\t\tthrow new Error(`No resource selected in AST.`);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tconst targetResourceAST = this.NavigateResources(\r\n\t\t\t\t\t\t\t\tthis.defaultResource,\r\n\t\t\t\t\t\t\t\tproperty.name,\r\n\t\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\t\tconst targetResourceName = sqlNameToODataName(\r\n\t\t\t\t\t\t\t\ttargetResourceAST.resource.name,\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\tconst currentResourceName = sqlNameToODataName(\r\n\t\t\t\t\t\t\t\tthis.defaultResource.name,\r\n\t\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t\tcurrentResourceName === targetResourceEscaped &&\r\n\t\t\t\t\t\t\t\ttargetResourceName === escapedName\r\n\t\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t\tfoundCanAccessLink = true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t// return a true expression to not select the relationship, which might be virtual\r\n\t\t\t\t\t\t\t// this should be a boolean expression, but needs to be a subquery in case it\r\n\t\t\t\t\t\t\t// is wrapped in an `or` or `and`\r\n\t\t\t\t\t\t\treturn ['Equals', ['Boolean', true], ['Boolean', true]];\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t// We need execute the abstract SQL compiler to traverse\r\n\t\t\t\t\t\t\t// through the permissions for that resource, using a\r\n\t\t\t\t\t\t\t// special canAccess callback.\r\n\t\t\t\t\t\t\todata2AbstractSQL.match(\r\n\t\t\t\t\t\t\t\todata.tree,\r\n\t\t\t\t\t\t\t\t'GET',\r\n\t\t\t\t\t\t\t\t[],\r\n\t\t\t\t\t\t\t\todata.binds.length,\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tcanAccess: canAccessFunction,\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\t\tthrow new ODataParser.SyntaxError(e);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (foundCanAccessLink) {\r\n\t\t\t\t\t\t\t// store the resource name as it was with a $bypass\r\n\t\t\t\t\t\t\t// suffix in this relationship, this means that the\r\n\t\t\t\t\t\t\t// query generator will use the plain resource instead\r\n\t\t\t\t\t\t\t// of the filtered resource.\r\n\t\t\t\t\t\t\tmapping[1][0] = `${possibleTargetResourceName}$bypass`;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\tif (e === constrainedPermissionError) {\r\n\t\t\t\t\t\t\t// ignore\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// TODO: We should investigate in detail why this error\r\n\t\t\t\t\t\t// occurse. It might be able to get rid of this.\r\n\t\t\t\t\t\tif (e instanceof ODataParser.SyntaxError) {\r\n\t\t\t\t\t\t\t// ignore\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tthrow e;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (Array.isArray(object) || _.isObject(object)) {\r\n\t\t\t\t_.forEach(object, (v) => {\r\n\t\t\t\t\t// we want to recurse into the relationship path, but\r\n\t\t\t\t\t// in case we hit a plain string, we don't need to bother\r\n\t\t\t\t\t// checking it. This can happen since plain terms also have\r\n\t\t\t\t\t// relationships to sbvr-types.\r\n\t\t\t\t\tif (typeof v !== 'string') {\r\n\t\t\t\t\t\trewrite(v as Relationship | RelationshipMapping);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\trewrite(value);\r\n\t},\r\n);\r\n\r\nconst rewriteRelationships = (\r\n\tabstractSqlModel: AbstractSqlModel,\r\n\trelationships: {\r\n\t\t[resourceName: string]: RelationshipInternalNode;\r\n\t},\r\n\tpermissionsLookup: PermissionLookup,\r\n\tvocabulary: string,\r\n): typeof relationships => {\r\n\tconst originalAbstractSQLModel = sbvrUtils.getAbstractSqlModel({\r\n\t\tvocabulary,\r\n\t});\r\n\r\n\tconst odata2AbstractSQL = memoizedGetOData2AbstractSQL(\r\n\t\toriginalAbstractSQLModel,\r\n\t);\r\n\r\n\tconst newRelationships = _.cloneDeep(relationships);\r\n\t_.forOwn(newRelationships, (value, name) =>\r\n\t\trewriteRelationship(\r\n\t\t\tvalue,\r\n\t\t\tname,\r\n\t\t\tabstractSqlModel,\r\n\t\t\tpermissionsLookup,\r\n\t\t\tvocabulary,\r\n\t\t\todata2AbstractSQL,\r\n\t\t),\r\n\t);\r\n\r\n\treturn newRelationships;\r\n};\r\n\r\nconst stringifiedGetPermissions = JSON.stringify(methodPermissions.GET);\r\nconst getBoundConstrainedMemoizer = memoizeWeak(\r\n\t(abstractSqlModel: AbstractSqlModel) =>\r\n\t\tmemoizeWeak(\r\n\t\t\t(permissionsLookup: PermissionLookup, vocabulary: string) => {\r\n\t\t\t\tconst constrainedAbstractSqlModel = _.cloneDeep(abstractSqlModel);\r\n\r\n\t\t\t\tconst origSynonyms = Object.keys(constrainedAbstractSqlModel.synonyms);\r\n\t\t\t\tconstrainedAbstractSqlModel.synonyms = new Proxy(\r\n\t\t\t\t\tconstrainedAbstractSqlModel.synonyms,\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tget: (synonyms, permissionSynonym: string) => {\r\n\t\t\t\t\t\t\tif (synonyms[permissionSynonym]) {\r\n\t\t\t\t\t\t\t\treturn synonyms[permissionSynonym];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tconst alias = getAlias(permissionSynonym);\r\n\t\t\t\t\t\t\tif (!alias) {\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\torigSynonyms.forEach((canonicalForm, synonym) => {\r\n\t\t\t\t\t\t\t\tsynonyms[`${synonym}$${alias}`] = `${canonicalForm}$${alias}`;\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\treturn synonyms[permissionSynonym];\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t},\r\n\t\t\t\t);\r\n\r\n\t\t\t\tconst origRelationships = Object.keys(\r\n\t\t\t\t\tconstrainedAbstractSqlModel.relationships,\r\n\t\t\t\t);\r\n\r\n\t\t\t\t_.forEach(constrainedAbstractSqlModel.tables, (table, resourceName) => {\r\n\t\t\t\t\tconst bypassResourceName = `${resourceName}$bypass`;\r\n\t\t\t\t\tconstrainedAbstractSqlModel.tables[bypassResourceName] = {\r\n\t\t\t\t\t\t...table,\r\n\t\t\t\t\t};\r\n\t\t\t\t\tconstrainedAbstractSqlModel.tables[\r\n\t\t\t\t\t\tbypassResourceName\r\n\t\t\t\t\t].resourceName = bypassResourceName;\r\n\t\t\t\t\tif (table.definition) {\r\n\t\t\t\t\t\t// If the table is definition based then just make the bypass version match but pointing to the equivalent bypassed resources\r\n\t\t\t\t\t\tconstrainedAbstractSqlModel.tables[\r\n\t\t\t\t\t\t\tbypassResourceName\r\n\t\t\t\t\t\t].definition = createBypassDefinition(table.definition);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// Otherwise constrain the non-bypass table\r\n\t\t\t\t\t\tonceGetter(\r\n\t\t\t\t\t\t\ttable,\r\n\t\t\t\t\t\t\t'definition',\r\n\t\t\t\t\t\t\t() =>\r\n\t\t\t\t\t\t\t\t// For $filter on eg a DELETE you need read permissions on the sub-resources,\r\n\t\t\t\t\t\t\t\t// you only need delete permissions on the resource being deleted\r\n\t\t\t\t\t\t\t\tconstrainedAbstractSqlModel.tables[\r\n\t\t\t\t\t\t\t\t\t`${resourceName}$permissions${stringifiedGetPermissions}`\r\n\t\t\t\t\t\t\t\t].definition,\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tconstrainedAbstractSqlModel.tables = new Proxy(\r\n\t\t\t\t\tconstrainedAbstractSqlModel.tables,\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tget: (tables, permissionResourceName: string) => {\r\n\t\t\t\t\t\t\tif (tables[permissionResourceName]) {\r\n\t\t\t\t\t\t\t\treturn tables[permissionResourceName];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tconst [\r\n\t\t\t\t\t\t\t\tresourceName,\r\n\t\t\t\t\t\t\t\tpermissionsJSON,\r\n\t\t\t\t\t\t\t] = permissionResourceName.split('$permissions');\r\n\t\t\t\t\t\t\tif (!permissionsJSON) {\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tconst permissions = JSON.parse(permissionsJSON);\r\n\r\n\t\t\t\t\t\t\tconst table = tables[`${resourceName}$bypass`];\r\n\r\n\t\t\t\t\t\t\tconst permissionsTable = (tables[permissionResourceName] = {\r\n\t\t\t\t\t\t\t\t...table,\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tpermissionsTable.resourceName = permissionResourceName;\r\n\t\t\t\t\t\t\tonceGetter(permissionsTable, 'definition', () =>\r\n\t\t\t\t\t\t\t\t// For $filter on eg a DELETE you need read permissions on the sub-resources,\r\n\t\t\t\t\t\t\t\t// you only need delete permissions on the resource being deleted\r\n\t\t\t\t\t\t\t\tgenerateConstrainedAbstractSql(\r\n\t\t\t\t\t\t\t\t\tpermissionsLookup,\r\n\t\t\t\t\t\t\t\t\tpermissions,\r\n\t\t\t\t\t\t\t\t\tvocabulary,\r\n\t\t\t\t\t\t\t\t\tsqlNameToODataName(permissionsTable.name),\r\n\t\t\t\t\t\t\t\t),\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\treturn permissionsTable;\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t},\r\n\t\t\t\t);\r\n\r\n\t\t\t\t// rewrite the relationships of the constraint model\r\n\t\t\t\t// we check if given the current permissions we can direct\r\n\t\t\t\t// expands and filters to unconstraint resources\r\n\t\t\t\tconstrainedAbstractSqlModel.relationships = rewriteRelationships(\r\n\t\t\t\t\tconstrainedAbstractSqlModel,\r\n\t\t\t\t\tconstrainedAbstractSqlModel.relationships,\r\n\t\t\t\t\tpermissionsLookup,\r\n\t\t\t\t\tvocabulary,\r\n\t\t\t\t);\r\n\r\n\t\t\t\tconstrainedAbstractSqlModel.relationships = new Proxy(\r\n\t\t\t\t\tconstrainedAbstractSqlModel.relationships,\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tget: (relationships, permissionResourceName: string) => {\r\n\t\t\t\t\t\t\tif (relationships[permissionResourceName]) {\r\n\t\t\t\t\t\t\t\treturn relationships[permissionResourceName];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tconst alias = getAlias(permissionResourceName);\r\n\t\t\t\t\t\t\tif (!alias) {\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tfor (const relationship of origRelationships) {\r\n\t\t\t\t\t\t\t\trelationships[`${relationship}$${alias}`] =\r\n\t\t\t\t\t\t\t\t\trelationships[relationship];\r\n\t\t\t\t\t\t\t\tnamespaceRelationships(relationships[relationship], alias);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn relationships[permissionResourceName];\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t},\r\n\t\t\t\t);\r\n\t\t\t\tdeepFreezeExceptDefinition(constrainedAbstractSqlModel);\r\n\t\t\t\treturn constrainedAbstractSqlModel;\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tprimitive: true,\r\n\t\t\t},\r\n\t\t),\r\n);\r\nconst memoizedGetConstrainedModel = (\r\n\tabstractSqlModel: AbstractSqlModel,\r\n\tpermissionsLookup: PermissionLookup,\r\n\tvocabulary: string,\r\n) =>\r\n\tgetBoundConstrainedMemoizer(abstractSqlModel)(permissionsLookup, vocabulary);\r\n\r\nconst getCheckPasswordQuery = _.once(() =>\r\n\tsbvrUtils.api.Auth.prepare<{ username: string }>({\r\n\t\tresource: 'user',\r\n\t\tpassthrough: {\r\n\t\t\treq: rootRead,\r\n\t\t},\r\n\t\tid: {\r\n\t\t\tusername: { '@': 'username' },\r\n\t\t},\r\n\t\toptions: {\r\n\t\t\t$select: ['id', 'actor', 'password'],\r\n\t\t},\r\n\t}),\r\n);\r\nexport const checkPassword = async (\r\n\tusername: string,\r\n\tpassword: string,\r\n): Promise<{\r\n\tid: number;\r\n\tactor: number;\r\n\tusername: string;\r\n\tpermissions: string[];\r\n}> => {\r\n\tconst user = await getCheckPasswordQuery()({\r\n\t\tusername,\r\n\t});\r\n\tif (user == null) {\r\n\t\tthrow new Error('User not found');\r\n\t}\r\n\tconst hash = user.password;\r\n\tconst userId = user.id;\r\n\tconst actorId = user.actor;\r\n\tconst res = await sbvrUtils.sbvrTypes.Hashed.compare(password, hash);\r\n\tif (!res) {\r\n\t\tthrow new Error('Passwords do not match');\r\n\t}\r\n\tconst permissions = await getUserPermissions(userId);\r\n\treturn {\r\n\t\tid: userId,\r\n\t\tactor: actorId,\r\n\t\tusername,\r\n\t\tpermissions,\r\n\t};\r\n};\r\n\r\nconst getUserPermissionsQuery = _.once(() =>\r\n\tsbvrUtils.api.Auth.prepare<{ userId: number }>({\r\n\t\tresource: 'permission',\r\n\t\tpassthrough: {\r\n\t\t\treq: rootRead,\r\n\t\t},\r\n\t\toptions: {\r\n\t\t\t$select: 'name',\r\n\t\t\t$filter: {\r\n\t\t\t\t$or: {\r\n\t\t\t\t\tis_of__user: {\r\n\t\t\t\t\t\t$any: {\r\n\t\t\t\t\t\t\t$alias: 'uhp',\r\n\t\t\t\t\t\t\t$expr: {\r\n\t\t\t\t\t\t\t\tuhp: { user: { '@': 'userId' } },\r\n\t\t\t\t\t\t\t\t$or: [\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\tuhp: { expiry_date: null },\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\tuhp: {\r\n\t\t\t\t\t\t\t\t\t\t\texpiry_date: { $gt: { $now: null } },\r\n\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t},\r\n\t\t\t\t\tis_of__role: {\r\n\t\t\t\t\t\t$any: {\r\n\t\t\t\t\t\t\t$alias: 'rhp',\r\n\t\t\t\t\t\t\t$expr: {\r\n\t\t\t\t\t\t\t\trhp: {\r\n\t\t\t\t\t\t\t\t\trole: {\r\n\t\t\t\t\t\t\t\t\t\t$any: {\r\n\t\t\t\t\t\t\t\t\t\t\t$alias: 'r',\r\n\t\t\t\t\t\t\t\t\t\t\t$expr: {\r\n\t\t\t\t\t\t\t\t\t\t\t\tr: {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tis_of__user: {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t$any: {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$alias: 'uhr',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$expr: {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tuhr: { user: { '@': 'userId' } },\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$or: [\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tuhr: { expiry_date: null },\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tuhr: {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\texpiry_date: { $gt: { $now: null } },\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t\t// We orderby to increase the hit rate for the `_checkPermissions` memoisation\r\n\t\t\t$orderby: {\r\n\t\t\t\tname: 'asc',\r\n\t\t\t},\r\n\t\t},\r\n\t}),\r\n);\r\nexport const getUserPermissions = async (userId: number): Promise<string[]> => {\r\n\tif (typeof userId === 'string') {\r\n\t\tuserId = parseInt(userId, 10);\r\n\t}\r\n\tif (!Number.isFinite(userId)) {\r\n\t\tthrow new Error(`User ID has to be numeric, got: ${typeof userId}`);\r\n\t}\r\n\ttry {\r\n\t\tconst permissions = (await getUserPermissionsQuery()({\r\n\t\t\tuserId,\r\n\t\t})) as Array<{ name: string }>;\r\n\t\treturn permissions.map((permission) => permission.name);\r\n\t} catch (err) {\r\n\t\tsbvrUtils.api.Auth.logger.error('Error loading user permissions', err);\r\n\t\tthrow err;\r\n\t}\r\n};\r\n\r\nconst getApiKeyPermissionsQuery = _.once(() =>\r\n\tsbvrUtils.api.Auth.prepare<{ apiKey: string }>({\r\n\t\tresource: 'permission',\r\n\t\tpassthrough: {\r\n\t\t\treq: rootRead,\r\n\t\t},\r\n\t\toptions: {\r\n\t\t\t$select: 'name',\r\n\t\t\t$filter: {\r\n\t\t\t\t$or: {\r\n\t\t\t\t\tis_of__api_key: {\r\n\t\t\t\t\t\t$any: {\r\n\t\t\t\t\t\t\t$alias: 'khp',\r\n\t\t\t\t\t\t\t$expr: {\r\n\t\t\t\t\t\t\t\tkhp: {\r\n\t\t\t\t\t\t\t\t\tapi_key: {\r\n\t\t\t\t\t\t\t\t\t\t$any: {\r\n\t\t\t\t\t\t\t\t\t\t\t$alias: 'k',\r\n\t\t\t\t\t\t\t\t\t\t\t$expr: {\r\n\t\t\t\t\t\t\t\t\t\t\t\tk: { key: { '@': 'apiKey' } },\r\n\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t},\r\n\t\t\t\t\tis_of__role: {\r\n\t\t\t\t\t\t$any: {\r\n\t\t\t\t\t\t\t$alias: 'rhp',\r\n\t\t\t\t\t\t\t$expr: {\r\n\t\t\t\t\t\t\t\trhp: {\r\n\t\t\t\t\t\t\t\t\trole: {\r\n\t\t\t\t\t\t\t\t\t\t$any: {\r\n\t\t\t\t\t\t\t\t\t\t\t$alias: 'r',\r\n\t\t\t\t\t\t\t\t\t\t\t$expr: {\r\n\t\t\t\t\t\t\t\t\t\t\t\tr: {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tis_of__api_key: {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t$any: {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$alias: 'khr',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$expr: {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tkhr: {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tapi_key: {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$any: {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$alias: 'k',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$expr: {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tk: { key: { '@': 'apiKey' } },\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t\t// We orderby to increase the hit rate for the `_checkPermissions` memoisation\r\n\t\t\t$orderby: {\r\n\t\t\t\tname: 'asc',\r\n\t\t\t},\r\n\t\t},\r\n\t}),\r\n);\r\nexport const getApiKeyPermissions = async (\r\n\tapiKey: string,\r\n): Promise<string[]> => {\r\n\tif (typeof apiKey !== 'string') {\r\n\t\tthrow new Error('API key has to be a string, got: ' + typeof apiKey);\r\n\t}\r\n\ttry {\r\n\t\tconst permissions = (await getApiKeyPermissionsQuery()({\r\n\t\t\tapiKey,\r\n\t\t})) as Array<{ name: string }>;\r\n\t\treturn permissions.map((permission) => permission.name);\r\n\t} catch (err) {\r\n\t\tsbvrUtils.api.Auth.logger.error('Error loading api key permissions', err);\r\n\t\tthrow err;\r\n\t}\r\n};\r\n\r\nconst getApiKeyActorIdQuery = _.once(() =>\r\n\tsbvrUtils.api.Auth.prepare<{ apiKey: string }>({\r\n\t\tresource: 'api_key',\r\n\t\tpassthrough: {\r\n\t\t\treq: rootRead,\r\n\t\t},\r\n\t\tid: {\r\n\t\t\tkey: { '@': 'apiKey' },\r\n\t\t},\r\n\t\toptions: {\r\n\t\t\t$select: 'is_of__actor',\r\n\t\t},\r\n\t}),\r\n);\r\nconst apiActorPermissionError = new PermissionError();\r\nconst getApiKeyActorId = async (apiKey: string) => {\r\n\tconst apiKeyResult = await getApiKeyActorIdQuery()({\r\n\t\tapiKey,\r\n\t});\r\n\tif (apiKeyResult == null) {\r\n\t\t// We reuse a constant permission error here as it will be cached, and\r\n\t\t// using a single error instance can drastically reduce the memory used\r\n\t\tthrow apiActorPermissionError;\r\n\t}\r\n\tconst apiKeyActorID = apiKeyResult.is_of__actor.__id;\r\n\tif (apiKeyActorID == null) {\r\n\t\tthrow new Error('API key is not linked to a actor?!');\r\n\t}\r\n\treturn apiKeyActorID as number;\r\n};\r\n\r\nconst checkApiKey = async (req: PermissionReq, apiKey: string) => {\r\n\tif (apiKey == null || req.apiKey != null) {\r\n\t\treturn;\r\n\t}\r\n\tlet permissions: string[];\r\n\ttry {\r\n\t\tpermissions = await getApiKeyPermissions(apiKey);\r\n\t} catch (err) {\r\n\t\tconsole.warn('Error with API key:', err);\r\n\t\t// Ignore errors getting the api key and just use an empty permissions object.\r\n\t\tpermissions = [];\r\n\t}\r\n\tlet actor;\r\n\tif (permissions.length > 0) {\r\n\t\tactor = await getApiKeyActorId(apiKey);\r\n\t}\r\n\treq.apiKey = {\r\n\t\tkey: apiKey,\r\n\t\tpermissions,\r\n\t};\r\n\tif (actor != null) {\r\n\t\treq.apiKey.actor = actor;\r\n\t}\r\n};\r\n\r\nexport const customAuthorizationMiddleware = (expectedScheme = 'Bearer') => {\r\n\texpectedScheme = expectedScheme.toLowerCase();\r\n\treturn async (\r\n\t\treq: Express.Request,\r\n\t\t_res?: Express.Response,\r\n\t\tnext?: Express.NextFunction,\r\n\t): Promise<void> => {\r\n\t\ttry {\r\n\t\t\tconst auth = req.header('Authorization');\r\n\t\t\tif (!auth) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst parts = auth.split(' ');\r\n\t\t\tif (parts.length !== 2) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst [scheme, apiKey] = parts;\r\n\t\t\tif (scheme.toLowerCase() !== expectedScheme) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tawait checkApiKey(req, apiKey);\r\n\t\t} finally {\r\n\t\t\tnext?.();\r\n\t\t}\r\n\t};\r\n};\r\n\r\n// A default bearer middleware for convenience\r\nexport const authorizationMiddleware = customAuthorizationMiddleware();\r\n\r\nexport const customApiKeyMiddleware = (paramName = 'apikey') => {\r\n\tif (paramName == null) {\r\n\t\tparamName = 'apikey';\r\n\t}\r\n\treturn async (\r\n\t\treq: HookReq | Express.Request,\r\n\t\t_res?: Express.Response,\r\n\t\tnext?: Express.NextFunction,\r\n\t): Promise<void> => {\r\n\t\ttry {\r\n\t\t\tconst apiKey =\r\n\t\t\t\treq.params[paramName] != null\r\n\t\t\t\t\t? req.params[paramName]\r\n\t\t\t\t\t: req.body[paramName] != null\r\n\t\t\t\t\t? req.body[paramName]\r\n\t\t\t\t\t: req.query[paramName];\r\n\t\t\tawait checkApiKey(req, apiKey);\r\n\t\t} finally {\r\n\t\t\tnext?.();\r\n\t\t}\r\n\t};\r\n};\r\n\r\n// A default api key middleware for convenience\r\nexport const apiKeyMiddleware = customApiKeyMiddleware();\r\n\r\nexport const checkPermissions = async (\r\n\treq: PermissionReq,\r\n\tactionList: PermissionCheck,\r\n\tresourceName?: string,\r\n\tvocabulary?: string,\r\n) => {\r\n\tconst permissionsLookup = await getReqPermissions(req);\r\n\treturn $checkPermissions(\r\n\t\tpermissionsLookup,\r\n\t\tactionList,\r\n\t\tvocabulary,\r\n\t\tresourceName,\r\n\t);\r\n};\r\n\r\nexport const checkPermissionsMiddleware = (\r\n\taction: PermissionCheck,\r\n): Express.RequestHandler => async (req, res, next) => {\r\n\ttry {\r\n\t\tconst allowed = await checkPermissions(req, action);\r\n\t\tswitch (allowed) {\r\n\t\t\tcase false:\r\n\t\t\t\tres.sendStatus(401);\r\n\t\t\t\treturn;\r\n\t\t\tcase true:\r\n\t\t\t\tnext();\r\n\t\t\t\treturn;\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error(\r\n\t\t\t\t\t'checkPermissionsMiddleware returned a conditional permission',\r\n\t\t\t\t);\r\n\t\t}\r\n\t} catch (err) {\r\n\t\tsbvrUtils.api.Auth.logger.error(\r\n\t\t\t'Error checking permissions',\r\n\t\t\terr,\r\n\t\t\terr.stack,\r\n\t\t);\r\n\t\tres.sendStatus(503);\r\n\t}\r\n};\r\n\r\nconst getGuestPermissions = memoize(\r\n\tasync () => {\r\n\t\t// Get guest user\r\n\t\tconst result = (await sbvrUtils.api.Auth.get({\r\n\t\t\tresource: 'user',\r\n\t\t\tpassthrough: {\r\n\t\t\t\treq: rootRead,\r\n\t\t\t},\r\n\t\t\tid: {\r\n\t\t\t\tusername: 'guest',\r\n\t\t\t},\r\n\t\t\toptions: {\r\n\t\t\t\t$select: 'id',\r\n\t\t\t},\r\n\t\t})) as { id: number } | undefined;\r\n\t\tif (result == null) {\r\n\t\t\tthrow new Error('No guest user');\r\n\t\t}\r\n\t\treturn _.uniq(await getUserPermissions(result.id));\r\n\t},\r\n\t{ promise: true },\r\n);\r\n\r\nconst getReqPermissions = async (\r\n\treq: PermissionReq,\r\n\todataBinds: ODataBinds = [],\r\n) => {\r\n\tconst [guestPermissions] = await Promise.all([\r\n\t\tgetGuestPermissions(),\r\n\t\t(async () => {\r\n\t\t\t// TODO: Remove this extra actor ID lookup making actor non-optional and updating open-balena-api.\r\n\t\t\tif (\r\n\t\t\t\treq.apiKey != null &&\r\n\t\t\t\treq.apiKey.actor == null &&\r\n\t\t\t\treq.apiKey.permissions != null &&\r\n\t\t\t\treq.apiKey.permissions.length > 0\r\n\t\t\t) {\r\n\t\t\t\tconst actorId = await getApiKeyActorId(req.apiKey.key);\r\n\t\t\t\treq.apiKey!.actor = actorId;\r\n\t\t\t}\r\n\t\t})(),\r\n\t]);\r\n\r\n\tif (guestPermissions.some((p) => DEFAULT_ACTOR_BIND_REGEX.test(p))) {\r\n\t\tthrow new Error('Guest permissions cannot reference actors');\r\n\t}\r\n\r\n\tlet permissions = guestPermissions;\r\n\r\n\tlet actorIndex = 0;\r\n\tconst addActorPermissions = (actorId: number, actorPermissions: string[]) => {\r\n\t\tlet actorBind = DEFAULT_ACTOR_BIND;\r\n\t\tif (actorIndex > 0) {\r\n\t\t\tactorBind += actorIndex;\r\n\t\t\tactorPermissions = actorPermissions.map((actorPermission) =>\r\n\t\t\t\tactorPermission.replace(DEFAULT_ACTOR_BIND_REGEX, actorBind),\r\n\t\t\t);\r\n\t\t}\r\n\t\todataBinds[actorBind] = ['Real', actorId];\r\n\t\tactorIndex++;\r\n\t\tpermissions = permissions.concat(actorPermissions);\r\n\t};\r\n\r\n\tif (req.user != null && req.user.permissions != null) {\r\n\t\taddActorPermissions(req.user.actor, req.user.permissions);\r\n\t} else if (req.apiKey != null && req.apiKey.permissions != null) {\r\n\t\taddActorPermissions(req.apiKey.actor!, req.apiKey.permissions);\r\n\t}\r\n\r\n\tpermissions = _.uniq(permissions);\r\n\r\n\treturn getPermissionsLookup(permissions);\r\n};\r\n\r\nexport const addPermissions = async (\r\n\treq: PermissionReq,\r\n\trequest: ODataRequest & { permissionType?: PermissionCheck },\r\n): Promise<void> => {\r\n\tconst { vocabulary, resourceName, odataQuery, odataBinds } = request;\r\n\tlet { method } = request;\r\n\tlet abstractSqlModel = sbvrUtils.getAbstractSqlModel(request);\r\n\tmethod = method.toUpperCase() as SupportedMethod;\r\n\tconst isMetadataEndpoint =\r\n\t\tmetadataEndpoints.includes(resourceName) || method === 'OPTIONS';\r\n\r\n\tlet permissionType: PermissionCheck;\r\n\tif (request.permissionType != null) {\r\n\t\tpermissionType = request.permissionType;\r\n\t} else if (isMetadataEndpoint) {\r\n\t\tpermissionType = 'model';\r\n\t} else {\r\n\t\tconst methodPermission = methodPermissions[method];\r\n\t\tif (methodPermission != null) {\r\n\t\t\tpermissionType = methodPermission;\r\n\t\t} else {\r\n\t\t\tconsole.warn('Unknown method for permissions type check: ', method);\r\n\t\t\tpermissionType = 'all';\r\n\t\t}\r\n\t}\r\n\r\n\t// This bypasses in the root cases, needed for fetching guest permissions to work, it can almost certainly be done better though\r\n\tlet permissions = req.user?.permissions ?? [];\r\n\tpermissions = permissions.concat(req.apiKey?.permissions ?? []);\r\n\tif (\r\n\t\tpermissions.length > 0 &&\r\n\t\t$checkPermissions(\r\n\t\t\tgetPermissionsLookup(permissions),\r\n\t\t\tpermissionType,\r\n\t\t\tvocabulary,\r\n\t\t) === true\r\n\t) {\r\n\t\t// We have unconditional permission to access the vocab so there's no need to intercept anything\r\n\t\treturn;\r\n\t}\r\n\tconst permissionsLookup = await getReqPermissions(req, odataBinds);\r\n\t// Update the request's abstract sql model to use the constrained version\r\n\trequest.abstractSqlModel = abstractSqlModel = memoizedGetConstrainedModel(\r\n\t\tabstractSqlModel,\r\n\t\tpermissionsLookup,\r\n\t\tvocabulary,\r\n\t);\r\n\r\n\tif (!_.isEqual(permissionType, methodPermissions.GET)) {\r\n\t\tconst sqlName = sbvrUtils.resolveSynonym(request);\r\n\t\todataQuery.resource = `${sqlName}$permissions${JSON.stringify(\r\n\t\t\tpermissionType,\r\n\t\t)}`;\r\n\t}\r\n};\r\n\r\nexport const config = {\r\n\tmodels: [\r\n\t\t{\r\n\t\t\tapiRoot: 'Auth',\r\n\t\t\tmodelText: userModel,\r\n\t\t\tcustomServerCode: exports,\r\n\t\t\tmigrations: {\r\n\t\t\t\t'11.0.0-modified-at': `\r\n\t\t\t\t\tALTER TABLE \"actor\"\r\n\t\t\t\t\tADD COLUMN IF NOT EXISTS \"modified at\" TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL;\r\n\r\n\t\t\t\t\tALTER TABLE \"api key\"\r\n\t\t\t\t\tADD COLUMN IF NOT EXISTS \"modified at\" TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL;\r\n\t\t\t\t\tALTER TABLE \"api key-has-permission\"\r\n\t\t\t\t\tADD COLUMN IF NOT EXISTS \"modified at\" TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL;\r\n\t\t\t\t\tALTER TABLE \"api key-has-role\"\r\n\t\t\t\t\tADD COLUMN IF NOT EXISTS \"modified at\" TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL;\r\n\r\n\t\t\t\t\tALTER TABLE \"permission\"\r\n\t\t\t\t\tADD COLUMN IF NOT EXISTS \"modified at\" TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL;\r\n\r\n\t\t\t\t\tALTER TABLE \"role\"\r\n\t\t\t\t\tADD COLUMN IF NOT EXISTS \"modified at\" TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL;\r\n\r\n\t\t\t\t\tALTER TABLE \"user\"\r\n\t\t\t\t\tADD COLUMN IF NOT EXISTS \"modified at\" TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL;\r\n\t\t\t\t\tALTER TABLE \"user-has-role\"\r\n\t\t\t\t\tADD COLUMN IF NOT EXISTS \"modified at\" TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL;\r\n\t\t\t\t\tALTER TABLE \"user-has-permission\"\r\n\t\t\t\t\tADD COLUMN IF NOT EXISTS \"modified at\" TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL;\r\n\t\t\t\t`,\r\n\t\t\t\t'11.0.1-modified-at': `\r\n\t\t\t\t\tALTER TABLE \"role-has-permission\"\r\n\t\t\t\t\tADD COLUMN IF NOT EXISTS \"modified at\" TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL;\r\n\t\t\t\t`,\r\n\t\t\t},\r\n\t\t},\r\n\t] as sbvrUtils.ExecutableModel[],\r\n};\r\nexport const setup = () => {\r\n\taddHook('all', 'all', 'all', {\r\n\t\tsideEffects: false,\r\n\t\treadOnlyTx: true,\r\n\t\tPREPARSE: ({ req }) => apiKeyMiddleware(req),\r\n\t\tPOSTPARSE: async ({\r\n\t\t\treq,\r\n\t\t\trequest,\r\n\t\t}: {\r\n\t\t\treq: HookReq;\r\n\t\t\trequest: ODataRequest & { permissionType?: PermissionCheck };\r\n\t\t}) => {\r\n\t\t\t// If the abstract sql query is already generated then adding permissions will do nothing\r\n\t\t\tif (request.abstractSqlQuery != null) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (\r\n\t\t\t\trequest.method === 'POST' &&\r\n\t\t\t\trequest.odataQuery.property != null &&\r\n\t\t\t\trequest.odataQuery.property.resource === 'canAccess'\r\n\t\t\t) {\r\n\t\t\t\tif (request.odataQuery.key == null) {\r\n\t\t\t\t\tthrow new BadRequestError();\r\n\t\t\t\t}\r\n\t\t\t\tconst { action, method } = request.values;\r\n\t\t\t\tif ((method == null) === (action == null)) {\r\n\t\t\t\t\t// Exactly one of method or action are allowed\r\n\t\t\t\t\tthrow new BadRequestError();\r\n\t\t\t\t}\r\n\t\t\t\tif (method != null) {\r\n\t\t\t\t\tconst permissions = methodPermissions[method as SupportedMethod];\r\n\t\t\t\t\tif (permissions == null) {\r\n\t\t\t\t\t\tthrow new BadRequestError();\r\n\t\t\t\t\t}\r\n\t\t\t\t\trequest.permissionType = permissions;\r\n\t\t\t\t} else {\r\n\t\t\t\t\trequest.permissionType = action;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst abstractSqlModel = sbvrUtils.getAbstractSqlModel(request);\r\n\t\t\t\trequest.resourceName = request.resourceName.slice(\r\n\t\t\t\t\t0,\r\n\t\t\t\t\t-'#canAccess'.length,\r\n\t\t\t\t);\r\n\t\t\t\tconst resourceName = sbvrUtils.resolveSynonym(request);\r\n\t\t\t\tconst resourceTable = abstractSqlModel.tables[resourceName];\r\n\t\t\t\tif (resourceTable == null) {\r\n\t\t\t\t\tthrow new Error('Unknown resource: ' + request.resourceName);\r\n\t\t\t\t}\r\n\t\t\t\tconst idField = resourceTable.idField;\r\n\t\t\t\trequest.odataQuery.options = {\r\n\t\t\t\t\t$select: { properties: [{ name: idField }] },\r\n\t\t\t\t\t$top: 1,\r\n\t\t\t\t};\r\n\t\t\t\trequest.odataQuery.resource = request.resourceName;\r\n\t\t\t\tdelete request.odataQuery.property;\r\n\t\t\t\trequest.method = 'GET';\r\n\t\t\t\trequest.custom.isAction = 'canAccess';\r\n\t\t\t}\r\n\t\t\tawait addPermissions(req, request);\r\n\t\t},\r\n\t\tPRERESPOND: ({ request, data }) => {\r\n\t\t\tif (request.custom.isAction === 'canAccess' && _.isEmpty(data)) {\r\n\t\t\t\t// If the caller does not have any permissions to access the\r\n\t\t\t\t// resource pine will throw a PermissionError. To have the\r\n\t\t\t\t// same behavior for the case that the user has permissions\r\n\t\t\t\t// to access the resource, but not this instance we also\r\n\t\t\t\t// throw a PermissionError if the result is empty.\r\n\t\t\t\tthrow new PermissionError();\r\n\t\t\t}\r\n\t\t},\r\n\t});\r\n\r\n\taddPureHook('POST', 'Auth', 'user', {\r\n\t\tPOSTPARSE: async ({ request, api }) => {\r\n\t\t\tconst result = await api.post({\r\n\t\t\t\tresource: 'actor',\r\n\t\t\t\toptions: { returnResource: false },\r\n\t\t\t});\r\n\t\t\trequest.values.actor = result.id;\r\n\t\t},\r\n\t});\r\n\r\n\taddPureHook('DELETE', 'Auth', 'user', {\r\n\t\tPOSTRUN: ({ request, api }) =>\r\n\t\t\tapi.delete({\r\n\t\t\t\tresource: 'actor',\r\n\t\t\t\tid: request.values.actor,\r\n\t\t\t}),\r\n\t});\r\n};\r\n","import type { AnyObject } from './common-types';\n\nimport { TypedError } from 'typed-error';\n\nexport class PermissionError extends TypedError {}\nexport class PermissionParsingError extends TypedError {}\n\nexport class SqlCompilationError extends TypedError {}\nexport class SbvrValidationError extends TypedError {}\n\nexport class TranslationError extends TypedError {}\nexport class ParsingError extends TypedError {}\n\nexport class HttpError extends TypedError {\n\tconstructor(\n\t\tpublic status: number,\n\t\terror: string | Error = '',\n\t\tpublic body?: string | AnyObject,\n\t) {\n\t\tsuper(error);\n\t}\n\n\tpublic getResponseBody() {\n\t\treturn this.body !== undefined ? this.body : this.message;\n\t}\n}\n\nexport class BadRequestError extends HttpError {\n\tconstructor(error?: string | Error, body?: string | AnyObject) {\n\t\tsuper(400, error, body);\n\t}\n}\n\nexport class UnauthorizedError extends HttpError {\n\tconstructor(error?: string | Error, body?: string | AnyObject) {\n\t\tsuper(401, error, body);\n\t}\n}\n\nexport class PaymentRequired extends HttpError {\n\tconstructor(error?: string | Error, body?: string | AnyObject) {\n\t\tsuper(402, error, body);\n\t}\n}\n\nexport class ForbiddenError extends HttpError {\n\tconstructor(error?: string | Error, body?: string | AnyObject) {\n\t\tsuper(403, error, body);\n\t}\n}\n\nexport class NotFoundError extends HttpError {\n\tconstructor(error?: string | Error, body?: string | AnyObject) {\n\t\tsuper(404, error, body);\n\t}\n}\n\nexport class MethodNotAllowedError extends HttpError {\n\tconstructor(error?: string | Error, body?: string | AnyObject) {\n\t\tsuper(405, error, body);\n\t}\n}\n\nexport class NotAcceptableError extends HttpError {\n\tconstructor(error?: string | Error, body?: string | AnyObject) {\n\t\tsuper(406, error, body);\n\t}\n}\n\nexport class ProxyAuthenticationRequiredError extends HttpError {\n\tconstructor(error?: string | Error, body?: string | AnyObject) {\n\t\tsuper(407, error, body);\n\t}\n}\n\nexport class RequestTimeoutError extends HttpError {\n\tconstructor(error?: string | Error, body?: string | AnyObject) {\n\t\tsuper(408, error, body);\n\t}\n}\n\nexport class ConflictError extends HttpError {\n\tconstructor(error?: string | Error, body?: string | AnyObject) {\n\t\tsuper(409, error, body);\n\t}\n}\n\nexport class GoneError extends HttpError {\n\tconstructor(error?: string | Error, body?: string | AnyObject) {\n\t\tsuper(410, error, body);\n\t}\n}\n\nexport class LengthRequiredError extends HttpError {\n\tconstructor(error?: string | Error, body?: string | AnyObject) {\n\t\tsuper(411, error, body);\n\t}\n}\n\nexport class PreconditionFailedError extends HttpError {\n\tconstructor(error?: string | Error, body?: string | AnyObject) {\n\t\tsuper(412, error, body);\n\t}\n}\n\nexport class PayloadTooLargeError extends HttpError {\n\tconstructor(error?: string | Error, body?: string | AnyObject) {\n\t\tsuper(413, error, body);\n\t}\n}\n\nexport class URITooLongError extends HttpError {\n\tconstructor(error?: string | Error, body?: string | AnyObject) {\n\t\tsuper(414, error, body);\n\t}\n}\n\nexport class UnsupportedMediaTypeError extends HttpError {\n\tconstructor(error?: string | Error, body?: string | AnyObject) {\n\t\tsuper(415, error, body);\n\t}\n}\n\nexport class RequestedRangeNotSatisfiableError extends HttpError {\n\tconstructor(error?: string | Error, body?: string | AnyObject) {\n\t\tsuper(416, error, body);\n\t}\n}\n\nexport class ExpectationFailedError extends HttpError {\n\tconstructor(error?: string | Error, body?: string | AnyObject) {\n\t\tsuper(417, error, body);\n\t}\n}\n\nexport class MisdirectedRequestError extends HttpError {\n\tconstructor(error?: string | Error, body?: string | AnyObject) {\n\t\tsuper(421, error, body);\n\t}\n}\n\nexport class UnprocessableEntityError extends HttpError {\n\tconstructor(error?: string | Error, body?: string | AnyObject) {\n\t\tsuper(422, error, body);\n\t}\n}\n\nexport class LockedError extends HttpError {\n\tconstructor(error?: string | Error, body?: string | AnyObject) {\n\t\tsuper(423, error, body);\n\t}\n}\n\nexport class FailedDependencyError extends HttpError {\n\tconstructor(error?: string | Error, body?: string | AnyObject) {\n\t\tsuper(424, error, body);\n\t}\n}\n\nexport class UpgradeRequiredError extends HttpError {\n\tconstructor(error?: string | Error, body?: string | AnyObject) {\n\t\tsuper(426, error, body);\n\t}\n}\n\nexport class PreconditionRequiredError extends HttpError {\n\tconstructor(error?: string | Error, body?: string | AnyObject) {\n\t\tsuper(428, error, body);\n\t}\n}\n\nexport class TooManyRequestsError extends HttpError {\n\tconstructor(error?: string | Error, body?: string | AnyObject) {\n\t\tsuper(429, error, body);\n\t}\n}\n\nexport class RequestHeaderFieldsTooLargeError extends HttpError {\n\tconstructor(error?: string | Error, body?: string | AnyObject) {\n\t\tsuper(431, error, body);\n\t}\n}\n\nexport class UnavailableForLegalReasonsError extends HttpError {\n\tconstructor(error?: string | Error, body?: string | AnyObject) {\n\t\tsuper(451, error, body);\n\t}\n}\n\nexport class InternalRequestError extends HttpError {\n\tconstructor(error?: string | Error, body?: string | AnyObject) {\n\t\tsuper(500, error, body);\n\t}\n}\n\nexport class NotImplementedError extends HttpError {\n\tconstructor(error?: string | Error, body?: string | AnyObject) {\n\t\tsuper(501, error, body);\n\t}\n}\n\nexport class BadGatewayError extends HttpError {\n\tconstructor(error?: string | Error, body?: string | AnyObject) {\n\t\tsuper(502, error, body);\n\t}\n}\n\nexport class ServiceUnavailableError extends HttpError {\n\tconstructor(error?: string | Error, body?: string | AnyObject) {\n\t\tsuper(503, error, body);\n\t}\n}\n\nexport class GatewayTimeoutError extends HttpError {\n\tconstructor(error?: string | Error, body?: string | AnyObject) {\n\t\tsuper(504, error, body);\n\t}\n}\n\nexport class HTTPVersionNotSupportedError extends HttpError {\n\tconstructor(error?: string | Error, body?: string | AnyObject) {\n\t\tsuper(505, error, body);\n\t}\n}\n\nexport class VariantAlsoNegotiatesError extends HttpError {\n\tconstructor(error?: string | Error, body?: string | AnyObject) {\n\t\tsuper(506, error, body);\n\t}\n}\n\nexport class InsufficientStorageError extends HttpError {\n\tconstructor(error?: string | Error, body?: string | AnyObject) {\n\t\tsuper(507, error, body);\n\t}\n}\n\nexport class LoopDetectedError extends HttpError {\n\tconstructor(error?: string | Error, body?: string | AnyObject) {\n\t\tsuper(508, error, body);\n\t}\n}\n\nexport class NotExtendedError extends HttpError {\n\tconstructor(error?: string | Error, body?: string | AnyObject) {\n\t\tsuper(510, error, body);\n\t}\n}\n\nexport class NetworkAuthenticationRequiredError extends HttpError {\n\tconstructor(error?: string | Error, body?: string | AnyObject) {\n\t\tsuper(511, error, body);\n\t}\n}\n\nexport const statusCodeToError = {\n\t400: BadRequestError,\n\t401: UnauthorizedError,\n\t402: PaymentRequired,\n\t403: ForbiddenError,\n\t404: NotFoundError,\n\t405: MethodNotAllowedError,\n\t406: NotAcceptableError,\n\t407: ProxyAuthenticationRequiredError,\n\t408: RequestTimeoutError,\n\t409: ConflictError,\n\t410: GoneError,\n\t411: LengthRequiredError,\n\t412: PreconditionFailedError,\n\t413: PayloadTooLargeError,\n\t414: URITooLongError,\n\t415: UnsupportedMediaTypeError,\n\t416: RequestedRangeNotSatisfiableError,\n\t417: ExpectationFailedError,\n\t421: MisdirectedRequestError,\n\t422: UnprocessableEntityError,\n\t423: LockedError,\n\t424: FailedDependencyError,\n\t426: UpgradeRequiredError,\n\t428: PreconditionRequiredError,\n\t429: TooManyRequestsError,\n\t431: RequestHeaderFieldsTooLargeError,\n\t451: UnavailableForLegalReasonsError,\n\t500: InternalRequestError,\n\t501: NotImplementedError,\n\t502: BadGatewayError,\n\t503: ServiceUnavailableError,\n\t504: GatewayTimeoutError,\n\t505: HTTPVersionNotSupportedError,\n\t506: VariantAlsoNegotiatesError,\n\t507: InsufficientStorageError,\n\t508: LoopDetectedError,\n\t510: NotExtendedError,\n\t511: NetworkAuthenticationRequiredError,\n};\n","module.exports = require(\"bluebird\");","\"use strict\";\n\nmodule.exports = require(\"./is-implemented\")() ? Array.from : require(\"./shim\");\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.websql = exports.mysql = exports.postgres = exports.compileRule = exports.isResourceNode = exports.isTableNode = exports.isFromNode = exports.Engines = void 0;\nvar Engines;\n(function (Engines) {\n    Engines[\"postgres\"] = \"postgres\";\n    Engines[\"mysql\"] = \"mysql\";\n    Engines[\"websql\"] = \"websql\";\n})(Engines = exports.Engines || (exports.Engines = {}));\nconst AbstractSQLOptimiser_1 = require(\"./AbstractSQLOptimiser\");\nconst AbstractSQLRules2SQL_1 = require(\"./AbstractSQLRules2SQL\");\nconst sbvrTypes = require(\"@balena/sbvr-types\");\nconst _ = require(\"lodash\");\nconst AbstractSQLSchemaOptimiser_1 = require(\"./AbstractSQLSchemaOptimiser\");\nconst referenced_fields_1 = require(\"./referenced-fields\");\nconst validateTypes = _.mapValues(sbvrTypes, ({ validate }) => validate);\nconst dataTypeValidate = async (value, field) => {\n    const { dataType, required } = field;\n    const validateFn = validateTypes[dataType];\n    if (validateFn != null) {\n        return validateFn(value, required);\n    }\n    else {\n        return new Error('is an unsupported type: ' + dataType);\n    }\n};\nconst dataTypeGen = (engine, { dataType, required, index, defaultValue, checks }) => {\n    var _a, _b;\n    let requiredStr;\n    if (required) {\n        requiredStr = ' NOT NULL';\n    }\n    else {\n        requiredStr = ' NULL';\n    }\n    if (defaultValue != null) {\n        defaultValue = ` DEFAULT ${defaultValue}`;\n    }\n    else {\n        defaultValue = '';\n    }\n    let checksString = '';\n    if (checks != null) {\n        checksString = checks\n            .map((check) => {\n            return ` CHECK (${compileRule(check, engine, true)})`;\n        })\n            .join('');\n    }\n    if (index == null) {\n        index = '';\n    }\n    else if (index !== '') {\n        index = ' ' + index;\n    }\n    const dbType = (_b = (_a = sbvrTypes === null || sbvrTypes === void 0 ? void 0 : sbvrTypes[dataType]) === null || _a === void 0 ? void 0 : _a.types) === null || _b === void 0 ? void 0 : _b[engine];\n    if (dbType != null) {\n        if (typeof dbType === 'function') {\n            return dbType(requiredStr, index);\n        }\n        return dbType + defaultValue + requiredStr + checksString + index;\n    }\n    else {\n        throw new Error(`Unknown data type '${dataType}' for engine: ${engine}`);\n    }\n};\nconst isFromNode = (n) => n[0] === 'From';\nexports.isFromNode = isFromNode;\nconst isTableNode = (n) => n[0] === 'Table';\nexports.isTableNode = isTableNode;\nconst isResourceNode = (n) => n[0] === 'Resource';\nexports.isResourceNode = isResourceNode;\nconst containsNode = (n, checkNodeTypeFn) => {\n    if (checkNodeTypeFn(n)) {\n        return true;\n    }\n    for (const p of n) {\n        if (Array.isArray(p) &&\n            containsNode(p, checkNodeTypeFn)) {\n            return true;\n        }\n    }\n    return false;\n};\nfunction compileRule(abstractSQL, engine, noBinds = false) {\n    abstractSQL = AbstractSQLOptimiser_1.AbstractSQLOptimiser(abstractSQL, noBinds);\n    return AbstractSQLRules2SQL_1.AbstractSQLRules2SQL(abstractSQL, engine, noBinds);\n}\nexports.compileRule = compileRule;\nconst compileSchema = (abstractSqlModel, engine, ifNotExists) => {\n    let ifNotExistsStr = '';\n    let orReplaceStr = '';\n    if (ifNotExists) {\n        ifNotExistsStr = 'IF NOT EXISTS ';\n        orReplaceStr = 'OR REPLACE ';\n    }\n    const createSchemaStatements = [];\n    const alterSchemaStatements = [];\n    let dropSchemaStatements = [];\n    const fns = {};\n    if (abstractSqlModel.functions) {\n        for (const fnName of Object.keys(abstractSqlModel.functions)) {\n            const fnDefinition = abstractSqlModel.functions[fnName];\n            if (engine !== \"postgres\") {\n                throw new Error('Functions are only supported on postgres currently');\n            }\n            if (fnDefinition.language !== 'plpgsql') {\n                throw new Error('Only plpgsql functions currently supported');\n            }\n            if (fnDefinition.type !== 'trigger') {\n                throw new Error('Only trigger functions currently supported');\n            }\n            fns[fnName] = true;\n            createSchemaStatements.push(`\\\nDO $$\nBEGIN\n\tPERFORM '\"${fnName}\"()'::regprocedure;\nEXCEPTION WHEN undefined_function THEN\n\tCREATE FUNCTION \"${fnName}\"()\n\tRETURNS TRIGGER AS $fn$\n\tBEGIN\n\t\t${fnDefinition.body}\n\tEND;\n\t$fn$ LANGUAGE ${fnDefinition.language};\nEND;\n$$;`);\n            dropSchemaStatements.push(`DROP FUNCTION \"${fnName}\"();`);\n        }\n    }\n    const hasDependants = {};\n    const schemaDependencyMap = {};\n    Object.keys(abstractSqlModel.tables).forEach((resourceName) => {\n        const table = abstractSqlModel.tables[resourceName];\n        if (typeof table === 'string') {\n            return;\n        }\n        const { definition } = table;\n        if (definition != null) {\n            if (definition.binds != null && definition.binds.length > 0) {\n                return;\n            }\n            let definitionAbstractSql = definition.abstractSql;\n            if (containsNode(definitionAbstractSql, exports.isResourceNode)) {\n                return;\n            }\n            if (exports.isTableNode(definitionAbstractSql)) {\n                definitionAbstractSql = [\n                    'SelectQuery',\n                    ['Select', [['Field', '*']]],\n                    ['From', definitionAbstractSql],\n                ];\n            }\n            schemaDependencyMap[table.resourceName] = {\n                resourceName,\n                primitive: table.primitive,\n                createSQL: [\n                    `\\\nCREATE ${orReplaceStr}VIEW \"${table.name}\" AS (\n${compileRule(definitionAbstractSql, engine, true).replace(/^/gm, '\t')}\n);`,\n                ],\n                dropSQL: [`DROP VIEW \"${table.name}\";`],\n                depends: [],\n            };\n            return;\n        }\n        const foreignKeys = [];\n        const depends = [];\n        const createSqlElements = [];\n        for (const field of table.fields) {\n            const { fieldName, references, dataType, computed } = field;\n            if (!computed) {\n                createSqlElements.push('\"' + fieldName + '\" ' + dataTypeGen(engine, field));\n                if (['ForeignKey', 'ConceptType'].includes(dataType) &&\n                    references != null) {\n                    const referencedTable = abstractSqlModel.tables[references.resourceName];\n                    const fkDefinition = `FOREIGN KEY (\"${fieldName}\") REFERENCES \"${referencedTable.name}\" (\"${references.fieldName}\")`;\n                    const schemaInfo = schemaDependencyMap[references.resourceName];\n                    if (schemaInfo && schemaInfo.depends.includes(table.resourceName)) {\n                        if (engine !== \"postgres\") {\n                            throw new Error('Circular dependencies are only supported on postgres currently');\n                        }\n                        alterSchemaStatements.push(`\\\nDO $$\nBEGIN\n\tIF NOT EXISTS (\n\t\tSELECT 1\n\t\tFROM information_schema.table_constraints tc\n\t\tJOIN information_schema.key_column_usage kcu USING (constraint_catalog, constraint_schema, constraint_name)\n\t\tJOIN information_schema.constraint_column_usage ccu USING (constraint_catalog, constraint_schema, constraint_name)\n\t\tWHERE constraint_type = 'FOREIGN KEY'\n\t\t\tAND tc.table_schema = CURRENT_SCHEMA()\n\t\t\tAND tc.table_name = '${table.name}'\n\t\t\tAND kcu.column_name = '${fieldName}'\n\t\t\tAND ccu.table_schema = CURRENT_SCHEMA()\n\t\t\tAND ccu.table_name = '${referencedTable.name}'\n\t\t\tAND ccu.column_name = '${references.fieldName}'\n\t) THEN\n\t\tALTER TABLE \"${table.name}\"\n\t\tADD CONSTRAINT \"${table.name}_${fieldName}_fkey\"\n\t\t${fkDefinition};\n\tEND IF;\nEND;\n$$;`);\n                    }\n                    else {\n                        foreignKeys.push(fkDefinition);\n                        depends.push(references.resourceName);\n                        hasDependants[references.resourceName] = true;\n                    }\n                }\n            }\n        }\n        createSqlElements.push(...foreignKeys);\n        for (const index of table.indexes) {\n            createSqlElements.push(index.type + '(\"' + index.fields.join('\", \"') + '\")');\n        }\n        if (table.checks) {\n            for (const check of table.checks) {\n                const comment = check.description\n                    ? `-- ${check.description.split(/\\r?\\n/).join('\\n-- ')}\\n`\n                    : '';\n                const constraintName = check.name ? `CONSTRAINT \"${check.name}\" ` : '';\n                const sql = compileRule(check.abstractSql, engine, true);\n                createSqlElements.push(`\\\n${comment}${constraintName}CHECK (${sql})`);\n            }\n        }\n        const createTriggers = [];\n        const dropTriggers = [];\n        if (table.triggers) {\n            for (const trigger of table.triggers) {\n                if (!fns[trigger.fnName]) {\n                    throw new Error(`No such function '${trigger.fnName}' declared`);\n                }\n                const triggerName = `${table.name}_${trigger.fnName}`.slice(0, 63);\n                createTriggers.push(`\\\nDO\n$$\nBEGIN\nIF NOT EXISTS(\n\tSELECT 1\n\tFROM \"information_schema\".\"triggers\"\n\tWHERE \"event_object_table\" = '${table.name}'\n\tAND \"trigger_name\" = '${triggerName}'\n) THEN\n\tCREATE TRIGGER \"${triggerName}\"\n\t${trigger.when} ${trigger.operation} ON \"${table.name}\"\n\tFOR EACH ${trigger.level}\n\tEXECUTE PROCEDURE \"${trigger.fnName}\"();\nEND IF;\nEND;\n$$`);\n                dropTriggers.push(`DROP TRIGGER \"${triggerName}\";`);\n            }\n        }\n        schemaDependencyMap[table.resourceName] = {\n            resourceName,\n            primitive: table.primitive,\n            createSQL: [\n                `\\\nCREATE TABLE ${ifNotExistsStr}\"${table.name}\" (\n\t${createSqlElements.join('\\n,\\t')}\n);`,\n                ...createTriggers,\n            ],\n            dropSQL: [...dropTriggers, `DROP TABLE \"${table.name}\";`],\n            depends,\n        };\n    });\n    let resourceNames = [];\n    while (resourceNames.length !==\n        (resourceNames = Object.keys(schemaDependencyMap)).length &&\n        resourceNames.length > 0) {\n        for (const resourceName of resourceNames) {\n            const schemaInfo = schemaDependencyMap[resourceName];\n            let unsolvedDependency = false;\n            for (const dependency of schemaInfo.depends) {\n                if (dependency !== resourceName &&\n                    schemaDependencyMap.hasOwnProperty(dependency)) {\n                    unsolvedDependency = true;\n                    break;\n                }\n            }\n            if (unsolvedDependency === false) {\n                if (schemaInfo.primitive === false ||\n                    hasDependants[resourceName] != null) {\n                    if (schemaInfo.primitive !== false) {\n                        console.warn(\"We're adding a primitive table??\", schemaInfo.resourceName);\n                    }\n                    createSchemaStatements.push(...schemaInfo.createSQL);\n                    dropSchemaStatements.push(...schemaInfo.dropSQL);\n                }\n                delete schemaDependencyMap[resourceName];\n            }\n        }\n    }\n    if (Object.keys(schemaDependencyMap).length > 0) {\n        console.error('Failed to resolve all schema dependencies', schemaDependencyMap);\n        throw new Error('Failed to resolve all schema dependencies');\n    }\n    createSchemaStatements.push(...alterSchemaStatements);\n    dropSchemaStatements = dropSchemaStatements.reverse();\n    const ruleStatements = abstractSqlModel.rules.map((rule) => {\n        const ruleBodyNode = rule.find((r) => r[0] === 'Body');\n        if (ruleBodyNode == null || typeof ruleBodyNode === 'string') {\n            throw new Error('Invalid rule');\n        }\n        const ruleBody = ruleBodyNode[1];\n        if (typeof ruleBody === 'string') {\n            throw new Error('Invalid rule');\n        }\n        const ruleSENode = rule.find((r) => r[0] === 'StructuredEnglish');\n        if (ruleSENode == null) {\n            throw new Error('Invalid structured English');\n        }\n        const ruleSE = ruleSENode[1];\n        if (typeof ruleSE !== 'string') {\n            throw new Error('Invalid structured English');\n        }\n        const { query: ruleSQL, bindings: ruleBindings } = compileRule(ruleBody, engine);\n        let referencedFields;\n        try {\n            referencedFields = referenced_fields_1.getReferencedFields(ruleBody);\n        }\n        catch (e) {\n            console.warn('Error fetching referenced fields', e);\n        }\n        let ruleReferencedFields;\n        try {\n            ruleReferencedFields = referenced_fields_1.getRuleReferencedFields(ruleBody);\n        }\n        catch (e) {\n            console.warn('Error fetching rule referenced fields', e);\n        }\n        return {\n            structuredEnglish: ruleSE,\n            sql: ruleSQL,\n            bindings: ruleBindings,\n            referencedFields,\n            ruleReferencedFields,\n        };\n    });\n    return {\n        synonyms: abstractSqlModel.synonyms,\n        relationships: abstractSqlModel.relationships,\n        tables: abstractSqlModel.tables,\n        createSchema: createSchemaStatements,\n        dropSchema: dropSchemaStatements,\n        rules: ruleStatements,\n    };\n};\nconst generateExport = (engine, ifNotExists) => {\n    return {\n        optimizeSchema: AbstractSQLSchemaOptimiser_1.optimizeSchema,\n        compileSchema: (abstractSqlModel) => compileSchema(abstractSqlModel, engine, ifNotExists),\n        compileRule: (abstractSQL) => compileRule(abstractSQL, engine, false),\n        dataTypeValidate,\n        getReferencedFields: referenced_fields_1.getReferencedFields,\n        getRuleReferencedFields: referenced_fields_1.getRuleReferencedFields,\n        getModifiedFields: referenced_fields_1.getModifiedFields,\n    };\n};\nexports.postgres = generateExport(\"postgres\", true);\nexports.mysql = generateExport(\"mysql\", true);\nexports.websql = generateExport(\"websql\", false);\n//# sourceMappingURL=AbstractSQLCompiler.js.map","\"use strict\";\n\nvar isValue = require(\"./is-value\");\n\nvar forEach = Array.prototype.forEach, create = Object.create;\n\nvar process = function (src, obj) {\n\tvar key;\n\tfor (key in src) obj[key] = src[key];\n};\n\n// eslint-disable-next-line no-unused-vars\nmodule.exports = function (opts1/*, options*/) {\n\tvar result = create(null);\n\tforEach.call(arguments, function (options) {\n\t\tif (!isValue(options)) return;\n\t\tprocess(Object(options), result);\n\t});\n\treturn result;\n};\n","\"use strict\";\n\nmodule.exports = require(\"./_iterate\")(\"forEach\");\n","\"use strict\";\n\nmodule.exports = require(\"./is-implemented\")() ? Object.assign : require(\"./shim\");\n","\"use strict\";\n\nvar toPosInt = require(\"../number/to-pos-integer\");\n\nvar test = function (arg1, arg2) { return arg2; };\n\nvar desc, defineProperty, generate, mixin;\n\ntry {\n\tObject.defineProperty(test, \"length\", {\n\t\tconfigurable: true,\n\t\twritable: false,\n\t\tenumerable: false,\n\t\tvalue: 1\n\t});\n}\ncatch (ignore) {}\n\nif (test.length === 1) {\n\t// ES6\n\tdesc = { configurable: true, writable: false, enumerable: false };\n\tdefineProperty = Object.defineProperty;\n\tmodule.exports = function (fn, length) {\n\t\tlength = toPosInt(length);\n\t\tif (fn.length === length) return fn;\n\t\tdesc.value = length;\n\t\treturn defineProperty(fn, \"length\", desc);\n\t};\n} else {\n\tmixin = require(\"../object/mixin\");\n\tgenerate = (function () {\n\t\tvar cache = [];\n\t\treturn function (length) {\n\t\t\tvar args, i = 0;\n\t\t\tif (cache[length]) return cache[length];\n\t\t\targs = [];\n\t\t\twhile (length--) args.push(\"a\" + (++i).toString(36));\n\t\t\t// eslint-disable-next-line no-new-func\n\t\t\treturn new Function(\n\t\t\t\t\"fn\",\n\t\t\t\t\"return function (\" + args.join(\", \") + \") { return fn.apply(this, arguments); };\"\n\t\t\t);\n\t\t};\n\t})();\n\tmodule.exports = function (src, length) {\n\t\tvar target;\n\t\tlength = toPosInt(length);\n\t\tif (src.length === length) return src;\n\t\ttarget = generate(length)(src);\n\t\ttry { mixin(target, src); }\n\t\tcatch (ignore) {}\n\t\treturn target;\n\t};\n}\n","\"use strict\";\n\nmodule.exports = require(\"./is-implemented\")() ? globalThis : require(\"./implementation\");\n","\"use strict\";\n\nvar objToString = Object.prototype.toString\n  , id = objToString.call((function () { return arguments; })());\n\nmodule.exports = function (value) { return objToString.call(value) === id; };\n","\"use strict\";\n\nvar objToString = Object.prototype.toString, id = objToString.call(\"\");\n\nmodule.exports = function (value) {\n\treturn (\n\t\ttypeof value === \"string\" ||\n\t\t(value &&\n\t\t\ttypeof value === \"object\" &&\n\t\t\t(value instanceof String || objToString.call(value) === id)) ||\n\t\tfalse\n\t);\n};\n","import type { OptionalField, Resolvable } from './common-types';\nimport type { Tx } from '../database-layer/db';\nimport type { ODataRequest } from './uri-parser';\nimport type { AnyObject } from 'pinejs-client-core';\nimport type { TypedError } from 'typed-error';\nimport type { SupportedMethod } from '@balena/odata-to-abstract-sql';\n\nimport * as Bluebird from 'bluebird';\nimport * as _ from 'lodash';\nimport { settleMapSeries } from './control-flow';\nimport * as memoize from 'memoizee';\nimport {\n\tPinejsClient,\n\tUser,\n\tApiKey,\n\tresolveSynonym,\n\tgetAbstractSqlModel,\n\tapi,\n} from './sbvr-utils';\n\nexport interface HookReq {\n\tuser?: User;\n\tapiKey?: ApiKey;\n\tmethod: string;\n\turl: string;\n\tquery: AnyObject;\n\tparams: AnyObject;\n\tbody: AnyObject;\n\tcustom?: AnyObject;\n\ttx?: Tx;\n\thooks?: InstantiatedHooks;\n}\nexport interface HookArgs {\n\treq: HookReq;\n\trequest: ODataRequest;\n\tapi: PinejsClient;\n\ttx?: Tx;\n}\nexport type HookResponse = PromiseLike<any> | null | void;\n\nexport interface Hooks {\n\tPREPARSE?: (options: Omit<HookArgs, 'request' | 'api'>) => HookResponse;\n\tPOSTPARSE?: (options: HookArgs) => HookResponse;\n\tPRERUN?: (options: HookArgs & { tx: Tx }) => HookResponse;\n\tPOSTRUN?: (options: HookArgs & { tx: Tx; result: any }) => HookResponse;\n\tPRERESPOND?: (\n\t\toptions: HookArgs & {\n\t\t\ttx: Tx;\n\t\t\tresult: any;\n\t\t\tdata?: any;\n\t\t},\n\t) => HookResponse;\n\t'POSTRUN-ERROR'?: (\n\t\toptions: HookArgs & { error: TypedError | any },\n\t) => HookResponse;\n}\nexport type HookBlueprints = {\n\t[key in keyof Hooks]: Array<HookBlueprint<NonNullable<Hooks[key]>>>;\n};\nconst hookNames: Array<keyof Hooks> = [\n\t'PREPARSE',\n\t'POSTPARSE',\n\t'PRERUN',\n\t'POSTRUN',\n\t'PRERESPOND',\n\t'POSTRUN-ERROR',\n];\nconst isValidHook = (x: any): x is keyof Hooks => hookNames.includes(x);\n\nexport type RollbackAction = () => Resolvable<void>;\nexport type HookFn = (...args: any[]) => any;\nexport interface HookBlueprint<T extends HookFn> {\n\thookFn: T;\n\tsideEffects: boolean;\n\treadOnlyTx: boolean;\n}\nexport type InstantiatedHooks = {\n\t[key in keyof Hooks]: Array<Hook<NonNullable<Hooks[key]>>>;\n};\n\nclass Hook<T extends HookFn> {\n\tprivate hookFn: HookBlueprint<T>['hookFn'];\n\tpublic readOnlyTx: HookBlueprint<T>['readOnlyTx'];\n\tconstructor(hook: HookBlueprint<T>) {\n\t\tthis.hookFn = hook.hookFn;\n\t\tthis.readOnlyTx = hook.readOnlyTx;\n\t}\n\n\tpublic async run(...args: any[]) {\n\t\tawait this.hookFn(...args);\n\t}\n}\n\nclass SideEffectHook<T extends HookFn> extends Hook<T> {\n\tprivate rollbackFns: RollbackAction[] = [];\n\tprivate rolledBack: boolean = false;\n\n\tpublic registerRollback(fn: RollbackAction): void {\n\t\tif (this.rolledBack) {\n\t\t\tBluebird.try(fn);\n\t\t} else {\n\t\t\tthis.rollbackFns.push(fn);\n\t\t}\n\t}\n\n\tpublic async rollback() {\n\t\t// Don't try to call the rollback functions twice\n\t\tif (this.rolledBack) {\n\t\t\treturn;\n\t\t}\n\t\t// set rolledBack to true straight away, so that if any rollback action\n\t\t// is registered after the rollback call, we will immediately execute it\n\t\tthis.rolledBack = true;\n\t\tawait settleMapSeries(this.rollbackFns, (fn) => fn());\n\t}\n}\n\n// The execution order of rollback actions is unspecified\nexport const rollbackRequestHooks = <T extends InstantiatedHooks>(\n\thooks: T | undefined,\n): void => {\n\tif (hooks == null) {\n\t\treturn;\n\t}\n\tsettleMapSeries(_(hooks).flatMap().compact().value(), async (hook) => {\n\t\tif (hook instanceof SideEffectHook) {\n\t\t\tawait hook.rollback();\n\t\t}\n\t});\n};\n\nconst instantiateHooks = (hooks: HookBlueprints): InstantiatedHooks =>\n\t_.mapValues(hooks, (typeHooks: Array<HookBlueprint<HookFn>>) => {\n\t\treturn typeHooks.map((hook) => {\n\t\t\tif (hook.sideEffects) {\n\t\t\t\treturn new SideEffectHook(hook);\n\t\t\t} else {\n\t\t\t\treturn new Hook(hook);\n\t\t\t}\n\t\t});\n\t});\n\nconst mergeHooks = (a: HookBlueprints, b: HookBlueprints): HookBlueprints => {\n\treturn _.mergeWith({}, a, b, (x, y) => {\n\t\tif (Array.isArray(x)) {\n\t\t\treturn x.concat(y);\n\t\t}\n\t});\n};\nexport type HookMethod = keyof typeof apiHooks;\nconst getResourceHooks = (vocabHooks: VocabHooks, resourceName?: string) => {\n\tif (vocabHooks == null) {\n\t\treturn {};\n\t}\n\t// When getting the hooks list for the sake of PREPARSE hooks\n\t// we don't know the resourceName we'll be acting on yet\n\tif (resourceName == null) {\n\t\treturn vocabHooks['all'];\n\t}\n\treturn mergeHooks(vocabHooks[resourceName], vocabHooks['all']);\n};\nconst getVocabHooks = (\n\tmethodHooks: MethodHooks,\n\tvocabulary: string,\n\tresourceName?: string,\n) => {\n\tif (methodHooks == null) {\n\t\treturn {};\n\t}\n\treturn mergeHooks(\n\t\tgetResourceHooks(methodHooks[vocabulary], resourceName),\n\t\tgetResourceHooks(methodHooks['all'], resourceName),\n\t);\n};\nconst getMethodHooks = memoize(\n\t(method: SupportedMethod, vocabulary: string, resourceName?: string) =>\n\t\tmergeHooks(\n\t\t\tgetVocabHooks(apiHooks[method], vocabulary, resourceName),\n\t\t\tgetVocabHooks(apiHooks['all'], vocabulary, resourceName),\n\t\t),\n\t{ primitive: true },\n);\nexport const getHooks = (\n\trequest: Pick<\n\t\tOptionalField<ODataRequest, 'resourceName'>,\n\t\t'resourceName' | 'method' | 'vocabulary'\n\t>,\n): InstantiatedHooks => {\n\tlet { resourceName } = request;\n\tif (resourceName != null) {\n\t\tresourceName = resolveSynonym(\n\t\t\trequest as Pick<ODataRequest, 'resourceName' | 'method' | 'vocabulary'>,\n\t\t);\n\t}\n\treturn instantiateHooks(\n\t\tgetMethodHooks(request.method, request.vocabulary, resourceName),\n\t);\n};\ngetHooks.clear = () => getMethodHooks.clear();\n\ninterface VocabHooks {\n\t[resourceName: string]: HookBlueprints;\n}\ninterface MethodHooks {\n\t[vocab: string]: VocabHooks;\n}\nconst apiHooks = {\n\tall: {} as MethodHooks,\n\tGET: {} as MethodHooks,\n\tPUT: {} as MethodHooks,\n\tPOST: {} as MethodHooks,\n\tPATCH: {} as MethodHooks,\n\tMERGE: {} as MethodHooks,\n\tDELETE: {} as MethodHooks,\n\tOPTIONS: {} as MethodHooks,\n};\n\n// Share hooks between merge and patch since they are the same operation,\n// just MERGE was the OData intermediary until the HTTP spec added PATCH.\napiHooks.MERGE = apiHooks.PATCH;\nexport const addHook = (\n\tmethod: keyof typeof apiHooks,\n\tvocabulary: string,\n\tresourceName: string,\n\thooks:\n\t\t| { [key in keyof Hooks]: HookBlueprint<NonNullable<Hooks[key]>> }\n\t\t| ({ [key in keyof Hooks]: NonNullable<Hooks[key]> } & {\n\t\t\t\tsideEffects: HookBlueprint<HookFn>['sideEffects'];\n\t\t\t\treadOnlyTx: HookBlueprint<HookFn>['readOnlyTx'];\n\t\t  }),\n) => {\n\tconst methodHooks = apiHooks[method];\n\tif (methodHooks == null) {\n\t\tthrow new Error('Unsupported method: ' + method);\n\t}\n\tif (vocabulary === 'all') {\n\t\tif (resourceName !== 'all') {\n\t\t\tthrow new Error(\n\t\t\t\t`When specifying a hook on all apis then you must also specify all resources, got: '${resourceName}'`,\n\t\t\t);\n\t\t}\n\t} else {\n\t\tlet abstractSqlModel;\n\t\ttry {\n\t\t\tabstractSqlModel = getAbstractSqlModel({ vocabulary });\n\t\t} catch {\n\t\t\tthrow new Error('Unknown api root: ' + vocabulary);\n\t\t}\n\t\tif (resourceName !== 'all') {\n\t\t\tconst origResourceName = resourceName;\n\t\t\tresourceName = resolveSynonym({ vocabulary, resourceName });\n\t\t\tif (abstractSqlModel.tables[resourceName] == null) {\n\t\t\t\tthrow new Error(\n\t\t\t\t\t'Unknown resource for api root: ' +\n\t\t\t\t\t\torigResourceName +\n\t\t\t\t\t\t', ' +\n\t\t\t\t\t\tvocabulary,\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\n\tmethodHooks[vocabulary] ??= {};\n\n\tconst apiRootHooks = methodHooks[vocabulary];\n\tapiRootHooks[resourceName] ??= {};\n\n\tconst resourceHooks = apiRootHooks[resourceName];\n\n\tif ('sideEffects' in hooks && 'readOnlyTx' in hooks) {\n\t\tconst { sideEffects, readOnlyTx } = hooks;\n\t\tconst blueprintedHooks: {\n\t\t\t[key in keyof Hooks]: HookBlueprint<NonNullable<Hooks[key]>>;\n\t\t} = {};\n\t\tfor (const hookName of hookNames) {\n\t\t\tconst hookFn: HookFn | undefined = hooks[hookName];\n\t\t\tif (hookFn != null) {\n\t\t\t\tblueprintedHooks[hookName] = {\n\t\t\t\t\thookFn,\n\t\t\t\t\tsideEffects,\n\t\t\t\t\treadOnlyTx,\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t\thooks = blueprintedHooks;\n\t}\n\n\tfor (const hookType of Object.keys(hooks)) {\n\t\tif (!isValidHook(hookType)) {\n\t\t\tthrow new Error('Unknown callback type: ' + hookType);\n\t\t}\n\t\tconst hook = hooks[hookType];\n\t\tresourceHooks[hookType] ??= [];\n\t\tif (hook != null) {\n\t\t\tresourceHooks[hookType]!.push(hook);\n\t\t}\n\t}\n\n\tgetHooks.clear();\n};\n\nexport const addSideEffectHook = (\n\tmethod: HookMethod,\n\tapiRoot: string,\n\tresourceName: string,\n\thooks: Hooks,\n): void => {\n\taddHook(method, apiRoot, resourceName, {\n\t\t...hooks,\n\t\tsideEffects: true,\n\t\treadOnlyTx: false,\n\t});\n};\n\nexport const addPureHook = (\n\tmethod: HookMethod,\n\tapiRoot: string,\n\tresourceName: string,\n\thooks: Hooks,\n): void => {\n\taddHook(method, apiRoot, resourceName, {\n\t\t...hooks,\n\t\tsideEffects: false,\n\t\treadOnlyTx: false,\n\t});\n};\n\nconst defineApi = (args: HookArgs) => {\n\tconst { request, req, tx } = args;\n\tconst { vocabulary } = request;\n\tObject.defineProperty(args, 'api', {\n\t\tget: _.once(() =>\n\t\t\tapi[vocabulary].clone({\n\t\t\t\tpassthrough: { req, tx },\n\t\t\t}),\n\t\t),\n\t});\n};\n\nexport const runHooks = async <T extends keyof Hooks>(\n\thookName: T,\n\thooksList: InstantiatedHooks | undefined,\n\targs: Omit<Parameters<NonNullable<Hooks[T]>>[0], 'api'>,\n) => {\n\tif (hooksList == null) {\n\t\treturn;\n\t}\n\tconst hooks = hooksList[hookName];\n\tif (hooks == null || hooks.length === 0) {\n\t\treturn;\n\t}\n\n\tlet readOnlyArgs: typeof args;\n\tif (args.tx != null) {\n\t\treadOnlyArgs = { ...args, tx: args.tx.asReadOnly() };\n\t} else {\n\t\t// If we don't have a tx then read-only/writable is irrelevant\n\t\treadOnlyArgs = args;\n\t}\n\n\tif ((args as HookArgs).request != null) {\n\t\tdefineApi(args as HookArgs);\n\t\tif (args !== readOnlyArgs) {\n\t\t\t// Only try to define a separate read-only api if it's different\n\t\t\tdefineApi(readOnlyArgs as HookArgs);\n\t\t}\n\t}\n\n\tawait Promise.all(\n\t\t(hooks as Array<Hook<HookFn>>).map(async (hook) => {\n\t\t\tif (hook.readOnlyTx) {\n\t\t\t\tawait hook.run(readOnlyArgs);\n\t\t\t} else {\n\t\t\t\tawait hook.run(args);\n\t\t\t}\n\t\t}),\n\t);\n};\n","\"use strict\";\n\nmodule.exports = require(\"./lib/weak\")(require(\"./\"));\n","import type * as Express from 'express';\r\n\r\nimport './sbvr-loader';\r\n\r\nimport * as dbModule from '../database-layer/db';\r\nimport * as configLoader from '../config-loader/config-loader';\r\nimport * as migrator from '../migrator/migrator';\r\n\r\nimport * as sbvrUtils from '../sbvr-api/sbvr-utils';\r\n\r\nexport * as dbModule from '../database-layer/db';\r\nexport { PinejsSessionStore } from '../pinejs-session-store/pinejs-session-store';\r\nexport * as sbvrUtils from '../sbvr-api/sbvr-utils';\r\nexport * as permissions from '../sbvr-api/permissions';\r\nexport * as errors from '../sbvr-api/errors';\r\nexport * as env from '../config-loader/env';\r\nexport * as types from '../sbvr-api/common-types';\r\nexport * as hooks from '../sbvr-api/hooks';\r\nexport type { configLoader as ConfigLoader };\r\nexport type { migrator as Migrator };\r\n\r\nlet envDatabaseOptions: {\r\n\tengine: string;\r\n\tparams: string;\r\n};\r\nif (dbModule.engines.websql != null) {\r\n\tenvDatabaseOptions = {\r\n\t\tengine: 'websql',\r\n\t\tparams: 'rulemotion',\r\n\t};\r\n} else {\r\n\tlet databaseURL: string;\r\n\tif (process.env.DATABASE_URL) {\r\n\t\tdatabaseURL = process.env.DATABASE_URL;\r\n\t} else if (dbModule.engines.postgres != null) {\r\n\t\tdatabaseURL = 'postgres://postgres:.@localhost:5432/postgres';\r\n\t} else if (dbModule.engines.mysql == null) {\r\n\t\tdatabaseURL = 'mysql://mysql:.@localhost:3306';\r\n\t} else {\r\n\t\tthrow new Error('No supported database options available');\r\n\t}\r\n\tenvDatabaseOptions = {\r\n\t\tengine: databaseURL.slice(0, databaseURL.indexOf(':')),\r\n\t\tparams: databaseURL,\r\n\t};\r\n}\r\n\r\nexport const init = async (\r\n\tapp: Express.Application,\r\n\tconfig?: string | configLoader.Config,\r\n\tdatabaseOptions = envDatabaseOptions,\r\n): Promise<ReturnType<typeof configLoader.setup>> => {\r\n\ttry {\r\n\t\tconst db = dbModule.connect(databaseOptions);\r\n\t\tawait sbvrUtils.setup(app, db);\r\n\t\tconst cfgLoader = await configLoader.setup(app);\r\n\t\tawait cfgLoader.loadConfig(migrator.config);\r\n\r\n\t\tconst promises: Array<Promise<void>> = [];\r\n\t\tif (process.env.SBVR_SERVER_ENABLED) {\r\n\t\t\tconst sbvrServer = await import('../data-server/sbvr-server');\r\n\t\t\tconst transactions = require('../http-transactions/transactions');\r\n\t\t\tpromises.push(cfgLoader.loadConfig(sbvrServer.config));\r\n\t\t\tpromises.push(\r\n\t\t\t\tcfgLoader\r\n\t\t\t\t\t.loadConfig(transactions.config)\r\n\t\t\t\t\t.then(() => transactions.addModelHooks('data')),\r\n\t\t\t);\r\n\t\t}\r\n\t\tif (!process.env.CONFIG_LOADER_DISABLED) {\r\n\t\t\tpromises.push(cfgLoader.loadApplicationConfig(config));\r\n\t\t}\r\n\t\tawait Promise.all(promises);\r\n\r\n\t\treturn cfgLoader;\r\n\t} catch (err) {\r\n\t\tconsole.error('Error initialising server', err, err.stack);\r\n\t\tprocess.exit(1);\r\n\t}\r\n};\r\n","module.exports = require(\"typed-error\");","module.exports = require(\"fs\");","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.AbstractSQLOptimiser = void 0;\nconst _ = require(\"lodash\");\nconst AbstractSQLRules2SQL = require(\"./AbstractSQLRules2SQL\");\nconst { isAbstractSqlQuery, getAbstractSqlQuery, checkArgs, checkMinArgs, isNotNullable, } = AbstractSQLRules2SQL;\nconst escapeForLike = (str) => [\n    'Replace',\n    [\n        'Replace',\n        ['Replace', str, ['EmbeddedText', '\\\\'], ['EmbeddedText', '\\\\\\\\']],\n        ['EmbeddedText', '_'],\n        ['EmbeddedText', '\\\\_'],\n    ],\n    ['EmbeddedText', '%'],\n    ['EmbeddedText', '\\\\%'],\n];\nlet helped = false;\nlet noBinds = false;\nconst Helper = (fn) => {\n    return (...args) => {\n        const result = fn(...args);\n        if (result !== false) {\n            helped = true;\n        }\n        return result;\n    };\n};\nconst isEmptySelectQuery = (query) => {\n    const [type, ...rest] = query;\n    switch (type) {\n        case 'SelectQuery':\n            for (const arg of rest) {\n                if (arg[0] === 'Where') {\n                    const maybeBool = arg[1];\n                    if (maybeBool[0] === 'Boolean') {\n                        if (maybeBool[1] === false) {\n                            return true;\n                        }\n                    }\n                }\n            }\n    }\n    return false;\n};\nconst rewriteMatch = (name, matchers, rewriteFn) => (args) => {\n    checkArgs(name, args, matchers.length);\n    return rewriteFn(args.map((arg, index) => {\n        return matchers[index](arg);\n    }));\n};\nconst matchArgs = (name, ...matchers) => rewriteMatch(name, matchers, (args) => [name, ...args]);\nconst tryMatches = (...matchers) => {\n    return (args) => {\n        let err;\n        for (const matcher of matchers) {\n            try {\n                const result = matcher(args);\n                if (result !== false) {\n                    return result;\n                }\n            }\n            catch (e) {\n                err = e;\n            }\n        }\n        throw err;\n    };\n};\nconst AnyValue = (args) => {\n    const [type, ...rest] = args;\n    if (type === 'Case') {\n        return typeRules[type](rest);\n    }\n    for (const matcher of [\n        isJSONValue,\n        isDateValue,\n        isTextValue,\n        isNumericValue,\n        isBooleanValue,\n        isDurationValue,\n    ]) {\n        if (matcher(type)) {\n            return typeRules[type](rest);\n        }\n    }\n    return UnknownValue(args);\n};\nconst UnknownValue = (args) => {\n    if (args === null || args === 'Null') {\n        helped = true;\n        args = ['Null'];\n    }\n    const [type, ...rest] = args;\n    switch (type) {\n        case 'Null':\n        case 'Field':\n        case 'ReferencedField':\n        case 'Bind':\n        case 'Cast':\n        case 'Coalesce':\n            return typeRules[type](rest);\n        case 'SelectQuery':\n        case 'UnionQuery':\n            return typeRules[type](rest);\n        default:\n            throw new Error(`Invalid \"UnknownValue\" type: ${type}`);\n    }\n};\nconst MatchValue = (matcher) => (args) => {\n    const [type, ...rest] = args;\n    if (matcher(type)) {\n        return typeRules[type](rest);\n    }\n    return UnknownValue(args);\n};\nconst isTextValue = (type) => {\n    return (type === 'Concat' ||\n        type === 'Tolower' ||\n        type === 'ToLower' ||\n        type === 'Toupper' ||\n        type === 'ToUpper' ||\n        AbstractSQLRules2SQL.isTextValue(type));\n};\nconst TextValue = MatchValue(isTextValue);\nconst isNumericValue = (type) => {\n    return (type === 'IndexOf' ||\n        type === 'Indexof' ||\n        AbstractSQLRules2SQL.isNumericValue(type));\n};\nconst NumericValue = MatchValue(isNumericValue);\nconst isBooleanValue = (type) => {\n    return (type === 'Contains' ||\n        type === 'Substringof' ||\n        type === 'Startswith' ||\n        type === 'Endswith' ||\n        AbstractSQLRules2SQL.isBooleanValue(type));\n};\nconst BooleanValue = MatchValue(isBooleanValue);\nconst { isDateValue } = AbstractSQLRules2SQL;\nconst DateValue = MatchValue(isDateValue);\nconst { isJSONValue } = AbstractSQLRules2SQL;\nconst { isDurationValue } = AbstractSQLRules2SQL;\nconst DurationValue = MatchValue(isDurationValue);\nconst { isFieldValue } = AbstractSQLRules2SQL;\nconst Field = (args) => {\n    const [type, ...rest] = args;\n    if (isFieldValue(type)) {\n        return typeRules[type](rest);\n    }\n    else {\n        throw new SyntaxError(`Invalid field type: ${type}`);\n    }\n};\nconst AnyNotNullValue = (args) => {\n    return args != null && args !== 'Null' && args[0] !== 'Null';\n};\nconst FieldOp = (type) => (args) => {\n    if (AnyNotNullValue(args[0]) === false ||\n        AnyNotNullValue(args[1]) === false) {\n        return false;\n    }\n    if (isFieldValue(args[0][0])) {\n        return [type, args[0], args[1]];\n    }\n    else if (isFieldValue(args[1][0])) {\n        return [type, args[1], args[0]];\n    }\n    else {\n        return false;\n    }\n};\nconst FieldEquals = FieldOp('Equals');\nconst FieldNotEquals = FieldOp('NotEquals');\nconst Comparison = (comparison) => {\n    return matchArgs(comparison, AnyValue, AnyValue);\n};\nconst NumberMatch = (type) => {\n    return matchArgs(type, (arg) => {\n        if (typeof arg !== 'number') {\n            throw new SyntaxError(`${type} expected number but got ${typeof arg}`);\n        }\n        return arg;\n    });\n};\nconst mathOps = {\n    Add: '+',\n    Subtract: '-',\n    Multiply: '*',\n    Divide: '/',\n};\nconst MathOp = (type) => {\n    return matchArgs(type, NumericValue, NumericValue);\n};\nconst ExtractNumericDatePart = (type) => {\n    return matchArgs(type, DateValue);\n};\nconst Concatenate = (args) => {\n    checkMinArgs('Concatenate', args, 1);\n    return [\n        'Concatenate',\n        ...args.map((arg) => {\n            if (!isAbstractSqlQuery(arg)) {\n                throw new SyntaxError(`Expected AbstractSqlQuery array but got ${typeof arg}`);\n            }\n            return TextValue(arg);\n        }),\n    ];\n};\nconst Text = matchArgs('Text', _.identity);\nconst Value = (arg) => {\n    switch (arg) {\n        case true:\n        case false:\n        case 'Default':\n            return arg;\n        default:\n            const [type, ...rest] = arg;\n            switch (type) {\n                case 'Null':\n                case 'Bind':\n                case 'Value':\n                case 'Text':\n                case 'Number':\n                case 'Real':\n                case 'Integer':\n                    return typeRules[type](rest);\n                default:\n                    throw new SyntaxError(`Invalid type for Value ${type}`);\n            }\n    }\n};\nconst FromMatch = (args) => {\n    if (typeof args === 'string') {\n        return ['Table', args];\n    }\n    const [type, ...rest] = args;\n    switch (type) {\n        case 'SelectQuery':\n        case 'UnionQuery':\n            return typeRules[type](rest);\n        case 'Table':\n            checkArgs('Table', rest, 1);\n            return ['Table', rest[0]];\n        default:\n            throw new SyntaxError(`From does not support ${type}`);\n    }\n};\nconst MaybeAlias = (args, matchFn) => {\n    if (args.length === 2 &&\n        args[0] !== 'Table' &&\n        args[0] !== 'Count' &&\n        args[0] !== 'Field' &&\n        typeof args[1] === 'string') {\n        helped = true;\n        return ['Alias', matchFn(args[0]), args[1]];\n    }\n    const [type, ...rest] = args;\n    switch (type) {\n        case 'Alias':\n            checkArgs('Alias', rest, 2);\n            return ['Alias', matchFn(getAbstractSqlQuery(rest, 0)), rest[1]];\n        default:\n            return matchFn(args);\n    }\n};\nconst Lower = matchArgs('Lower', TextValue);\nconst Upper = matchArgs('Upper', TextValue);\nconst JoinMatch = (joinType) => (args) => {\n    if (args.length !== 1 && args.length !== 2) {\n        throw new SyntaxError(`\"${joinType}\" requires 1/2 arg(s)`);\n    }\n    const from = MaybeAlias(getAbstractSqlQuery(args, 0), FromMatch);\n    if (args.length === 1) {\n        return [joinType, from];\n    }\n    const [type, ...rest] = getAbstractSqlQuery(args, 1);\n    switch (type) {\n        case 'On':\n            checkArgs('On', rest, 1);\n            const ruleBody = BooleanValue(getAbstractSqlQuery(rest, 0));\n            return [joinType, from, ['On', ruleBody]];\n        default:\n            throw new SyntaxError(`'${joinType}' clause does not support '${type}' clause`);\n    }\n};\nconst typeRules = {\n    UnionQuery: (args) => {\n        checkMinArgs('UnionQuery', args, 2);\n        return [\n            'UnionQuery',\n            ...args.map((arg) => {\n                if (!isAbstractSqlQuery(arg)) {\n                    throw new SyntaxError(`Expected AbstractSqlQuery array but got ${typeof arg}`);\n                }\n                const [type, ...rest] = arg;\n                switch (type) {\n                    case 'SelectQuery':\n                    case 'UnionQuery':\n                        return typeRules[type](rest);\n                    default:\n                        throw new SyntaxError(`UnionQuery does not support ${type}`);\n                }\n            }),\n        ];\n    },\n    SelectQuery: (args) => {\n        const tables = [];\n        let select = [];\n        const groups = {\n            Where: [],\n            GroupBy: [],\n            OrderBy: [],\n            Limit: [],\n            Offset: [],\n        };\n        for (const arg of args) {\n            if (!isAbstractSqlQuery(arg)) {\n                throw new SyntaxError('`SelectQuery` args must all be arrays');\n            }\n            const [type, ...rest] = arg;\n            switch (type) {\n                case 'Select':\n                    if (select.length !== 0) {\n                        throw new SyntaxError(`'SelectQuery' can only accept one '${type}'`);\n                    }\n                    select = [typeRules[type](rest)];\n                    break;\n                case 'From':\n                case 'Join':\n                case 'LeftJoin':\n                case 'RightJoin':\n                case 'FullJoin':\n                case 'CrossJoin':\n                    tables.push(typeRules[type](rest));\n                    break;\n                case 'Where':\n                case 'GroupBy':\n                case 'OrderBy':\n                case 'Limit':\n                case 'Offset':\n                    if (groups[type].length !== 0) {\n                        throw new SyntaxError(`'SelectQuery' can only accept one '${type}'`);\n                    }\n                    groups[type] = [typeRules[type](rest)];\n                    break;\n                default:\n                    throw new SyntaxError(`'SelectQuery' does not support '${type}'`);\n            }\n        }\n        return [\n            'SelectQuery',\n            ...select,\n            ...tables,\n            ...groups.Where,\n            ...groups.GroupBy,\n            ...groups.OrderBy,\n            ...groups.Limit,\n            ...groups.Offset,\n        ];\n    },\n    Select: (args) => {\n        checkArgs('Select', args, 1);\n        return [\n            'Select',\n            getAbstractSqlQuery(args, 0).map((arg) => {\n                if (!isAbstractSqlQuery(arg)) {\n                    throw new SyntaxError(`Expected AbstractSqlQuery array but got ${typeof arg}`);\n                }\n                return MaybeAlias(arg, AnyValue);\n            }),\n        ];\n    },\n    From: (args) => {\n        checkArgs('From', args, 1);\n        return ['From', MaybeAlias(args[0], FromMatch)];\n    },\n    Join: JoinMatch('Join'),\n    LeftJoin: JoinMatch('LeftJoin'),\n    RightJoin: JoinMatch('RightJoin'),\n    FullJoin: JoinMatch('FullJoin'),\n    CrossJoin: (args) => {\n        checkArgs('CrossJoin', args, 1);\n        const from = MaybeAlias(getAbstractSqlQuery(args, 0), FromMatch);\n        return ['CrossJoin', from];\n    },\n    Where: matchArgs('Where', BooleanValue),\n    GroupBy: (args) => {\n        checkArgs('GroupBy', args, 1);\n        const groups = getAbstractSqlQuery(args, 0);\n        checkMinArgs('GroupBy groups', groups, 1);\n        return ['GroupBy', groups.map(AnyValue)];\n    },\n    OrderBy: (args) => {\n        checkMinArgs('OrderBy', args, 1);\n        return [\n            'OrderBy',\n            ...args.map((arg) => {\n                checkMinArgs('OrderBy ordering', arg, 2);\n                const order = arg[0];\n                if (order !== 'ASC' && order !== 'DESC') {\n                    throw new SyntaxError(`Can only order by \"ASC\" or \"DESC\"`);\n                }\n                const field = Field(getAbstractSqlQuery(arg, 1));\n                return [order, field];\n            }),\n        ];\n    },\n    Limit: matchArgs('Limit', NumericValue),\n    Offset: matchArgs('Offset', NumericValue),\n    Count: (args) => {\n        checkArgs('Count', args, 1);\n        if (args[0] !== '*') {\n            throw new SyntaxError('\"Count\" only supports \"*\"');\n        }\n        return ['Count', args[0]];\n    },\n    Average: matchArgs('Average', NumericValue),\n    Sum: matchArgs('Sum', NumericValue),\n    Field: matchArgs('Field', _.identity),\n    ReferencedField: matchArgs('ReferencedField', _.identity, _.identity),\n    Cast: matchArgs('Cast', AnyValue, _.identity),\n    Number: NumberMatch('Number'),\n    Real: NumberMatch('Real'),\n    Integer: NumberMatch('Integer'),\n    Boolean: matchArgs('Boolean', _.identity),\n    EmbeddedText: matchArgs('EmbeddedText', _.identity),\n    Null: matchArgs('Null'),\n    Now: matchArgs('Now'),\n    AggregateJSON: matchArgs('AggregateJSON', _.identity),\n    Equals: tryMatches(Helper((args) => {\n        checkArgs('Equals', args, 2);\n        let valueIndex;\n        if (args[0][0] === 'Null') {\n            valueIndex = 1;\n        }\n        else if (args[1][0] === 'Null') {\n            valueIndex = 0;\n        }\n        else {\n            return false;\n        }\n        return ['NotExists', getAbstractSqlQuery(args, valueIndex)];\n    }), Comparison('Equals')),\n    NotEquals: tryMatches(Helper((args) => {\n        checkArgs('NotEquals', args, 2);\n        let valueIndex;\n        if (args[0][0] === 'Null') {\n            valueIndex = 1;\n        }\n        else if (args[1][0] === 'Null') {\n            valueIndex = 0;\n        }\n        else {\n            return false;\n        }\n        return ['Exists', getAbstractSqlQuery(args, valueIndex)];\n    }), Comparison('NotEquals')),\n    GreaterThan: Comparison('GreaterThan'),\n    GreaterThanOrEqual: Comparison('GreaterThanOrEqual'),\n    LessThan: Comparison('LessThan'),\n    LessThanOrEqual: Comparison('LessThanOrEqual'),\n    Like: Comparison('Like'),\n    IsNotDistinctFrom: tryMatches(Helper((args) => {\n        checkArgs('IsNotDistinctFrom', args, 2);\n        let valueIndex;\n        if (args[0][0] === 'Null') {\n            valueIndex = 1;\n        }\n        else if (args[1][0] === 'Null') {\n            valueIndex = 0;\n        }\n        else {\n            return false;\n        }\n        return ['NotExists', getAbstractSqlQuery(args, valueIndex)];\n    }), Helper((args) => {\n        checkArgs('IsDistinctFrom', args, 2);\n        if (isNotNullable(getAbstractSqlQuery(args, 0)) &&\n            isNotNullable(getAbstractSqlQuery(args, 1))) {\n            return ['Equals', ...args];\n        }\n        return false;\n    }), matchArgs('IsNotDistinctFrom', AnyValue, AnyValue)),\n    IsDistinctFrom: tryMatches(Helper((args) => {\n        checkArgs('IsDistinctFrom', args, 2);\n        let valueIndex;\n        if (args[0][0] === 'Null') {\n            valueIndex = 1;\n        }\n        else if (args[1][0] === 'Null') {\n            valueIndex = 0;\n        }\n        else {\n            return false;\n        }\n        return ['Exists', getAbstractSqlQuery(args, valueIndex)];\n    }), Helper((args) => {\n        checkArgs('IsDistinctFrom', args, 2);\n        if (isNotNullable(getAbstractSqlQuery(args, 0)) &&\n            isNotNullable(getAbstractSqlQuery(args, 1))) {\n            return ['NotEquals', ...args];\n        }\n        return false;\n    }), matchArgs('IsDistinctFrom', AnyValue, AnyValue)),\n    Add: MathOp('Add'),\n    Subtract: MathOp('Subtract'),\n    Multiply: MathOp('Multiply'),\n    Divide: MathOp('Divide'),\n    Year: ExtractNumericDatePart('Year'),\n    Month: ExtractNumericDatePart('Month'),\n    Day: ExtractNumericDatePart('Day'),\n    Hour: ExtractNumericDatePart('Hour'),\n    Minute: ExtractNumericDatePart('Minute'),\n    Second: ExtractNumericDatePart('Second'),\n    Fractionalseconds: ExtractNumericDatePart('Fractionalseconds'),\n    Totalseconds: matchArgs('Totalseconds', DurationValue),\n    Concat: Concatenate,\n    Concatenate,\n    Replace: matchArgs('Replace', TextValue, TextValue, TextValue),\n    CharacterLength: matchArgs('CharacterLength', TextValue),\n    StrPos: matchArgs('StrPos', TextValue, TextValue),\n    Substring: (args) => {\n        checkMinArgs('Substring', args, 2);\n        const str = TextValue(getAbstractSqlQuery(args, 0));\n        const nums = args.slice(1).map((arg) => {\n            if (!isAbstractSqlQuery(arg)) {\n                throw new SyntaxError(`Expected AbstractSqlQuery array but got ${typeof arg}`);\n            }\n            return NumericValue(arg);\n        });\n        return ['Substring', str, ...nums];\n    },\n    Right: matchArgs('Right', TextValue, NumericValue),\n    Tolower: Lower,\n    ToLower: Lower,\n    Lower,\n    Toupper: Upper,\n    ToUpper: Upper,\n    Upper,\n    Trim: matchArgs('Trim', TextValue),\n    Round: matchArgs('Round', NumericValue),\n    Floor: matchArgs('Floor', NumericValue),\n    Ceiling: matchArgs('Ceiling', NumericValue),\n    ToDate: matchArgs('ToDate', DateValue),\n    ToTime: matchArgs('ToTime', DateValue),\n    Coalesce: (args) => {\n        checkMinArgs('Coalesce', args, 2);\n        return ['Coalesce', ...args.map(AnyValue)];\n    },\n    Case: (args) => {\n        checkMinArgs('Case', args, 1);\n        return [\n            'Case',\n            ...args.map((arg, index) => {\n                if (!isAbstractSqlQuery(arg)) {\n                    throw new SyntaxError(`Expected AbstractSqlQuery array but got ${typeof arg}`);\n                }\n                const [type, ...rest] = arg;\n                switch (type) {\n                    case 'When':\n                        checkArgs('When', rest, 2);\n                        const matches = BooleanValue(getAbstractSqlQuery(rest, 0));\n                        const resultValue = AnyValue(getAbstractSqlQuery(rest, 1));\n                        return ['When', matches, resultValue];\n                    case 'Else':\n                        if (index !== args.length - 1) {\n                            throw new SyntaxError('Else must be the last element of a Case');\n                        }\n                        checkArgs('Else', rest, 1);\n                        return ['Else', AnyValue(getAbstractSqlQuery(rest, 0))];\n                    default:\n                        throw new SyntaxError('Case can only contain When/Else');\n                }\n            }),\n        ];\n    },\n    And: tryMatches(Helper((args) => {\n        if (args.length !== 1) {\n            return false;\n        }\n        return getAbstractSqlQuery(args, 0);\n    }), Helper((args) => {\n        checkMinArgs('And', args, 2);\n        let maybeHelped = false;\n        const conditions = _.flatMap(args, (arg) => {\n            if (!isAbstractSqlQuery(arg)) {\n                throw new SyntaxError(`Expected AbstractSqlQuery array but got ${typeof arg}`);\n            }\n            if (arg[0] === 'And') {\n                maybeHelped = true;\n                return arg.slice(1);\n            }\n            return [arg];\n        });\n        if (!maybeHelped) {\n            return false;\n        }\n        return ['And', ...conditions];\n    }), Helper((args) => {\n        checkMinArgs('And', args, 2);\n        let maybeHelped = false;\n        let containsFalse = false;\n        const conditions = args.filter((arg) => {\n            if (arg[0] === 'Boolean') {\n                if (arg[1] === true) {\n                    maybeHelped = true;\n                    return false;\n                }\n                else if (arg[1] === false) {\n                    containsFalse = true;\n                }\n            }\n            return true;\n        });\n        if (containsFalse) {\n            return ['Boolean', false];\n        }\n        if (maybeHelped) {\n            return ['And', ...conditions];\n        }\n        return false;\n    }), Helper((args) => {\n        checkMinArgs('And', args, 2);\n        const fieldBuckets = {};\n        const others = [];\n        let maybeHelped = false;\n        args.map((arg) => {\n            if (!isAbstractSqlQuery(arg)) {\n                throw new SyntaxError(`Expected AbstractSqlQuery array but got ${typeof arg}`);\n            }\n            if (arg[0] === 'NotEquals') {\n                const fieldBool = FieldNotEquals(arg.slice(1));\n                if (fieldBool !== false) {\n                    const fieldRef = fieldBool[1];\n                    if (fieldBuckets[fieldRef] == null) {\n                        fieldBuckets[fieldRef] = [fieldBool];\n                    }\n                    else {\n                        maybeHelped = true;\n                        fieldBuckets[fieldRef].push(fieldBool);\n                    }\n                    return;\n                }\n            }\n            else if (arg[0] === 'NotIn') {\n                const fieldRef = arg[1];\n                if (fieldBuckets[fieldRef] == null) {\n                    fieldBuckets[fieldRef] = [arg];\n                }\n                else {\n                    maybeHelped = true;\n                    fieldBuckets[fieldRef].push(arg);\n                }\n                return;\n            }\n            others.push(arg);\n        });\n        if (!maybeHelped) {\n            return false;\n        }\n        const fields = Object.keys(fieldBuckets).map((fieldRef) => {\n            const fieldBucket = fieldBuckets[fieldRef];\n            if (fieldBucket.length === 1) {\n                return fieldBucket[0];\n            }\n            else {\n                return [\n                    'NotIn',\n                    fieldBucket[0][1],\n                    ..._.flatMap(fieldBucket, (field) => field.slice(2)),\n                ];\n            }\n        });\n        return ['And', ...fields, ...others];\n    }), (args) => {\n        checkMinArgs('And', args, 2);\n        return [\n            'And',\n            ...args.map((arg) => {\n                if (!isAbstractSqlQuery(arg)) {\n                    throw new SyntaxError(`Expected AbstractSqlQuery array but got ${typeof arg}`);\n                }\n                return BooleanValue(arg);\n            }),\n        ];\n    }),\n    Or: tryMatches(Helper((args) => {\n        if (args.length !== 1) {\n            return false;\n        }\n        return getAbstractSqlQuery(args, 0);\n    }), Helper((args) => {\n        checkMinArgs('Or', args, 2);\n        let maybeHelped = false;\n        const conditions = _.flatMap(args, (arg) => {\n            if (!isAbstractSqlQuery(arg)) {\n                throw new SyntaxError(`Expected AbstractSqlQuery array but got ${typeof arg}`);\n            }\n            if (arg[0] === 'Or') {\n                maybeHelped = true;\n                return arg.slice(1);\n            }\n            return [arg];\n        });\n        if (!maybeHelped) {\n            return false;\n        }\n        return ['Or', ...conditions];\n    }), Helper((args) => {\n        checkMinArgs('Or', args, 2);\n        let maybeHelped = false;\n        let containsTrue = false;\n        const conditions = args.filter((arg) => {\n            if (arg[0] === 'Boolean') {\n                if (arg[1] === false) {\n                    maybeHelped = true;\n                    return false;\n                }\n                else if (arg[1] === true) {\n                    containsTrue = true;\n                }\n            }\n            return true;\n        });\n        if (containsTrue) {\n            return ['Boolean', true];\n        }\n        if (maybeHelped) {\n            return ['Or', ...conditions];\n        }\n        return false;\n    }), Helper((args) => {\n        checkMinArgs('Or', args, 2);\n        const fieldBuckets = {};\n        const others = [];\n        let maybeHelped = false;\n        args.map((arg) => {\n            if (!isAbstractSqlQuery(arg)) {\n                throw new SyntaxError(`Expected AbstractSqlQuery array but got ${typeof arg}`);\n            }\n            if (arg[0] === 'Equals') {\n                const fieldBool = FieldEquals(arg.slice(1));\n                if (fieldBool !== false) {\n                    const fieldRef = fieldBool[1];\n                    if (fieldBuckets[fieldRef] == null) {\n                        fieldBuckets[fieldRef] = [fieldBool];\n                    }\n                    else {\n                        maybeHelped = true;\n                        fieldBuckets[fieldRef].push(fieldBool);\n                    }\n                    return;\n                }\n            }\n            else if (arg[0] === 'In') {\n                const fieldRef = arg[1];\n                if (fieldBuckets[fieldRef] == null) {\n                    fieldBuckets[fieldRef] = [arg];\n                }\n                else {\n                    maybeHelped = true;\n                    fieldBuckets[fieldRef].push(arg);\n                }\n                return;\n            }\n            others.push(arg);\n        });\n        if (!maybeHelped) {\n            return false;\n        }\n        const fields = Object.keys(fieldBuckets).map((fieldRef) => {\n            const fieldBucket = fieldBuckets[fieldRef];\n            if (fieldBucket.length === 1) {\n                return fieldBucket[0];\n            }\n            else {\n                return [\n                    'In',\n                    fieldBucket[0][1],\n                    ..._.flatMap(fieldBucket, (field) => field.slice(2)),\n                ];\n            }\n        });\n        return ['Or', ...fields, ...others];\n    }), (args) => {\n        checkMinArgs('Or', args, 2);\n        return [\n            'Or',\n            ...args.map((arg) => {\n                if (!isAbstractSqlQuery(arg)) {\n                    throw new SyntaxError(`Expected AbstractSqlQuery array but got ${typeof arg}`);\n                }\n                return BooleanValue(arg);\n            }),\n        ];\n    }),\n    Bind: (args) => {\n        if (noBinds) {\n            throw new SyntaxError('Cannot use a bind whilst they are disabled');\n        }\n        if (args.length !== 1 && args.length !== 2) {\n            throw new SyntaxError(`\"Bind\" requires 1/2 arg(s)`);\n        }\n        return ['Bind', ...args];\n    },\n    Text,\n    Value: Text,\n    Date: matchArgs('Date', _.identity),\n    Duration: (args) => {\n        checkArgs('Duration', args, 1);\n        let duration = args[0];\n        if (duration == null || typeof duration !== 'object') {\n            throw new SyntaxError(`Duration must be an object, got ${typeof duration}`);\n        }\n        duration = _(duration)\n            .pick('negative', 'day', 'hour', 'minute', 'second')\n            .omitBy(_.isNil)\n            .value();\n        if (_(duration).omit('negative').isEmpty()) {\n            throw new SyntaxError('Invalid duration');\n        }\n        return ['Duration', duration];\n    },\n    Exists: tryMatches(Helper((args) => {\n        checkArgs('Exists', args, 1);\n        const arg = getAbstractSqlQuery(args, 0);\n        if (isNotNullable(arg)) {\n            return ['Boolean', true];\n        }\n        return false;\n    }), Helper((args) => {\n        checkArgs('Exists', args, 1);\n        const arg = getAbstractSqlQuery(args, 0);\n        if (isEmptySelectQuery(arg)) {\n            return ['Boolean', false];\n        }\n        return false;\n    }), (args) => {\n        checkArgs('Exists', args, 1);\n        const arg = getAbstractSqlQuery(args, 0);\n        const [type, ...rest] = arg;\n        switch (type) {\n            case 'SelectQuery':\n            case 'UnionQuery':\n                return ['Exists', typeRules[type](rest)];\n            default:\n                return ['Exists', AnyValue(arg)];\n        }\n    }),\n    NotExists: tryMatches(Helper((args) => {\n        checkArgs('Exists', args, 1);\n        const arg = getAbstractSqlQuery(args, 0);\n        if (isNotNullable(arg)) {\n            return ['Boolean', false];\n        }\n        return false;\n    }), Helper((args) => {\n        checkArgs('Exists', args, 1);\n        const arg = getAbstractSqlQuery(args, 0);\n        if (isEmptySelectQuery(arg)) {\n            return ['Boolean', true];\n        }\n        return false;\n    }), (args) => {\n        checkArgs('NotExists', args, 1);\n        const arg = getAbstractSqlQuery(args, 0);\n        const [type, ...rest] = arg;\n        switch (type) {\n            case 'SelectQuery':\n            case 'UnionQuery':\n                return ['NotExists', typeRules[type](rest)];\n            default:\n                return ['NotExists', AnyValue(arg)];\n        }\n    }),\n    Not: tryMatches(Helper((args) => {\n        checkArgs('Not', args, 1);\n        const [type, ...rest] = getAbstractSqlQuery(args, 0);\n        switch (type) {\n            case 'Not':\n                return BooleanValue(rest[0]);\n            case 'Equals':\n                return typeRules.NotEquals(rest);\n            case 'NotEquals':\n                return typeRules.Equals(rest);\n            case 'In':\n                return typeRules.NotIn(rest);\n            case 'NotIn':\n                return typeRules.In(rest);\n            case 'Exists':\n                return typeRules.NotExists(rest);\n            case 'NotExists':\n                return typeRules.Exists(rest);\n            default:\n                return false;\n        }\n    }), matchArgs('Not', BooleanValue)),\n    In: (args) => {\n        checkMinArgs('In', args, 2);\n        const field = Field(getAbstractSqlQuery(args, 0));\n        const vals = args.slice(1).map((arg) => {\n            if (!isAbstractSqlQuery(arg)) {\n                throw new SyntaxError(`Expected AbstractSqlQuery array but got ${typeof arg}`);\n            }\n            return AnyValue(arg);\n        });\n        return ['In', field, ...vals];\n    },\n    NotIn: (args) => {\n        checkMinArgs('NotIn', args, 2);\n        const field = Field(getAbstractSqlQuery(args, 0));\n        const vals = args.slice(1).map((arg) => {\n            if (!isAbstractSqlQuery(arg)) {\n                throw new SyntaxError(`Expected AbstractSqlQuery array but got ${typeof arg}`);\n            }\n            return AnyValue(arg);\n        });\n        return ['NotIn', field, ...vals];\n    },\n    InsertQuery: (args) => {\n        const tables = [];\n        let fields = [];\n        let values = [];\n        const where = [];\n        for (const arg of args) {\n            if (!isAbstractSqlQuery(arg)) {\n                throw new SyntaxError('`InsertQuery` args must all be arrays');\n            }\n            const [type, ...rest] = arg;\n            switch (type) {\n                case 'Fields':\n                    if (fields.length !== 0) {\n                        throw new SyntaxError(`'InsertQuery' can only accept one '${type}'`);\n                    }\n                    checkMinArgs('Update fields', rest, 1);\n                    fields = [arg];\n                    break;\n                case 'Values':\n                    if (values.length !== 0) {\n                        throw new SyntaxError(`'InsertQuery' can only accept one '${type}'`);\n                    }\n                    const valuesArray = getAbstractSqlQuery(rest, 0);\n                    if (valuesArray.length > 0) {\n                        const [valuesType, ...valuesRest] = valuesArray;\n                        switch (valuesType) {\n                            case 'SelectQuery':\n                            case 'UnionQuery':\n                                values = [['Values', typeRules[valuesType](valuesRest)]];\n                                break;\n                            default:\n                                values = [\n                                    ['Values', valuesArray.map(Value)],\n                                ];\n                        }\n                    }\n                    break;\n                case 'From':\n                    tables.push(typeRules[type](rest));\n                    break;\n                case 'Where':\n                    break;\n                default:\n                    throw new SyntaxError(`'InsertQuery' does not support '${type}'`);\n            }\n        }\n        if (tables.length === 0) {\n            throw new SyntaxError(\"'InsertQuery' must have a From component\");\n        }\n        if (fields.length === 0) {\n            throw new SyntaxError(\"'InsertQuery' requires a Fields component\");\n        }\n        if (values.length === 0 && fields[0][1].length !== 0) {\n            throw new SyntaxError(\"'InsertQuery' requires Values component to be present if Fields are provided \");\n        }\n        if (fields.length !== 0 &&\n            values.length !== 0 &&\n            !['SelectQuery', 'UnionQuery'].includes(values[0][0]) &&\n            fields[0].length !== values[0].length) {\n            throw new SyntaxError(\"'InsertQuery' requires Fields and Values components to have the same length or use a query for Values\");\n        }\n        return [\n            'InsertQuery',\n            ...tables,\n            ...fields,\n            ...values,\n            ...where,\n        ];\n    },\n    UpdateQuery: (args) => {\n        const tables = [];\n        let fields = [];\n        let values = [];\n        let where = [];\n        for (const arg of args) {\n            if (!isAbstractSqlQuery(arg)) {\n                throw new SyntaxError('`UpdateQuery` args must all be arrays');\n            }\n            const [type, ...rest] = arg;\n            switch (type) {\n                case 'Fields':\n                    if (fields.length !== 0) {\n                        throw new SyntaxError(`'UpdateQuery' can only accept one '${type}'`);\n                    }\n                    checkMinArgs('Update fields', rest, 1);\n                    fields = [arg];\n                    break;\n                case 'Values':\n                    if (values.length !== 0) {\n                        throw new SyntaxError(`'UpdateQuery' can only accept one '${type}'`);\n                    }\n                    checkArgs('Update values', rest, 1);\n                    const valuesArray = getAbstractSqlQuery(rest, 0);\n                    checkMinArgs('Update values array', valuesArray, 1);\n                    values = [['Values', valuesArray.map(Value)]];\n                    break;\n                case 'From':\n                    tables.push(typeRules[type](rest));\n                    break;\n                case 'Where':\n                    if (where.length !== 0) {\n                        throw new SyntaxError(`'UpdateQuery' can only accept one '${type}'`);\n                    }\n                    where = [typeRules[type](rest)];\n                    break;\n                default:\n                    throw new SyntaxError(`'UpdateQuery' does not support '${type}'`);\n            }\n        }\n        if (tables.length === 0) {\n            throw new SyntaxError(\"'UpdateQuery' must have a From component\");\n        }\n        if (fields.length === 0) {\n            throw new SyntaxError(\"'UpdateQuery' requires a Fields component\");\n        }\n        if (values.length === 0) {\n            throw new SyntaxError(\"'UpdateQuery' requires a Values component\");\n        }\n        return [\n            'UpdateQuery',\n            ...tables,\n            ...fields,\n            ...values,\n            ...where,\n        ];\n    },\n    DeleteQuery: (args) => {\n        const tables = [];\n        let where = [];\n        for (const arg of args) {\n            if (!isAbstractSqlQuery(arg)) {\n                throw new SyntaxError('`DeleteQuery` args must all be arrays');\n            }\n            const [type, ...rest] = arg;\n            switch (type) {\n                case 'From':\n                    tables.push(typeRules[type](rest));\n                    break;\n                case 'Where':\n                    if (where.length !== 0) {\n                        throw new SyntaxError(`'DeleteQuery' can only accept one '${type}'`);\n                    }\n                    where = [typeRules[type](rest)];\n                    break;\n                default:\n                    throw new SyntaxError(`'DeleteQuery' does not support '${type}'`);\n            }\n        }\n        if (tables.length === 0) {\n            throw new SyntaxError(\"'DeleteQuery' must have a From component\");\n        }\n        return ['DeleteQuery', ...tables, ...where];\n    },\n    Contains: rewriteMatch('Contains', [TextValue, TextValue], Helper(([haystack, needle]) => [\n        'Like',\n        haystack,\n        [\n            'Concatenate',\n            ['EmbeddedText', '%'],\n            escapeForLike(needle),\n            ['EmbeddedText', '%'],\n        ],\n    ])),\n    Substringof: rewriteMatch('Substringof', [TextValue, TextValue], Helper(([needle, haystack]) => [\n        'Like',\n        haystack,\n        [\n            'Concatenate',\n            ['EmbeddedText', '%'],\n            escapeForLike(needle),\n            ['EmbeddedText', '%'],\n        ],\n    ])),\n    Startswith: rewriteMatch('Startswith', [TextValue, TextValue], Helper(([haystack, needle]) => [\n        'Like',\n        haystack,\n        ['Concatenate', escapeForLike(needle), ['EmbeddedText', '%']],\n    ])),\n    Endswith: rewriteMatch('Endswith', [TextValue, TextValue], Helper(([haystack, needle]) => [\n        'Like',\n        haystack,\n        ['Concatenate', ['EmbeddedText', '%'], escapeForLike(needle)],\n    ])),\n    IndexOf: rewriteMatch('IndexOf', [TextValue, TextValue], Helper(([haystack, needle]) => [\n        'Subtract',\n        ['StrPos', haystack, needle],\n        ['Number', 1],\n    ])),\n    Indexof: rewriteMatch('Indexof', [TextValue, TextValue], Helper(([haystack, needle]) => [\n        'Subtract',\n        ['StrPos', haystack, needle],\n        ['Number', 1],\n    ])),\n};\nconst AbstractSQLOptimiser = (abstractSQL, $noBinds = false) => {\n    noBinds = $noBinds;\n    do {\n        helped = false;\n        const [type, ...rest] = abstractSQL;\n        switch (type) {\n            case 'SelectQuery':\n            case 'UnionQuery':\n            case 'InsertQuery':\n            case 'UpdateQuery':\n            case 'DeleteQuery':\n                abstractSQL = typeRules[type](rest);\n                break;\n            case 'UpsertQuery':\n                checkArgs('UpsertQuery', rest, 2);\n                const insertQuery = getAbstractSqlQuery(rest, 0);\n                const updateQuery = getAbstractSqlQuery(rest, 1);\n                if (insertQuery[0] !== 'InsertQuery' ||\n                    updateQuery[0] !== 'UpdateQuery') {\n                    throw new SyntaxError('UpsertQuery must have [InsertQuery, UpdateQuery] provided');\n                }\n                abstractSQL = [\n                    'UpsertQuery',\n                    typeRules.InsertQuery(insertQuery.slice(1)),\n                    typeRules.UpdateQuery(updateQuery.slice(1)),\n                ];\n                break;\n            default:\n                abstractSQL = AnyValue(abstractSQL);\n        }\n    } while (helped);\n    return abstractSQL;\n};\nexports.AbstractSQLOptimiser = AbstractSQLOptimiser;\n//# sourceMappingURL=AbstractSQLOptimiser.js.map","var OMeta = require(\"ometa-js/lib/ometajs/core\"), _ = require(\"lodash\"), SBVRLibs = exports.SBVRLibs = OMeta._extend({});\n\nSBVRLibs.initialize = function() {\n    this.currentVocabulary = \"\";\n    this.vocabularies = {};\n    this.factTypes = {};\n};\n\nSBVRLibs.ApplyFirstExisting = function(rules, ruleArgs) {\n    null == ruleArgs && (ruleArgs = []);\n    for (var i = 0; i < rules.length; i++) if (null != this[rules[i]]) return ruleArgs.length > 0 ? this._applyWithArgs.apply(this, [ rules[i] ].concat(ruleArgs)) : this._apply(rules[i]);\n};\n\nSBVRLibs.IdentifiersEqual = function(a, b) {\n    return a[0] === b[0] && a[1] === b[1] && a[2] === b[2];\n};\n\nSBVRLibs.FollowConceptType = function(identifier) {\n    var conceptTypes = this.vocabularies[identifier[2]].ConceptTypes;\n    identifier = identifier.slice(0, 3);\n    return !!conceptTypes.hasOwnProperty(identifier) && conceptTypes[identifier];\n};\n\nSBVRLibs.AddVocabulary = function(vocabulary, baseSynonym) {\n    this.currentVocabulary = baseSynonym;\n    this.vocabularies.hasOwnProperty(baseSynonym) || (this.vocabularies[baseSynonym] = {\n        Term: {},\n        Name: {},\n        IdentifierChildren: {},\n        ConceptTypes: {}\n    });\n    this.vocabularies.hasOwnProperty(vocabulary) || (this.vocabularies[vocabulary] = this.vocabularies[baseSynonym]);\n};\n\nvar formatFactType = function(factType) {\n    return factType.map(function(v) {\n        return v[1];\n    }).join(\" \");\n};\n\nSBVRLibs.AddFactType = function(factType, realFactType) {\n    for (var mappedFactType = [], matchingFactTypes = _.isEqual(factType, realFactType), i = 0; i < realFactType.length; i++) {\n        var realFactTypePart = realFactType[i];\n        mappedFactType[i] = realFactTypePart.slice(0, 3);\n        if (\"Verb\" !== realFactTypePart[0]) if (matchingFactTypes) mappedFactType[i][3] = i; else {\n            for (var mappingFound = !1, j = 0; j < factType.length; j++) {\n                var factTypePart = factType[j];\n                if (\"Verb\" !== factTypePart[0] && this.IdentifiersEqual(realFactTypePart, factTypePart) && realFactTypePart.length === factTypePart.length && (realFactTypePart.length < 4 || realFactTypePart[3][1] === factTypePart[3][1])) {\n                    if (mappingFound) throw new Error('Ambiguous use of fact type \"' + formatFactType(factType) + '\", please add explicit numbering');\n                    mappingFound = !0;\n                    mappedFactType[i][3] = j;\n                }\n            }\n            if (!mappingFound) throw new Error('Unable to map identifiers for \"' + formatFactType(factType) + '\", please add explicit numbering');\n        }\n    }\n    this._traverseFactType(factType, mappedFactType);\n};\n\nSBVRLibs._traverseFactType = function(factType, create) {\n    var $elf = this, traverseRecurse = function(currentFactTypePart, remainingFactType, currentLevel) {\n        if (null == currentFactTypePart) {\n            create && (currentLevel.__valid = create);\n            return currentLevel;\n        }\n        var finalLevel, finalLevels = {};\n        switch (currentFactTypePart[0]) {\n          case \"Verb\":\n            currentFactTypePart = currentFactTypePart.slice(0, 2);\n            break;\n\n          default:\n            currentFactTypePart = currentFactTypePart.slice(0, 3);\n        }\n        if (currentLevel.hasOwnProperty(currentFactTypePart) || create && (currentLevel[currentFactTypePart] = {})) {\n            finalLevel = traverseRecurse(remainingFactType[0], remainingFactType.slice(1), currentLevel[currentFactTypePart]);\n            !1 !== finalLevel && Object.assign(finalLevels, finalLevel);\n        }\n        if (!create && (\"Term\" === currentFactTypePart[0] || \"Name\" === currentFactTypePart[0])) for (;!1 !== (currentFactTypePart = $elf.FollowConceptType(currentFactTypePart)); ) if (currentLevel.hasOwnProperty(currentFactTypePart)) {\n            finalLevel = traverseRecurse(remainingFactType[0], remainingFactType.slice(1), currentLevel[currentFactTypePart]);\n            !1 !== finalLevel && Object.assign(finalLevels, finalLevel);\n        }\n        return !0 !== _.isEmpty(finalLevels) && finalLevels;\n    };\n    return traverseRecurse(factType[0], factType.slice(1), this.factTypes);\n};","\"use strict\";\n\nvar toPosInt = require(\"es5-ext/number/to-pos-integer\");\n\nmodule.exports = function (optsLength, fnLength, isAsync) {\n\tvar length;\n\tif (isNaN(optsLength)) {\n\t\tlength = fnLength;\n\t\tif (!(length >= 0)) return 1;\n\t\tif (isAsync && length) return length - 1;\n\t\treturn length;\n\t}\n\tif (optsLength === false) return false;\n\treturn toPosInt(optsLength);\n};\n","\"use strict\";\n\nvar isValue = require(\"./is-value\");\n\nvar map = { function: true, object: true };\n\nmodule.exports = function (value) { return (isValue(value) && map[typeof value]) || false; };\n","\"use strict\";\n\nvar isValue = require(\"../value/is\");\n\n// prettier-ignore\nvar possibleTypes = { \"object\": true, \"function\": true, \"undefined\": true /* document.all */ };\n\nmodule.exports = function (value) {\n\tif (!isValue(value)) return false;\n\treturn hasOwnProperty.call(possibleTypes, typeof value);\n};\n","\"use strict\";\n\nvar numberIsNaN       = require(\"../../number/is-nan\")\n  , toPosInt          = require(\"../../number/to-pos-integer\")\n  , value             = require(\"../../object/valid-value\")\n  , indexOf           = Array.prototype.indexOf\n  , objHasOwnProperty = Object.prototype.hasOwnProperty\n  , abs               = Math.abs\n  , floor             = Math.floor;\n\nmodule.exports = function (searchElement/*, fromIndex*/) {\n\tvar i, length, fromIndex, val;\n\tif (!numberIsNaN(searchElement)) return indexOf.apply(this, arguments);\n\n\tlength = toPosInt(value(this).length);\n\tfromIndex = arguments[1];\n\tif (isNaN(fromIndex)) fromIndex = 0;\n\telse if (fromIndex >= 0) fromIndex = floor(fromIndex);\n\telse fromIndex = toPosInt(this.length) - floor(abs(fromIndex));\n\n\tfor (i = fromIndex; i < length; ++i) {\n\t\tif (objHasOwnProperty.call(this, i)) {\n\t\t\tval = this[i];\n\t\t\tif (numberIsNaN(val)) return i; // Jslint: ignore\n\t\t}\n\t}\n\treturn -1;\n};\n","\"use strict\";\n\nvar callable = require(\"./valid-callable\")\n  , forEach  = require(\"./for-each\")\n  , call     = Function.prototype.call;\n\nmodule.exports = function (obj, cb/*, thisArg*/) {\n\tvar result = {}, thisArg = arguments[2];\n\tcallable(cb);\n\tforEach(obj, function (value, key, targetObj, index) {\n\t\tresult[key] = call.call(cb, thisArg, value, key, targetObj, index);\n\t});\n\treturn result;\n};\n","'use strict';\n\nvar ensureCallable = function (fn) {\n\tif (typeof fn !== 'function') throw new TypeError(fn + \" is not a function\");\n\treturn fn;\n};\n\nvar byObserver = function (Observer) {\n\tvar node = document.createTextNode(''), queue, currentQueue, i = 0;\n\tnew Observer(function () {\n\t\tvar callback;\n\t\tif (!queue) {\n\t\t\tif (!currentQueue) return;\n\t\t\tqueue = currentQueue;\n\t\t} else if (currentQueue) {\n\t\t\tqueue = currentQueue.concat(queue);\n\t\t}\n\t\tcurrentQueue = queue;\n\t\tqueue = null;\n\t\tif (typeof currentQueue === 'function') {\n\t\t\tcallback = currentQueue;\n\t\t\tcurrentQueue = null;\n\t\t\tcallback();\n\t\t\treturn;\n\t\t}\n\t\tnode.data = (i = ++i % 2); // Invoke other batch, to handle leftover callbacks in case of crash\n\t\twhile (currentQueue) {\n\t\t\tcallback = currentQueue.shift();\n\t\t\tif (!currentQueue.length) currentQueue = null;\n\t\t\tcallback();\n\t\t}\n\t}).observe(node, { characterData: true });\n\treturn function (fn) {\n\t\tensureCallable(fn);\n\t\tif (queue) {\n\t\t\tif (typeof queue === 'function') queue = [queue, fn];\n\t\t\telse queue.push(fn);\n\t\t\treturn;\n\t\t}\n\t\tqueue = fn;\n\t\tnode.data = (i = ++i % 2);\n\t};\n};\n\nmodule.exports = (function () {\n\t// Node.js\n\tif ((typeof process === 'object') && process && (typeof process.nextTick === 'function')) {\n\t\treturn process.nextTick;\n\t}\n\n\t// queueMicrotask\n\tif (typeof queueMicrotask === \"function\") {\n\t\treturn function (cb) { queueMicrotask(ensureCallable(cb)); };\n\t}\n\n\t// MutationObserver\n\tif ((typeof document === 'object') && document) {\n\t\tif (typeof MutationObserver === 'function') return byObserver(MutationObserver);\n\t\tif (typeof WebKitMutationObserver === 'function') return byObserver(WebKitMutationObserver);\n\t}\n\n\t// W3C Draft\n\t// http://dvcs.w3.org/hg/webperf/raw-file/tip/specs/setImmediate/Overview.html\n\tif (typeof setImmediate === 'function') {\n\t\treturn function (cb) { setImmediate(ensureCallable(cb)); };\n\t}\n\n\t// Wide available standard\n\tif ((typeof setTimeout === 'function') || (typeof setTimeout === 'object')) {\n\t\treturn function (cb) { setTimeout(ensureCallable(cb), 0); };\n\t}\n\n\treturn null;\n}());\n","module.exports = function deepFreeze (o) {\n  Object.freeze(o);\n\n  Object.getOwnPropertyNames(o).forEach(function (prop) {\n    if (o.hasOwnProperty(prop)\n    && o[prop] !== null\n    && (typeof o[prop] === \"object\" || typeof o[prop] === \"function\")\n    && !Object.isFrozen(o[prop])) {\n      deepFreeze(o[prop]);\n    }\n  });\n  \n  return o;\n};\n","\"use strict\";\n\nmodule.exports = require(\"./is-implemented\")() ? Object.setPrototypeOf : require(\"./shim\");\n","/// <references types=\"websql\"/>\r\nimport type * as Mysql from 'mysql';\r\nimport type * as Pg from 'pg';\r\nimport type * as PgConnectionString from 'pg-connection-string';\r\nimport type { Resolvable } from '../sbvr-api/common-types';\r\n\r\nimport { Engines } from '@balena/abstract-sql-compiler';\r\nimport * as Bluebird from 'bluebird';\r\nimport * as EventEmitter from 'eventemitter3';\r\nimport * as _ from 'lodash';\r\nimport { TypedError } from 'typed-error';\r\nimport * as env from '../config-loader/env';\r\n\r\nexport const metrics = new EventEmitter();\r\n\r\nexport interface CodedError extends Error {\r\n\tcode: number | string;\r\n}\r\n\r\ntype CreateTransactionFn = (stackTraceErr?: Error) => Promise<Tx>;\r\ntype CloseTransactionFn = () => void;\r\nexport interface Row {\r\n\t[fieldName: string]: any;\r\n}\r\nexport interface Result {\r\n\trows: Row[];\r\n\trowsAffected: number;\r\n\tinsertId?: number;\r\n}\r\n\r\nexport type Sql = string;\r\nexport type Bindings = any[];\r\n\r\nconst isSqlError = (value: any): value is SQLError => {\r\n\treturn (\r\n\t\tvalue != null &&\r\n\t\tvalue.constructor != null &&\r\n\t\tvalue.constructor.name === 'SQLError'\r\n\t);\r\n};\r\n\r\nexport class DatabaseError extends TypedError {\r\n\tpublic code: number | string;\r\n\tconstructor(message?: string | CodedError | SQLError) {\r\n\t\tif (isSqlError(message)) {\r\n\t\t\t// If this is a SQLError we have to handle it specially (since it's not actually an instance of Error)\r\n\t\t\tsuper(message.message as string);\r\n\t\t} else {\r\n\t\t\tsuper(message);\r\n\t\t}\r\n\t\tif (\r\n\t\t\tmessage != null &&\r\n\t\t\ttypeof message !== 'string' &&\r\n\t\t\tmessage.code != null\r\n\t\t) {\r\n\t\t\t// If the message has a code then use that as our code.\r\n\t\t\tthis.code = message.code;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport class ConstraintError extends DatabaseError {}\r\nexport class UniqueConstraintError extends ConstraintError {}\r\nexport class ForeignKeyConstraintError extends ConstraintError {}\r\nexport class CheckConstraintError extends ConstraintError {}\r\nexport class TransactionClosedError extends DatabaseError {}\r\nexport class ReadOnlyViolationError extends DatabaseError {}\r\n\r\nconst wrapDatabaseError = (err: CodedError): DatabaseError => {\r\n\tmetrics.emit('db_error', err);\r\n\tif (!(err instanceof DatabaseError)) {\r\n\t\t// Wrap the error so we can catch it easier later\r\n\t\treturn new DatabaseError(err);\r\n\t}\r\n\treturn err;\r\n};\r\n\r\nconst alwaysExport = {\r\n\tDatabaseError,\r\n\tConstraintError,\r\n\tUniqueConstraintError,\r\n\tForeignKeyConstraintError,\r\n\tCheckConstraintError,\r\n\tTransactionClosedError,\r\n\tReadOnlyViolationError,\r\n};\r\ntype BaseDatabase = typeof alwaysExport;\r\n\r\ninterface TransactionFn {\r\n\t<T>(fn: (tx: Tx) => Resolvable<T>): Promise<T>;\r\n\t(): Promise<Tx>;\r\n}\r\n\r\nexport interface Database extends BaseDatabase {\r\n\tengine: Engines;\r\n\texecuteSql: (\r\n\t\tthis: Database,\r\n\t\tsql: Sql,\r\n\t\tbindings?: Bindings,\r\n\t) => Promise<Result>;\r\n\ttransaction: TransactionFn;\r\n\treadTransaction: TransactionFn;\r\n}\r\n\r\nexport const engines: {\r\n\t[engine: string]: (connectString: string | object) => Database;\r\n} = {};\r\n\r\nconst atomicExecuteSql: Database['executeSql'] = async function (\r\n\tsql,\r\n\tbindings,\r\n) {\r\n\treturn await this.transaction(\r\n\t\tasync (tx) => await tx.executeSql(sql, bindings),\r\n\t);\r\n};\r\n\r\nconst asyncTryFn = (fn: () => any) => {\r\n\tPromise.resolve().then(fn);\r\n};\r\n\r\ntype RejectedFunctions = (\r\n\tmessage: string,\r\n) => {\r\n\texecuteSql: Tx['executeSql'];\r\n\trollback: Tx['rollback'];\r\n};\r\nconst getRejectedFunctions: RejectedFunctions = env.DEBUG\r\n\t? (message) => {\r\n\t\t\t// In debug mode we create the error here to give the stack trace of where we first closed the transaction,\r\n\t\t\t// but it adds significant overhead for a production environment\r\n\t\t\tconst rejectionValue = new TransactionClosedError(message);\r\n\t\t\tconst rejectFn = async () => {\r\n\t\t\t\t// We return a new rejected promise on each call so that errors are automatically logged if the\r\n\t\t\t\t// rejection is not handled (but only if it is not handled)\r\n\t\t\t\tthrow rejectionValue;\r\n\t\t\t};\r\n\t\t\treturn {\r\n\t\t\t\texecuteSql: rejectFn,\r\n\t\t\t\trollback: rejectFn,\r\n\t\t\t};\r\n\t  }\r\n\t: (message) => {\r\n\t\t\tconst rejectFn = async () => {\r\n\t\t\t\tthrow new TransactionClosedError(message);\r\n\t\t\t};\r\n\t\t\treturn {\r\n\t\t\t\texecuteSql: rejectFn,\r\n\t\t\t\trollback: rejectFn,\r\n\t\t\t};\r\n\t  };\r\n\r\nconst onEnd: Tx['on'] = (name: string, fn: () => void) => {\r\n\tif (name === 'end') {\r\n\t\tasyncTryFn(fn);\r\n\t}\r\n};\r\nconst onRollback: Tx['on'] = (name: string, fn: () => void) => {\r\n\tif (name === 'rollback') {\r\n\t\tasyncTryFn(fn);\r\n\t}\r\n};\r\n\r\nclass AutomaticClose {\r\n\tprivate automaticCloseTimeout: ReturnType<typeof setTimeout>;\r\n\tprivate automaticClose: () => void;\r\n\tprivate pending: false | number = 0;\r\n\tconstructor(tx: Tx, private stackTraceErr?: Error) {\r\n\t\tthis.automaticClose = () => {\r\n\t\t\tconsole.error(\r\n\t\t\t\t`Transaction still open after ${env.db.timeoutMS}ms without an execute call.`,\r\n\t\t\t);\r\n\t\t\tif (this.stackTraceErr) {\r\n\t\t\t\tconsole.error(this.stackTraceErr.stack);\r\n\t\t\t}\r\n\t\t\ttx.rollback();\r\n\t\t};\r\n\t\tthis.automaticCloseTimeout = setTimeout(\r\n\t\t\tthis.automaticClose,\r\n\t\t\tenv.db.timeoutMS,\r\n\t\t);\r\n\t}\r\n\tpublic incrementPending() {\r\n\t\tif (this.pending === false) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.pending++;\r\n\t\tclearTimeout(this.automaticCloseTimeout);\r\n\t}\r\n\tpublic decrementPending() {\r\n\t\tif (this.pending === false) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.pending--;\r\n\t\t// We only ever want one timeout running at a time, hence not using <=\r\n\t\tif (this.pending === 0) {\r\n\t\t\tthis.automaticCloseTimeout = setTimeout(\r\n\t\t\t\tthis.automaticClose,\r\n\t\t\t\tenv.db.timeoutMS,\r\n\t\t\t);\r\n\t\t} else if (this.pending < 0) {\r\n\t\t\tconsole.error('Pending transactions is less than 0, wtf?');\r\n\t\t\tthis.pending = 0;\r\n\t\t}\r\n\t}\r\n\tpublic cancelPending() {\r\n\t\t// Set pending to false to cancel all pending.\r\n\t\tthis.pending = false;\r\n\t\tclearTimeout(this.automaticCloseTimeout);\r\n\t}\r\n}\r\n\r\nexport abstract class Tx {\r\n\tprivate closed = false;\r\n\tprotected automaticClose: AutomaticClose;\r\n\r\n\tconstructor(\r\n\t\tprotected readOnly: boolean,\r\n\t\tstackTraceErr?: Error | AutomaticClose,\r\n\t) {\r\n\t\tif (stackTraceErr instanceof AutomaticClose) {\r\n\t\t\tthis.automaticClose = stackTraceErr;\r\n\t\t} else {\r\n\t\t\tthis.automaticClose = new AutomaticClose(this, stackTraceErr);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate closeTransaction(message: string): void {\r\n\t\tthis.automaticClose.cancelPending();\r\n\t\tconst { executeSql, rollback } = getRejectedFunctions(message);\r\n\t\tthis.executeSql = executeSql;\r\n\t\tthis.rollback = this.end = rollback;\r\n\t\tthis.closed = true;\r\n\t}\r\n\tpublic isClosed() {\r\n\t\treturn this.closed;\r\n\t}\r\n\r\n\tprotected abstract clone(readOnly?: boolean): Tx;\r\n\tpublic asReadOnly() {\r\n\t\tif (this.readOnly) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\treturn this.clone(true);\r\n\t}\r\n\tpublic isReadOnly() {\r\n\t\treturn this.readOnly;\r\n\t}\r\n\r\n\tpublic async executeSql(\r\n\t\tsql: Sql,\r\n\t\tbindings: Bindings = [],\r\n\t\t...args: any[]\r\n\t): Promise<Result> {\r\n\t\tif (this.readOnly && !/^\\s*SELECT\\s(?:[^;]|;\\s*SELECT\\s)*$/.test(sql)) {\r\n\t\t\tthrow new ReadOnlyViolationError(\r\n\t\t\t\t`Attempted to run a non-SELECT statement in a read-only tx: ${sql}`,\r\n\t\t\t);\r\n\t\t}\r\n\t\treturn await this.$executeSql(sql, bindings, ...args);\r\n\t}\r\n\tprotected async $executeSql(\r\n\t\tsql: Sql,\r\n\t\tbindings: Bindings = [],\r\n\t\t...args: any[]\r\n\t): Promise<Result> {\r\n\t\tthis.automaticClose.incrementPending();\r\n\r\n\t\tconst t0 = Date.now();\r\n\t\ttry {\r\n\t\t\treturn await this._executeSql(sql, bindings, ...args);\r\n\t\t} catch (err) {\r\n\t\t\tthrow wrapDatabaseError(err);\r\n\t\t} finally {\r\n\t\t\tthis.automaticClose.decrementPending();\r\n\t\t\tconst queryTime = Date.now() - t0;\r\n\t\t\tmetrics.emit('db_query_time', {\r\n\t\t\t\tqueryTime,\r\n\t\t\t\t// metrics-TODO: statistics on query types (SELECT, INSERT)\r\n\t\t\t\t// themselves should be gathered by postgres, while at this\r\n\t\t\t\t// scope in pine, we should report the overall query time as\r\n\t\t\t\t// being associated with an HTTP method on the given model\r\n\t\t\t\t// (eg. [PUT, Device])\r\n\t\t\t\t//\r\n\t\t\t\t// metrics-TODO: evaluate whether a request to a model can,\r\n\t\t\t\t// with hooks, make multiple DB queries in such a way that\r\n\t\t\t\t// it would be a statistically significant difference in the\r\n\t\t\t\t// \"query time\" metric if we were to report them individually\r\n\t\t\t\t// by attaching here, vs. aggregating all query times for a\r\n\t\t\t\t// given request as one figure.\r\n\t\t\t\t//\r\n\t\t\t\t// Grab the first word of the query and regard that as the\r\n\t\t\t\t// \"query type\" (to be improved in line with the above\r\n\t\t\t\t// TODO's)\r\n\t\t\t\tqueryType: sql.split(' ', 1)[0],\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\tpublic async rollback(): Promise<void> {\r\n\t\ttry {\r\n\t\t\tconst promise = this._rollback();\r\n\t\t\tthis.closeTransaction('Transaction has been rolled back.');\r\n\r\n\t\t\tawait promise;\r\n\t\t} finally {\r\n\t\t\tthis.listeners.rollback.forEach(asyncTryFn);\r\n\t\t\tthis.on = onRollback;\r\n\t\t\tthis.clearListeners();\r\n\t\t}\r\n\t}\r\n\tpublic async end(): Promise<void> {\r\n\t\tconst promise = this._commit();\r\n\t\tthis.closeTransaction('Transaction has been ended.');\r\n\r\n\t\tawait promise;\r\n\r\n\t\tthis.listeners.end.forEach(asyncTryFn);\r\n\t\tthis.on = onEnd;\r\n\t\tthis.clearListeners();\r\n\t}\r\n\r\n\tprivate listeners: {\r\n\t\tend: Array<() => void>;\r\n\t\trollback: Array<() => void>;\r\n\t} = {\r\n\t\tend: [],\r\n\t\trollback: [],\r\n\t};\r\n\tpublic on(name: keyof Tx['listeners'], fn: () => void): void {\r\n\t\tthis.listeners[name].push(fn);\r\n\t}\r\n\r\n\tprivate clearListeners() {\r\n\t\tthis.listeners.end.length = 0;\r\n\t\tthis.listeners.rollback.length = 0;\r\n\t}\r\n\r\n\tprotected abstract _executeSql(\r\n\t\tsql: Sql,\r\n\t\tbindings: Bindings,\r\n\t\taddReturning?: false | string,\r\n\t): Promise<Result>;\r\n\tprotected abstract _rollback(): Promise<void>;\r\n\tprotected abstract _commit(): Promise<void>;\r\n\r\n\tpublic abstract tableList(extraWhereClause?: string): Promise<Result>;\r\n\tpublic async dropTable(tableName: string, ifExists = true) {\r\n\t\tif (typeof tableName !== 'string') {\r\n\t\t\tthrow new TypeError('\"tableName\" must be a string');\r\n\t\t}\r\n\t\tif (tableName.includes('\"')) {\r\n\t\t\tthrow new TypeError('\"tableName\" cannot include double quotes');\r\n\t\t}\r\n\t\tif (this.readOnly) {\r\n\t\t\tthrow new ReadOnlyViolationError(\r\n\t\t\t\t'Cannot drop tables in a read-only transaction',\r\n\t\t\t);\r\n\t\t}\r\n\t\tconst ifExistsStr = ifExists === true ? ' IF EXISTS' : '';\r\n\t\treturn await this.$executeSql(`DROP TABLE${ifExistsStr} \"${tableName}\";`);\r\n\t}\r\n}\r\n\r\nconst getStackTraceErr: () => Error | undefined = env.DEBUG\r\n\t? () => new Error()\r\n\t: (_.noop as () => undefined);\r\n\r\nconst createTransaction = (createFunc: CreateTransactionFn): TransactionFn => {\r\n\treturn async <T>(fn?: (tx: Tx) => Resolvable<T>): Promise<T | Tx> => {\r\n\t\tconst stackTraceErr = getStackTraceErr();\r\n\t\tlet tx;\r\n\t\ttry {\r\n\t\t\ttx = await createFunc(stackTraceErr);\r\n\t\t} catch (err) {\r\n\t\t\tthrow wrapDatabaseError(err);\r\n\t\t}\r\n\t\tif (fn) {\r\n\t\t\ttry {\r\n\t\t\t\tconst result = await fn(tx);\r\n\t\t\t\tawait tx.end();\r\n\t\t\t\treturn result;\r\n\t\t\t} catch (err) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tawait tx.rollback();\r\n\t\t\t\t} catch {\r\n\t\t\t\t\t// Ignore rollback errors as we want to throw the original error\r\n\t\t\t\t}\r\n\t\t\t\tthrow err;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\treturn tx;\r\n\t\t}\r\n\t};\r\n};\r\n\r\nlet maybePg: typeof Pg | undefined;\r\ntry {\r\n\t// tslint:disable-next-line:no-var-requires\r\n\tmaybePg = require('pg');\r\n} catch (e) {\r\n\t// Ignore errors\r\n}\r\nif (maybePg != null) {\r\n\tconst pg = maybePg;\r\n\tengines.postgres = (connectString: string | object): Database => {\r\n\t\tconst PG_UNIQUE_VIOLATION = '23505';\r\n\t\tconst PG_FOREIGN_KEY_VIOLATION = '23503';\r\n\t\tconst PG_CHECK_CONSTRAINT_VIOLATION = '23514';\r\n\r\n\t\tlet config: Pg.PoolConfig;\r\n\t\tif (typeof connectString === 'string') {\r\n\t\t\tconst pgConnectionString: typeof PgConnectionString = require('pg-connection-string');\r\n\t\t\t// We have to cast because of the use of null vs undefined\r\n\t\t\tconfig = pgConnectionString.parse(connectString) as Pg.PoolConfig;\r\n\t\t} else {\r\n\t\t\tconfig = connectString;\r\n\t\t}\r\n\t\tconfig.max = env.db.poolSize;\r\n\t\tconfig.idleTimeoutMillis = env.db.idleTimeoutMillis;\r\n\t\tconfig.statement_timeout = env.db.statementTimeout;\r\n\t\tconfig.query_timeout = env.db.queryTimeout;\r\n\t\tconfig.connectionTimeoutMillis = env.db.connectionTimeoutMillis;\r\n\t\tconfig.keepAlive = env.db.keepAlive;\r\n\t\tconst pool = new pg.Pool(config);\r\n\t\tconst { PG_SCHEMA } = process.env;\r\n\t\tif (PG_SCHEMA != null) {\r\n\t\t\tpool.on('connect', (client) => {\r\n\t\t\t\tclient.query({ text: `SET search_path TO \"${PG_SCHEMA}\"` });\r\n\t\t\t});\r\n\t\t\tpool.on('error', (err) => {\r\n\t\t\t\tconsole.error('Pool error:', err.message);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tconst createResult = ({\r\n\t\t\trowCount,\r\n\t\t\trows,\r\n\t\t}: {\r\n\t\t\trowCount: number;\r\n\t\t\trows: Row[];\r\n\t\t}): Result => {\r\n\t\t\treturn {\r\n\t\t\t\trows,\r\n\t\t\t\trowsAffected: rowCount,\r\n\t\t\t\tinsertId: rows?.[0]?.id,\r\n\t\t\t};\r\n\t\t};\r\n\t\tclass PostgresTx extends Tx {\r\n\t\t\tconstructor(\r\n\t\t\t\tprivate db: Pg.PoolClient,\r\n\t\t\t\treadOnly: boolean,\r\n\t\t\t\tstackTraceErr?: Error | AutomaticClose,\r\n\t\t\t) {\r\n\t\t\t\tsuper(readOnly, stackTraceErr);\r\n\t\t\t}\r\n\r\n\t\t\tprotected clone(readOnly = this.readOnly) {\r\n\t\t\t\treturn new PostgresTx(this.db, readOnly, this.automaticClose);\r\n\t\t\t}\r\n\r\n\t\t\tprotected async _executeSql(\r\n\t\t\t\tsql: Sql,\r\n\t\t\t\tbindings: Bindings,\r\n\t\t\t\taddReturning: false | string = false,\r\n\t\t\t) {\r\n\t\t\t\tif (addReturning && /^\\s*(?:INSERT\\s+INTO|UPDATE|DELETE)/i.test(sql)) {\r\n\t\t\t\t\tsql = sql.replace(/;?$/, ' RETURNING \"' + addReturning + '\";');\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet result;\r\n\t\t\t\ttry {\r\n\t\t\t\t\tresult = await this.db.query({\r\n\t\t\t\t\t\ttext: sql,\r\n\t\t\t\t\t\tvalues: bindings,\r\n\t\t\t\t\t});\r\n\t\t\t\t} catch (err) {\r\n\t\t\t\t\tif (err.code === PG_UNIQUE_VIOLATION) {\r\n\t\t\t\t\t\tthrow new UniqueConstraintError(err);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (err.code === PG_FOREIGN_KEY_VIOLATION) {\r\n\t\t\t\t\t\tthrow new ForeignKeyConstraintError(err);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (err.code === PG_CHECK_CONSTRAINT_VIOLATION) {\r\n\t\t\t\t\t\tthrow new CheckConstraintError(err);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthrow err;\r\n\t\t\t\t}\r\n\t\t\t\treturn createResult(result);\r\n\t\t\t}\r\n\r\n\t\t\tprotected async _rollback() {\r\n\t\t\t\ttry {\r\n\t\t\t\t\t// Error/dequeue all queued up queries on a rollback, this will not cancel an in-progress query however\r\n\t\t\t\t\t// @ts-expect-error typings do not include this queryQueue\r\n\t\t\t\t\tconst queryQueue = this.db.queryQueue as Pg.Query[];\r\n\t\t\t\t\tif (queryQueue.length > 0) {\r\n\t\t\t\t\t\tconst err = new DatabaseError('Rolling back transaction');\r\n\t\t\t\t\t\tqueryQueue.forEach((query) => {\r\n\t\t\t\t\t\t\tprocess.nextTick(() => {\r\n\t\t\t\t\t\t\t\t// @ts-expect-error typings do not include this function\r\n\t\t\t\t\t\t\t\tquery.handleError(err, this.db.connection);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tqueryQueue.length = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tawait Bluebird.resolve(this.$executeSql('ROLLBACK;')).timeout(\r\n\t\t\t\t\t\tenv.db.rollbackTimeout,\r\n\t\t\t\t\t\t'Rolling back transaction timed out',\r\n\t\t\t\t\t);\r\n\t\t\t\t\tthis.db.release();\r\n\t\t\t\t} catch (err) {\r\n\t\t\t\t\terr = wrapDatabaseError(err);\r\n\t\t\t\t\tthis.db.release(err);\r\n\t\t\t\t\tthrow err;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tprotected async _commit() {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tawait this.$executeSql('COMMIT;');\r\n\t\t\t\t\tthis.db.release();\r\n\t\t\t\t} catch (err) {\r\n\t\t\t\t\tthis.db.release(err);\r\n\t\t\t\t\tthrow err;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tpublic async tableList(extraWhereClause: string = '') {\r\n\t\t\t\tif (extraWhereClause !== '') {\r\n\t\t\t\t\textraWhereClause = 'WHERE ' + extraWhereClause;\r\n\t\t\t\t}\r\n\t\t\t\treturn await this.executeSql(`\r\n\t\t\t\t\tSELECT *\r\n\t\t\t\t\tFROM (\r\n\t\t\t\t\t\tSELECT tablename as name\r\n\t\t\t\t\t\tFROM pg_tables\r\n\t\t\t\t\t\tWHERE schemaname = 'public'\r\n\t\t\t\t\t) t ${extraWhereClause};\r\n\t\t\t\t`);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tengine: Engines.postgres,\r\n\t\t\texecuteSql: atomicExecuteSql,\r\n\t\t\ttransaction: createTransaction(async (stackTraceErr) => {\r\n\t\t\t\tconst client = await pool.connect();\r\n\t\t\t\tconst tx = new PostgresTx(client, false, stackTraceErr);\r\n\t\t\t\ttx.executeSql('START TRANSACTION;');\r\n\t\t\t\treturn tx;\r\n\t\t\t}),\r\n\t\t\treadTransaction: createTransaction(async (stackTraceErr) => {\r\n\t\t\t\tconst client = await pool.connect();\r\n\t\t\t\tconst tx = new PostgresTx(client, false, stackTraceErr);\r\n\t\t\t\ttx.executeSql('START TRANSACTION READ ONLY;');\r\n\t\t\t\treturn tx.asReadOnly();\r\n\t\t\t}),\r\n\t\t\t...alwaysExport,\r\n\t\t};\r\n\t};\r\n}\r\n\r\nlet maybeMysql: typeof Mysql | undefined;\r\ntry {\r\n\t// tslint:disable-next-line:no-var-requires\r\n\tmaybeMysql = require('mysql');\r\n} catch (e) {\r\n\t// Ignore errors\r\n}\r\nif (maybeMysql != null) {\r\n\tconst mysql = maybeMysql;\r\n\tengines.mysql = (options: Mysql.PoolConfig): Database => {\r\n\t\tconst MYSQL_UNIQUE_VIOLATION = 'ER_DUP_ENTRY';\r\n\t\tconst MYSQL_FOREIGN_KEY_VIOLATION = 'ER_ROW_IS_REFERENCED';\r\n\t\tconst MYSQL_CHECK_CONSTRAINT_VIOLATION = 'ER_CHECK_CONSTRAINT_VIOLATED';\r\n\t\tconst pool = mysql.createPool(options);\r\n\t\tpool.on('connection', (db) => {\r\n\t\t\tdb.query(\"SET sql_mode='ANSI_QUOTES';\");\r\n\t\t});\r\n\t\tconst getConnectionAsync = Bluebird.promisify(pool.getConnection, {\r\n\t\t\tcontext: pool,\r\n\t\t});\r\n\r\n\t\tinterface MysqlRowArray extends Array<Row> {\r\n\t\t\taffectedRows: number;\r\n\t\t\tinsertId?: number;\r\n\t\t}\r\n\t\tconst createResult = (rows: MysqlRowArray): Result => {\r\n\t\t\treturn {\r\n\t\t\t\trows,\r\n\t\t\t\trowsAffected: rows.affectedRows,\r\n\t\t\t\tinsertId: rows.insertId,\r\n\t\t\t};\r\n\t\t};\r\n\t\tclass MySqlTx extends Tx {\r\n\t\t\tconstructor(\r\n\t\t\t\tprivate db: Mysql.Connection,\r\n\t\t\t\tprivate close: CloseTransactionFn,\r\n\t\t\t\treadOnly: boolean,\r\n\t\t\t\tstackTraceErr?: Error | AutomaticClose,\r\n\t\t\t) {\r\n\t\t\t\tsuper(readOnly, stackTraceErr);\r\n\t\t\t}\r\n\r\n\t\t\tprotected clone(readOnly = this.readOnly) {\r\n\t\t\t\treturn new MySqlTx(this.db, this.close, readOnly, this.automaticClose);\r\n\t\t\t}\r\n\r\n\t\t\tprotected async _executeSql(sql: Sql, bindings: Bindings) {\r\n\t\t\t\tlet result;\r\n\t\t\t\ttry {\r\n\t\t\t\t\tresult = await Bluebird.fromCallback<MysqlRowArray>((callback) => {\r\n\t\t\t\t\t\tthis.db.query(sql, bindings, callback);\r\n\t\t\t\t\t});\r\n\t\t\t\t} catch (err) {\r\n\t\t\t\t\tif (err.code === MYSQL_UNIQUE_VIOLATION) {\r\n\t\t\t\t\t\t// We know that the type is an IError for mysql, but typescript doesn't like the catch obj sugar\r\n\t\t\t\t\t\tthrow new UniqueConstraintError(err as Mysql.MysqlError);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (err.code === MYSQL_FOREIGN_KEY_VIOLATION) {\r\n\t\t\t\t\t\tthrow new ForeignKeyConstraintError(err as Mysql.MysqlError);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (err.code === MYSQL_CHECK_CONSTRAINT_VIOLATION) {\r\n\t\t\t\t\t\tthrow new CheckConstraintError(err as Mysql.MysqlError);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthrow err;\r\n\t\t\t\t}\r\n\t\t\t\treturn createResult(result);\r\n\t\t\t}\r\n\r\n\t\t\tprotected async _rollback() {\r\n\t\t\t\tconst promise = this.$executeSql('ROLLBACK;');\r\n\t\t\t\tthis.close();\r\n\t\t\t\tawait promise;\r\n\t\t\t}\r\n\r\n\t\t\tprotected async _commit() {\r\n\t\t\t\tconst promise = this.$executeSql('COMMIT;');\r\n\t\t\t\tthis.close();\r\n\t\t\t\tawait promise;\r\n\t\t\t}\r\n\r\n\t\t\tpublic async tableList(extraWhereClause: string = '') {\r\n\t\t\t\tif (extraWhereClause !== '') {\r\n\t\t\t\t\textraWhereClause = ' WHERE ' + extraWhereClause;\r\n\t\t\t\t}\r\n\t\t\t\treturn await this.executeSql(\r\n\t\t\t\t\t`\r\n\t\t\t\t\tSELECT name\r\n\t\t\t\t\tFROM (\r\n\t\t\t\t\t\tSELECT table_name AS name\r\n\t\t\t\t\t\tFROM information_schema.tables\r\n\t\t\t\t\t\tWHERE table_schema = ?\r\n\t\t\t\t\t) t ${extraWhereClause};\r\n\t\t\t\t`,\r\n\t\t\t\t\t[options.database],\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tengine: Engines.mysql,\r\n\t\t\texecuteSql: atomicExecuteSql,\r\n\t\t\ttransaction: createTransaction(async (stackTraceErr) => {\r\n\t\t\t\tconst client = await getConnectionAsync();\r\n\t\t\t\tconst close = () => client.release();\r\n\t\t\t\tconst tx = new MySqlTx(client, close, false, stackTraceErr);\r\n\t\t\t\ttx.executeSql('START TRANSACTION;');\r\n\t\t\t\treturn tx;\r\n\t\t\t}),\r\n\t\t\treadTransaction: createTransaction(async (stackTraceErr) => {\r\n\t\t\t\tconst client = await getConnectionAsync();\r\n\t\t\t\tconst close = () => client.release();\r\n\t\t\t\tconst tx = new MySqlTx(client, close, false, stackTraceErr);\r\n\t\t\t\ttx.executeSql('START TRANSACTION READ ONLY;');\r\n\t\t\t\treturn tx.asReadOnly();\r\n\t\t\t}),\r\n\t\t\t...alwaysExport,\r\n\t\t};\r\n\t};\r\n}\r\n\r\nif (typeof window !== 'undefined' && window.openDatabase != null) {\r\n\tinterface WebSqlResult {\r\n\t\tinsertId?: number;\r\n\t\trowsAffected: number;\r\n\t\trows: {\r\n\t\t\titem: (i: number) => Row;\r\n\t\t\tlength: number;\r\n\t\t};\r\n\t}\r\n\ttype AsyncQuery = [\r\n\t\tSql,\r\n\t\tBindings,\r\n\t\tSQLStatementCallback,\r\n\t\tSQLStatementErrorCallback,\r\n\t];\r\n\tengines.websql = (databaseName: string): Database => {\r\n\t\tconst WEBSQL_CONSTRAINT_ERR = 6;\r\n\r\n\t\tconst db = window.openDatabase(\r\n\t\t\tdatabaseName,\r\n\t\t\t'1.0',\r\n\t\t\t'rulemotion',\r\n\t\t\t2 * 1024 * 1024,\r\n\t\t);\r\n\t\tconst getInsertId = (result: WebSqlResult) => {\r\n\t\t\ttry {\r\n\t\t\t\treturn result.insertId;\r\n\t\t\t} catch (e) {\r\n\t\t\t\t// Ignore the potential DOM exception.\r\n\t\t\t}\r\n\t\t};\r\n\t\tconst createResult = (result: WebSqlResult): Result => {\r\n\t\t\tconst { length } = result.rows;\r\n\t\t\t// We convert `result.rows` to a real array to make it easier to work with\r\n\t\t\tconst rows: Row[] = Array(length);\r\n\t\t\tfor (let i = 0; i < length; i++) {\r\n\t\t\t\trows[i] = result.rows.item(i);\r\n\t\t\t}\r\n\t\t\treturn {\r\n\t\t\t\trows,\r\n\t\t\t\trowsAffected: result.rowsAffected,\r\n\t\t\t\tinsertId: getInsertId(result),\r\n\t\t\t};\r\n\t\t};\r\n\r\n\t\tclass WebSqlTx extends Tx {\r\n\t\t\tconstructor(\r\n\t\t\t\tprivate tx: WebSqlWrapper,\r\n\t\t\t\treadOnly: boolean,\r\n\t\t\t\tstackTraceErr?: Error | AutomaticClose,\r\n\t\t\t) {\r\n\t\t\t\tsuper(readOnly, stackTraceErr);\r\n\t\t\t}\r\n\r\n\t\t\tprotected clone(readOnly = this.readOnly) {\r\n\t\t\t\treturn new WebSqlTx(this.tx, readOnly, this.automaticClose);\r\n\t\t\t}\r\n\r\n\t\t\tprotected async _executeSql(sql: Sql, bindings: Bindings) {\r\n\t\t\t\tlet result;\r\n\t\t\t\ttry {\r\n\t\t\t\t\tresult = await this.tx.executeSql(sql, bindings);\r\n\t\t\t\t} catch (err) {\r\n\t\t\t\t\tif (err.code === WEBSQL_CONSTRAINT_ERR) {\r\n\t\t\t\t\t\tthrow new ConstraintError('Constraint failed.');\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthrow err;\r\n\t\t\t\t}\r\n\t\t\t\treturn createResult(result);\r\n\t\t\t}\r\n\r\n\t\t\tprotected async _rollback(): Promise<void> {\r\n\t\t\t\treturn await this.tx.rollback();\r\n\t\t\t}\r\n\r\n\t\t\tprotected async _commit() {\r\n\t\t\t\tthis.tx.commit();\r\n\t\t\t}\r\n\r\n\t\t\tpublic async tableList(extraWhereClause: string = '') {\r\n\t\t\t\tif (extraWhereClause !== '') {\r\n\t\t\t\t\textraWhereClause = ' AND ' + extraWhereClause;\r\n\t\t\t\t}\r\n\t\t\t\treturn await this.executeSql(`\r\n\t\t\t\t\tSELECT name, sql\r\n\t\t\t\t\tFROM sqlite_master\r\n\t\t\t\t\tWHERE type='table'\r\n\t\t\t\t\tAND name NOT IN (\r\n\t\t\t\t\t\t'__WebKitDatabaseInfoTable__',\r\n\t\t\t\t\t\t'sqlite_sequence'\r\n\t\t\t\t\t)\r\n\t\t\t\t\t${extraWhereClause};\r\n\t\t\t\t`);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tclass WebSqlWrapper {\r\n\t\t\tprivate running = true;\r\n\t\t\tprivate queue: AsyncQuery[] = [];\r\n\r\n\t\t\tconstructor(private tx: SQLTransaction) {\r\n\t\t\t\tthis.asyncRecurse();\r\n\t\t\t}\r\n\r\n\t\t\t// This function is used to recurse executeSql calls and keep the transaction open,\r\n\t\t\t// allowing us to use async calls within the API.\r\n\t\t\tprivate asyncRecurse = () => {\r\n\t\t\t\tlet args: AsyncQuery | undefined;\r\n\t\t\t\t// tslint:disable-next-line no-conditional-assignment\r\n\t\t\t\twhile ((args = this.queue.pop())) {\r\n\t\t\t\t\tconsole.debug('Running', args[0]);\r\n\t\t\t\t\tthis.tx.executeSql(args[0], args[1], args[2], args[3]);\r\n\t\t\t\t}\r\n\t\t\t\tif (this.running) {\r\n\t\t\t\t\tconsole.debug('Looping');\r\n\t\t\t\t\tthis.tx.executeSql('SELECT 0', [], this.asyncRecurse);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tpublic async executeSql(sql: Sql, bindings: Bindings) {\r\n\t\t\t\treturn await new Promise<SQLResultSet>((resolve, reject) => {\r\n\t\t\t\t\tconst successCallback: SQLStatementCallback = (_tx, results) => {\r\n\t\t\t\t\t\tresolve(results);\r\n\t\t\t\t\t};\r\n\t\t\t\t\tconst errorCallback: SQLStatementErrorCallback = (_tx, err) => {\r\n\t\t\t\t\t\treject(err);\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tthis.queue.push([sql, bindings, successCallback, errorCallback]);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tpublic async rollback(): Promise<void> {\r\n\t\t\t\treturn await new Promise((resolve) => {\r\n\t\t\t\t\tconst successCallback: SQLStatementCallback = () => {\r\n\t\t\t\t\t\tresolve();\r\n\t\t\t\t\t\tthrow new Error('Rollback');\r\n\t\t\t\t\t};\r\n\t\t\t\t\tconst errorCallback: SQLStatementErrorCallback = () => {\r\n\t\t\t\t\t\tresolve();\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t};\r\n\t\t\t\t\tthis.queue = [\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t'RUN A FAILING STATEMENT TO ROLLBACK',\r\n\t\t\t\t\t\t\t[],\r\n\t\t\t\t\t\t\tsuccessCallback,\r\n\t\t\t\t\t\t\terrorCallback,\r\n\t\t\t\t\t\t],\r\n\t\t\t\t\t];\r\n\t\t\t\t\tthis.running = false;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tpublic commit() {\r\n\t\t\t\tthis.running = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tengine: Engines.websql,\r\n\t\t\texecuteSql: atomicExecuteSql,\r\n\t\t\ttransaction: createTransaction(\r\n\t\t\t\t(stackTraceErr) =>\r\n\t\t\t\t\tnew Promise((resolve) => {\r\n\t\t\t\t\t\tdb.transaction((tx) => {\r\n\t\t\t\t\t\t\tresolve(\r\n\t\t\t\t\t\t\t\tnew WebSqlTx(new WebSqlWrapper(tx), false, stackTraceErr),\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}),\r\n\t\t\t),\r\n\t\t\treadTransaction: createTransaction(\r\n\t\t\t\t(stackTraceErr) =>\r\n\t\t\t\t\tnew Promise((resolve) => {\r\n\t\t\t\t\t\tdb.transaction((tx) => {\r\n\t\t\t\t\t\t\tresolve(new WebSqlTx(new WebSqlWrapper(tx), true, stackTraceErr));\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}),\r\n\t\t\t),\r\n\t\t\t...alwaysExport,\r\n\t\t};\r\n\t};\r\n}\r\n\r\nexport const connect = (databaseOptions: { engine: string; params: {} }) => {\r\n\tif (engines[databaseOptions.engine] == null) {\r\n\t\tthrow new Error('Unsupported database engine: ' + databaseOptions.engine);\r\n\t}\r\n\treturn engines[databaseOptions.engine](databaseOptions.params);\r\n};\r\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.AbstractSQLRules2SQL = exports.checkMinArgs = exports.checkArgs = exports.getAbstractSqlQuery = exports.isAbstractSqlQuery = exports.isNotNullable = exports.isFieldValue = exports.isDurationValue = exports.isJSONValue = exports.isDateValue = exports.isBooleanValue = exports.isNumericValue = exports.isTextValue = exports.comparisons = void 0;\nconst _ = require(\"lodash\");\nconst sbvrTypes = require(\"@balena/sbvr-types\");\nlet fieldOrderings = [];\nlet fieldOrderingsLookup = {};\nlet engine = \"postgres\";\nlet noBinds = false;\nexports.comparisons = {\n    Equals: ' = ',\n    GreaterThan: ' > ',\n    GreaterThanOrEqual: ' >= ',\n    LessThan: ' < ',\n    LessThanOrEqual: ' <= ',\n    NotEquals: ' != ',\n    Like: ' LIKE ',\n};\nconst NestedIndent = (indent) => indent + '\\t';\nconst escapeField = (field) => field === '*' ? '*' : `\"${field}\"`;\nconst AnyValue = (args, indent) => {\n    const [type, ...rest] = args;\n    if (type === 'Case') {\n        return typeRules[type](rest, indent);\n    }\n    for (const matcher of [\n        exports.isJSONValue,\n        exports.isDateValue,\n        exports.isTextValue,\n        exports.isNumericValue,\n        exports.isBooleanValue,\n        exports.isDurationValue,\n    ]) {\n        if (matcher(type)) {\n            return typeRules[type](rest, indent);\n        }\n    }\n    return UnknownValue(args, indent);\n};\nconst UnknownValue = (args, indent) => {\n    const [type, ...rest] = args;\n    switch (type) {\n        case 'Null':\n        case 'Field':\n        case 'ReferencedField':\n        case 'Bind':\n        case 'Cast':\n        case 'Coalesce':\n            return typeRules[type](rest, indent);\n        case 'SelectQuery':\n        case 'UnionQuery':\n            const nestedIndent = NestedIndent(indent);\n            const query = typeRules[type](rest, nestedIndent);\n            return '(' + nestedIndent + query + indent + ')';\n        default:\n            throw new Error(`Invalid \"UnknownValue\" type: ${type}`);\n    }\n};\nconst MatchValue = (matcher) => (args, indent) => {\n    const [type, ...rest] = args;\n    if (matcher(type)) {\n        return typeRules[type](rest, indent);\n    }\n    return UnknownValue(args, indent);\n};\nconst isTextValue = (type) => {\n    return (type === 'Value' ||\n        type === 'Text' ||\n        type === 'EmbeddedText' ||\n        type === 'Concatenate' ||\n        type === 'Lower' ||\n        type === 'Upper' ||\n        type === 'Trim' ||\n        type === 'Replace' ||\n        type === 'Substring' ||\n        type === 'Right');\n};\nexports.isTextValue = isTextValue;\nconst TextValue = MatchValue(exports.isTextValue);\nconst isNumericValue = (type) => {\n    return (type === 'Number' ||\n        type === 'Real' ||\n        type === 'Integer' ||\n        type === 'Add' ||\n        type === 'Subtract' ||\n        type === 'Multiply' ||\n        type === 'Divide' ||\n        type === 'BitwiseAnd' ||\n        type === 'BitwiseShiftRight' ||\n        type === 'CharacterLength' ||\n        type === 'StrPos' ||\n        type === 'Year' ||\n        type === 'Month' ||\n        type === 'Day' ||\n        type === 'Hour' ||\n        type === 'Minute' ||\n        type === 'Second' ||\n        type === 'Fractionalseconds' ||\n        type === 'Totalseconds' ||\n        type === 'Round' ||\n        type === 'Floor' ||\n        type === 'Ceiling' ||\n        type === 'Count' ||\n        type === 'Average' ||\n        type === 'Sum');\n};\nexports.isNumericValue = isNumericValue;\nconst NumericValue = MatchValue(exports.isNumericValue);\nconst isBooleanValue = (type) => {\n    return (type === 'Boolean' ||\n        type === 'Not' ||\n        type === 'And' ||\n        type === 'Or' ||\n        type === 'Exists' ||\n        type === 'NotExists' ||\n        type === 'Between' ||\n        type === 'In' ||\n        type === 'NotIn' ||\n        type === 'Equals' ||\n        type === 'GreaterThan' ||\n        type === 'GreaterThanOrEqual' ||\n        type === 'LessThan' ||\n        type === 'LessThanOrEqual' ||\n        type === 'NotEquals' ||\n        type === 'Like' ||\n        type === 'IsNotDistinctFrom' ||\n        type === 'IsDistinctFrom');\n};\nexports.isBooleanValue = isBooleanValue;\nconst BooleanValue = MatchValue(exports.isBooleanValue);\nconst isDateValue = (type) => {\n    return (type === 'Date' || type === 'ToDate' || type === 'ToTime' || type === 'Now');\n};\nexports.isDateValue = isDateValue;\nconst DateValue = MatchValue(exports.isDateValue);\nconst isJSONValue = (type) => {\n    return type === 'AggregateJSON';\n};\nexports.isJSONValue = isJSONValue;\nconst isDurationValue = (type) => {\n    return type === 'Duration';\n};\nexports.isDurationValue = isDurationValue;\nconst DurationValue = MatchValue(exports.isDurationValue);\nconst isFieldValue = (type) => {\n    return type === 'Field' || type === 'ReferencedField';\n};\nexports.isFieldValue = isFieldValue;\nconst Field = (args, indent) => {\n    const [type, ...rest] = args;\n    if (exports.isFieldValue(type)) {\n        return typeRules[type](rest, indent);\n    }\n    else {\n        throw new SyntaxError(`Invalid field type: ${type}`);\n    }\n};\nconst isNotNullable = (node) => {\n    switch (node[0]) {\n        case 'EmbeddedText':\n        case 'Boolean':\n        case 'Bind':\n        case 'Value':\n        case 'Text':\n        case 'Date':\n        case 'Number':\n        case 'Real':\n        case 'Integer':\n        case 'IsDistinctFrom':\n        case 'IsNotDistinctFrom':\n        case 'Exists':\n        case 'NotExists':\n            return true;\n        case 'Coalesce':\n            return node.slice(1).some((n) => exports.isNotNullable(n));\n        case 'Not':\n            return exports.isNotNullable(node[1]);\n    }\n    return false;\n};\nexports.isNotNullable = isNotNullable;\nconst isNotDistinctFrom = (args, indent) => {\n    const a = exports.getAbstractSqlQuery(args, 0);\n    const b = exports.getAbstractSqlQuery(args, 1);\n    const aSql = AnyValue(a, indent);\n    const bSql = AnyValue(b, indent);\n    if (engine === \"postgres\") {\n        const aIsNotNullable = exports.isNotNullable(a);\n        const bIsNotNullable = exports.isNotNullable(b);\n        if (aIsNotNullable && bIsNotNullable) {\n            return `${aSql} = ${bSql}`;\n        }\n        const isNotNullChecks = [];\n        if (!aIsNotNullable) {\n            isNotNullChecks.push(`(${aSql}) IS NOT NULL`);\n        }\n        if (!bIsNotNullable) {\n            isNotNullChecks.push(`(${bSql}) IS NOT NULL`);\n        }\n        const orBothNull = !aIsNotNullable && !bIsNotNullable\n            ? ` OR (${aSql}) IS NULL AND (${bSql}) IS NULL`\n            : '';\n        return `${isNotNullChecks.join(' AND ')} AND (${aSql}) = (${bSql})${orBothNull}`;\n    }\n    else if (engine === \"mysql\") {\n        return aSql + ' <=> ' + bSql;\n    }\n    else if (engine === \"websql\") {\n        return aSql + ' IS ' + bSql;\n    }\n    else {\n        throw new SyntaxError('IsDistinctFrom/IsNotDistinctFrom not supported on: ' + engine);\n    }\n};\nconst isAbstractSqlQuery = (x) => {\n    return Array.isArray(x);\n};\nexports.isAbstractSqlQuery = isAbstractSqlQuery;\nconst getAbstractSqlQuery = (args, index) => {\n    const abstractSqlQuery = args[index];\n    if (!exports.isAbstractSqlQuery(abstractSqlQuery)) {\n        throw new SyntaxError(`Expected AbstractSqlQuery array but got ${typeof abstractSqlQuery}`);\n    }\n    return abstractSqlQuery;\n};\nexports.getAbstractSqlQuery = getAbstractSqlQuery;\nconst Comparison = (comparison) => {\n    return (args, indent) => {\n        exports.checkArgs(comparison, args, 2);\n        const a = AnyValue(exports.getAbstractSqlQuery(args, 0), indent);\n        const b = AnyValue(exports.getAbstractSqlQuery(args, 1), indent);\n        return a + exports.comparisons[comparison] + b;\n    };\n};\nconst NumberMatch = (type) => {\n    return (args) => {\n        exports.checkArgs(type, args, 1);\n        const n = args[0];\n        if (typeof n !== 'number') {\n            throw new SyntaxError(`${type} expected number but got ${typeof n}`);\n        }\n        return `${n}`;\n    };\n};\nconst JoinMatch = (joinType) => {\n    let sqlJoinType;\n    switch (joinType) {\n        case 'Join':\n            sqlJoinType = 'JOIN ';\n            break;\n        case 'LeftJoin':\n            sqlJoinType = 'LEFT JOIN ';\n            break;\n        case 'RightJoin':\n            sqlJoinType = 'RIGHT JOIN ';\n            break;\n        case 'FullJoin':\n            sqlJoinType = 'FULL JOIN ';\n            break;\n        case 'CrossJoin':\n            sqlJoinType = 'CROSS JOIN ';\n            break;\n        default:\n            throw new Error(`Unknown join type: '${joinType}'`);\n    }\n    return (args, indent) => {\n        if (args.length !== 1 && args.length !== 2) {\n            throw new SyntaxError(`\"${joinType}\" requires 1/2 arg(s)`);\n        }\n        const from = MaybeAlias(exports.getAbstractSqlQuery(args, 0), indent, FromMatch);\n        if (args.length === 1) {\n            return sqlJoinType + from;\n        }\n        const [type, ...rest] = exports.getAbstractSqlQuery(args, 1);\n        switch (type) {\n            case 'On':\n                exports.checkArgs('On', rest, 1);\n                const ruleBody = BooleanValue(exports.getAbstractSqlQuery(rest, 0), NestedIndent(indent));\n                return sqlJoinType + from + ' ON ' + ruleBody;\n            default:\n                throw new SyntaxError(`'${joinType}' clause does not support '${type}' clause`);\n        }\n    };\n};\nconst mathOps = {\n    Add: '+',\n    Subtract: '-',\n    Multiply: '*',\n    Divide: '/',\n};\nconst MathOp = (type) => {\n    return (args, indent) => {\n        exports.checkArgs(type, args, 2);\n        const a = NumericValue(exports.getAbstractSqlQuery(args, 0), indent);\n        const b = NumericValue(exports.getAbstractSqlQuery(args, 1), indent);\n        return `${a} ${mathOps[type]} ${b}`;\n    };\n};\nconst fractionalSecondsFormat = function (date) {\n    return this['Totalseconds'](date) + ' - ' + this['Second'](date);\n};\nconst websqlBasicDateFormat = (format) => {\n    return (date) => `STRFTIME('${format}', ${date})`;\n};\nconst websqlDateFormats = {\n    Year: websqlBasicDateFormat('%Y'),\n    Month: websqlBasicDateFormat('%m'),\n    Day: websqlBasicDateFormat('%d'),\n    Hour: websqlBasicDateFormat('%H'),\n    Minute: websqlBasicDateFormat('%M'),\n    Second: websqlBasicDateFormat('%S'),\n    Fractionalseconds: fractionalSecondsFormat,\n    Totalseconds: websqlBasicDateFormat('%f'),\n};\nconst basicDateFormat = function (part) {\n    return (date) => `EXTRACT('${part}' FROM ${date})`;\n};\nconst dateFormats = {\n    Year: basicDateFormat('YEAR'),\n    Month: basicDateFormat('MONTH'),\n    Day: basicDateFormat('DAY'),\n    Hour: basicDateFormat('HOUR'),\n    Minute: basicDateFormat('MINUTE'),\n    Second: (date) => `FLOOR(${dateFormats['Totalseconds'](date)})`,\n    Fractionalseconds: fractionalSecondsFormat,\n    Totalseconds: basicDateFormat('SECOND'),\n};\nconst ExtractNumericDatePart = (type) => {\n    return (args, indent) => {\n        exports.checkArgs(type, args, 1);\n        const date = DateValue(exports.getAbstractSqlQuery(args, 0), indent);\n        if (engine === \"websql\") {\n            return websqlDateFormats[type](date);\n        }\n        else {\n            return dateFormats[type](date);\n        }\n    };\n};\nconst Text = (args) => {\n    exports.checkArgs('Text', args, 1);\n    if (noBinds) {\n        return `'${args[0]}'`;\n    }\n    else {\n        return AddBind(['Text', args[0]]);\n    }\n};\nconst checkArgs = (matchName, args, num) => {\n    if (args.length !== num) {\n        throw new SyntaxError(`\"${matchName}\" requires ${num} arg(s)`);\n    }\n};\nexports.checkArgs = checkArgs;\nconst checkMinArgs = (matchName, args, num) => {\n    if (args.length < num) {\n        throw new SyntaxError(`\"${matchName}\" requires at least ${num} arg(s)`);\n    }\n};\nexports.checkMinArgs = checkMinArgs;\nconst Value = (arg, indent) => {\n    switch (arg) {\n        case true:\n            return '1';\n        case false:\n            return '0';\n        case 'Default':\n            return 'DEFAULT';\n        default:\n            const [type, ...rest] = arg;\n            switch (type) {\n                case 'Null':\n                case 'Bind':\n                case 'Value':\n                case 'Text':\n                case 'Number':\n                case 'Real':\n                case 'Integer':\n                    return typeRules[type](rest, indent);\n                default:\n                    throw new SyntaxError(`Invalid type for Value ${type}`);\n            }\n    }\n};\nconst SelectMatch = (args, indent) => {\n    const [type, ...rest] = args;\n    switch (type) {\n        case 'Count':\n            return typeRules[type](rest, indent);\n        default:\n            return AnyValue(args, indent);\n    }\n};\nconst FromMatch = (args, indent) => {\n    const [type, ...rest] = args;\n    switch (type) {\n        case 'SelectQuery':\n        case 'UnionQuery':\n            const nestedindent = NestedIndent(indent);\n            const query = typeRules[type](rest, nestedindent);\n            return '(' + nestedindent + query + indent + ')';\n        case 'Table':\n            exports.checkArgs('Table', rest, 1);\n            const [table] = rest;\n            if (typeof table !== 'string') {\n                throw new SyntaxError('`Table` table must be a string');\n            }\n            return escapeField(table);\n        default:\n            throw new SyntaxError(`From does not support ${type}`);\n    }\n};\nconst MaybeAlias = (args, indent, matchFn) => {\n    const [type, ...rest] = args;\n    switch (type) {\n        case 'Alias':\n            exports.checkArgs('Alias', rest, 2);\n            const field = matchFn(exports.getAbstractSqlQuery(rest, 0), indent);\n            return `${field} AS \"${rest[1]}\"`;\n        default:\n            return matchFn(args, indent);\n    }\n};\nconst AddBind = (bind) => {\n    if (noBinds) {\n        throw new SyntaxError('Cannot use a bind whilst they are disabled');\n    }\n    if (engine === \"postgres\") {\n        if (bind[0] === 'Bind') {\n            const key = JSON.stringify(bind[1]);\n            const existingBindIndex = fieldOrderingsLookup[key];\n            if (existingBindIndex != null) {\n                return '$' + existingBindIndex;\n            }\n            const nextID = fieldOrderings.push(bind);\n            fieldOrderingsLookup[key] = nextID;\n            return '$' + nextID;\n        }\n        return '$' + fieldOrderings.push(bind);\n    }\n    else {\n        fieldOrderings.push(bind);\n        return '?';\n    }\n};\nconst typeRules = {\n    UnionQuery: (args, indent) => {\n        exports.checkMinArgs('UnionQuery', args, 2);\n        return args\n            .map((arg) => {\n            if (!exports.isAbstractSqlQuery(arg)) {\n                throw new SyntaxError(`Expected AbstractSqlQuery array but got ${typeof arg}`);\n            }\n            const [type, ...rest] = arg;\n            switch (type) {\n                case 'SelectQuery':\n                case 'UnionQuery':\n                    return typeRules[type](rest, indent);\n                default:\n                    throw new SyntaxError(`UnionQuery does not support ${type}`);\n            }\n        })\n            .join(indent + 'UNION' + indent);\n    },\n    SelectQuery: (args, indent) => {\n        const tables = [];\n        const joins = [];\n        let select = '';\n        const groups = {\n            Where: '',\n            GroupBy: '',\n            OrderBy: '',\n            Limit: '',\n            Offset: '',\n        };\n        for (const arg of args) {\n            if (!exports.isAbstractSqlQuery(arg)) {\n                throw new SyntaxError('`SelectQuery` args must all be arrays');\n            }\n            const [type, ...rest] = arg;\n            switch (type) {\n                case 'Select':\n                    if (select !== '') {\n                        throw new SyntaxError(`'SelectQuery' can only accept one '${type}'`);\n                    }\n                    select = typeRules[type](rest, indent);\n                    break;\n                case 'From':\n                    tables.push(typeRules[type](rest, indent));\n                    break;\n                case 'Join':\n                case 'LeftJoin':\n                case 'RightJoin':\n                case 'FullJoin':\n                case 'CrossJoin':\n                    joins.push(typeRules[type](rest, indent));\n                    break;\n                case 'Where':\n                case 'GroupBy':\n                case 'OrderBy':\n                case 'Limit':\n                case 'Offset':\n                    if (groups[type] !== '') {\n                        throw new SyntaxError(`'SelectQuery' can only accept one '${type}'`);\n                    }\n                    groups[type] = indent + typeRules[type](rest, indent);\n                    break;\n                default:\n                    throw new SyntaxError(`'SelectQuery' does not support '${type}'`);\n            }\n        }\n        if (tables.length === 0 && joins.length > 0) {\n            throw new SyntaxError('Must have at least one From node in order to use Join nodes');\n        }\n        const from = tables.length > 0\n            ? indent + 'FROM ' + tables.join(',' + NestedIndent(indent))\n            : '';\n        const joinStr = joins.length > 0 ? indent + joins.join(indent) : '';\n        return ('SELECT ' +\n            select +\n            from +\n            joinStr +\n            groups.Where +\n            groups.GroupBy +\n            groups.OrderBy +\n            groups.Limit +\n            groups.Offset);\n    },\n    Select: (args, indent) => {\n        exports.checkArgs('Select', args, 1);\n        args = exports.getAbstractSqlQuery(args, 0);\n        if (args.length === 0) {\n            return '1';\n        }\n        return args\n            .map((arg) => {\n            if (!exports.isAbstractSqlQuery(arg)) {\n                throw new SyntaxError(`Expected AbstractSqlQuery array but got ${typeof arg}`);\n            }\n            return MaybeAlias(arg, indent, SelectMatch);\n        })\n            .join(', ');\n    },\n    From: (args, indent) => {\n        exports.checkArgs('From', args, 1);\n        return MaybeAlias(exports.getAbstractSqlQuery(args, 0), indent, FromMatch);\n    },\n    Join: JoinMatch('Join'),\n    LeftJoin: JoinMatch('LeftJoin'),\n    RightJoin: JoinMatch('RightJoin'),\n    FullJoin: JoinMatch('FullJoin'),\n    CrossJoin: (args, indent) => {\n        exports.checkArgs('CrossJoin', args, 1);\n        const from = MaybeAlias(exports.getAbstractSqlQuery(args, 0), indent, FromMatch);\n        return `CROSS JOIN ${from}`;\n    },\n    Where: (args, indent) => {\n        exports.checkArgs('Where', args, 1);\n        const boolNode = exports.getAbstractSqlQuery(args, 0);\n        if (boolNode[0] === 'Boolean') {\n            return `WHERE ${boolNode[1] ? 'true' : 'false'}`;\n        }\n        const ruleBody = BooleanValue(boolNode, indent);\n        return 'WHERE ' + ruleBody;\n    },\n    GroupBy: (args, indent) => {\n        exports.checkMinArgs('GroupBy', args, 1);\n        const groups = exports.getAbstractSqlQuery(args, 0);\n        exports.checkMinArgs('GroupBy groups', groups, 1);\n        return ('GROUP BY ' +\n            groups.map((arg) => AnyValue(arg, indent)).join(', '));\n    },\n    OrderBy: (args, indent) => {\n        exports.checkMinArgs('OrderBy', args, 1);\n        return ('ORDER BY ' +\n            args\n                .map((arg) => {\n                exports.checkMinArgs('OrderBy ordering', arg, 2);\n                const order = arg[0];\n                if (order !== 'ASC' && order !== 'DESC') {\n                    throw new SyntaxError(`Can only order by \"ASC\" or \"DESC\"`);\n                }\n                const field = Field(exports.getAbstractSqlQuery(arg, 1), indent);\n                return `${field} ${order}`;\n            })\n                .join(',' + NestedIndent(indent)));\n    },\n    Limit: (args, indent) => {\n        exports.checkArgs('Limit', args, 1);\n        const num = NumericValue(exports.getAbstractSqlQuery(args, 0), indent);\n        return `LIMIT ${num}`;\n    },\n    Offset: (args, indent) => {\n        exports.checkArgs('Offset', args, 1);\n        const num = NumericValue(exports.getAbstractSqlQuery(args, 0), indent);\n        return `OFFSET ${num}`;\n    },\n    Count: (args) => {\n        exports.checkArgs('Count', args, 1);\n        if (args[0] !== '*') {\n            throw new SyntaxError('\"Count\" only supports \"*\"');\n        }\n        return 'COUNT(*)';\n    },\n    Average: (args, indent) => {\n        exports.checkArgs('Average', args, 1);\n        const num = NumericValue(exports.getAbstractSqlQuery(args, 0), indent);\n        return `AVG(${num})`;\n    },\n    Sum: (args, indent) => {\n        exports.checkArgs('Sum', args, 1);\n        const num = NumericValue(exports.getAbstractSqlQuery(args, 0), indent);\n        return `SUM(${num})`;\n    },\n    Field: (args) => {\n        exports.checkArgs('Field', args, 1);\n        const [field] = args;\n        if (typeof field !== 'string') {\n            throw new SyntaxError('`Field` field must be a string');\n        }\n        return escapeField(field);\n    },\n    ReferencedField: (args) => {\n        exports.checkArgs('ReferencedField', args, 2);\n        const [table, field] = args;\n        if (typeof table !== 'string') {\n            throw new SyntaxError('`ReferencedField` table must be a string');\n        }\n        if (typeof field !== 'string') {\n            throw new SyntaxError('`ReferencedField` field must be a string');\n        }\n        return `\"${table}\".${escapeField(field)}`;\n    },\n    Cast: (args, indent) => {\n        exports.checkArgs('Cast', args, 2);\n        const value = AnyValue(exports.getAbstractSqlQuery(args, 0), indent);\n        const typeName = args[1];\n        if (!sbvrTypes[typeName] || !sbvrTypes[typeName].types[engine]) {\n            throw new SyntaxError(`Invalid cast type: ${typeName}`);\n        }\n        let type;\n        const dbType = sbvrTypes[typeName].types[engine];\n        if (typeof dbType === 'function') {\n            type = dbType.castType;\n        }\n        else if (dbType.toUpperCase() === 'SERIAL') {\n            type = 'INTEGER';\n        }\n        else {\n            type = dbType;\n        }\n        return `CAST(${value} AS ${type})`;\n    },\n    Number: NumberMatch('Number'),\n    Real: NumberMatch('Real'),\n    Integer: NumberMatch('Integer'),\n    Boolean: (args) => {\n        exports.checkArgs('Boolean', args, 1);\n        const b = args[0];\n        if (typeof b !== 'boolean') {\n            throw new SyntaxError(`Boolean expected boolean but got ${typeof b}`);\n        }\n        return b ? '1' : '0';\n    },\n    EmbeddedText: (args) => {\n        exports.checkArgs('EmbeddedText', args, 1);\n        return `'${args[0]}'`;\n    },\n    Null: (args) => {\n        exports.checkArgs('Null', args, 0);\n        return 'NULL';\n    },\n    Now: (args) => {\n        exports.checkArgs('Now', args, 0);\n        return 'CURRENT_TIMESTAMP';\n    },\n    AggregateJSON: (args) => {\n        exports.checkArgs('AggregateJSON', args, 1);\n        args = exports.getAbstractSqlQuery(args, 0);\n        exports.checkArgs(\"AggregateJSON's argument\", args, 2);\n        if (engine !== \"postgres\") {\n            throw new SyntaxError('AggregateJSON not supported on: ' + engine);\n        }\n        const [table, field] = args;\n        if (typeof table !== 'string') {\n            throw new SyntaxError('`AggregateJSON` table must be a string');\n        }\n        if (typeof field !== 'string') {\n            throw new SyntaxError('`AggregateJSON` field must be a string');\n        }\n        return `coalesce(array_to_json(array_agg(\"${table}\".${escapeField(field)})), '[]')`;\n    },\n    Equals: Comparison('Equals'),\n    GreaterThan: Comparison('GreaterThan'),\n    GreaterThanOrEqual: Comparison('GreaterThanOrEqual'),\n    LessThan: Comparison('LessThan'),\n    LessThanOrEqual: Comparison('LessThanOrEqual'),\n    NotEquals: Comparison('NotEquals'),\n    Like: Comparison('Like'),\n    IsNotDistinctFrom: (args, indent) => {\n        exports.checkArgs('IsNotDistinctFrom', args, 2);\n        return isNotDistinctFrom(args, indent);\n    },\n    IsDistinctFrom: (args, indent) => {\n        exports.checkArgs('IsDistinctFrom', args, 2);\n        return 'NOT(' + isNotDistinctFrom(args, indent) + ')';\n    },\n    Add: MathOp('Add'),\n    Subtract: MathOp('Subtract'),\n    Multiply: MathOp('Multiply'),\n    Divide: MathOp('Divide'),\n    Year: ExtractNumericDatePart('Year'),\n    Month: ExtractNumericDatePart('Month'),\n    Day: ExtractNumericDatePart('Day'),\n    Hour: ExtractNumericDatePart('Hour'),\n    Minute: ExtractNumericDatePart('Minute'),\n    Second: ExtractNumericDatePart('Second'),\n    Fractionalseconds: ExtractNumericDatePart('Fractionalseconds'),\n    Totalseconds: (args, indent) => {\n        exports.checkArgs('Totalseconds', args, 1);\n        const duration = DurationValue(exports.getAbstractSqlQuery(args, 0), indent);\n        if (engine === \"postgres\") {\n            return `EXTRACT(EPOCH FROM ${duration})`;\n        }\n        else if (engine === \"mysql\") {\n            return `(TIMESTAMPDIFF(MICROSECOND, FROM_UNIXTIME(0), FROM_UNIXTIME(0) + ${duration}) / 1000000)`;\n        }\n        else {\n            throw new SyntaxError('TotalSeconds not supported on: ' + engine);\n        }\n    },\n    Concatenate: (args, indent) => {\n        exports.checkMinArgs('Concatenate', args, 1);\n        const comparators = args.map((arg) => {\n            if (!exports.isAbstractSqlQuery(arg)) {\n                throw new SyntaxError(`Expected AbstractSqlQuery array but got ${typeof arg}`);\n            }\n            return TextValue(arg, indent);\n        });\n        if (engine === \"mysql\") {\n            return 'CONCAT(' + comparators.join(', ') + ')';\n        }\n        else {\n            return '(' + comparators.join(' || ') + ')';\n        }\n    },\n    Replace: (args, indent) => {\n        exports.checkArgs('Replace', args, 3);\n        const str = TextValue(exports.getAbstractSqlQuery(args, 0), indent);\n        const find = TextValue(exports.getAbstractSqlQuery(args, 1), indent);\n        const replacement = TextValue(exports.getAbstractSqlQuery(args, 2), indent);\n        return `REPLACE(${str}, ${find}, ${replacement})`;\n    },\n    CharacterLength: (args, indent) => {\n        exports.checkArgs('CharacterLength', args, 1);\n        const text = TextValue(exports.getAbstractSqlQuery(args, 0), indent);\n        if (engine === \"mysql\") {\n            return `CHAR_LENGTH(${text})`;\n        }\n        else {\n            return `LENGTH(${text})`;\n        }\n    },\n    StrPos: (args, indent) => {\n        exports.checkArgs('StrPos', args, 2);\n        const haystack = TextValue(exports.getAbstractSqlQuery(args, 0), indent);\n        const needle = TextValue(exports.getAbstractSqlQuery(args, 1), indent);\n        if (engine === \"postgres\") {\n            return `STRPOS(${haystack}, ${needle})`;\n        }\n        else {\n            return `INSTR(${haystack}, ${needle})`;\n        }\n    },\n    Substring: (args, indent) => {\n        exports.checkMinArgs('Substring', args, 2);\n        const str = TextValue(exports.getAbstractSqlQuery(args, 0), indent);\n        const nums = args.slice(1).map((arg) => {\n            if (!exports.isAbstractSqlQuery(arg)) {\n                throw new SyntaxError(`Expected AbstractSqlQuery array but got ${typeof arg}`);\n            }\n            return NumericValue(arg, indent);\n        });\n        return `SUBSTRING(${[str, ...nums].join(', ')})`;\n    },\n    Right: (args, indent) => {\n        exports.checkArgs('Right', args, 2);\n        const str = TextValue(exports.getAbstractSqlQuery(args, 0), indent);\n        const n = NumericValue(exports.getAbstractSqlQuery(args, 0), indent);\n        if (engine === \"websql\") {\n            return `SUBSTRING(${str}, -${n})`;\n        }\n        else {\n            return `RIGHT(${str}, ${n})`;\n        }\n    },\n    Lower: (args, indent) => {\n        exports.checkArgs('Lower', args, 1);\n        const str = TextValue(exports.getAbstractSqlQuery(args, 0), indent);\n        return `LOWER(${str})`;\n    },\n    Upper: (args, indent) => {\n        exports.checkArgs('Upper', args, 1);\n        const str = TextValue(exports.getAbstractSqlQuery(args, 0), indent);\n        return `UPPER(${str})`;\n    },\n    Trim: (args, indent) => {\n        exports.checkArgs('Trim', args, 1);\n        const str = TextValue(exports.getAbstractSqlQuery(args, 0), indent);\n        return `TRIM(${str})`;\n    },\n    Round: (args, indent) => {\n        exports.checkArgs('Round', args, 1);\n        const num = NumericValue(exports.getAbstractSqlQuery(args, 0), indent);\n        return `ROUND(${num})`;\n    },\n    Floor: (args, indent) => {\n        exports.checkArgs('Floor', args, 1);\n        const num = NumericValue(exports.getAbstractSqlQuery(args, 0), indent);\n        return `FLOOR(${num})`;\n    },\n    Ceiling: (args, indent) => {\n        exports.checkArgs('Ceiling', args, 1);\n        const num = NumericValue(exports.getAbstractSqlQuery(args, 0), indent);\n        return `CEILING(${num})`;\n    },\n    ToDate: (args, indent) => {\n        exports.checkArgs('ToDate', args, 1);\n        const date = DateValue(exports.getAbstractSqlQuery(args, 0), indent);\n        return `DATE(${date})`;\n    },\n    ToTime: (args, indent) => {\n        exports.checkArgs('ToTime', args, 1);\n        const date = DateValue(exports.getAbstractSqlQuery(args, 0), indent);\n        if (engine === \"postgres\") {\n            return `CAST(${date} AS TIME)`;\n        }\n        else {\n            return `TIME(${date})`;\n        }\n    },\n    Coalesce: (args, indent) => {\n        exports.checkMinArgs('Coalesce', args, 2);\n        const comparators = args.map((arg) => {\n            if (!exports.isAbstractSqlQuery(arg)) {\n                throw new SyntaxError(`Expected AbstractSqlQuery array but got ${typeof arg}`);\n            }\n            return AnyValue(arg, indent);\n        });\n        return 'COALESCE(' + comparators.join(', ') + ')';\n    },\n    Case: (args, indent) => {\n        exports.checkMinArgs('Case', args, 1);\n        const nestedIndent = NestedIndent(indent);\n        const clauses = args\n            .map((arg, index) => {\n            if (!exports.isAbstractSqlQuery(arg)) {\n                throw new SyntaxError(`Expected AbstractSqlQuery array but got ${typeof arg}`);\n            }\n            const [type, ...rest] = arg;\n            switch (type) {\n                case 'When':\n                    exports.checkArgs('When', rest, 2);\n                    const matches = BooleanValue(exports.getAbstractSqlQuery(rest, 0), NestedIndent(nestedIndent));\n                    const resultValue = AnyValue(exports.getAbstractSqlQuery(rest, 1), nestedIndent);\n                    return 'WHEN ' + matches + ' THEN ' + resultValue;\n                case 'Else':\n                    if (index !== args.length - 1) {\n                        throw new SyntaxError('Else must be the last element of a Case');\n                    }\n                    exports.checkArgs('Else', rest, 1);\n                    return ('ELSE ' + AnyValue(exports.getAbstractSqlQuery(rest, 0), nestedIndent));\n                default:\n                    throw new SyntaxError('Case can only contain When/Else');\n            }\n        })\n            .join(nestedIndent);\n        return 'CASE' + nestedIndent + clauses + indent + 'END';\n    },\n    And: (args, indent) => {\n        exports.checkMinArgs('And', args, 2);\n        return args\n            .map((arg) => {\n            if (!exports.isAbstractSqlQuery(arg)) {\n                throw new SyntaxError(`Expected AbstractSqlQuery array but got ${typeof arg}`);\n            }\n            return BooleanValue(arg, indent);\n        })\n            .join(indent + 'AND ');\n    },\n    Or: (args, indent) => {\n        exports.checkMinArgs('Or', args, 2);\n        return ('(' +\n            args\n                .map((arg) => {\n                if (!exports.isAbstractSqlQuery(arg)) {\n                    throw new SyntaxError(`Expected AbstractSqlQuery array but got ${typeof arg}`);\n                }\n                return BooleanValue(arg, indent);\n            })\n                .join(indent + 'OR ') +\n            ')');\n    },\n    Bind: (args) => {\n        let bind;\n        if (args.length === 2) {\n            bind = args;\n        }\n        else if (args.length === 1) {\n            bind = args[0];\n        }\n        else {\n            throw new SyntaxError(`\"Bind\" requires 1/2 arg(s)`);\n        }\n        return AddBind(['Bind', bind]);\n    },\n    Text,\n    Value: Text,\n    Date: (args) => {\n        exports.checkArgs('Date', args, 1);\n        return AddBind(['Date', args[0]]);\n    },\n    Duration: (args) => {\n        exports.checkArgs('Duration', args, 1);\n        if (engine === \"websql\") {\n            throw new SyntaxError('Durations not supported on: ' + engine);\n        }\n        let duration = args[0];\n        if (duration == null || typeof duration !== 'object') {\n            throw new SyntaxError(`Duration must be an object, got ${typeof duration}`);\n        }\n        duration = _(duration)\n            .pick('negative', 'day', 'hour', 'minute', 'second')\n            .omitBy(_.isNil)\n            .value();\n        if (_(duration).omit('negative').isEmpty()) {\n            throw new SyntaxError('Invalid duration');\n        }\n        return (\"INTERVAL '\" +\n            (duration.negative ? '-' : '') +\n            (duration.day || '0') +\n            ' ' +\n            (duration.negative ? '-' : '') +\n            (duration.hour || '0') +\n            ':' +\n            (duration.minute || '0') +\n            ':' +\n            Number(duration.second).toLocaleString('en', {\n                minimumFractionDigits: 1,\n            }) +\n            \"'\" +\n            (engine === \"mysql\" ? ' DAY_MICROSECOND' : ''));\n    },\n    Exists: (args, indent) => {\n        exports.checkArgs('Exists', args, 1);\n        const arg = exports.getAbstractSqlQuery(args, 0);\n        const [type, ...rest] = arg;\n        switch (type) {\n            case 'SelectQuery':\n            case 'UnionQuery':\n                const nestedIndent = NestedIndent(indent);\n                const query = typeRules[type](rest, nestedIndent);\n                return 'EXISTS (' + nestedIndent + query + indent + ')';\n            default:\n                return AnyValue(arg, indent) + ' IS NOT NULL';\n        }\n    },\n    NotExists: (args, indent) => {\n        exports.checkArgs('NotExists', args, 1);\n        const arg = exports.getAbstractSqlQuery(args, 0);\n        const [type, ...rest] = arg;\n        switch (type) {\n            case 'SelectQuery':\n            case 'UnionQuery':\n                const nestedIndent = NestedIndent(indent);\n                const query = typeRules[type](rest, nestedIndent);\n                return 'NOT EXISTS (' + nestedIndent + query + indent + ')';\n            default:\n                return AnyValue(arg, indent) + ' IS NULL';\n        }\n    },\n    Not: (args, indent) => {\n        exports.checkArgs('Not', args, 1);\n        const nestedIndent = NestedIndent(indent);\n        const bool = BooleanValue(exports.getAbstractSqlQuery(args, 0), nestedIndent);\n        return 'NOT (' + nestedIndent + bool + indent + ')';\n    },\n    In: (args, indent) => {\n        exports.checkMinArgs('In', args, 2);\n        const field = Field(exports.getAbstractSqlQuery(args, 0), indent);\n        const vals = args.slice(1).map((arg) => {\n            if (!exports.isAbstractSqlQuery(arg)) {\n                throw new SyntaxError(`Expected AbstractSqlQuery array but got ${typeof arg}`);\n            }\n            return AnyValue(arg, indent);\n        });\n        return field + ' IN (' + vals.join(', ') + ')';\n    },\n    NotIn: (args, indent) => {\n        exports.checkMinArgs('NotIn', args, 2);\n        const field = Field(exports.getAbstractSqlQuery(args, 0), indent);\n        const vals = args.slice(1).map((arg) => {\n            if (!exports.isAbstractSqlQuery(arg)) {\n                throw new SyntaxError(`Expected AbstractSqlQuery array but got ${typeof arg}`);\n            }\n            return AnyValue(arg, indent);\n        });\n        return field + ' NOT IN (' + vals.join(', ') + ')';\n    },\n    InsertQuery: (args, indent) => {\n        const tables = [];\n        let fields = [];\n        let values = [];\n        for (const arg of args) {\n            if (!exports.isAbstractSqlQuery(arg)) {\n                throw new SyntaxError('`InsertQuery` args must all be arrays');\n            }\n            const [type, ...rest] = arg;\n            switch (type) {\n                case 'Fields':\n                    if (fields.length !== 0) {\n                        throw new SyntaxError(`'InsertQuery' can only accept one '${type}'`);\n                    }\n                    exports.checkMinArgs('Update fields', rest, 1);\n                    fields = exports.getAbstractSqlQuery(rest, 0).map(escapeField);\n                    break;\n                case 'Values':\n                    if (values.length !== 0) {\n                        throw new SyntaxError(`'InsertQuery' can only accept one '${type}'`);\n                    }\n                    const valuesArray = exports.getAbstractSqlQuery(rest, 0);\n                    if (valuesArray.length > 0) {\n                        const [valuesType, ...valuesRest] = valuesArray;\n                        switch (valuesType) {\n                            case 'SelectQuery':\n                            case 'UnionQuery':\n                                values = typeRules[valuesType](valuesRest, indent);\n                                break;\n                            default:\n                                values = valuesArray.map((v) => Value(v, indent));\n                        }\n                    }\n                    break;\n                case 'From':\n                    tables.push(typeRules[type](rest, indent));\n                    break;\n                default:\n                    throw new SyntaxError(`'InsertQuery' does not support '${type}'`);\n            }\n        }\n        if (typeof values !== 'string' && fields.length !== values.length) {\n            throw new SyntaxError('Fields and Values must have the same length or use a query');\n        }\n        if (fields.length > 0) {\n            if (Array.isArray(values)) {\n                values = 'VALUES (' + values.join(', ') + ')';\n            }\n            return ('INSERT INTO ' +\n                tables.join(', ') +\n                ' (' +\n                fields.join(', ') +\n                ')' +\n                indent +\n                values);\n        }\n        else {\n            return 'INSERT INTO ' + tables.join(', ') + ' DEFAULT VALUES';\n        }\n    },\n    UpdateQuery: (args, indent) => {\n        const tables = [];\n        let fields = [];\n        let values = [];\n        let where = '';\n        for (const arg of args) {\n            if (!exports.isAbstractSqlQuery(arg)) {\n                throw new SyntaxError('`UpdateQuery` args must all be arrays');\n            }\n            const [type, ...rest] = arg;\n            switch (type) {\n                case 'Fields':\n                    if (fields.length !== 0) {\n                        throw new SyntaxError(`'UpdateQuery' can only accept one '${type}'`);\n                    }\n                    exports.checkMinArgs('Update fields', rest, 1);\n                    fields = exports.getAbstractSqlQuery(rest, 0).map(escapeField);\n                    break;\n                case 'Values':\n                    if (values.length !== 0) {\n                        throw new SyntaxError(`'UpdateQuery' can only accept one '${type}'`);\n                    }\n                    exports.checkArgs('Update values', rest, 1);\n                    const valuesArray = exports.getAbstractSqlQuery(rest, 0);\n                    exports.checkMinArgs('Update values array', valuesArray, 1);\n                    values = valuesArray.map((v) => Value(v, indent));\n                    break;\n                case 'From':\n                    tables.push(typeRules[type](rest, indent));\n                    break;\n                case 'Where':\n                    if (where !== '') {\n                        throw new SyntaxError(`'UpdateQuery' can only accept one '${type}'`);\n                    }\n                    where = indent + typeRules[type](rest, indent);\n                    break;\n                default:\n                    throw new SyntaxError(`'UpdateQuery' does not support '${type}'`);\n            }\n        }\n        if (fields.length !== values.length) {\n            throw new SyntaxError('Fields and Values must have the same length');\n        }\n        const sets = fields.map((field, i) => field + ' = ' + values[i]);\n        return ('UPDATE ' +\n            tables.join(', ') +\n            indent +\n            'SET ' +\n            sets.join(',' + NestedIndent(indent)) +\n            where);\n    },\n    DeleteQuery: (args, indent) => {\n        const tables = [];\n        let where = '';\n        for (const arg of args) {\n            if (!exports.isAbstractSqlQuery(arg)) {\n                throw new SyntaxError('`DeleteQuery` args must all be arrays');\n            }\n            const [type, ...rest] = arg;\n            switch (type) {\n                case 'From':\n                    tables.push(typeRules[type](rest, indent));\n                    break;\n                case 'Where':\n                    if (where !== '') {\n                        throw new SyntaxError(`'DeleteQuery' can only accept one '${type}'`);\n                    }\n                    where = indent + typeRules[type](rest, indent);\n                    break;\n                default:\n                    throw new SyntaxError(`'DeleteQuery' does not support '${type}'`);\n            }\n        }\n        return 'DELETE FROM ' + tables.join(', ') + where;\n    },\n};\nconst toSqlResult = (query) => {\n    if (noBinds) {\n        return query;\n    }\n    return {\n        query,\n        bindings: fieldOrderings,\n    };\n};\nfunction AbstractSQLRules2SQL(abstractSQL, $engine, $noBinds = false) {\n    engine = $engine;\n    noBinds = $noBinds;\n    fieldOrderings = [];\n    fieldOrderingsLookup = {};\n    const indent = '\\n';\n    const [type, ...rest] = abstractSQL;\n    switch (type) {\n        case 'SelectQuery':\n        case 'UnionQuery':\n        case 'InsertQuery':\n        case 'UpdateQuery':\n        case 'DeleteQuery':\n            const query = typeRules[type](rest, indent);\n            return toSqlResult(query);\n        case 'UpsertQuery':\n            exports.checkArgs('UpsertQuery', rest, 2);\n            const insertQuery = exports.getAbstractSqlQuery(rest, 0);\n            const updateQuery = exports.getAbstractSqlQuery(rest, 1);\n            if (insertQuery[0] !== 'InsertQuery' ||\n                updateQuery[0] !== 'UpdateQuery') {\n                throw new SyntaxError('UpsertQuery must have [InsertQuery, UpdateQuery] provided');\n            }\n            const insertSql = typeRules.InsertQuery(insertQuery.slice(1), indent);\n            const insert = toSqlResult(insertSql);\n            fieldOrderings = [];\n            fieldOrderingsLookup = {};\n            const updateSql = typeRules.UpdateQuery(updateQuery.slice(1), indent);\n            const update = toSqlResult(updateSql);\n            return [insert, update];\n        default:\n            const value = AnyValue(abstractSQL, indent);\n            if (noBinds) {\n                return value;\n            }\n            return {\n                query: `SELECT ${value} AS \"result\";`,\n                bindings: fieldOrderings,\n            };\n    }\n}\nexports.AbstractSQLRules2SQL = AbstractSQLRules2SQL;\n//# sourceMappingURL=AbstractSQLRules2SQL.js.map","module.exports = require(\"crypto\");","/**\n * A JavaScript implementation of the Secure Hash Algorithm, SHA-256, as defined\n * in FIPS 180-2\n * Version 2.2-beta Copyright Angel Marin, Paul Johnston 2000 - 2009.\n * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet\n *\n */\n\nvar inherits = require('inherits')\nvar Hash = require('./hash')\nvar Buffer = require('safe-buffer').Buffer\n\nvar K = [\n  0x428A2F98, 0x71374491, 0xB5C0FBCF, 0xE9B5DBA5,\n  0x3956C25B, 0x59F111F1, 0x923F82A4, 0xAB1C5ED5,\n  0xD807AA98, 0x12835B01, 0x243185BE, 0x550C7DC3,\n  0x72BE5D74, 0x80DEB1FE, 0x9BDC06A7, 0xC19BF174,\n  0xE49B69C1, 0xEFBE4786, 0x0FC19DC6, 0x240CA1CC,\n  0x2DE92C6F, 0x4A7484AA, 0x5CB0A9DC, 0x76F988DA,\n  0x983E5152, 0xA831C66D, 0xB00327C8, 0xBF597FC7,\n  0xC6E00BF3, 0xD5A79147, 0x06CA6351, 0x14292967,\n  0x27B70A85, 0x2E1B2138, 0x4D2C6DFC, 0x53380D13,\n  0x650A7354, 0x766A0ABB, 0x81C2C92E, 0x92722C85,\n  0xA2BFE8A1, 0xA81A664B, 0xC24B8B70, 0xC76C51A3,\n  0xD192E819, 0xD6990624, 0xF40E3585, 0x106AA070,\n  0x19A4C116, 0x1E376C08, 0x2748774C, 0x34B0BCB5,\n  0x391C0CB3, 0x4ED8AA4A, 0x5B9CCA4F, 0x682E6FF3,\n  0x748F82EE, 0x78A5636F, 0x84C87814, 0x8CC70208,\n  0x90BEFFFA, 0xA4506CEB, 0xBEF9A3F7, 0xC67178F2\n]\n\nvar W = new Array(64)\n\nfunction Sha256 () {\n  this.init()\n\n  this._w = W // new Array(64)\n\n  Hash.call(this, 64, 56)\n}\n\ninherits(Sha256, Hash)\n\nSha256.prototype.init = function () {\n  this._a = 0x6a09e667\n  this._b = 0xbb67ae85\n  this._c = 0x3c6ef372\n  this._d = 0xa54ff53a\n  this._e = 0x510e527f\n  this._f = 0x9b05688c\n  this._g = 0x1f83d9ab\n  this._h = 0x5be0cd19\n\n  return this\n}\n\nfunction ch (x, y, z) {\n  return z ^ (x & (y ^ z))\n}\n\nfunction maj (x, y, z) {\n  return (x & y) | (z & (x | y))\n}\n\nfunction sigma0 (x) {\n  return (x >>> 2 | x << 30) ^ (x >>> 13 | x << 19) ^ (x >>> 22 | x << 10)\n}\n\nfunction sigma1 (x) {\n  return (x >>> 6 | x << 26) ^ (x >>> 11 | x << 21) ^ (x >>> 25 | x << 7)\n}\n\nfunction gamma0 (x) {\n  return (x >>> 7 | x << 25) ^ (x >>> 18 | x << 14) ^ (x >>> 3)\n}\n\nfunction gamma1 (x) {\n  return (x >>> 17 | x << 15) ^ (x >>> 19 | x << 13) ^ (x >>> 10)\n}\n\nSha256.prototype._update = function (M) {\n  var W = this._w\n\n  var a = this._a | 0\n  var b = this._b | 0\n  var c = this._c | 0\n  var d = this._d | 0\n  var e = this._e | 0\n  var f = this._f | 0\n  var g = this._g | 0\n  var h = this._h | 0\n\n  for (var i = 0; i < 16; ++i) W[i] = M.readInt32BE(i * 4)\n  for (; i < 64; ++i) W[i] = (gamma1(W[i - 2]) + W[i - 7] + gamma0(W[i - 15]) + W[i - 16]) | 0\n\n  for (var j = 0; j < 64; ++j) {\n    var T1 = (h + sigma1(e) + ch(e, f, g) + K[j] + W[j]) | 0\n    var T2 = (sigma0(a) + maj(a, b, c)) | 0\n\n    h = g\n    g = f\n    f = e\n    e = (d + T1) | 0\n    d = c\n    c = b\n    b = a\n    a = (T1 + T2) | 0\n  }\n\n  this._a = (a + this._a) | 0\n  this._b = (b + this._b) | 0\n  this._c = (c + this._c) | 0\n  this._d = (d + this._d) | 0\n  this._e = (e + this._e) | 0\n  this._f = (f + this._f) | 0\n  this._g = (g + this._g) | 0\n  this._h = (h + this._h) | 0\n}\n\nSha256.prototype._hash = function () {\n  var H = Buffer.allocUnsafe(32)\n\n  H.writeInt32BE(this._a, 0)\n  H.writeInt32BE(this._b, 4)\n  H.writeInt32BE(this._c, 8)\n  H.writeInt32BE(this._d, 12)\n  H.writeInt32BE(this._e, 16)\n  H.writeInt32BE(this._f, 20)\n  H.writeInt32BE(this._g, 24)\n  H.writeInt32BE(this._h, 28)\n\n  return H\n}\n\nmodule.exports = Sha256\n","var inherits = require('inherits')\nvar Hash = require('./hash')\nvar Buffer = require('safe-buffer').Buffer\n\nvar K = [\n  0x428a2f98, 0xd728ae22, 0x71374491, 0x23ef65cd,\n  0xb5c0fbcf, 0xec4d3b2f, 0xe9b5dba5, 0x8189dbbc,\n  0x3956c25b, 0xf348b538, 0x59f111f1, 0xb605d019,\n  0x923f82a4, 0xaf194f9b, 0xab1c5ed5, 0xda6d8118,\n  0xd807aa98, 0xa3030242, 0x12835b01, 0x45706fbe,\n  0x243185be, 0x4ee4b28c, 0x550c7dc3, 0xd5ffb4e2,\n  0x72be5d74, 0xf27b896f, 0x80deb1fe, 0x3b1696b1,\n  0x9bdc06a7, 0x25c71235, 0xc19bf174, 0xcf692694,\n  0xe49b69c1, 0x9ef14ad2, 0xefbe4786, 0x384f25e3,\n  0x0fc19dc6, 0x8b8cd5b5, 0x240ca1cc, 0x77ac9c65,\n  0x2de92c6f, 0x592b0275, 0x4a7484aa, 0x6ea6e483,\n  0x5cb0a9dc, 0xbd41fbd4, 0x76f988da, 0x831153b5,\n  0x983e5152, 0xee66dfab, 0xa831c66d, 0x2db43210,\n  0xb00327c8, 0x98fb213f, 0xbf597fc7, 0xbeef0ee4,\n  0xc6e00bf3, 0x3da88fc2, 0xd5a79147, 0x930aa725,\n  0x06ca6351, 0xe003826f, 0x14292967, 0x0a0e6e70,\n  0x27b70a85, 0x46d22ffc, 0x2e1b2138, 0x5c26c926,\n  0x4d2c6dfc, 0x5ac42aed, 0x53380d13, 0x9d95b3df,\n  0x650a7354, 0x8baf63de, 0x766a0abb, 0x3c77b2a8,\n  0x81c2c92e, 0x47edaee6, 0x92722c85, 0x1482353b,\n  0xa2bfe8a1, 0x4cf10364, 0xa81a664b, 0xbc423001,\n  0xc24b8b70, 0xd0f89791, 0xc76c51a3, 0x0654be30,\n  0xd192e819, 0xd6ef5218, 0xd6990624, 0x5565a910,\n  0xf40e3585, 0x5771202a, 0x106aa070, 0x32bbd1b8,\n  0x19a4c116, 0xb8d2d0c8, 0x1e376c08, 0x5141ab53,\n  0x2748774c, 0xdf8eeb99, 0x34b0bcb5, 0xe19b48a8,\n  0x391c0cb3, 0xc5c95a63, 0x4ed8aa4a, 0xe3418acb,\n  0x5b9cca4f, 0x7763e373, 0x682e6ff3, 0xd6b2b8a3,\n  0x748f82ee, 0x5defb2fc, 0x78a5636f, 0x43172f60,\n  0x84c87814, 0xa1f0ab72, 0x8cc70208, 0x1a6439ec,\n  0x90befffa, 0x23631e28, 0xa4506ceb, 0xde82bde9,\n  0xbef9a3f7, 0xb2c67915, 0xc67178f2, 0xe372532b,\n  0xca273ece, 0xea26619c, 0xd186b8c7, 0x21c0c207,\n  0xeada7dd6, 0xcde0eb1e, 0xf57d4f7f, 0xee6ed178,\n  0x06f067aa, 0x72176fba, 0x0a637dc5, 0xa2c898a6,\n  0x113f9804, 0xbef90dae, 0x1b710b35, 0x131c471b,\n  0x28db77f5, 0x23047d84, 0x32caab7b, 0x40c72493,\n  0x3c9ebe0a, 0x15c9bebc, 0x431d67c4, 0x9c100d4c,\n  0x4cc5d4be, 0xcb3e42b6, 0x597f299c, 0xfc657e2a,\n  0x5fcb6fab, 0x3ad6faec, 0x6c44198c, 0x4a475817\n]\n\nvar W = new Array(160)\n\nfunction Sha512 () {\n  this.init()\n  this._w = W\n\n  Hash.call(this, 128, 112)\n}\n\ninherits(Sha512, Hash)\n\nSha512.prototype.init = function () {\n  this._ah = 0x6a09e667\n  this._bh = 0xbb67ae85\n  this._ch = 0x3c6ef372\n  this._dh = 0xa54ff53a\n  this._eh = 0x510e527f\n  this._fh = 0x9b05688c\n  this._gh = 0x1f83d9ab\n  this._hh = 0x5be0cd19\n\n  this._al = 0xf3bcc908\n  this._bl = 0x84caa73b\n  this._cl = 0xfe94f82b\n  this._dl = 0x5f1d36f1\n  this._el = 0xade682d1\n  this._fl = 0x2b3e6c1f\n  this._gl = 0xfb41bd6b\n  this._hl = 0x137e2179\n\n  return this\n}\n\nfunction Ch (x, y, z) {\n  return z ^ (x & (y ^ z))\n}\n\nfunction maj (x, y, z) {\n  return (x & y) | (z & (x | y))\n}\n\nfunction sigma0 (x, xl) {\n  return (x >>> 28 | xl << 4) ^ (xl >>> 2 | x << 30) ^ (xl >>> 7 | x << 25)\n}\n\nfunction sigma1 (x, xl) {\n  return (x >>> 14 | xl << 18) ^ (x >>> 18 | xl << 14) ^ (xl >>> 9 | x << 23)\n}\n\nfunction Gamma0 (x, xl) {\n  return (x >>> 1 | xl << 31) ^ (x >>> 8 | xl << 24) ^ (x >>> 7)\n}\n\nfunction Gamma0l (x, xl) {\n  return (x >>> 1 | xl << 31) ^ (x >>> 8 | xl << 24) ^ (x >>> 7 | xl << 25)\n}\n\nfunction Gamma1 (x, xl) {\n  return (x >>> 19 | xl << 13) ^ (xl >>> 29 | x << 3) ^ (x >>> 6)\n}\n\nfunction Gamma1l (x, xl) {\n  return (x >>> 19 | xl << 13) ^ (xl >>> 29 | x << 3) ^ (x >>> 6 | xl << 26)\n}\n\nfunction getCarry (a, b) {\n  return (a >>> 0) < (b >>> 0) ? 1 : 0\n}\n\nSha512.prototype._update = function (M) {\n  var W = this._w\n\n  var ah = this._ah | 0\n  var bh = this._bh | 0\n  var ch = this._ch | 0\n  var dh = this._dh | 0\n  var eh = this._eh | 0\n  var fh = this._fh | 0\n  var gh = this._gh | 0\n  var hh = this._hh | 0\n\n  var al = this._al | 0\n  var bl = this._bl | 0\n  var cl = this._cl | 0\n  var dl = this._dl | 0\n  var el = this._el | 0\n  var fl = this._fl | 0\n  var gl = this._gl | 0\n  var hl = this._hl | 0\n\n  for (var i = 0; i < 32; i += 2) {\n    W[i] = M.readInt32BE(i * 4)\n    W[i + 1] = M.readInt32BE(i * 4 + 4)\n  }\n  for (; i < 160; i += 2) {\n    var xh = W[i - 15 * 2]\n    var xl = W[i - 15 * 2 + 1]\n    var gamma0 = Gamma0(xh, xl)\n    var gamma0l = Gamma0l(xl, xh)\n\n    xh = W[i - 2 * 2]\n    xl = W[i - 2 * 2 + 1]\n    var gamma1 = Gamma1(xh, xl)\n    var gamma1l = Gamma1l(xl, xh)\n\n    // W[i] = gamma0 + W[i - 7] + gamma1 + W[i - 16]\n    var Wi7h = W[i - 7 * 2]\n    var Wi7l = W[i - 7 * 2 + 1]\n\n    var Wi16h = W[i - 16 * 2]\n    var Wi16l = W[i - 16 * 2 + 1]\n\n    var Wil = (gamma0l + Wi7l) | 0\n    var Wih = (gamma0 + Wi7h + getCarry(Wil, gamma0l)) | 0\n    Wil = (Wil + gamma1l) | 0\n    Wih = (Wih + gamma1 + getCarry(Wil, gamma1l)) | 0\n    Wil = (Wil + Wi16l) | 0\n    Wih = (Wih + Wi16h + getCarry(Wil, Wi16l)) | 0\n\n    W[i] = Wih\n    W[i + 1] = Wil\n  }\n\n  for (var j = 0; j < 160; j += 2) {\n    Wih = W[j]\n    Wil = W[j + 1]\n\n    var majh = maj(ah, bh, ch)\n    var majl = maj(al, bl, cl)\n\n    var sigma0h = sigma0(ah, al)\n    var sigma0l = sigma0(al, ah)\n    var sigma1h = sigma1(eh, el)\n    var sigma1l = sigma1(el, eh)\n\n    // t1 = h + sigma1 + ch + K[j] + W[j]\n    var Kih = K[j]\n    var Kil = K[j + 1]\n\n    var chh = Ch(eh, fh, gh)\n    var chl = Ch(el, fl, gl)\n\n    var t1l = (hl + sigma1l) | 0\n    var t1h = (hh + sigma1h + getCarry(t1l, hl)) | 0\n    t1l = (t1l + chl) | 0\n    t1h = (t1h + chh + getCarry(t1l, chl)) | 0\n    t1l = (t1l + Kil) | 0\n    t1h = (t1h + Kih + getCarry(t1l, Kil)) | 0\n    t1l = (t1l + Wil) | 0\n    t1h = (t1h + Wih + getCarry(t1l, Wil)) | 0\n\n    // t2 = sigma0 + maj\n    var t2l = (sigma0l + majl) | 0\n    var t2h = (sigma0h + majh + getCarry(t2l, sigma0l)) | 0\n\n    hh = gh\n    hl = gl\n    gh = fh\n    gl = fl\n    fh = eh\n    fl = el\n    el = (dl + t1l) | 0\n    eh = (dh + t1h + getCarry(el, dl)) | 0\n    dh = ch\n    dl = cl\n    ch = bh\n    cl = bl\n    bh = ah\n    bl = al\n    al = (t1l + t2l) | 0\n    ah = (t1h + t2h + getCarry(al, t1l)) | 0\n  }\n\n  this._al = (this._al + al) | 0\n  this._bl = (this._bl + bl) | 0\n  this._cl = (this._cl + cl) | 0\n  this._dl = (this._dl + dl) | 0\n  this._el = (this._el + el) | 0\n  this._fl = (this._fl + fl) | 0\n  this._gl = (this._gl + gl) | 0\n  this._hl = (this._hl + hl) | 0\n\n  this._ah = (this._ah + ah + getCarry(this._al, al)) | 0\n  this._bh = (this._bh + bh + getCarry(this._bl, bl)) | 0\n  this._ch = (this._ch + ch + getCarry(this._cl, cl)) | 0\n  this._dh = (this._dh + dh + getCarry(this._dl, dl)) | 0\n  this._eh = (this._eh + eh + getCarry(this._el, el)) | 0\n  this._fh = (this._fh + fh + getCarry(this._fl, fl)) | 0\n  this._gh = (this._gh + gh + getCarry(this._gl, gl)) | 0\n  this._hh = (this._hh + hh + getCarry(this._hl, hl)) | 0\n}\n\nSha512.prototype._hash = function () {\n  var H = Buffer.allocUnsafe(64)\n\n  function writeInt64BE (h, l, offset) {\n    H.writeInt32BE(h, offset)\n    H.writeInt32BE(l, offset + 4)\n  }\n\n  writeInt64BE(this._ah, this._al, 0)\n  writeInt64BE(this._bh, this._bl, 8)\n  writeInt64BE(this._ch, this._cl, 16)\n  writeInt64BE(this._dh, this._dl, 24)\n  writeInt64BE(this._eh, this._el, 32)\n  writeInt64BE(this._fh, this._fl, 40)\n  writeInt64BE(this._gh, this._gl, 48)\n  writeInt64BE(this._hh, this._hl, 56)\n\n  return H\n}\n\nmodule.exports = Sha512\n","var OMeta = require(\"ometa-js/lib/ometajs/core\"), SBVRLibs = require(\"@balena/sbvr-parser/sbvr-libs\").SBVRLibs, SBVRCompilerLibs = exports.SBVRCompilerLibs = SBVRLibs._extend({\n    ResolveSynonym: function(name) {\n        var $elf = this, _fromIdx = this.input.idx;\n        return this._or(function() {\n            this._pred(this.synonyms[name]);\n            return this.synonyms[name];\n        }, function() {\n            return name;\n        });\n    }\n});\n\nSBVRCompilerLibs.initialize = function() {\n    SBVRLibs.initialize.call(this);\n    this.synonyms = {};\n};\n\nSBVRCompilerLibs.TYPE_VOCAB = \"Type\";\n\nSBVRCompilerLibs.IsPrimitive = function(term) {\n    return term[2] == this.TYPE_VOCAB ? term[1] : !1 !== (term = this.FollowConceptType(term)) && term[2] == this.TYPE_VOCAB && term[1];\n};\n\nSBVRCompilerLibs.IsChild = function(child, parent) {\n    do {\n        if (this.IdentifiersEqual(child, parent)) return !0;\n    } while (!1 !== (child = this.FollowConceptType(child)));\n    return !1;\n};\n\nSBVRCompilerLibs.MappedFactType = function(factType) {\n    var traverseInfo = this._traverseFactType(factType), mappedFactType = [];\n    if (!1 === traverseInfo || !traverseInfo.hasOwnProperty(\"__valid\")) return !1;\n    for (var i = 0; i < traverseInfo.__valid.length; i++) mappedFactType[i] = traverseInfo.__valid[i].slice();\n    mappedFactType[1][2] = factType[1][2];\n    return mappedFactType;\n};\n\nSBVRCompilerLibs.UnmappedFactType = function(factType) {\n    var mappedFactType = this.MappedFactType(factType);\n    if (!1 === mappedFactType) return !1;\n    for (var i = 0; i < mappedFactType.length; i++) mappedFactType[i] = mappedFactType[i].slice(0, 3);\n    return mappedFactType;\n};\n\nSBVRCompilerLibs.GetResourceName = function(termOrFactType) {\n    var i = 0, resource = [];\n    if (\"string\" == typeof termOrFactType) return this.ResolveSynonym(termOrFactType);\n    for (void 0; i < termOrFactType.length; i++) resource.push(this.ResolveSynonym(termOrFactType[i][1]));\n    return resource.join(\"-\");\n};\n\nSBVRCompilerLibs.GetTable = function(termNameOrFactType) {\n    return this.tables[this.GetResourceName(termNameOrFactType)];\n};\n\nSBVRCompilerLibs.GetTableID = function(termOrFactType) {\n    switch (termOrFactType[0]) {\n      case \"Term\":\n      case \"Name\":\n        return termOrFactType[1];\n\n      default:\n        return termOrFactType;\n    }\n};\n\nSBVRCompilerLibs.GetTableField = function(table, fieldName) {\n    var fieldID = this.GetTableFieldID(table, fieldName);\n    return !1 !== fieldID && table.fields[fieldID];\n};\n\nSBVRCompilerLibs.GetTableFieldID = function(table, fieldName) {\n    for (var tableFields = table.fields, i = 0; i < tableFields.length; i++) if (tableFields[i].fieldName == fieldName) return i;\n    return !1;\n};","\"use strict\";\n\nvar assign            = require(\"../object/assign\")\n  , isObject          = require(\"../object/is-object\")\n  , isValue           = require(\"../object/is-value\")\n  , captureStackTrace = Error.captureStackTrace;\n\nmodule.exports = function (message/*, code, ext*/) {\n\tvar err = new Error(message), code = arguments[1], ext = arguments[2];\n\tif (!isValue(ext)) {\n\t\tif (isObject(code)) {\n\t\t\text = code;\n\t\t\tcode = null;\n\t\t}\n\t}\n\tif (isValue(ext)) assign(err, ext);\n\tif (isValue(code)) err.code = code;\n\tif (captureStackTrace) captureStackTrace(err, module.exports);\n\treturn err;\n};\n","\"use strict\";\n\nvar value                    = require(\"./valid-value\")\n  , defineProperty           = Object.defineProperty\n  , getOwnPropertyDescriptor = Object.getOwnPropertyDescriptor\n  , getOwnPropertyNames      = Object.getOwnPropertyNames\n  , getOwnPropertySymbols    = Object.getOwnPropertySymbols;\n\nmodule.exports = function (target, source) {\n\tvar error, sourceObject = Object(value(source));\n\ttarget = Object(value(target));\n\tgetOwnPropertyNames(sourceObject).forEach(function (name) {\n\t\ttry {\n\t\t\tdefineProperty(target, name, getOwnPropertyDescriptor(source, name));\n\t\t} catch (e) { error = e; }\n\t});\n\tif (typeof getOwnPropertySymbols === \"function\") {\n\t\tgetOwnPropertySymbols(sourceObject).forEach(function (symbol) {\n\t\t\ttry {\n\t\t\t\tdefineProperty(target, symbol, getOwnPropertyDescriptor(source, symbol));\n\t\t\t} catch (e) { error = e; }\n\t\t});\n\t}\n\tif (error !== undefined) throw error;\n\treturn target;\n};\n","\"use strict\";\n\nvar isFunction = require(\"../function/is\");\n\nvar classRe = /^\\s*class[\\s{/}]/, functionToString = Function.prototype.toString;\n\nmodule.exports = function (value) {\n\tif (!isFunction(value)) return false;\n\tif (classRe.test(functionToString.call(value))) return false;\n\treturn true;\n};\n","\"use strict\";\n\nmodule.exports = require(\"./is-implemented\")() ? String.prototype.contains : require(\"./shim\");\n","\"use strict\";\n\nvar toArray  = require(\"es5-ext/array/to-array\")\n  , isValue  = require(\"es5-ext/object/is-value\")\n  , callable = require(\"es5-ext/object/valid-callable\");\n\nvar slice = Array.prototype.slice, resolveArgs;\n\nresolveArgs = function (args) {\n\treturn this.map(function (resolve, i) {\n\t\treturn resolve ? resolve(args[i]) : args[i];\n\t}).concat(slice.call(args, this.length));\n};\n\nmodule.exports = function (resolvers) {\n\tresolvers = toArray(resolvers);\n\tresolvers.forEach(function (resolve) {\n\t\tif (isValue(resolve)) callable(resolve);\n\t});\n\treturn resolveArgs.bind(resolvers);\n};\n","\"use strict\";\n\nvar isSymbol = require(\"./is-symbol\");\n\nmodule.exports = function (value) {\n\tif (!isSymbol(value)) throw new TypeError(value + \" is not a symbol\");\n\treturn value;\n};\n","\"use strict\";\n\nvar callable = require(\"es5-ext/object/valid-callable\");\n\nmodule.exports = function (userNormalizer) {\n\tvar normalizer;\n\tif (typeof userNormalizer === \"function\") return { set: userNormalizer, get: userNormalizer };\n\tnormalizer = { get: callable(userNormalizer.get) };\n\tif (userNormalizer.set !== undefined) {\n\t\tnormalizer.set = callable(userNormalizer.set);\n\t\tif (userNormalizer.delete) normalizer.delete = callable(userNormalizer.delete);\n\t\tif (userNormalizer.clear) normalizer.clear = callable(userNormalizer.clear);\n\t\treturn normalizer;\n\t}\n\tnormalizer.set = normalizer.get;\n\treturn normalizer;\n};\n","// Deprecated\n\n\"use strict\";\n\nmodule.exports = function (obj) { return typeof obj === \"function\"; };\n","module.exports = isPromise;\nmodule.exports.default = isPromise;\n\nfunction isPromise(obj) {\n  return !!obj && (typeof obj === 'object' || typeof obj === 'function') && typeof obj.then === 'function';\n}\n","module.exports = require(\"./lib/randomstring\");","import { SBVRParser } from '@balena/sbvr-parser';\n// tslint:disable-next-line:no-var-requires\nconst Types: string = require('@balena/sbvr-types/Type.sbvr');\nimport { version as sbvrParserVersion } from '@balena/sbvr-parser/package.json';\nimport { version } from '@balena/sbvr-parser/package.json';\n\nexport const ExtendedSBVRParser = SBVRParser._extend({\n\tinitialize() {\n\t\tSBVRParser.initialize.call(this);\n\t\tthis.AddCustomAttribute('Database ID Field:');\n\t\tthis.AddCustomAttribute('Database Table Name:');\n\t\tthis.AddBuiltInVocab(Types);\n\t\treturn this;\n\t},\n\tversion: sbvrParserVersion + '+' + version,\n});\n","import type { Tx } from '../database-layer/db';\nimport type { Resolvable } from '../sbvr-api/common-types';\nimport type { Config, Model } from '../config-loader/config-loader';\n\nimport { Engines } from '@balena/abstract-sql-compiler';\nimport * as Bluebird from 'bluebird';\nimport * as _ from 'lodash';\nimport { TypedError } from 'typed-error';\nimport { migrator as migratorEnv } from '../config-loader/env';\nimport * as sbvrUtils from '../sbvr-api/sbvr-utils';\n\n// tslint:disable-next-line:no-var-requires\nconst modelText: string = require('./migrations.sbvr');\n\ntype ApiRootModel = Model & { apiRoot: string };\n\ntype SbvrUtils = typeof sbvrUtils;\n\ntype MigrationTuple = [string, Migration];\n\nexport type MigrationFn = (tx: Tx, sbvrUtils: SbvrUtils) => Resolvable<void>;\n\nexport type Migration = string | MigrationFn;\n\nexport class MigrationError extends TypedError {}\n\n// Tagged template to convert binds from `?` format to the necessary output format,\n// eg `$1`/`$2`/etc for postgres\nconst binds = (strings: TemplateStringsArray, ...bindNums: number[]) =>\n\tstrings\n\t\t.map((str, i) => {\n\t\t\tif (i === bindNums.length) {\n\t\t\t\treturn str;\n\t\t\t}\n\t\t\tif (i + 1 !== bindNums[i]) {\n\t\t\t\tthrow new SyntaxError('Migration sql binds must be sequential');\n\t\t\t}\n\t\t\tif (sbvrUtils.db.engine === Engines.postgres) {\n\t\t\t\treturn str + `$${bindNums[i]}`;\n\t\t\t}\n\t\t\treturn str + `?`;\n\t\t})\n\t\t.join('');\n\nexport const postRun = async (tx: Tx, model: ApiRootModel): Promise<void> => {\n\tconst { initSql } = model;\n\tif (initSql == null) {\n\t\treturn;\n\t}\n\n\tconst modelName = model.apiRoot;\n\n\tconst exists = await checkModelAlreadyExists(tx, modelName);\n\tif (!exists) {\n\t\t(sbvrUtils.api.migrations?.logger.info ?? console.info)(\n\t\t\t'First time executing, running init script',\n\t\t);\n\t\tawait Bluebird.using(lockMigrations(tx, modelName), async () => {\n\t\t\tawait tx.executeSql(initSql);\n\t\t});\n\t}\n};\n\nexport const run = async (tx: Tx, model: ApiRootModel): Promise<void> => {\n\tconst { migrations } = model;\n\tif (migrations == null || _.isEmpty(migrations)) {\n\t\treturn;\n\t}\n\n\tconst modelName = model.apiRoot;\n\n\t// migrations only run if the model has been executed before,\n\t// to make changes that can't be automatically applied\n\tconst exists = await checkModelAlreadyExists(tx, modelName);\n\tif (!exists) {\n\t\t(sbvrUtils.api.migrations?.logger.info ?? console.info)(\n\t\t\t'First time model has executed, skipping migrations',\n\t\t);\n\n\t\treturn await setExecutedMigrations(tx, modelName, Object.keys(migrations));\n\t}\n\tawait Bluebird.using(lockMigrations(tx, modelName), async () => {\n\t\tconst executedMigrations = await getExecutedMigrations(tx, modelName);\n\t\tconst pendingMigrations = filterAndSortPendingMigrations(\n\t\t\tmigrations,\n\t\t\texecutedMigrations,\n\t\t);\n\t\tif (pendingMigrations.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst newlyExecutedMigrations = await executeMigrations(\n\t\t\ttx,\n\t\t\tpendingMigrations,\n\t\t);\n\t\tawait setExecutedMigrations(tx, modelName, [\n\t\t\t...executedMigrations,\n\t\t\t...newlyExecutedMigrations,\n\t\t]);\n\t});\n};\n\nconst checkModelAlreadyExists = async (\n\ttx: Tx,\n\tmodelName: string,\n): Promise<boolean> => {\n\tconst result = await tx.tableList(\"name = 'migration'\");\n\tif (result.rows.length === 0) {\n\t\treturn false;\n\t}\n\tconst { rows } = await tx.executeSql(\n\t\tbinds`\nSELECT 1\nFROM \"model\"\nWHERE \"model\".\"is of-vocabulary\" = ${1}\nLIMIT 1`,\n\t\t[modelName],\n\t);\n\n\treturn rows.length > 0;\n};\n\nconst getExecutedMigrations = async (\n\ttx: Tx,\n\tmodelName: string,\n): Promise<string[]> => {\n\tconst { rows } = await tx.executeSql(\n\t\tbinds`\nSELECT \"migration\".\"executed migrations\" AS \"executed_migrations\"\nFROM \"migration\"\nWHERE \"migration\".\"model name\" = ${1}`,\n\t\t[modelName],\n\t);\n\n\tconst data = rows[0];\n\tif (data == null) {\n\t\treturn [];\n\t}\n\n\treturn JSON.parse(data.executed_migrations) as string[];\n};\n\nconst setExecutedMigrations = async (\n\ttx: Tx,\n\tmodelName: string,\n\texecutedMigrations: string[],\n): Promise<void> => {\n\tconst stringifiedMigrations = JSON.stringify(executedMigrations);\n\n\tconst result = await tx.tableList(\"name = 'migration'\");\n\tif (result.rows.length === 0) {\n\t\treturn;\n\t}\n\n\tconst { rowsAffected } = await tx.executeSql(\n\t\tbinds`\nUPDATE \"migration\"\nSET \"model name\" = ${1},\n\"executed migrations\" = ${2}\nWHERE \"migration\".\"model name\" = ${3}`,\n\t\t[modelName, stringifiedMigrations, modelName],\n\t);\n\n\tif (rowsAffected === 0) {\n\t\ttx.executeSql(\n\t\t\tbinds`\nINSERT INTO \"migration\" (\"model name\", \"executed migrations\")\nVALUES (${1}, ${2})`,\n\t\t\t[modelName, stringifiedMigrations],\n\t\t);\n\t}\n};\n\n// turns {\"key1\": migration, \"key3\": migration, \"key2\": migration}\n// into  [[\"key1\", migration], [\"key2\", migration], [\"key3\", migration]]\nconst filterAndSortPendingMigrations = (\n\tmigrations: NonNullable<Model['migrations']>,\n\texecutedMigrations: string[],\n): MigrationTuple[] =>\n\t(_(migrations).omit(executedMigrations) as _.Object<typeof migrations>)\n\t\t.toPairs()\n\t\t.sortBy(([migrationKey]) => migrationKey)\n\t\t.value();\n\nconst lockMigrations = (tx: Tx, modelName: string): Bluebird.Disposer<void> =>\n\tBluebird.try(async () => {\n\t\ttry {\n\t\t\tawait tx.executeSql(\n\t\t\t\tbinds`\nDELETE FROM \"migration lock\"\nWHERE \"model name\" = ${1}\nAND \"created at\" < ${2}`,\n\t\t\t\t[modelName, new Date(Date.now() - migratorEnv.lockTimeout)],\n\t\t\t);\n\t\t\tawait tx.executeSql(\n\t\t\t\tbinds`\nINSERT INTO \"migration lock\" (\"model name\")\nVALUES (${1})`,\n\t\t\t\t[modelName],\n\t\t\t);\n\t\t} catch (err) {\n\t\t\tawait Bluebird.delay(migratorEnv.lockFailDelay);\n\t\t\tthrow err;\n\t\t}\n\t}).disposer(async () => {\n\t\ttry {\n\t\t\tawait tx.executeSql(\n\t\t\t\tbinds`\nDELETE FROM \"migration lock\"\nWHERE \"model name\" = ${1}`,\n\t\t\t\t[modelName],\n\t\t\t);\n\t\t} catch {\n\t\t\t// We ignore errors here as it's mostly likely caused by the migration failing and\n\t\t\t// rolling back the transaction, and if we rethrow here we'll overwrite the real error\n\t\t\t// making it much harder for users to see what went wrong and fix it\n\t\t}\n\t});\n\nconst executeMigrations = async (\n\ttx: Tx,\n\tmigrations: MigrationTuple[] = [],\n): Promise<string[]> => {\n\ttry {\n\t\tfor (const migration of migrations) {\n\t\t\tawait executeMigration(tx, migration);\n\t\t}\n\t} catch (err) {\n\t\t(sbvrUtils.api.migrations?.logger.error ?? console.error)(\n\t\t\t'Error while executing migrations, rolled back',\n\t\t);\n\t\tthrow new MigrationError(err);\n\t}\n\treturn migrations.map(([migrationKey]) => migrationKey); // return migration keys\n};\n\nconst executeMigration = async (\n\ttx: Tx,\n\t[key, migration]: MigrationTuple,\n): Promise<void> => {\n\t(sbvrUtils.api.migrations?.logger.info ?? console.info)(\n\t\t`Running migration ${JSON.stringify(key)}`,\n\t);\n\n\tif (typeof migration === 'function') {\n\t\tawait migration(tx, sbvrUtils);\n\t} else if (typeof migration === 'string') {\n\t\tawait tx.executeSql(migration);\n\t} else {\n\t\tthrow new MigrationError(`Invalid migration type: ${typeof migration}`);\n\t}\n};\n\nexport const config: Config = {\n\tmodels: [\n\t\t{\n\t\t\tmodelName: 'migrations',\n\t\t\tapiRoot: 'migrations',\n\t\t\tmodelText,\n\t\t\tmigrations: {\n\t\t\t\t'11.0.0-modified-at': `\n\t\t\t\t\tALTER TABLE \"migration\"\n\t\t\t\t\tADD COLUMN IF NOT EXISTS \"modified at\" TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL;\n\t\t\t\t`,\n\t\t\t\t'11.0.1-modified-at': `\n\t\t\t\t\tALTER TABLE \"migration lock\"\n\t\t\t\t\tADD COLUMN IF NOT EXISTS \"modified at\" TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL;\n\t\t\t\t`,\n\t\t\t},\n\t\t},\n\t],\n};\n","// Generated by PEG.js v0.11.0-master.b7b87ea, https://pegjs.org/\n\n\"use strict\";\n\nfunction peg$subclass(child, parent) {\n  function C() { this.constructor = child; }\n  C.prototype = parent.prototype;\n  child.prototype = new C();\n}\n\nfunction peg$SyntaxError(message, expected, found, location) {\n  this.message = message;\n  this.expected = expected;\n  this.found = found;\n  this.location = location;\n  this.name = \"SyntaxError\";\n\n  // istanbul ignore next\n  if (typeof Error.captureStackTrace === \"function\") {\n    Error.captureStackTrace(this, peg$SyntaxError);\n  }\n}\n\npeg$subclass(peg$SyntaxError, Error);\n\npeg$SyntaxError.buildMessage = function(expected, found, location) {\n  var DESCRIBE_EXPECTATION_FNS = {\n    literal: function(expectation) {\n      return \"\\\"\" + literalEscape(expectation.text) + \"\\\"\";\n    },\n\n    class: function(expectation) {\n      var escapedParts = expectation.parts.map(function(part) {\n        return Array.isArray(part)\n          ? classEscape(part[0]) + \"-\" + classEscape(part[1])\n          : classEscape(part);\n      });\n\n      return \"[\" + (expectation.inverted ? \"^\" : \"\") + escapedParts + \"]\";\n    },\n\n    any: function() {\n      return \"any character\";\n    },\n\n    end: function() {\n      return \"end of input\";\n    },\n\n    other: function(expectation) {\n      return expectation.description;\n    },\n\n    not: function(expectation) {\n      return \"not \" + describeExpectation(expectation.expected);\n    }\n  };\n\n  function hex(ch) {\n    return ch.charCodeAt(0).toString(16).toUpperCase();\n  }\n\n  function literalEscape(s) {\n    return s\n      .replace(/\\\\/g, \"\\\\\\\\\")\n      .replace(/\"/g,  \"\\\\\\\"\")\n      .replace(/\\0/g, \"\\\\0\")\n      .replace(/\\t/g, \"\\\\t\")\n      .replace(/\\n/g, \"\\\\n\")\n      .replace(/\\r/g, \"\\\\r\")\n      .replace(/[\\x00-\\x0F]/g,          function(ch) { return \"\\\\x0\" + hex(ch); })\n      .replace(/[\\x10-\\x1F\\x7F-\\x9F]/g, function(ch) { return \"\\\\x\"  + hex(ch); });\n  }\n\n  function classEscape(s) {\n    return s\n      .replace(/\\\\/g, \"\\\\\\\\\")\n      .replace(/\\]/g, \"\\\\]\")\n      .replace(/\\^/g, \"\\\\^\")\n      .replace(/-/g,  \"\\\\-\")\n      .replace(/\\0/g, \"\\\\0\")\n      .replace(/\\t/g, \"\\\\t\")\n      .replace(/\\n/g, \"\\\\n\")\n      .replace(/\\r/g, \"\\\\r\")\n      .replace(/[\\x00-\\x0F]/g,          function(ch) { return \"\\\\x0\" + hex(ch); })\n      .replace(/[\\x10-\\x1F\\x7F-\\x9F]/g, function(ch) { return \"\\\\x\"  + hex(ch); });\n  }\n\n  function describeExpectation(expectation) {\n    return DESCRIBE_EXPECTATION_FNS[expectation.type](expectation);\n  }\n\n  function describeExpected(expected) {\n    var descriptions = expected.map(describeExpectation);\n    var i, j;\n\n    descriptions.sort();\n\n    if (descriptions.length > 0) {\n      for (i = 1, j = 1; i < descriptions.length; i++) {\n        if (descriptions[i - 1] !== descriptions[i]) {\n          descriptions[j] = descriptions[i];\n          j++;\n        }\n      }\n      descriptions.length = j;\n    }\n\n    switch (descriptions.length) {\n      case 1:\n        return descriptions[0];\n\n      case 2:\n        return descriptions[0] + \" or \" + descriptions[1];\n\n      default:\n        return descriptions.slice(0, -1).join(\", \")\n          + \", or \"\n          + descriptions[descriptions.length - 1];\n    }\n  }\n\n  function describeFound(found) {\n    return found ? \"\\\"\" + literalEscape(found) + \"\\\"\" : \"end of input\";\n  }\n\n  return \"Expected \" + describeExpected(expected) + \" but \" + describeFound(found) + \" found.\";\n};\n\nfunction peg$parse(input, options) {\n  options = options !== undefined ? options : {};\n\n  var peg$FAILED = {};\n\n  var peg$startRuleFunctions = { Process: peg$parseProcess, ProcessRule: peg$parseProcessRule };\n  var peg$startRuleFunction = peg$parseProcess;\n\n  var peg$c0 = \"/$metadata\";\n  var peg$c1 = \"/\";\n  var peg$c2 = \"&\";\n  var peg$c3 = \"$\";\n  var peg$c4 = \"%24\";\n  var peg$c5 = \"@\";\n  var peg$c6 = \"=\";\n  var peg$c7 = \"orderby=\";\n  var peg$c8 = \",\";\n  var peg$c9 = \"asc\";\n  var peg$c10 = \"desc\";\n  var peg$c11 = \"top=\";\n  var peg$c12 = \"skip=\";\n  var peg$c13 = \"inlinecount=\";\n  var peg$c14 = \"allpages\";\n  var peg$c15 = \"none\";\n  var peg$c16 = \"count=\";\n  var peg$c17 = \"expand=\";\n  var peg$c18 = \"select=\";\n  var peg$c19 = \"*\";\n  var peg$c20 = \"filter=\";\n  var peg$c21 = \"+\";\n  var peg$c22 = \"json\";\n  var peg$c23 = \"atom\";\n  var peg$c24 = \"xml\";\n  var peg$c25 = \"format=\";\n  var peg$c26 = \";\";\n  var peg$c27 = \"odata.\";\n  var peg$c28 = \"metadata=\";\n  var peg$c29 = \"minimal\";\n  var peg$c30 = \"full\";\n  var peg$c31 = \"in\";\n  var peg$c32 = \"(\";\n  var peg$c33 = \")\";\n  var peg$c34 = \"eq\";\n  var peg$c35 = \"ne\";\n  var peg$c36 = \"gt\";\n  var peg$c37 = \"ge\";\n  var peg$c38 = \"lt\";\n  var peg$c39 = \"le\";\n  var peg$c40 = \"and\";\n  var peg$c41 = \"or\";\n  var peg$c42 = \"sub\";\n  var peg$c43 = \"add\";\n  var peg$c44 = \"mod\";\n  var peg$c45 = \"div\";\n  var peg$c46 = \"mul\";\n  var peg$c47 = \"not\";\n  var peg$c48 = \"cast\";\n  var peg$c49 = \"ceiling\";\n  var peg$c50 = \"concat\";\n  var peg$c51 = \"contains\";\n  var peg$c52 = \"date\";\n  var peg$c53 = \"day\";\n  var peg$c54 = \"endswith\";\n  var peg$c55 = \"floor\";\n  var peg$c56 = \"fractionalseconds\";\n  var peg$c57 = \"hour\";\n  var peg$c58 = \"indexof\";\n  var peg$c59 = \"isof\";\n  var peg$c60 = \"length\";\n  var peg$c61 = \"maxdatetime\";\n  var peg$c62 = \"mindatetime\";\n  var peg$c63 = \"minute\";\n  var peg$c64 = \"month\";\n  var peg$c65 = \"now\";\n  var peg$c66 = \"replace\";\n  var peg$c67 = \"round\";\n  var peg$c68 = \"second\";\n  var peg$c69 = \"startswith\";\n  var peg$c70 = \"substringof\";\n  var peg$c71 = \"substring\";\n  var peg$c72 = \"time\";\n  var peg$c73 = \"tolower\";\n  var peg$c74 = \"totaloffsetminutes\";\n  var peg$c75 = \"totalseconds\";\n  var peg$c76 = \"toupper\";\n  var peg$c77 = \"trim\";\n  var peg$c78 = \"year\";\n  var peg$c79 = \"any\";\n  var peg$c80 = \"all\";\n  var peg$c81 = \":\";\n  var peg$c82 = \"/$count\";\n  var peg$c83 = \"/$links\";\n  var peg$c84 = \"?\";\n  var peg$c85 = \".\";\n  var peg$c86 = \"null\";\n  var peg$c87 = \"true\";\n  var peg$c88 = \"false\";\n  var peg$c89 = \"duration\";\n  var peg$c90 = \"P\";\n  var peg$c91 = \"D\";\n  var peg$c92 = \"T\";\n  var peg$c93 = \"H\";\n  var peg$c94 = \"M\";\n  var peg$c95 = \"S\";\n  var peg$c96 = \"%2B\";\n  var peg$c97 = \"-\";\n  var peg$c98 = \"'\";\n  var peg$c99 = \"%27\";\n  var peg$c100 = \"datetime\";\n  var peg$c101 = \" \";\n  var peg$c102 = \"%20\";\n\n  var peg$r0 = /^[a-z]/i;\n  var peg$r1 = /^[&;]/;\n  var peg$r2 = /^[^:\\/?#[\\]@!$*&()+,;= %]/;\n  var peg$r3 = /^[0-9]/;\n  var peg$r4 = /^[^:\\/?#[\\]@!$*&()+,;=]/;\n\n  var peg$e0 = peg$literalExpectation(\"/$metadata\", false);\n  var peg$e1 = peg$literalExpectation(\"/\", false);\n  var peg$e2 = peg$literalExpectation(\"&\", false);\n  var peg$e3 = peg$otherExpectation(\"$ query options\");\n  var peg$e4 = peg$literalExpectation(\"@\", false);\n  var peg$e5 = peg$literalExpectation(\"=\", false);\n  var peg$e6 = peg$literalExpectation(\"orderby=\", false);\n  var peg$e7 = peg$literalExpectation(\",\", false);\n  var peg$e8 = peg$literalExpectation(\"asc\", false);\n  var peg$e9 = peg$literalExpectation(\"desc\", false);\n  var peg$e10 = peg$literalExpectation(\"top=\", false);\n  var peg$e11 = peg$literalExpectation(\"skip=\", false);\n  var peg$e12 = peg$literalExpectation(\"inlinecount=\", false);\n  var peg$e13 = peg$literalExpectation(\"allpages\", false);\n  var peg$e14 = peg$literalExpectation(\"none\", false);\n  var peg$e15 = peg$literalExpectation(\"count=\", false);\n  var peg$e16 = peg$literalExpectation(\"expand=\", false);\n  var peg$e17 = peg$literalExpectation(\"select=\", false);\n  var peg$e18 = peg$literalExpectation(\"*\", false);\n  var peg$e19 = peg$literalExpectation(\"filter=\", false);\n  var peg$e20 = peg$classExpectation([[\"a\", \"z\"]], false, true);\n  var peg$e21 = peg$literalExpectation(\"+\", false);\n  var peg$e22 = peg$literalExpectation(\"json\", false);\n  var peg$e23 = peg$literalExpectation(\"atom\", false);\n  var peg$e24 = peg$literalExpectation(\"xml\", false);\n  var peg$e25 = peg$literalExpectation(\"format=\", false);\n  var peg$e26 = peg$literalExpectation(\";\", false);\n  var peg$e27 = peg$literalExpectation(\"odata.\", false);\n  var peg$e28 = peg$literalExpectation(\"metadata=\", false);\n  var peg$e29 = peg$literalExpectation(\"minimal\", false);\n  var peg$e30 = peg$literalExpectation(\"full\", false);\n  var peg$e31 = peg$literalExpectation(\"in\", false);\n  var peg$e32 = peg$literalExpectation(\"(\", false);\n  var peg$e33 = peg$literalExpectation(\")\", false);\n  var peg$e34 = peg$literalExpectation(\"eq\", false);\n  var peg$e35 = peg$literalExpectation(\"ne\", false);\n  var peg$e36 = peg$literalExpectation(\"gt\", false);\n  var peg$e37 = peg$literalExpectation(\"ge\", false);\n  var peg$e38 = peg$literalExpectation(\"lt\", false);\n  var peg$e39 = peg$literalExpectation(\"le\", false);\n  var peg$e40 = peg$literalExpectation(\"and\", false);\n  var peg$e41 = peg$literalExpectation(\"or\", false);\n  var peg$e42 = peg$literalExpectation(\"sub\", false);\n  var peg$e43 = peg$literalExpectation(\"add\", false);\n  var peg$e44 = peg$literalExpectation(\"mod\", false);\n  var peg$e45 = peg$literalExpectation(\"div\", false);\n  var peg$e46 = peg$literalExpectation(\"mul\", false);\n  var peg$e47 = peg$literalExpectation(\"not\", false);\n  var peg$e48 = peg$literalExpectation(\"cast\", false);\n  var peg$e49 = peg$literalExpectation(\"ceiling\", false);\n  var peg$e50 = peg$literalExpectation(\"concat\", false);\n  var peg$e51 = peg$literalExpectation(\"contains\", false);\n  var peg$e52 = peg$literalExpectation(\"date\", false);\n  var peg$e53 = peg$literalExpectation(\"day\", false);\n  var peg$e54 = peg$literalExpectation(\"endswith\", false);\n  var peg$e55 = peg$literalExpectation(\"floor\", false);\n  var peg$e56 = peg$literalExpectation(\"fractionalseconds\", false);\n  var peg$e57 = peg$literalExpectation(\"hour\", false);\n  var peg$e58 = peg$literalExpectation(\"indexof\", false);\n  var peg$e59 = peg$literalExpectation(\"isof\", false);\n  var peg$e60 = peg$literalExpectation(\"length\", false);\n  var peg$e61 = peg$literalExpectation(\"maxdatetime\", false);\n  var peg$e62 = peg$literalExpectation(\"mindatetime\", false);\n  var peg$e63 = peg$literalExpectation(\"minute\", false);\n  var peg$e64 = peg$literalExpectation(\"month\", false);\n  var peg$e65 = peg$literalExpectation(\"now\", false);\n  var peg$e66 = peg$literalExpectation(\"replace\", false);\n  var peg$e67 = peg$literalExpectation(\"round\", false);\n  var peg$e68 = peg$literalExpectation(\"second\", false);\n  var peg$e69 = peg$literalExpectation(\"startswith\", false);\n  var peg$e70 = peg$literalExpectation(\"substringof\", false);\n  var peg$e71 = peg$literalExpectation(\"substring\", false);\n  var peg$e72 = peg$literalExpectation(\"time\", false);\n  var peg$e73 = peg$literalExpectation(\"tolower\", false);\n  var peg$e74 = peg$literalExpectation(\"totaloffsetminutes\", false);\n  var peg$e75 = peg$literalExpectation(\"totalseconds\", false);\n  var peg$e76 = peg$literalExpectation(\"toupper\", false);\n  var peg$e77 = peg$literalExpectation(\"trim\", false);\n  var peg$e78 = peg$literalExpectation(\"year\", false);\n  var peg$e79 = peg$literalExpectation(\"any\", false);\n  var peg$e80 = peg$literalExpectation(\"all\", false);\n  var peg$e81 = peg$literalExpectation(\":\", false);\n  var peg$e82 = peg$literalExpectation(\"/$count\", false);\n  var peg$e83 = peg$classExpectation([\"&\", \";\"], false, false);\n  var peg$e84 = peg$literalExpectation(\"/$links\", false);\n  var peg$e85 = peg$literalExpectation(\"?\", false);\n  var peg$e86 = peg$classExpectation([\":\", \"/\", \"?\", \"#\", \"[\", \"]\", \"@\", \"!\", \"$\", \"*\", \"&\", \"(\", \")\", \"+\", \",\", \";\", \"=\", \" \", \"%\"], true, false);\n  var peg$e87 = peg$classExpectation([[\"0\", \"9\"]], false, false);\n  var peg$e88 = peg$literalExpectation(\".\", false);\n  var peg$e89 = peg$literalExpectation(\"null\", false);\n  var peg$e90 = peg$literalExpectation(\"true\", false);\n  var peg$e91 = peg$literalExpectation(\"false\", false);\n  var peg$e92 = peg$literalExpectation(\"duration\", false);\n  var peg$e93 = peg$literalExpectation(\"P\", false);\n  var peg$e94 = peg$literalExpectation(\"D\", false);\n  var peg$e95 = peg$literalExpectation(\"T\", false);\n  var peg$e96 = peg$literalExpectation(\"H\", false);\n  var peg$e97 = peg$literalExpectation(\"M\", false);\n  var peg$e98 = peg$literalExpectation(\"S\", false);\n  var peg$e99 = peg$classExpectation([\":\", \"/\", \"?\", \"#\", \"[\", \"]\", \"@\", \"!\", \"$\", \"*\", \"&\", \"(\", \")\", \"+\", \",\", \";\", \"=\"], true, false);\n  var peg$e100 = peg$literalExpectation(\"%2B\", false);\n  var peg$e101 = peg$literalExpectation(\"-\", false);\n  var peg$e102 = peg$literalExpectation(\"'\", false);\n  var peg$e103 = peg$literalExpectation(\"%27\", false);\n  var peg$e104 = peg$anyExpectation();\n  var peg$e105 = peg$literalExpectation(\"datetime\", false);\n  var peg$e106 = peg$literalExpectation(\"$\", false);\n  var peg$e107 = peg$literalExpectation(\" \", false);\n  var peg$e108 = peg$literalExpectation(\"%20\", false);\n\n  var peg$f0 = function() {reset(); return true;};\n  var peg$f1 = function(tree) { return { tree: tree, binds: binds } };\n  var peg$f2 = function() {\n  \t\treset();\n  \t\tvar tree = eval(`peg$parse${options.rule}()`);\n  \t\treturn {\n  \t\t\ttree,\n  \t\t\tbinds\n  \t\t}\n  \t};\n  var peg$f3 = function(model) { return model };\n  var peg$f4 = function() { return { resource: '$metadata' } };\n  var peg$f5 = function() { return { resource: '$serviceroot' } };\n  var peg$f6 = function(option, options) { return CollapseObjectArray([option, ...options]) };\n  var peg$f7 = function(name, n) { return [ 'Real', n ] };\n  var peg$f8 = function(name, b) { return [ 'Boolean', b ] };\n  var peg$f9 = function(name, s) { return [ 'Text', s ] };\n  var peg$f10 = function(name, value) { return !binds['@' + name] };\n  var peg$f11 = function(name, value) {\n  \t\tbinds['@' + name] = value\n  \t\treturn {\n  \t\t\tname: '@' + name,\n  \t\t\tvalue: value\n  \t\t}\n  \t};\n  var peg$f12 = function(name, value) { return { name: name, value: value } };\n  var peg$f13 = function(property, properties) { return { name: '$orderby', value: { properties: [property, ...properties] } } };\n  var peg$f14 = function(property) { return 'desc' };\n  var peg$f15 = function(property, order) {\n  \t\tproperty.order = order;\n  \t\treturn property\n  \t};\n  var peg$f16 = function(value) { return { name: '$top', value: value } };\n  var peg$f17 = function(value) { return { name: '$skip', value: value } };\n  var peg$f18 = function() { return '' };\n  var peg$f19 = function(value) { return { name: '$inlinecount', value: value } };\n  var peg$f20 = function(value) { return { name: '$count', value: value } };\n  var peg$f21 = function(properties) { return { name: '$expand', value: { properties: properties } } };\n  var peg$f22 = function(properties) { return { properties: properties } };\n  var peg$f23 = function(value) { return { name: '$select', value: value } };\n  var peg$f24 = function(expr) { return { name: '$filter', value: expr } };\n  var peg$f25 = function(type, metadata) { return { name: '$format', value: { type, metadata } } };\n  var peg$f26 = function(type) { return { name: '$format', value: type } };\n  var peg$f27 = function() {\n  \t\tprecedence = 0;\n  \t};\n  var peg$f28 = function() {\n  \t\t\treturn precedence;\n  \t\t};\n  var peg$f29 = function(minPrecedence, x) { return [x] };\n  var peg$f30 = function(minPrecedence, lhs, op) {\n  \t\t\t\tprecedence = operatorPrecedence[op] + 1\n  \t\t\t\treturn precedence > minPrecedence\n  \t\t\t};\n  var peg$f31 = function(minPrecedence, lhs, op, rhs) {\n  \t\t\t\tif (Array.isArray(lhs[0]) && op === lhs[0][0]) {\n  \t\t\t\t\tlhs[0].push(rhs);\n  \t\t\t\t} else {\n  \t\t\t\t\tlhs[0] = [ op, lhs[0], rhs ];\n  \t\t\t\t}\n  \t\t\t};\n  var peg$f32 = function(minPrecedence, lhs, op, rhs) {lhs[0] = [ op, lhs[0], rhs ]};\n  var peg$f33 = function(minPrecedence, lhs) { return lhs[0] };\n  var peg$f34 = function(minPrecedence) {return minPrecedence > 0};\n  var peg$f35 = function(minPrecedence) {\n  \t\t\tprecedence = 0;\n  \t\t\treturn peg$parseFilterByExpressionLoop()\n  \t\t};\n  var peg$f36 = function(first, rest) { return [ first, ...rest ] };\n  var peg$f37 = function(methodName, first, rest) { return [ first, ...rest ] };\n  var peg$f38 = function(methodName) { return [] };\n  var peg$f39 = function(methodName, args) { return args.length === methods[methodName] || (Array.isArray(methods[methodName]) && methods[methodName].includes(args.length)) };\n  var peg$f40 = function(methodName, args) { return [ 'call', { args: args, method: methodName } ] };\n  var peg$f41 = function(name, identifier, expression) { return { expression: expression, identifier: identifier, method: name } };\n  var peg$f42 = function(path, paths) { return [path, ...paths] };\n  var peg$f43 = function(resource, property) { return true };\n  var peg$f44 = function(resource, property, count) { return { name: resource, property, count } };\n  var peg$f45 = function(resource) { return true };\n  var peg$f46 = function(resource, count, option, options) { return CollapseObjectArray([option, ...options]) };\n  var peg$f47 = function(resource, count) { return {} };\n  var peg$f48 = function(resource, count, optionsObj, next) { return { name: resource, property: next, count: count, options: optionsObj} };\n  var peg$f49 = function(resource, next) { return { name: resource, property: next } };\n  var peg$f50 = function(resource, lambda) { return { name: resource, lambda: lambda } };\n  var peg$f51 = function(resource, method) { return { name: resource, method: method } };\n  var peg$f52 = function(keyBind, keyBinds) { return CollapseObjectArray([keyBind, ...keyBinds]) };\n  var peg$f53 = function(name, value) { return { name, value }};\n  var peg$f54 = function(resource) { return { resource } };\n  var peg$f55 = function(result, key) { result.key = key };\n  var peg$f56 = function(result, link) {result.link = link};\n  var peg$f57 = function(result, property) {result.property = property};\n  var peg$f58 = function(result) {result.count = true};\n  var peg$f59 = function(result) { return result };\n  var peg$f60 = function(result, options) {result.options = options};\n  var peg$f61 = function(resourceName) { return decodeURIComponent(resourceName) };\n  var peg$f62 = function(sign, d) { return Number(sign + d) };\n  var peg$f63 = function(d) { return parseInt(d, 10) };\n  var peg$f64 = function() { return null };\n  var peg$f65 = function() { return true };\n  var peg$f66 = function() { return false };\n  var peg$f67 = function(sign, day, hour, minute, second) {return hour || minute || second};\n  var peg$f68 = function(sign, day, hour, minute, second) {\n  \t\t\treturn {\n  \t\t\t\thour: hour || undefined,\n  \t\t\t\tminute: minute || undefined,\n  \t\t\t\tsecond: second || undefined\n  \t\t\t}\n  \t\t};\n  var peg$f69 = function(sign, day, time) {return day || time};\n  var peg$f70 = function(sign, day, time) { return {\n  \t\tnegative: sign === '-',\n  \t\tday: day || undefined,\n  \t\thour: time ? time.hour : undefined,\n  \t\tminute: time ? time.minute : undefined,\n  \t\tsecond: time ? time.second : undefined,\n  \t} };\n  var peg$f71 = function(d) { return Number(d) };\n  var peg$f72 = function(text) { return decodeURIComponent(text) };\n  var peg$f73 = function() { return '+' };\n  var peg$f74 = function() { return '\\'' };\n  var peg$f75 = function(text) { return decodeURIComponent(text.join('')) };\n  var peg$f76 = function(param) { return { bind: '@' + param } };\n  var peg$f77 = function(n) { return Bind('Real', n) };\n  var peg$f78 = function() { return 'Date Time' };\n  var peg$f79 = function() { return 'Date' };\n  var peg$f80 = function(type, date) { return Date.parse(date) };\n  var peg$f81 = function(type, date) { return isNaN(date) };\n  var peg$f82 = function(type, date) { return [type, date] };\n  var peg$f83 = function(d) { return Bind(d[0], d[1]) };\n  var peg$f84 = function(b) { return Bind('Boolean', b) };\n  var peg$f85 = function(resource) {\n  \t\tvar bind = Bind('ContentReference', resource)\n  \t\treturn { resource: bind, key: bind }\n  \t};\n  var peg$f86 = function(t) { return Bind('Text', t) };\n\n  var peg$currPos = 0;\n  var peg$savedPos = 0;\n  var peg$posDetailsCache = [{ line: 1, column: 1 }];\n  var peg$expected = [];\n  var peg$silentFails = 0;\n\n  var peg$resultsCache = {};\n\n  var peg$result;\n\n  if (\"startRule\" in options) {\n    if (!(options.startRule in peg$startRuleFunctions)) {\n      throw new Error(\"Can't start parsing from rule \\\"\" + options.startRule + \"\\\".\");\n    }\n\n    peg$startRuleFunction = peg$startRuleFunctions[options.startRule];\n  }\n\n  function peg$literalExpectation(text, ignoreCase) {\n    return { type: \"literal\", text: text, ignoreCase: ignoreCase };\n  }\n\n  function peg$classExpectation(parts, inverted, ignoreCase) {\n    return { type: \"class\", parts: parts, inverted: inverted, ignoreCase: ignoreCase };\n  }\n\n  function peg$anyExpectation() {\n    return { type: \"any\" };\n  }\n\n  function peg$endExpectation() {\n    return { type: \"end\" };\n  }\n\n  function peg$otherExpectation(description) {\n    return { type: \"other\", description: description };\n  }\n\n  function peg$computePosDetails(pos) {\n    var details = peg$posDetailsCache[pos];\n    var p;\n\n    if (details) {\n      return details;\n    } else {\n      p = pos - 1;\n      while (!peg$posDetailsCache[p]) {\n        p--;\n      }\n\n      details = peg$posDetailsCache[p];\n      details = {\n        line: details.line,\n        column: details.column\n      };\n\n      while (p < pos) {\n        if (input.charCodeAt(p) === 10) {\n          details.line++;\n          details.column = 1;\n        } else {\n          details.column++;\n        }\n\n        p++;\n      }\n\n      peg$posDetailsCache[pos] = details;\n\n      return details;\n    }\n  }\n\n\n  function peg$computeLocation(startPos, endPos) {\n    var loc = {};\n\n\n\n    var startPosDetails = peg$computePosDetails(startPos);\n    loc.start = {\n      offset: startPos,\n      line: startPosDetails.line,\n      column: startPosDetails.column\n    };\n\n    var endPosDetails = peg$computePosDetails(endPos);\n    loc.end = {\n      offset: endPos,\n      line: endPosDetails.line,\n      column: endPosDetails.column\n    };\n\n    return loc;\n  }\n\n  function peg$begin() {\n    peg$expected.push({ pos: peg$currPos, variants: [] });\n  }\n\n  function peg$expect(expected) {\n    var top = peg$expected[peg$expected.length - 1];\n\n    if (peg$currPos < top.pos) { return; }\n\n    if (peg$currPos > top.pos) {\n      top.pos = peg$currPos;\n      top.variants = [];\n    }\n\n    top.variants.push(expected);\n  }\n\n  function peg$end(invert) {\n    var expected = peg$expected.pop();\n    var top = peg$expected[peg$expected.length - 1];\n    var variants = expected.variants;\n\n    if (top.pos !== expected.pos) { return; }\n\n    if (invert) {\n      variants = variants.map(function(e) {\n        return e.type === \"not\" ? e.expected : { type: \"not\", expected: e };\n      });\n    }\n\n    Array.prototype.push.apply(top.variants, variants);\n  }\n\n  function peg$buildSimpleError(message, location) {\n    return new peg$SyntaxError(message, null, null, location);\n  }\n\n  function peg$buildStructuredError(expected, found, location) {\n    return new peg$SyntaxError(\n      peg$SyntaxError.buildMessage(expected, found, location),\n      expected,\n      found,\n      location\n    );\n  }\n\n  function peg$buildError() {\n    var expected = peg$expected[0];\n    var failPos = expected.pos;\n\n    return peg$buildStructuredError(\n      expected.variants,\n      failPos < input.length ? input.charAt(failPos) : null,\n      failPos < input.length\n        ? peg$computeLocation(failPos, failPos + 1)\n        : peg$computeLocation(failPos, failPos)\n    );\n  }\n\n  function peg$parseProcess() {\n    var s0, s1, s2;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 0;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    peg$savedPos = peg$currPos;\n    s1 = peg$f0();\n    if (s1) {\n      s1 = undefined;\n    } else {\n      s1 = peg$FAILED;\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = peg$parseOData();\n      if (s2 !== peg$FAILED) {\n        peg$savedPos = s0;\n        s0 = peg$f1(s2);\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseProcessRule() {\n    var s0, s1;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 1;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    s1 = '';\n    peg$savedPos = s0;\n    s1 = peg$f2();\n    s0 = s1;\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseOData() {\n    var s0, s1;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 2;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    s1 = peg$parsePathSegment();\n    if (s1 !== peg$FAILED) {\n      peg$savedPos = s0;\n      s1 = peg$f3(s1);\n    }\n    s0 = s1;\n    if (s0 === peg$FAILED) {\n      s0 = peg$currPos;\n      rule$expects(peg$e0);\n      if (input.substr(peg$currPos, 10) === peg$c0) {\n        s1 = peg$c0;\n        peg$currPos += 10;\n      } else {\n        s1 = peg$FAILED;\n      }\n      if (s1 !== peg$FAILED) {\n        peg$savedPos = s0;\n        s1 = peg$f4();\n      }\n      s0 = s1;\n      if (s0 === peg$FAILED) {\n        s0 = peg$currPos;\n        rule$expects(peg$e1);\n        if (input.charCodeAt(peg$currPos) === 47) {\n          s1 = peg$c1;\n          peg$currPos++;\n        } else {\n          s1 = peg$FAILED;\n        }\n        if (s1 !== peg$FAILED) {\n          peg$savedPos = s0;\n          s1 = peg$f5();\n        }\n        s0 = s1;\n      }\n    }\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseQueryOptions() {\n    var s0, s1, s2, s3, s4, s5;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 3;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    s1 = peg$parseQueryOption();\n    if (s1 !== peg$FAILED) {\n      s2 = [];\n      s3 = peg$currPos;\n      rule$expects(peg$e2);\n      if (input.charCodeAt(peg$currPos) === 38) {\n        s4 = peg$c2;\n        peg$currPos++;\n      } else {\n        s4 = peg$FAILED;\n      }\n      if (s4 !== peg$FAILED) {\n        s5 = peg$parseQueryOption();\n        if (s5 !== peg$FAILED) {\n          s3 = s5;\n        } else {\n          peg$currPos = s3;\n          s3 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s3;\n        s3 = peg$FAILED;\n      }\n      while (s3 !== peg$FAILED) {\n        s2.push(s3);\n        s3 = peg$currPos;\n        rule$expects(peg$e2);\n        if (input.charCodeAt(peg$currPos) === 38) {\n          s4 = peg$c2;\n          peg$currPos++;\n        } else {\n          s4 = peg$FAILED;\n        }\n        if (s4 !== peg$FAILED) {\n          s5 = peg$parseQueryOption();\n          if (s5 !== peg$FAILED) {\n            s3 = s5;\n          } else {\n            peg$currPos = s3;\n            s3 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s3;\n          s3 = peg$FAILED;\n        }\n      }\n      peg$savedPos = s0;\n      s0 = peg$f6(s1, s2);\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseQueryOption() {\n    var s0, s1, s2;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 4;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    s1 = peg$parseDollar();\n    if (s1 !== peg$FAILED) {\n      s2 = peg$parseSelectOption();\n      if (s2 === peg$FAILED) {\n        s2 = peg$parseFilterByOption();\n        if (s2 === peg$FAILED) {\n          s2 = peg$parseExpandOption();\n          if (s2 === peg$FAILED) {\n            s2 = peg$parseSortOption();\n            if (s2 === peg$FAILED) {\n              s2 = peg$parseTopOption();\n              if (s2 === peg$FAILED) {\n                s2 = peg$parseSkipOption();\n                if (s2 === peg$FAILED) {\n                  s2 = peg$parseCountOption();\n                  if (s2 === peg$FAILED) {\n                    s2 = peg$parseInlineCountOption();\n                    if (s2 === peg$FAILED) {\n                      s2 = peg$parseFormatOption();\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n      if (s2 !== peg$FAILED) {\n        s0 = s2;\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n    if (s0 === peg$FAILED) {\n      s0 = peg$parseOperationParam();\n      if (s0 === peg$FAILED) {\n        s0 = peg$parseParameterAliasOption();\n      }\n    }\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseDollar() {\n    var s0;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 5;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    rule$expects(peg$e3);\n    peg$silentFails++;\n    if (input.charCodeAt(peg$currPos) === 36) {\n      s0 = peg$c3;\n      peg$currPos++;\n    } else {\n      s0 = peg$FAILED;\n    }\n    if (s0 === peg$FAILED) {\n      if (input.substr(peg$currPos, 3) === peg$c4) {\n        s0 = peg$c4;\n        peg$currPos += 3;\n      } else {\n        s0 = peg$FAILED;\n      }\n    }\n    peg$silentFails--;\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseParameterAliasOption() {\n    var s0, s1, s2, s3, s4, s5;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 6;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    rule$expects(peg$e4);\n    if (input.charCodeAt(peg$currPos) === 64) {\n      s1 = peg$c5;\n      peg$currPos++;\n    } else {\n      s1 = peg$FAILED;\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = peg$parseText();\n      rule$expects(peg$e5);\n      if (input.charCodeAt(peg$currPos) === 61) {\n        s3 = peg$c6;\n        peg$currPos++;\n      } else {\n        s3 = peg$FAILED;\n      }\n      if (s3 !== peg$FAILED) {\n        s4 = peg$currPos;\n        s5 = peg$parseNumber();\n        if (s5 !== peg$FAILED) {\n          peg$savedPos = s4;\n          s5 = peg$f7(s2, s5);\n        }\n        s4 = s5;\n        if (s4 === peg$FAILED) {\n          s4 = peg$currPos;\n          s5 = peg$parseBoolean();\n          if (s5 !== peg$FAILED) {\n            peg$savedPos = s4;\n            s5 = peg$f8(s2, s5);\n          }\n          s4 = s5;\n          if (s4 === peg$FAILED) {\n            s4 = peg$currPos;\n            s5 = peg$parseQuotedText();\n            if (s5 !== peg$FAILED) {\n              peg$savedPos = s4;\n              s5 = peg$f9(s2, s5);\n            }\n            s4 = s5;\n            if (s4 === peg$FAILED) {\n              s4 = peg$parseDate();\n            }\n          }\n        }\n        if (s4 !== peg$FAILED) {\n          peg$savedPos = peg$currPos;\n          s5 = peg$f10(s2, s4);\n          if (s5) {\n            s5 = undefined;\n          } else {\n            s5 = peg$FAILED;\n          }\n          if (s5 !== peg$FAILED) {\n            peg$savedPos = s0;\n            s0 = peg$f11(s2, s4);\n          } else {\n            peg$currPos = s0;\n            s0 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseOperationParam() {\n    var s0, s1, s2, s3;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 7;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    s1 = peg$parseText();\n    rule$expects(peg$e5);\n    if (input.charCodeAt(peg$currPos) === 61) {\n      s2 = peg$c6;\n      peg$currPos++;\n    } else {\n      s2 = peg$FAILED;\n    }\n    if (s2 !== peg$FAILED) {\n      s3 = peg$parseText();\n      peg$savedPos = s0;\n      s0 = peg$f12(s1, s3);\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseSortOption() {\n    var s0, s1, s2, s3, s4, s5, s6;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 8;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    rule$expects(peg$e6);\n    if (input.substr(peg$currPos, 8) === peg$c7) {\n      s1 = peg$c7;\n      peg$currPos += 8;\n    } else {\n      s1 = peg$FAILED;\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = peg$parseSortProperty();\n      if (s2 !== peg$FAILED) {\n        s3 = [];\n        s4 = peg$currPos;\n        rule$expects(peg$e7);\n        if (input.charCodeAt(peg$currPos) === 44) {\n          s5 = peg$c8;\n          peg$currPos++;\n        } else {\n          s5 = peg$FAILED;\n        }\n        if (s5 !== peg$FAILED) {\n          s6 = peg$parseSortProperty();\n          if (s6 !== peg$FAILED) {\n            s4 = s6;\n          } else {\n            peg$currPos = s4;\n            s4 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s4;\n          s4 = peg$FAILED;\n        }\n        while (s4 !== peg$FAILED) {\n          s3.push(s4);\n          s4 = peg$currPos;\n          rule$expects(peg$e7);\n          if (input.charCodeAt(peg$currPos) === 44) {\n            s5 = peg$c8;\n            peg$currPos++;\n          } else {\n            s5 = peg$FAILED;\n          }\n          if (s5 !== peg$FAILED) {\n            s6 = peg$parseSortProperty();\n            if (s6 !== peg$FAILED) {\n              s4 = s6;\n            } else {\n              peg$currPos = s4;\n              s4 = peg$FAILED;\n            }\n          } else {\n            peg$currPos = s4;\n            s4 = peg$FAILED;\n          }\n        }\n        peg$savedPos = s0;\n        s0 = peg$f13(s2, s3);\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseSortProperty() {\n    var s0, s1, s2, s3, s4;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 9;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    s1 = peg$parsePropertyPath();\n    if (s1 !== peg$FAILED) {\n      s2 = peg$parsespaces();\n      rule$expects(peg$e8);\n      if (input.substr(peg$currPos, 3) === peg$c9) {\n        s3 = peg$c9;\n        peg$currPos += 3;\n      } else {\n        s3 = peg$FAILED;\n      }\n      if (s3 === peg$FAILED) {\n        rule$expects(peg$e9);\n        if (input.substr(peg$currPos, 4) === peg$c10) {\n          s3 = peg$c10;\n          peg$currPos += 4;\n        } else {\n          s3 = peg$FAILED;\n        }\n        if (s3 === peg$FAILED) {\n          s3 = peg$currPos;\n          s4 = '';\n          peg$savedPos = s3;\n          s4 = peg$f14(s1);\n          s3 = s4;\n        }\n      }\n      if (s3 !== peg$FAILED) {\n        peg$savedPos = s0;\n        s0 = peg$f15(s1, s3);\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseTopOption() {\n    var s0, s1, s2;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 10;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    rule$expects(peg$e10);\n    if (input.substr(peg$currPos, 4) === peg$c11) {\n      s1 = peg$c11;\n      peg$currPos += 4;\n    } else {\n      s1 = peg$FAILED;\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = peg$parseUnsignedInteger();\n      if (s2 !== peg$FAILED) {\n        peg$savedPos = s0;\n        s0 = peg$f16(s2);\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseSkipOption() {\n    var s0, s1, s2;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 11;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    rule$expects(peg$e11);\n    if (input.substr(peg$currPos, 5) === peg$c12) {\n      s1 = peg$c12;\n      peg$currPos += 5;\n    } else {\n      s1 = peg$FAILED;\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = peg$parseUnsignedInteger();\n      if (s2 !== peg$FAILED) {\n        peg$savedPos = s0;\n        s0 = peg$f17(s2);\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseInlineCountOption() {\n    var s0, s1, s2, s3;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 12;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    rule$expects(peg$e12);\n    if (input.substr(peg$currPos, 12) === peg$c13) {\n      s1 = peg$c13;\n      peg$currPos += 12;\n    } else {\n      s1 = peg$FAILED;\n    }\n    if (s1 !== peg$FAILED) {\n      rule$expects(peg$e13);\n      if (input.substr(peg$currPos, 8) === peg$c14) {\n        s2 = peg$c14;\n        peg$currPos += 8;\n      } else {\n        s2 = peg$FAILED;\n      }\n      if (s2 === peg$FAILED) {\n        rule$expects(peg$e14);\n        if (input.substr(peg$currPos, 4) === peg$c15) {\n          s2 = peg$c15;\n          peg$currPos += 4;\n        } else {\n          s2 = peg$FAILED;\n        }\n        if (s2 === peg$FAILED) {\n          s2 = peg$currPos;\n          s3 = peg$parseText();\n          peg$savedPos = s2;\n          s3 = peg$f18();\n          s2 = s3;\n        }\n      }\n      if (s2 !== peg$FAILED) {\n        peg$savedPos = s0;\n        s0 = peg$f19(s2);\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseCountOption() {\n    var s0, s1, s2;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 13;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    rule$expects(peg$e15);\n    if (input.substr(peg$currPos, 6) === peg$c16) {\n      s1 = peg$c16;\n      peg$currPos += 6;\n    } else {\n      s1 = peg$FAILED;\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = peg$parseBoolean();\n      if (s2 !== peg$FAILED) {\n        peg$savedPos = s0;\n        s0 = peg$f20(s2);\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseExpandOption() {\n    var s0, s1, s2;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 14;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    rule$expects(peg$e16);\n    if (input.substr(peg$currPos, 7) === peg$c17) {\n      s1 = peg$c17;\n      peg$currPos += 7;\n    } else {\n      s1 = peg$FAILED;\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = peg$parseExpandPropertyPathList();\n      if (s2 !== peg$FAILED) {\n        peg$savedPos = s0;\n        s0 = peg$f21(s2);\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseSelectOption() {\n    var s0, s1, s2, s3;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 15;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    rule$expects(peg$e17);\n    if (input.substr(peg$currPos, 7) === peg$c18) {\n      s1 = peg$c18;\n      peg$currPos += 7;\n    } else {\n      s1 = peg$FAILED;\n    }\n    if (s1 !== peg$FAILED) {\n      rule$expects(peg$e18);\n      if (input.charCodeAt(peg$currPos) === 42) {\n        s2 = peg$c19;\n        peg$currPos++;\n      } else {\n        s2 = peg$FAILED;\n      }\n      if (s2 === peg$FAILED) {\n        s2 = peg$currPos;\n        s3 = peg$parsePropertyPathList();\n        if (s3 !== peg$FAILED) {\n          peg$savedPos = s2;\n          s3 = peg$f22(s3);\n        }\n        s2 = s3;\n      }\n      if (s2 !== peg$FAILED) {\n        peg$savedPos = s0;\n        s0 = peg$f23(s2);\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseFilterByOption() {\n    var s0, s1, s2;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 16;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    rule$expects(peg$e19);\n    if (input.substr(peg$currPos, 7) === peg$c20) {\n      s1 = peg$c20;\n      peg$currPos += 7;\n    } else {\n      s1 = peg$FAILED;\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = peg$parseFilterByExpression();\n      if (s2 !== peg$FAILED) {\n        peg$savedPos = s0;\n        s0 = peg$f24(s2);\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseContentType() {\n    var s0, s1, s2, s3, s4, s5, s6, s7, s8;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 17;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    s1 = peg$currPos;\n    s2 = [];\n    rule$expects(peg$e20);\n    if (peg$r0.test(input.charAt(peg$currPos))) {\n      s3 = input.charAt(peg$currPos);\n      peg$currPos++;\n    } else {\n      s3 = peg$FAILED;\n    }\n    if (s3 !== peg$FAILED) {\n      while (s3 !== peg$FAILED) {\n        s2.push(s3);\n        rule$expects(peg$e20);\n        if (peg$r0.test(input.charAt(peg$currPos))) {\n          s3 = input.charAt(peg$currPos);\n          peg$currPos++;\n        } else {\n          s3 = peg$FAILED;\n        }\n      }\n    } else {\n      s2 = peg$FAILED;\n    }\n    if (s2 !== peg$FAILED) {\n      rule$expects(peg$e1);\n      if (input.charCodeAt(peg$currPos) === 47) {\n        s3 = peg$c1;\n        peg$currPos++;\n      } else {\n        s3 = peg$FAILED;\n      }\n      if (s3 !== peg$FAILED) {\n        s4 = [];\n        rule$expects(peg$e20);\n        if (peg$r0.test(input.charAt(peg$currPos))) {\n          s5 = input.charAt(peg$currPos);\n          peg$currPos++;\n        } else {\n          s5 = peg$FAILED;\n        }\n        if (s5 !== peg$FAILED) {\n          while (s5 !== peg$FAILED) {\n            s4.push(s5);\n            rule$expects(peg$e20);\n            if (peg$r0.test(input.charAt(peg$currPos))) {\n              s5 = input.charAt(peg$currPos);\n              peg$currPos++;\n            } else {\n              s5 = peg$FAILED;\n            }\n          }\n        } else {\n          s4 = peg$FAILED;\n        }\n        if (s4 !== peg$FAILED) {\n          s5 = peg$currPos;\n          rule$expects(peg$e21);\n          if (input.charCodeAt(peg$currPos) === 43) {\n            s6 = peg$c21;\n            peg$currPos++;\n          } else {\n            s6 = peg$FAILED;\n          }\n          if (s6 !== peg$FAILED) {\n            s7 = [];\n            rule$expects(peg$e20);\n            if (peg$r0.test(input.charAt(peg$currPos))) {\n              s8 = input.charAt(peg$currPos);\n              peg$currPos++;\n            } else {\n              s8 = peg$FAILED;\n            }\n            if (s8 !== peg$FAILED) {\n              while (s8 !== peg$FAILED) {\n                s7.push(s8);\n                rule$expects(peg$e20);\n                if (peg$r0.test(input.charAt(peg$currPos))) {\n                  s8 = input.charAt(peg$currPos);\n                  peg$currPos++;\n                } else {\n                  s8 = peg$FAILED;\n                }\n              }\n            } else {\n              s7 = peg$FAILED;\n            }\n            if (s7 !== peg$FAILED) {\n              s6 = [s6, s7];\n              s5 = s6;\n            } else {\n              peg$currPos = s5;\n              s5 = peg$FAILED;\n            }\n          } else {\n            peg$currPos = s5;\n            s5 = peg$FAILED;\n          }\n          if (s5 === peg$FAILED) {\n            s5 = null;\n          }\n          s2 = [s2, s3, s4, s5];\n          s1 = s2;\n        } else {\n          peg$currPos = s1;\n          s1 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s1;\n        s1 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s1;\n      s1 = peg$FAILED;\n    }\n    if (s1 === peg$FAILED) {\n      rule$expects(peg$e22);\n      if (input.substr(peg$currPos, 4) === peg$c22) {\n        s1 = peg$c22;\n        peg$currPos += 4;\n      } else {\n        s1 = peg$FAILED;\n      }\n      if (s1 === peg$FAILED) {\n        rule$expects(peg$e23);\n        if (input.substr(peg$currPos, 4) === peg$c23) {\n          s1 = peg$c23;\n          peg$currPos += 4;\n        } else {\n          s1 = peg$FAILED;\n        }\n        if (s1 === peg$FAILED) {\n          rule$expects(peg$e24);\n          if (input.substr(peg$currPos, 3) === peg$c24) {\n            s1 = peg$c24;\n            peg$currPos += 3;\n          } else {\n            s1 = peg$FAILED;\n          }\n        }\n      }\n    }\n    if (s1 !== peg$FAILED) {\n      s0 = input.substring(s0, peg$currPos);\n    } else {\n      s0 = s1;\n    }\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseFormatOption() {\n    var s0, s1, s2, s3, s4, s5, s6, s7;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 18;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    rule$expects(peg$e25);\n    if (input.substr(peg$currPos, 7) === peg$c25) {\n      s1 = peg$c25;\n      peg$currPos += 7;\n    } else {\n      s1 = peg$FAILED;\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = peg$parseContentType();\n      if (s2 !== peg$FAILED) {\n        s3 = peg$currPos;\n        rule$expects(peg$e26);\n        if (input.charCodeAt(peg$currPos) === 59) {\n          s4 = peg$c26;\n          peg$currPos++;\n        } else {\n          s4 = peg$FAILED;\n        }\n        if (s4 !== peg$FAILED) {\n          rule$expects(peg$e27);\n          if (input.substr(peg$currPos, 6) === peg$c27) {\n            s5 = peg$c27;\n            peg$currPos += 6;\n          } else {\n            s5 = peg$FAILED;\n          }\n          if (s5 === peg$FAILED) {\n            s5 = null;\n          }\n          rule$expects(peg$e28);\n          if (input.substr(peg$currPos, 9) === peg$c28) {\n            s6 = peg$c28;\n            peg$currPos += 9;\n          } else {\n            s6 = peg$FAILED;\n          }\n          if (s6 !== peg$FAILED) {\n            rule$expects(peg$e14);\n            if (input.substr(peg$currPos, 4) === peg$c15) {\n              s7 = peg$c15;\n              peg$currPos += 4;\n            } else {\n              s7 = peg$FAILED;\n            }\n            if (s7 === peg$FAILED) {\n              rule$expects(peg$e29);\n              if (input.substr(peg$currPos, 7) === peg$c29) {\n                s7 = peg$c29;\n                peg$currPos += 7;\n              } else {\n                s7 = peg$FAILED;\n              }\n              if (s7 === peg$FAILED) {\n                rule$expects(peg$e30);\n                if (input.substr(peg$currPos, 4) === peg$c30) {\n                  s7 = peg$c30;\n                  peg$currPos += 4;\n                } else {\n                  s7 = peg$FAILED;\n                }\n              }\n            }\n            if (s7 !== peg$FAILED) {\n              peg$savedPos = s3;\n              s3 = peg$f25(s2, s7);\n            } else {\n              peg$currPos = s3;\n              s3 = peg$FAILED;\n            }\n          } else {\n            peg$currPos = s3;\n            s3 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s3;\n          s3 = peg$FAILED;\n        }\n        if (s3 === peg$FAILED) {\n          s3 = peg$currPos;\n          s4 = '';\n          peg$savedPos = s3;\n          s4 = peg$f26(s2);\n          s3 = s4;\n        }\n        if (s3 !== peg$FAILED) {\n          s0 = s3;\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseFilterByExpression() {\n    var s0, s1, s2;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 19;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    s1 = peg$currPos;\n    s2 = '';\n    peg$savedPos = s1;\n    s2 = peg$f27();\n    s1 = s2;\n    s2 = peg$parseFilterByExpressionLoop();\n    if (s2 !== peg$FAILED) {\n      s0 = s2;\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseFilterByExpressionLoop() {\n    var s0, s1, s2, s3, s4, s5, s6, s7, s8, s9;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 20;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    s1 = peg$currPos;\n    s2 = '';\n    peg$savedPos = s1;\n    s2 = peg$f28();\n    s1 = s2;\n    s2 = peg$currPos;\n    s3 = peg$currPos;\n    s4 = peg$parseFilterByValue();\n    if (s4 !== peg$FAILED) {\n      peg$savedPos = s3;\n      s4 = peg$f29(s1, s4);\n    }\n    s3 = s4;\n    if (s3 !== peg$FAILED) {\n      s4 = [];\n      s5 = peg$currPos;\n      s6 = peg$parseFilterByOperand();\n      if (s6 !== peg$FAILED) {\n        peg$savedPos = peg$currPos;\n        s7 = peg$f30(s1, s3, s6);\n        if (s7) {\n          s7 = undefined;\n        } else {\n          s7 = peg$FAILED;\n        }\n        if (s7 !== peg$FAILED) {\n          s8 = peg$parseFilterByExpressionLoop();\n          if (s8 !== peg$FAILED) {\n            peg$savedPos = s5;\n            s5 = peg$f31(s1, s3, s6, s8);\n          } else {\n            peg$currPos = s5;\n            s5 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s5;\n          s5 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s5;\n        s5 = peg$FAILED;\n      }\n      if (s5 === peg$FAILED) {\n        s5 = peg$currPos;\n        s6 = peg$parsespaces();\n        rule$expects(peg$e31);\n        if (input.substr(peg$currPos, 2) === peg$c31) {\n          s7 = peg$c31;\n          peg$currPos += 2;\n        } else {\n          s7 = peg$FAILED;\n        }\n        if (s7 !== peg$FAILED) {\n          s8 = peg$parsespaces();\n          s9 = peg$parseGroupedPrimitive();\n          if (s9 !== peg$FAILED) {\n            peg$savedPos = s5;\n            s5 = peg$f32(s1, s3, s7, s9);\n          } else {\n            peg$currPos = s5;\n            s5 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s5;\n          s5 = peg$FAILED;\n        }\n      }\n      while (s5 !== peg$FAILED) {\n        s4.push(s5);\n        s5 = peg$currPos;\n        s6 = peg$parseFilterByOperand();\n        if (s6 !== peg$FAILED) {\n          peg$savedPos = peg$currPos;\n          s7 = peg$f30(s1, s3, s6);\n          if (s7) {\n            s7 = undefined;\n          } else {\n            s7 = peg$FAILED;\n          }\n          if (s7 !== peg$FAILED) {\n            s8 = peg$parseFilterByExpressionLoop();\n            if (s8 !== peg$FAILED) {\n              peg$savedPos = s5;\n              s5 = peg$f31(s1, s3, s6, s8);\n            } else {\n              peg$currPos = s5;\n              s5 = peg$FAILED;\n            }\n          } else {\n            peg$currPos = s5;\n            s5 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s5;\n          s5 = peg$FAILED;\n        }\n        if (s5 === peg$FAILED) {\n          s5 = peg$currPos;\n          s6 = peg$parsespaces();\n          rule$expects(peg$e31);\n          if (input.substr(peg$currPos, 2) === peg$c31) {\n            s7 = peg$c31;\n            peg$currPos += 2;\n          } else {\n            s7 = peg$FAILED;\n          }\n          if (s7 !== peg$FAILED) {\n            s8 = peg$parsespaces();\n            s9 = peg$parseGroupedPrimitive();\n            if (s9 !== peg$FAILED) {\n              peg$savedPos = s5;\n              s5 = peg$f32(s1, s3, s7, s9);\n            } else {\n              peg$currPos = s5;\n              s5 = peg$FAILED;\n            }\n          } else {\n            peg$currPos = s5;\n            s5 = peg$FAILED;\n          }\n        }\n      }\n      peg$savedPos = s2;\n      s2 = peg$f33(s1, s3);\n    } else {\n      peg$currPos = s2;\n      s2 = peg$FAILED;\n    }\n    if (s2 === peg$FAILED) {\n      s2 = peg$currPos;\n      peg$savedPos = peg$currPos;\n      s3 = peg$f34(s1);\n      if (s3) {\n        s3 = undefined;\n      } else {\n        s3 = peg$FAILED;\n      }\n      if (s3 !== peg$FAILED) {\n        peg$savedPos = s2;\n        s3 = peg$f35(s1);\n      }\n      s2 = s3;\n    }\n    if (s2 !== peg$FAILED) {\n      s0 = s2;\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseFilterByValue() {\n    var s0;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 21;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$parseGroupedPrecedenceExpression();\n    if (s0 === peg$FAILED) {\n      s0 = peg$parseFilterMethodCallExpression();\n      if (s0 === peg$FAILED) {\n        s0 = peg$parseFilterNegateExpression();\n        if (s0 === peg$FAILED) {\n          s0 = peg$parseParameterAlias();\n          if (s0 === peg$FAILED) {\n            s0 = peg$parsePrimitive();\n          }\n        }\n      }\n    }\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parsePrimitive() {\n    var s0, s1, s2, s3, s4, s5;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 22;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    rule$expects(peg$e32);\n    if (input.charCodeAt(peg$currPos) === 40) {\n      s1 = peg$c32;\n      peg$currPos++;\n    } else {\n      s1 = peg$FAILED;\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = peg$parsespaces();\n      s3 = peg$parsePrimitive();\n      if (s3 !== peg$FAILED) {\n        s4 = peg$parsespaces();\n        rule$expects(peg$e33);\n        if (input.charCodeAt(peg$currPos) === 41) {\n          s5 = peg$c33;\n          peg$currPos++;\n        } else {\n          s5 = peg$FAILED;\n        }\n        if (s5 !== peg$FAILED) {\n          s0 = s3;\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n    if (s0 === peg$FAILED) {\n      s0 = peg$parseQuotedTextBind();\n      if (s0 === peg$FAILED) {\n        s0 = peg$parseNumberBind();\n        if (s0 === peg$FAILED) {\n          s0 = peg$parseBooleanBind();\n          if (s0 === peg$FAILED) {\n            s0 = peg$parseNull();\n            if (s0 === peg$FAILED) {\n              s0 = peg$parseDateBind();\n              if (s0 === peg$FAILED) {\n                s0 = peg$parseDuration();\n                if (s0 === peg$FAILED) {\n                  s0 = peg$parseLambdaPropertyPath();\n                  if (s0 === peg$FAILED) {\n                    s0 = peg$parsePropertyPath();\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseGroupedPrecedenceExpression() {\n    var s0, s1, s2, s3, s4, s5;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 23;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    rule$expects(peg$e32);\n    if (input.charCodeAt(peg$currPos) === 40) {\n      s1 = peg$c32;\n      peg$currPos++;\n    } else {\n      s1 = peg$FAILED;\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = peg$parsespaces();\n      s3 = peg$parseFilterByExpression();\n      if (s3 !== peg$FAILED) {\n        s4 = peg$parsespaces();\n        rule$expects(peg$e33);\n        if (input.charCodeAt(peg$currPos) === 41) {\n          s5 = peg$c33;\n          peg$currPos++;\n        } else {\n          s5 = peg$FAILED;\n        }\n        if (s5 !== peg$FAILED) {\n          s0 = s3;\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseFilterByOperand() {\n    var s0, s1, s2, s3;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 24;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    s1 = peg$parsespaces();\n    rule$expects(peg$e34);\n    if (input.substr(peg$currPos, 2) === peg$c34) {\n      s2 = peg$c34;\n      peg$currPos += 2;\n    } else {\n      s2 = peg$FAILED;\n    }\n    if (s2 === peg$FAILED) {\n      rule$expects(peg$e35);\n      if (input.substr(peg$currPos, 2) === peg$c35) {\n        s2 = peg$c35;\n        peg$currPos += 2;\n      } else {\n        s2 = peg$FAILED;\n      }\n      if (s2 === peg$FAILED) {\n        rule$expects(peg$e36);\n        if (input.substr(peg$currPos, 2) === peg$c36) {\n          s2 = peg$c36;\n          peg$currPos += 2;\n        } else {\n          s2 = peg$FAILED;\n        }\n        if (s2 === peg$FAILED) {\n          rule$expects(peg$e37);\n          if (input.substr(peg$currPos, 2) === peg$c37) {\n            s2 = peg$c37;\n            peg$currPos += 2;\n          } else {\n            s2 = peg$FAILED;\n          }\n          if (s2 === peg$FAILED) {\n            rule$expects(peg$e38);\n            if (input.substr(peg$currPos, 2) === peg$c38) {\n              s2 = peg$c38;\n              peg$currPos += 2;\n            } else {\n              s2 = peg$FAILED;\n            }\n            if (s2 === peg$FAILED) {\n              rule$expects(peg$e39);\n              if (input.substr(peg$currPos, 2) === peg$c39) {\n                s2 = peg$c39;\n                peg$currPos += 2;\n              } else {\n                s2 = peg$FAILED;\n              }\n              if (s2 === peg$FAILED) {\n                rule$expects(peg$e40);\n                if (input.substr(peg$currPos, 3) === peg$c40) {\n                  s2 = peg$c40;\n                  peg$currPos += 3;\n                } else {\n                  s2 = peg$FAILED;\n                }\n                if (s2 === peg$FAILED) {\n                  rule$expects(peg$e41);\n                  if (input.substr(peg$currPos, 2) === peg$c41) {\n                    s2 = peg$c41;\n                    peg$currPos += 2;\n                  } else {\n                    s2 = peg$FAILED;\n                  }\n                  if (s2 === peg$FAILED) {\n                    rule$expects(peg$e42);\n                    if (input.substr(peg$currPos, 3) === peg$c42) {\n                      s2 = peg$c42;\n                      peg$currPos += 3;\n                    } else {\n                      s2 = peg$FAILED;\n                    }\n                    if (s2 === peg$FAILED) {\n                      rule$expects(peg$e43);\n                      if (input.substr(peg$currPos, 3) === peg$c43) {\n                        s2 = peg$c43;\n                        peg$currPos += 3;\n                      } else {\n                        s2 = peg$FAILED;\n                      }\n                      if (s2 === peg$FAILED) {\n                        rule$expects(peg$e44);\n                        if (input.substr(peg$currPos, 3) === peg$c44) {\n                          s2 = peg$c44;\n                          peg$currPos += 3;\n                        } else {\n                          s2 = peg$FAILED;\n                        }\n                        if (s2 === peg$FAILED) {\n                          rule$expects(peg$e45);\n                          if (input.substr(peg$currPos, 3) === peg$c45) {\n                            s2 = peg$c45;\n                            peg$currPos += 3;\n                          } else {\n                            s2 = peg$FAILED;\n                          }\n                          if (s2 === peg$FAILED) {\n                            rule$expects(peg$e46);\n                            if (input.substr(peg$currPos, 3) === peg$c46) {\n                              s2 = peg$c46;\n                              peg$currPos += 3;\n                            } else {\n                              s2 = peg$FAILED;\n                            }\n                          }\n                        }\n                      }\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n    if (s2 !== peg$FAILED) {\n      s3 = peg$parsespaces();\n      s0 = s2;\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseFilterNegateExpression() {\n    var s0, s1, s2, s3, s4, s5, s6, s7, s8, s9;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 25;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    s1 = peg$parsespaces();\n    rule$expects(peg$e47);\n    if (input.substr(peg$currPos, 3) === peg$c47) {\n      s2 = peg$c47;\n      peg$currPos += 3;\n    } else {\n      s2 = peg$FAILED;\n    }\n    if (s2 !== peg$FAILED) {\n      s3 = peg$parsespaces();\n      s4 = peg$parseFilterByValue();\n      if (s4 === peg$FAILED) {\n        s4 = peg$currPos;\n        rule$expects(peg$e32);\n        if (input.charCodeAt(peg$currPos) === 40) {\n          s5 = peg$c32;\n          peg$currPos++;\n        } else {\n          s5 = peg$FAILED;\n        }\n        if (s5 !== peg$FAILED) {\n          s6 = peg$parsespaces();\n          s7 = peg$parseFilterByExpression();\n          if (s7 !== peg$FAILED) {\n            s8 = peg$parsespaces();\n            rule$expects(peg$e33);\n            if (input.charCodeAt(peg$currPos) === 41) {\n              s9 = peg$c33;\n              peg$currPos++;\n            } else {\n              s9 = peg$FAILED;\n            }\n            if (s9 !== peg$FAILED) {\n              s4 = s7;\n            } else {\n              peg$currPos = s4;\n              s4 = peg$FAILED;\n            }\n          } else {\n            peg$currPos = s4;\n            s4 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s4;\n          s4 = peg$FAILED;\n        }\n      }\n      if (s4 !== peg$FAILED) {\n        s0 = [ s2, s4 ];\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseGroupedPrimitive() {\n    var s0, s1, s2, s3, s4, s5, s6, s7, s8;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 26;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    rule$expects(peg$e32);\n    if (input.charCodeAt(peg$currPos) === 40) {\n      s1 = peg$c32;\n      peg$currPos++;\n    } else {\n      s1 = peg$FAILED;\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = peg$parsespaces();\n      s3 = peg$parsePrimitive();\n      if (s3 !== peg$FAILED) {\n        s4 = [];\n        s5 = peg$currPos;\n        rule$expects(peg$e7);\n        if (input.charCodeAt(peg$currPos) === 44) {\n          s6 = peg$c8;\n          peg$currPos++;\n        } else {\n          s6 = peg$FAILED;\n        }\n        if (s6 !== peg$FAILED) {\n          s7 = peg$parsespaces();\n          s8 = peg$parsePrimitive();\n          if (s8 !== peg$FAILED) {\n            s5 = s8;\n          } else {\n            peg$currPos = s5;\n            s5 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s5;\n          s5 = peg$FAILED;\n        }\n        while (s5 !== peg$FAILED) {\n          s4.push(s5);\n          s5 = peg$currPos;\n          rule$expects(peg$e7);\n          if (input.charCodeAt(peg$currPos) === 44) {\n            s6 = peg$c8;\n            peg$currPos++;\n          } else {\n            s6 = peg$FAILED;\n          }\n          if (s6 !== peg$FAILED) {\n            s7 = peg$parsespaces();\n            s8 = peg$parsePrimitive();\n            if (s8 !== peg$FAILED) {\n              s5 = s8;\n            } else {\n              peg$currPos = s5;\n              s5 = peg$FAILED;\n            }\n          } else {\n            peg$currPos = s5;\n            s5 = peg$FAILED;\n          }\n        }\n        rule$expects(peg$e33);\n        if (input.charCodeAt(peg$currPos) === 41) {\n          s5 = peg$c33;\n          peg$currPos++;\n        } else {\n          s5 = peg$FAILED;\n        }\n        if (s5 !== peg$FAILED) {\n          peg$savedPos = s0;\n          s0 = peg$f36(s3, s4);\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseFilterMethodCallExpression() {\n    var s0, s1, s2, s3, s4, s5, s6, s7, s8, s9, s10, s11;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 27;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    rule$expects(peg$e48);\n    if (input.substr(peg$currPos, 4) === peg$c48) {\n      s1 = peg$c48;\n      peg$currPos += 4;\n    } else {\n      s1 = peg$FAILED;\n    }\n    if (s1 === peg$FAILED) {\n      rule$expects(peg$e49);\n      if (input.substr(peg$currPos, 7) === peg$c49) {\n        s1 = peg$c49;\n        peg$currPos += 7;\n      } else {\n        s1 = peg$FAILED;\n      }\n      if (s1 === peg$FAILED) {\n        rule$expects(peg$e50);\n        if (input.substr(peg$currPos, 6) === peg$c50) {\n          s1 = peg$c50;\n          peg$currPos += 6;\n        } else {\n          s1 = peg$FAILED;\n        }\n        if (s1 === peg$FAILED) {\n          rule$expects(peg$e51);\n          if (input.substr(peg$currPos, 8) === peg$c51) {\n            s1 = peg$c51;\n            peg$currPos += 8;\n          } else {\n            s1 = peg$FAILED;\n          }\n          if (s1 === peg$FAILED) {\n            rule$expects(peg$e52);\n            if (input.substr(peg$currPos, 4) === peg$c52) {\n              s1 = peg$c52;\n              peg$currPos += 4;\n            } else {\n              s1 = peg$FAILED;\n            }\n            if (s1 === peg$FAILED) {\n              rule$expects(peg$e53);\n              if (input.substr(peg$currPos, 3) === peg$c53) {\n                s1 = peg$c53;\n                peg$currPos += 3;\n              } else {\n                s1 = peg$FAILED;\n              }\n              if (s1 === peg$FAILED) {\n                rule$expects(peg$e54);\n                if (input.substr(peg$currPos, 8) === peg$c54) {\n                  s1 = peg$c54;\n                  peg$currPos += 8;\n                } else {\n                  s1 = peg$FAILED;\n                }\n                if (s1 === peg$FAILED) {\n                  rule$expects(peg$e55);\n                  if (input.substr(peg$currPos, 5) === peg$c55) {\n                    s1 = peg$c55;\n                    peg$currPos += 5;\n                  } else {\n                    s1 = peg$FAILED;\n                  }\n                  if (s1 === peg$FAILED) {\n                    rule$expects(peg$e56);\n                    if (input.substr(peg$currPos, 17) === peg$c56) {\n                      s1 = peg$c56;\n                      peg$currPos += 17;\n                    } else {\n                      s1 = peg$FAILED;\n                    }\n                    if (s1 === peg$FAILED) {\n                      rule$expects(peg$e57);\n                      if (input.substr(peg$currPos, 4) === peg$c57) {\n                        s1 = peg$c57;\n                        peg$currPos += 4;\n                      } else {\n                        s1 = peg$FAILED;\n                      }\n                      if (s1 === peg$FAILED) {\n                        rule$expects(peg$e58);\n                        if (input.substr(peg$currPos, 7) === peg$c58) {\n                          s1 = peg$c58;\n                          peg$currPos += 7;\n                        } else {\n                          s1 = peg$FAILED;\n                        }\n                        if (s1 === peg$FAILED) {\n                          rule$expects(peg$e59);\n                          if (input.substr(peg$currPos, 4) === peg$c59) {\n                            s1 = peg$c59;\n                            peg$currPos += 4;\n                          } else {\n                            s1 = peg$FAILED;\n                          }\n                          if (s1 === peg$FAILED) {\n                            rule$expects(peg$e60);\n                            if (input.substr(peg$currPos, 6) === peg$c60) {\n                              s1 = peg$c60;\n                              peg$currPos += 6;\n                            } else {\n                              s1 = peg$FAILED;\n                            }\n                            if (s1 === peg$FAILED) {\n                              rule$expects(peg$e61);\n                              if (input.substr(peg$currPos, 11) === peg$c61) {\n                                s1 = peg$c61;\n                                peg$currPos += 11;\n                              } else {\n                                s1 = peg$FAILED;\n                              }\n                              if (s1 === peg$FAILED) {\n                                rule$expects(peg$e62);\n                                if (input.substr(peg$currPos, 11) === peg$c62) {\n                                  s1 = peg$c62;\n                                  peg$currPos += 11;\n                                } else {\n                                  s1 = peg$FAILED;\n                                }\n                                if (s1 === peg$FAILED) {\n                                  rule$expects(peg$e63);\n                                  if (input.substr(peg$currPos, 6) === peg$c63) {\n                                    s1 = peg$c63;\n                                    peg$currPos += 6;\n                                  } else {\n                                    s1 = peg$FAILED;\n                                  }\n                                  if (s1 === peg$FAILED) {\n                                    rule$expects(peg$e64);\n                                    if (input.substr(peg$currPos, 5) === peg$c64) {\n                                      s1 = peg$c64;\n                                      peg$currPos += 5;\n                                    } else {\n                                      s1 = peg$FAILED;\n                                    }\n                                    if (s1 === peg$FAILED) {\n                                      rule$expects(peg$e65);\n                                      if (input.substr(peg$currPos, 3) === peg$c65) {\n                                        s1 = peg$c65;\n                                        peg$currPos += 3;\n                                      } else {\n                                        s1 = peg$FAILED;\n                                      }\n                                      if (s1 === peg$FAILED) {\n                                        rule$expects(peg$e66);\n                                        if (input.substr(peg$currPos, 7) === peg$c66) {\n                                          s1 = peg$c66;\n                                          peg$currPos += 7;\n                                        } else {\n                                          s1 = peg$FAILED;\n                                        }\n                                        if (s1 === peg$FAILED) {\n                                          rule$expects(peg$e67);\n                                          if (input.substr(peg$currPos, 5) === peg$c67) {\n                                            s1 = peg$c67;\n                                            peg$currPos += 5;\n                                          } else {\n                                            s1 = peg$FAILED;\n                                          }\n                                          if (s1 === peg$FAILED) {\n                                            rule$expects(peg$e68);\n                                            if (input.substr(peg$currPos, 6) === peg$c68) {\n                                              s1 = peg$c68;\n                                              peg$currPos += 6;\n                                            } else {\n                                              s1 = peg$FAILED;\n                                            }\n                                            if (s1 === peg$FAILED) {\n                                              rule$expects(peg$e69);\n                                              if (input.substr(peg$currPos, 10) === peg$c69) {\n                                                s1 = peg$c69;\n                                                peg$currPos += 10;\n                                              } else {\n                                                s1 = peg$FAILED;\n                                              }\n                                              if (s1 === peg$FAILED) {\n                                                rule$expects(peg$e70);\n                                                if (input.substr(peg$currPos, 11) === peg$c70) {\n                                                  s1 = peg$c70;\n                                                  peg$currPos += 11;\n                                                } else {\n                                                  s1 = peg$FAILED;\n                                                }\n                                                if (s1 === peg$FAILED) {\n                                                  rule$expects(peg$e71);\n                                                  if (input.substr(peg$currPos, 9) === peg$c71) {\n                                                    s1 = peg$c71;\n                                                    peg$currPos += 9;\n                                                  } else {\n                                                    s1 = peg$FAILED;\n                                                  }\n                                                  if (s1 === peg$FAILED) {\n                                                    rule$expects(peg$e72);\n                                                    if (input.substr(peg$currPos, 4) === peg$c72) {\n                                                      s1 = peg$c72;\n                                                      peg$currPos += 4;\n                                                    } else {\n                                                      s1 = peg$FAILED;\n                                                    }\n                                                    if (s1 === peg$FAILED) {\n                                                      rule$expects(peg$e73);\n                                                      if (input.substr(peg$currPos, 7) === peg$c73) {\n                                                        s1 = peg$c73;\n                                                        peg$currPos += 7;\n                                                      } else {\n                                                        s1 = peg$FAILED;\n                                                      }\n                                                      if (s1 === peg$FAILED) {\n                                                        rule$expects(peg$e74);\n                                                        if (input.substr(peg$currPos, 18) === peg$c74) {\n                                                          s1 = peg$c74;\n                                                          peg$currPos += 18;\n                                                        } else {\n                                                          s1 = peg$FAILED;\n                                                        }\n                                                        if (s1 === peg$FAILED) {\n                                                          rule$expects(peg$e75);\n                                                          if (input.substr(peg$currPos, 12) === peg$c75) {\n                                                            s1 = peg$c75;\n                                                            peg$currPos += 12;\n                                                          } else {\n                                                            s1 = peg$FAILED;\n                                                          }\n                                                          if (s1 === peg$FAILED) {\n                                                            rule$expects(peg$e76);\n                                                            if (input.substr(peg$currPos, 7) === peg$c76) {\n                                                              s1 = peg$c76;\n                                                              peg$currPos += 7;\n                                                            } else {\n                                                              s1 = peg$FAILED;\n                                                            }\n                                                            if (s1 === peg$FAILED) {\n                                                              rule$expects(peg$e77);\n                                                              if (input.substr(peg$currPos, 4) === peg$c77) {\n                                                                s1 = peg$c77;\n                                                                peg$currPos += 4;\n                                                              } else {\n                                                                s1 = peg$FAILED;\n                                                              }\n                                                              if (s1 === peg$FAILED) {\n                                                                rule$expects(peg$e78);\n                                                                if (input.substr(peg$currPos, 4) === peg$c78) {\n                                                                  s1 = peg$c78;\n                                                                  peg$currPos += 4;\n                                                                } else {\n                                                                  s1 = peg$FAILED;\n                                                                }\n                                                              }\n                                                            }\n                                                          }\n                                                        }\n                                                      }\n                                                    }\n                                                  }\n                                                }\n                                              }\n                                            }\n                                          }\n                                        }\n                                      }\n                                    }\n                                  }\n                                }\n                              }\n                            }\n                          }\n                        }\n                      }\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n    if (s1 !== peg$FAILED) {\n      rule$expects(peg$e32);\n      if (input.charCodeAt(peg$currPos) === 40) {\n        s2 = peg$c32;\n        peg$currPos++;\n      } else {\n        s2 = peg$FAILED;\n      }\n      if (s2 !== peg$FAILED) {\n        s3 = peg$parsespaces();\n        s4 = peg$currPos;\n        s5 = peg$parseFilterByExpression();\n        if (s5 !== peg$FAILED) {\n          s6 = [];\n          s7 = peg$currPos;\n          s8 = peg$parsespaces();\n          rule$expects(peg$e7);\n          if (input.charCodeAt(peg$currPos) === 44) {\n            s9 = peg$c8;\n            peg$currPos++;\n          } else {\n            s9 = peg$FAILED;\n          }\n          if (s9 !== peg$FAILED) {\n            s10 = peg$parsespaces();\n            s11 = peg$parseFilterByExpression();\n            if (s11 !== peg$FAILED) {\n              s7 = s11;\n            } else {\n              peg$currPos = s7;\n              s7 = peg$FAILED;\n            }\n          } else {\n            peg$currPos = s7;\n            s7 = peg$FAILED;\n          }\n          while (s7 !== peg$FAILED) {\n            s6.push(s7);\n            s7 = peg$currPos;\n            s8 = peg$parsespaces();\n            rule$expects(peg$e7);\n            if (input.charCodeAt(peg$currPos) === 44) {\n              s9 = peg$c8;\n              peg$currPos++;\n            } else {\n              s9 = peg$FAILED;\n            }\n            if (s9 !== peg$FAILED) {\n              s10 = peg$parsespaces();\n              s11 = peg$parseFilterByExpression();\n              if (s11 !== peg$FAILED) {\n                s7 = s11;\n              } else {\n                peg$currPos = s7;\n                s7 = peg$FAILED;\n              }\n            } else {\n              peg$currPos = s7;\n              s7 = peg$FAILED;\n            }\n          }\n          s7 = peg$parsespaces();\n          peg$savedPos = s4;\n          s4 = peg$f37(s1, s5, s6);\n        } else {\n          peg$currPos = s4;\n          s4 = peg$FAILED;\n        }\n        if (s4 === peg$FAILED) {\n          s4 = peg$currPos;\n          s5 = '';\n          peg$savedPos = s4;\n          s5 = peg$f38(s1);\n          s4 = s5;\n        }\n        if (s4 !== peg$FAILED) {\n          peg$savedPos = peg$currPos;\n          s5 = peg$f39(s1, s4);\n          if (s5) {\n            s5 = undefined;\n          } else {\n            s5 = peg$FAILED;\n          }\n          if (s5 !== peg$FAILED) {\n            rule$expects(peg$e33);\n            if (input.charCodeAt(peg$currPos) === 41) {\n              s6 = peg$c33;\n              peg$currPos++;\n            } else {\n              s6 = peg$FAILED;\n            }\n            if (s6 !== peg$FAILED) {\n              peg$savedPos = s0;\n              s0 = peg$f40(s1, s4);\n            } else {\n              peg$currPos = s0;\n              s0 = peg$FAILED;\n            }\n          } else {\n            peg$currPos = s0;\n            s0 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseLambdaMethodCall() {\n    var s0, s1, s2, s3, s4, s5, s6, s7, s8;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 28;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    rule$expects(peg$e79);\n    if (input.substr(peg$currPos, 3) === peg$c79) {\n      s1 = peg$c79;\n      peg$currPos += 3;\n    } else {\n      s1 = peg$FAILED;\n    }\n    if (s1 === peg$FAILED) {\n      rule$expects(peg$e80);\n      if (input.substr(peg$currPos, 3) === peg$c80) {\n        s1 = peg$c80;\n        peg$currPos += 3;\n      } else {\n        s1 = peg$FAILED;\n      }\n    }\n    if (s1 !== peg$FAILED) {\n      rule$expects(peg$e32);\n      if (input.charCodeAt(peg$currPos) === 40) {\n        s2 = peg$c32;\n        peg$currPos++;\n      } else {\n        s2 = peg$FAILED;\n      }\n      if (s2 !== peg$FAILED) {\n        s3 = peg$parsespaces();\n        s4 = peg$parseResourceName();\n        if (s4 !== peg$FAILED) {\n          rule$expects(peg$e81);\n          if (input.charCodeAt(peg$currPos) === 58) {\n            s5 = peg$c81;\n            peg$currPos++;\n          } else {\n            s5 = peg$FAILED;\n          }\n          if (s5 !== peg$FAILED) {\n            s6 = peg$parseFilterByExpression();\n            if (s6 !== peg$FAILED) {\n              s7 = peg$parsespaces();\n              rule$expects(peg$e33);\n              if (input.charCodeAt(peg$currPos) === 41) {\n                s8 = peg$c33;\n                peg$currPos++;\n              } else {\n                s8 = peg$FAILED;\n              }\n              if (s8 !== peg$FAILED) {\n                peg$savedPos = s0;\n                s0 = peg$f41(s1, s4, s6);\n              } else {\n                peg$currPos = s0;\n                s0 = peg$FAILED;\n              }\n            } else {\n              peg$currPos = s0;\n              s0 = peg$FAILED;\n            }\n          } else {\n            peg$currPos = s0;\n            s0 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseResourceMethodCall() {\n    var s0, s1, s2, s3, s4, s5, s6, s7, s8, s9, s10, s11;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 29;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    s1 = peg$parseResourceName();\n    if (s1 !== peg$FAILED) {\n      rule$expects(peg$e32);\n      if (input.charCodeAt(peg$currPos) === 40) {\n        s2 = peg$c32;\n        peg$currPos++;\n      } else {\n        s2 = peg$FAILED;\n      }\n      if (s2 !== peg$FAILED) {\n        s3 = peg$parsespaces();\n        s4 = peg$currPos;\n        s5 = peg$parseFilterByExpression();\n        if (s5 !== peg$FAILED) {\n          s6 = [];\n          s7 = peg$currPos;\n          s8 = peg$parsespaces();\n          rule$expects(peg$e7);\n          if (input.charCodeAt(peg$currPos) === 44) {\n            s9 = peg$c8;\n            peg$currPos++;\n          } else {\n            s9 = peg$FAILED;\n          }\n          if (s9 !== peg$FAILED) {\n            s10 = peg$parsespaces();\n            s11 = peg$parseFilterByExpression();\n            if (s11 !== peg$FAILED) {\n              s7 = s11;\n            } else {\n              peg$currPos = s7;\n              s7 = peg$FAILED;\n            }\n          } else {\n            peg$currPos = s7;\n            s7 = peg$FAILED;\n          }\n          while (s7 !== peg$FAILED) {\n            s6.push(s7);\n            s7 = peg$currPos;\n            s8 = peg$parsespaces();\n            rule$expects(peg$e7);\n            if (input.charCodeAt(peg$currPos) === 44) {\n              s9 = peg$c8;\n              peg$currPos++;\n            } else {\n              s9 = peg$FAILED;\n            }\n            if (s9 !== peg$FAILED) {\n              s10 = peg$parsespaces();\n              s11 = peg$parseFilterByExpression();\n              if (s11 !== peg$FAILED) {\n                s7 = s11;\n              } else {\n                peg$currPos = s7;\n                s7 = peg$FAILED;\n              }\n            } else {\n              peg$currPos = s7;\n              s7 = peg$FAILED;\n            }\n          }\n          s7 = peg$parsespaces();\n          peg$savedPos = s4;\n          s4 = peg$f37(s1, s5, s6);\n        } else {\n          peg$currPos = s4;\n          s4 = peg$FAILED;\n        }\n        if (s4 === peg$FAILED) {\n          s4 = peg$currPos;\n          s5 = '';\n          peg$savedPos = s4;\n          s5 = peg$f38(s1);\n          s4 = s5;\n        }\n        if (s4 !== peg$FAILED) {\n          rule$expects(peg$e33);\n          if (input.charCodeAt(peg$currPos) === 41) {\n            s5 = peg$c33;\n            peg$currPos++;\n          } else {\n            s5 = peg$FAILED;\n          }\n          if (s5 !== peg$FAILED) {\n            peg$savedPos = s0;\n            s0 = peg$f40(s1, s4);\n          } else {\n            peg$currPos = s0;\n            s0 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parsePropertyPathList() {\n    var s0, s1, s2, s3, s4, s5;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 30;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    s1 = peg$parsePropertyPath();\n    if (s1 !== peg$FAILED) {\n      s2 = [];\n      s3 = peg$currPos;\n      rule$expects(peg$e7);\n      if (input.charCodeAt(peg$currPos) === 44) {\n        s4 = peg$c8;\n        peg$currPos++;\n      } else {\n        s4 = peg$FAILED;\n      }\n      if (s4 !== peg$FAILED) {\n        s5 = peg$parsePropertyPath();\n        if (s5 !== peg$FAILED) {\n          s3 = s5;\n        } else {\n          peg$currPos = s3;\n          s3 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s3;\n        s3 = peg$FAILED;\n      }\n      while (s3 !== peg$FAILED) {\n        s2.push(s3);\n        s3 = peg$currPos;\n        rule$expects(peg$e7);\n        if (input.charCodeAt(peg$currPos) === 44) {\n          s4 = peg$c8;\n          peg$currPos++;\n        } else {\n          s4 = peg$FAILED;\n        }\n        if (s4 !== peg$FAILED) {\n          s5 = peg$parsePropertyPath();\n          if (s5 !== peg$FAILED) {\n            s3 = s5;\n          } else {\n            peg$currPos = s3;\n            s3 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s3;\n          s3 = peg$FAILED;\n        }\n      }\n      peg$savedPos = s0;\n      s0 = peg$f42(s1, s2);\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parsePropertyPath() {\n    var s0, s1, s2, s3, s4;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 31;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    s1 = peg$parseResourceName();\n    if (s1 !== peg$FAILED) {\n      s2 = peg$currPos;\n      rule$expects(peg$e1);\n      if (input.charCodeAt(peg$currPos) === 47) {\n        s3 = peg$c1;\n        peg$currPos++;\n      } else {\n        s3 = peg$FAILED;\n      }\n      if (s3 !== peg$FAILED) {\n        s4 = peg$parsePropertyPath();\n        if (s4 !== peg$FAILED) {\n          s2 = s4;\n        } else {\n          peg$currPos = s2;\n          s2 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s2;\n        s2 = peg$FAILED;\n      }\n      if (s2 === peg$FAILED) {\n        s2 = null;\n      }\n      s3 = peg$currPos;\n      rule$expects(peg$e82);\n      if (input.substr(peg$currPos, 7) === peg$c82) {\n        s4 = peg$c82;\n        peg$currPos += 7;\n      } else {\n        s4 = peg$FAILED;\n      }\n      if (s4 !== peg$FAILED) {\n        peg$savedPos = s3;\n        s4 = peg$f43(s1, s2);\n      }\n      s3 = s4;\n      if (s3 === peg$FAILED) {\n        s3 = null;\n      }\n      peg$savedPos = s0;\n      s0 = peg$f44(s1, s2, s3);\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseExpandPropertyPathList() {\n    var s0, s1, s2, s3, s4, s5;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 32;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    s1 = peg$parseExpandPropertyPath();\n    if (s1 !== peg$FAILED) {\n      s2 = [];\n      s3 = peg$currPos;\n      rule$expects(peg$e7);\n      if (input.charCodeAt(peg$currPos) === 44) {\n        s4 = peg$c8;\n        peg$currPos++;\n      } else {\n        s4 = peg$FAILED;\n      }\n      if (s4 !== peg$FAILED) {\n        s5 = peg$parseExpandPropertyPath();\n        if (s5 !== peg$FAILED) {\n          s3 = s5;\n        } else {\n          peg$currPos = s3;\n          s3 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s3;\n        s3 = peg$FAILED;\n      }\n      while (s3 !== peg$FAILED) {\n        s2.push(s3);\n        s3 = peg$currPos;\n        rule$expects(peg$e7);\n        if (input.charCodeAt(peg$currPos) === 44) {\n          s4 = peg$c8;\n          peg$currPos++;\n        } else {\n          s4 = peg$FAILED;\n        }\n        if (s4 !== peg$FAILED) {\n          s5 = peg$parseExpandPropertyPath();\n          if (s5 !== peg$FAILED) {\n            s3 = s5;\n          } else {\n            peg$currPos = s3;\n            s3 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s3;\n          s3 = peg$FAILED;\n        }\n      }\n      peg$savedPos = s0;\n      s0 = peg$f42(s1, s2);\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseExpandPropertyPath() {\n    var s0, s1, s2, s3, s4, s5, s6, s7, s8, s9, s10;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 33;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    s1 = peg$parseResourceName();\n    if (s1 !== peg$FAILED) {\n      s2 = peg$currPos;\n      rule$expects(peg$e82);\n      if (input.substr(peg$currPos, 7) === peg$c82) {\n        s3 = peg$c82;\n        peg$currPos += 7;\n      } else {\n        s3 = peg$FAILED;\n      }\n      if (s3 !== peg$FAILED) {\n        peg$savedPos = s2;\n        s3 = peg$f45(s1);\n      }\n      s2 = s3;\n      if (s2 === peg$FAILED) {\n        s2 = null;\n      }\n      s3 = peg$currPos;\n      rule$expects(peg$e32);\n      if (input.charCodeAt(peg$currPos) === 40) {\n        s4 = peg$c32;\n        peg$currPos++;\n      } else {\n        s4 = peg$FAILED;\n      }\n      if (s4 !== peg$FAILED) {\n        s5 = peg$currPos;\n        s6 = peg$parseQueryOption();\n        if (s6 !== peg$FAILED) {\n          s7 = [];\n          s8 = peg$currPos;\n          rule$expects(peg$e83);\n          if (peg$r1.test(input.charAt(peg$currPos))) {\n            s9 = input.charAt(peg$currPos);\n            peg$currPos++;\n          } else {\n            s9 = peg$FAILED;\n          }\n          if (s9 !== peg$FAILED) {\n            s10 = peg$parseQueryOption();\n            if (s10 !== peg$FAILED) {\n              s8 = s10;\n            } else {\n              peg$currPos = s8;\n              s8 = peg$FAILED;\n            }\n          } else {\n            peg$currPos = s8;\n            s8 = peg$FAILED;\n          }\n          while (s8 !== peg$FAILED) {\n            s7.push(s8);\n            s8 = peg$currPos;\n            rule$expects(peg$e83);\n            if (peg$r1.test(input.charAt(peg$currPos))) {\n              s9 = input.charAt(peg$currPos);\n              peg$currPos++;\n            } else {\n              s9 = peg$FAILED;\n            }\n            if (s9 !== peg$FAILED) {\n              s10 = peg$parseQueryOption();\n              if (s10 !== peg$FAILED) {\n                s8 = s10;\n              } else {\n                peg$currPos = s8;\n                s8 = peg$FAILED;\n              }\n            } else {\n              peg$currPos = s8;\n              s8 = peg$FAILED;\n            }\n          }\n          peg$savedPos = s5;\n          s5 = peg$f46(s1, s2, s6, s7);\n        } else {\n          peg$currPos = s5;\n          s5 = peg$FAILED;\n        }\n        if (s5 === peg$FAILED) {\n          s5 = peg$currPos;\n          s6 = '';\n          peg$savedPos = s5;\n          s6 = peg$f47(s1, s2);\n          s5 = s6;\n        }\n        if (s5 !== peg$FAILED) {\n          rule$expects(peg$e33);\n          if (input.charCodeAt(peg$currPos) === 41) {\n            s6 = peg$c33;\n            peg$currPos++;\n          } else {\n            s6 = peg$FAILED;\n          }\n          if (s6 !== peg$FAILED) {\n            s3 = s5;\n          } else {\n            peg$currPos = s3;\n            s3 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s3;\n          s3 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s3;\n        s3 = peg$FAILED;\n      }\n      if (s3 === peg$FAILED) {\n        s3 = null;\n      }\n      s4 = peg$currPos;\n      rule$expects(peg$e1);\n      if (input.charCodeAt(peg$currPos) === 47) {\n        s5 = peg$c1;\n        peg$currPos++;\n      } else {\n        s5 = peg$FAILED;\n      }\n      if (s5 !== peg$FAILED) {\n        s6 = peg$parsePropertyPath();\n        if (s6 !== peg$FAILED) {\n          s4 = s6;\n        } else {\n          peg$currPos = s4;\n          s4 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s4;\n        s4 = peg$FAILED;\n      }\n      if (s4 === peg$FAILED) {\n        s4 = null;\n      }\n      peg$savedPos = s0;\n      s0 = peg$f48(s1, s2, s3, s4);\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseLambdaPropertyPath() {\n    var s0, s1, s2, s3, s4;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 34;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    s1 = peg$parseResourceName();\n    if (s1 !== peg$FAILED) {\n      rule$expects(peg$e1);\n      if (input.charCodeAt(peg$currPos) === 47) {\n        s2 = peg$c1;\n        peg$currPos++;\n      } else {\n        s2 = peg$FAILED;\n      }\n      if (s2 !== peg$FAILED) {\n        s3 = peg$currPos;\n        s4 = peg$parseLambdaPropertyPath();\n        if (s4 !== peg$FAILED) {\n          peg$savedPos = s3;\n          s4 = peg$f49(s1, s4);\n        }\n        s3 = s4;\n        if (s3 === peg$FAILED) {\n          s3 = peg$currPos;\n          s4 = peg$parseLambdaMethodCall();\n          if (s4 !== peg$FAILED) {\n            peg$savedPos = s3;\n            s4 = peg$f50(s1, s4);\n          }\n          s3 = s4;\n          if (s3 === peg$FAILED) {\n            s3 = peg$currPos;\n            s4 = peg$parseResourceMethodCall();\n            if (s4 !== peg$FAILED) {\n              peg$savedPos = s3;\n              s4 = peg$f51(s1, s4);\n            }\n            s3 = s4;\n          }\n        }\n        if (s3 !== peg$FAILED) {\n          s0 = s3;\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseKey() {\n    var s0, s1, s2, s3, s4, s5, s6, s7;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 35;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    rule$expects(peg$e32);\n    if (input.charCodeAt(peg$currPos) === 40) {\n      s1 = peg$c32;\n      peg$currPos++;\n    } else {\n      s1 = peg$FAILED;\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = peg$parseKeyBind();\n      if (s2 === peg$FAILED) {\n        s2 = peg$currPos;\n        s3 = peg$parseNamedKeyBind();\n        if (s3 !== peg$FAILED) {\n          s4 = [];\n          s5 = peg$currPos;\n          rule$expects(peg$e7);\n          if (input.charCodeAt(peg$currPos) === 44) {\n            s6 = peg$c8;\n            peg$currPos++;\n          } else {\n            s6 = peg$FAILED;\n          }\n          if (s6 !== peg$FAILED) {\n            s7 = peg$parseNamedKeyBind();\n            if (s7 !== peg$FAILED) {\n              s5 = s7;\n            } else {\n              peg$currPos = s5;\n              s5 = peg$FAILED;\n            }\n          } else {\n            peg$currPos = s5;\n            s5 = peg$FAILED;\n          }\n          while (s5 !== peg$FAILED) {\n            s4.push(s5);\n            s5 = peg$currPos;\n            rule$expects(peg$e7);\n            if (input.charCodeAt(peg$currPos) === 44) {\n              s6 = peg$c8;\n              peg$currPos++;\n            } else {\n              s6 = peg$FAILED;\n            }\n            if (s6 !== peg$FAILED) {\n              s7 = peg$parseNamedKeyBind();\n              if (s7 !== peg$FAILED) {\n                s5 = s7;\n              } else {\n                peg$currPos = s5;\n                s5 = peg$FAILED;\n              }\n            } else {\n              peg$currPos = s5;\n              s5 = peg$FAILED;\n            }\n          }\n          peg$savedPos = s2;\n          s2 = peg$f52(s3, s4);\n        } else {\n          peg$currPos = s2;\n          s2 = peg$FAILED;\n        }\n      }\n      if (s2 !== peg$FAILED) {\n        rule$expects(peg$e33);\n        if (input.charCodeAt(peg$currPos) === 41) {\n          s3 = peg$c33;\n          peg$currPos++;\n        } else {\n          s3 = peg$FAILED;\n        }\n        if (s3 !== peg$FAILED) {\n          s0 = s2;\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseNamedKeyBind() {\n    var s0, s1, s2, s3;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 36;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    s1 = peg$parseResourceName();\n    if (s1 !== peg$FAILED) {\n      rule$expects(peg$e5);\n      if (input.charCodeAt(peg$currPos) === 61) {\n        s2 = peg$c6;\n        peg$currPos++;\n      } else {\n        s2 = peg$FAILED;\n      }\n      if (s2 !== peg$FAILED) {\n        s3 = peg$parseKeyBind();\n        if (s3 !== peg$FAILED) {\n          peg$savedPos = s0;\n          s0 = peg$f53(s1, s3);\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseKeyBind() {\n    var s0;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 37;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$parseNumberBind();\n    if (s0 === peg$FAILED) {\n      s0 = peg$parseQuotedTextBind();\n      if (s0 === peg$FAILED) {\n        s0 = peg$parseParameterAlias();\n      }\n    }\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseLinks() {\n    var s0, s1, s2;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 38;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    rule$expects(peg$e84);\n    if (input.substr(peg$currPos, 7) === peg$c83) {\n      s1 = peg$c83;\n      peg$currPos += 7;\n    } else {\n      s1 = peg$FAILED;\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = peg$parseSubPathSegment();\n      if (s2 !== peg$FAILED) {\n        s0 = s2;\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parsePathSegment() {\n    var s0, s1, s2, s3, s4, s5, s6, s7;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 39;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    s1 = peg$currPos;\n    rule$expects(peg$e1);\n    if (input.charCodeAt(peg$currPos) === 47) {\n      s2 = peg$c1;\n      peg$currPos++;\n    } else {\n      s2 = peg$FAILED;\n    }\n    if (s2 !== peg$FAILED) {\n      s3 = peg$currPos;\n      s4 = peg$parseResourceName();\n      if (s4 !== peg$FAILED) {\n        peg$savedPos = s3;\n        s4 = peg$f54(s4);\n      }\n      s3 = s4;\n      if (s3 !== peg$FAILED) {\n        s4 = peg$currPos;\n        s5 = peg$currPos;\n        s6 = peg$parseKey();\n        if (s6 !== peg$FAILED) {\n          peg$savedPos = s5;\n          s6 = peg$f55(s3, s6);\n        }\n        s5 = s6;\n        if (s5 !== peg$FAILED) {\n          s6 = peg$currPos;\n          s7 = peg$parseLinks();\n          if (s7 !== peg$FAILED) {\n            peg$savedPos = s6;\n            s7 = peg$f56(s3, s7);\n          }\n          s6 = s7;\n          if (s6 === peg$FAILED) {\n            s6 = peg$currPos;\n            s7 = peg$parseSubPathSegment();\n            if (s7 !== peg$FAILED) {\n              peg$savedPos = s6;\n              s7 = peg$f57(s3, s7);\n            }\n            s6 = s7;\n          }\n          if (s6 === peg$FAILED) {\n            s6 = null;\n          }\n          s5 = [s5, s6];\n          s4 = s5;\n        } else {\n          peg$currPos = s4;\n          s4 = peg$FAILED;\n        }\n        if (s4 === peg$FAILED) {\n          s4 = peg$currPos;\n          rule$expects(peg$e82);\n          if (input.substr(peg$currPos, 7) === peg$c82) {\n            s5 = peg$c82;\n            peg$currPos += 7;\n          } else {\n            s5 = peg$FAILED;\n          }\n          if (s5 !== peg$FAILED) {\n            peg$savedPos = s4;\n            s5 = peg$f58(s3);\n          }\n          s4 = s5;\n        }\n        if (s4 === peg$FAILED) {\n          s4 = null;\n        }\n        peg$savedPos = s1;\n        s1 = peg$f59(s3);\n      } else {\n        peg$currPos = s1;\n        s1 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s1;\n      s1 = peg$FAILED;\n    }\n    if (s1 === peg$FAILED) {\n      s1 = peg$currPos;\n      s2 = peg$parseContentReference();\n      if (s2 !== peg$FAILED) {\n        s3 = peg$currPos;\n        s4 = peg$parseLinks();\n        if (s4 !== peg$FAILED) {\n          peg$savedPos = s3;\n          s4 = peg$f56(s2, s4);\n        }\n        s3 = s4;\n        if (s3 === peg$FAILED) {\n          s3 = peg$currPos;\n          s4 = peg$parseSubPathSegment();\n          if (s4 !== peg$FAILED) {\n            peg$savedPos = s3;\n            s4 = peg$f57(s2, s4);\n          }\n          s3 = s4;\n        }\n        if (s3 === peg$FAILED) {\n          s3 = null;\n        }\n        peg$savedPos = s1;\n        s1 = peg$f59(s2);\n      } else {\n        peg$currPos = s1;\n        s1 = peg$FAILED;\n      }\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = peg$currPos;\n      rule$expects(peg$e85);\n      if (input.charCodeAt(peg$currPos) === 63) {\n        s3 = peg$c84;\n        peg$currPos++;\n      } else {\n        s3 = peg$FAILED;\n      }\n      if (s3 !== peg$FAILED) {\n        s4 = peg$currPos;\n        s5 = peg$parseQueryOptions();\n        if (s5 !== peg$FAILED) {\n          peg$savedPos = s4;\n          s5 = peg$f60(s1, s5);\n        }\n        s4 = s5;\n        if (s4 === peg$FAILED) {\n          s4 = null;\n        }\n        s3 = [s3, s4];\n        s2 = s3;\n      } else {\n        peg$currPos = s2;\n        s2 = peg$FAILED;\n      }\n      if (s2 === peg$FAILED) {\n        s2 = null;\n      }\n      peg$savedPos = s0;\n      s0 = peg$f59(s1);\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseSubPathSegment() {\n    var s0, s1, s2, s3, s4, s5, s6, s7, s8, s9;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 40;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    rule$expects(peg$e1);\n    if (input.charCodeAt(peg$currPos) === 47) {\n      s1 = peg$c1;\n      peg$currPos++;\n    } else {\n      s1 = peg$FAILED;\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = peg$currPos;\n      s3 = peg$parseResourceName();\n      if (s3 !== peg$FAILED) {\n        peg$savedPos = s2;\n        s3 = peg$f54(s3);\n      }\n      s2 = s3;\n      if (s2 !== peg$FAILED) {\n        s3 = peg$currPos;\n        s4 = peg$parseKey();\n        if (s4 !== peg$FAILED) {\n          peg$savedPos = s3;\n          s4 = peg$f55(s2, s4);\n        }\n        s3 = s4;\n        if (s3 === peg$FAILED) {\n          s3 = null;\n        }\n        s4 = peg$currPos;\n        rule$expects(peg$e84);\n        if (input.substr(peg$currPos, 7) === peg$c83) {\n          s5 = peg$c83;\n          peg$currPos += 7;\n        } else {\n          s5 = peg$FAILED;\n        }\n        if (s5 !== peg$FAILED) {\n          s6 = peg$parseSubPathSegment();\n          if (s6 !== peg$FAILED) {\n            peg$savedPos = s4;\n            s4 = peg$f56(s2, s6);\n          } else {\n            peg$currPos = s4;\n            s4 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s4;\n          s4 = peg$FAILED;\n        }\n        if (s4 === peg$FAILED) {\n          s4 = peg$currPos;\n          s5 = peg$parseSubPathSegment();\n          if (s5 !== peg$FAILED) {\n            peg$savedPos = s4;\n            s5 = peg$f57(s2, s5);\n          }\n          s4 = s5;\n        }\n        if (s4 === peg$FAILED) {\n          s4 = null;\n        }\n        s5 = peg$currPos;\n        rule$expects(peg$e82);\n        if (input.substr(peg$currPos, 7) === peg$c82) {\n          s6 = peg$c82;\n          peg$currPos += 7;\n        } else {\n          s6 = peg$FAILED;\n        }\n        if (s6 !== peg$FAILED) {\n          peg$savedPos = s5;\n          s6 = peg$f58(s2);\n        }\n        s5 = s6;\n        if (s5 === peg$FAILED) {\n          s5 = null;\n        }\n        s6 = peg$currPos;\n        rule$expects(peg$e85);\n        if (input.charCodeAt(peg$currPos) === 63) {\n          s7 = peg$c84;\n          peg$currPos++;\n        } else {\n          s7 = peg$FAILED;\n        }\n        if (s7 !== peg$FAILED) {\n          s8 = peg$currPos;\n          s9 = peg$parseQueryOptions();\n          if (s9 !== peg$FAILED) {\n            peg$savedPos = s8;\n            s9 = peg$f60(s2, s9);\n          }\n          s8 = s9;\n          if (s8 === peg$FAILED) {\n            s8 = null;\n          }\n          s7 = [s7, s8];\n          s6 = s7;\n        } else {\n          peg$currPos = s6;\n          s6 = peg$FAILED;\n        }\n        if (s6 === peg$FAILED) {\n          s6 = null;\n        }\n        peg$savedPos = s0;\n        s0 = peg$f59(s2);\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseResourceName() {\n    var s0, s1, s2, s3;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 41;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    s1 = peg$currPos;\n    s2 = [];\n    rule$expects(peg$e86);\n    if (peg$r2.test(input.charAt(peg$currPos))) {\n      s3 = input.charAt(peg$currPos);\n      peg$currPos++;\n    } else {\n      s3 = peg$FAILED;\n    }\n    if (s3 !== peg$FAILED) {\n      while (s3 !== peg$FAILED) {\n        s2.push(s3);\n        rule$expects(peg$e86);\n        if (peg$r2.test(input.charAt(peg$currPos))) {\n          s3 = input.charAt(peg$currPos);\n          peg$currPos++;\n        } else {\n          s3 = peg$FAILED;\n        }\n      }\n    } else {\n      s2 = peg$FAILED;\n    }\n    if (s2 !== peg$FAILED) {\n      s1 = input.substring(s1, peg$currPos);\n    } else {\n      s1 = s2;\n    }\n    if (s1 !== peg$FAILED) {\n      peg$savedPos = s0;\n      s1 = peg$f61(s1);\n    }\n    s0 = s1;\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseNumber() {\n    var s0, s1, s2, s3, s4, s5, s6, s7, s8;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 42;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    s1 = peg$parseSign();\n    if (s1 !== peg$FAILED) {\n      s2 = peg$currPos;\n      s3 = peg$currPos;\n      s4 = [];\n      rule$expects(peg$e87);\n      if (peg$r3.test(input.charAt(peg$currPos))) {\n        s5 = input.charAt(peg$currPos);\n        peg$currPos++;\n      } else {\n        s5 = peg$FAILED;\n      }\n      if (s5 !== peg$FAILED) {\n        while (s5 !== peg$FAILED) {\n          s4.push(s5);\n          rule$expects(peg$e87);\n          if (peg$r3.test(input.charAt(peg$currPos))) {\n            s5 = input.charAt(peg$currPos);\n            peg$currPos++;\n          } else {\n            s5 = peg$FAILED;\n          }\n        }\n      } else {\n        s4 = peg$FAILED;\n      }\n      if (s4 !== peg$FAILED) {\n        s5 = peg$currPos;\n        rule$expects(peg$e88);\n        if (input.charCodeAt(peg$currPos) === 46) {\n          s6 = peg$c85;\n          peg$currPos++;\n        } else {\n          s6 = peg$FAILED;\n        }\n        if (s6 !== peg$FAILED) {\n          s7 = [];\n          rule$expects(peg$e87);\n          if (peg$r3.test(input.charAt(peg$currPos))) {\n            s8 = input.charAt(peg$currPos);\n            peg$currPos++;\n          } else {\n            s8 = peg$FAILED;\n          }\n          if (s8 !== peg$FAILED) {\n            while (s8 !== peg$FAILED) {\n              s7.push(s8);\n              rule$expects(peg$e87);\n              if (peg$r3.test(input.charAt(peg$currPos))) {\n                s8 = input.charAt(peg$currPos);\n                peg$currPos++;\n              } else {\n                s8 = peg$FAILED;\n              }\n            }\n          } else {\n            s7 = peg$FAILED;\n          }\n          if (s7 !== peg$FAILED) {\n            s6 = [s6, s7];\n            s5 = s6;\n          } else {\n            peg$currPos = s5;\n            s5 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s5;\n          s5 = peg$FAILED;\n        }\n        if (s5 === peg$FAILED) {\n          s5 = null;\n        }\n        s4 = [s4, s5];\n        s3 = s4;\n      } else {\n        peg$currPos = s3;\n        s3 = peg$FAILED;\n      }\n      if (s3 !== peg$FAILED) {\n        s2 = input.substring(s2, peg$currPos);\n      } else {\n        s2 = s3;\n      }\n      if (s2 !== peg$FAILED) {\n        peg$savedPos = s0;\n        s0 = peg$f62(s1, s2);\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseUnsignedInteger() {\n    var s0, s1, s2, s3;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 43;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    s1 = peg$currPos;\n    s2 = [];\n    rule$expects(peg$e87);\n    if (peg$r3.test(input.charAt(peg$currPos))) {\n      s3 = input.charAt(peg$currPos);\n      peg$currPos++;\n    } else {\n      s3 = peg$FAILED;\n    }\n    if (s3 !== peg$FAILED) {\n      while (s3 !== peg$FAILED) {\n        s2.push(s3);\n        rule$expects(peg$e87);\n        if (peg$r3.test(input.charAt(peg$currPos))) {\n          s3 = input.charAt(peg$currPos);\n          peg$currPos++;\n        } else {\n          s3 = peg$FAILED;\n        }\n      }\n    } else {\n      s2 = peg$FAILED;\n    }\n    if (s2 !== peg$FAILED) {\n      s1 = input.substring(s1, peg$currPos);\n    } else {\n      s1 = s2;\n    }\n    if (s1 !== peg$FAILED) {\n      peg$savedPos = s0;\n      s1 = peg$f63(s1);\n    }\n    s0 = s1;\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseNull() {\n    var s0, s1;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 44;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    rule$expects(peg$e89);\n    if (input.substr(peg$currPos, 4) === peg$c86) {\n      s1 = peg$c86;\n      peg$currPos += 4;\n    } else {\n      s1 = peg$FAILED;\n    }\n    if (s1 !== peg$FAILED) {\n      peg$savedPos = s0;\n      s1 = peg$f64();\n    }\n    s0 = s1;\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseBoolean() {\n    var s0, s1;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 45;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    rule$expects(peg$e90);\n    if (input.substr(peg$currPos, 4) === peg$c87) {\n      s1 = peg$c87;\n      peg$currPos += 4;\n    } else {\n      s1 = peg$FAILED;\n    }\n    if (s1 !== peg$FAILED) {\n      peg$savedPos = s0;\n      s1 = peg$f65();\n    }\n    s0 = s1;\n    if (s0 === peg$FAILED) {\n      s0 = peg$currPos;\n      rule$expects(peg$e91);\n      if (input.substr(peg$currPos, 5) === peg$c88) {\n        s1 = peg$c88;\n        peg$currPos += 5;\n      } else {\n        s1 = peg$FAILED;\n      }\n      if (s1 !== peg$FAILED) {\n        peg$savedPos = s0;\n        s1 = peg$f66();\n      }\n      s0 = s1;\n    }\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseDuration() {\n    var s0, s1, s2, s3, s4, s5, s6, s7, s8, s9, s10, s11, s12;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 46;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    rule$expects(peg$e92);\n    if (input.substr(peg$currPos, 8) === peg$c89) {\n      s1 = peg$c89;\n      peg$currPos += 8;\n    } else {\n      s1 = peg$FAILED;\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = peg$parseApostrophe();\n      if (s2 !== peg$FAILED) {\n        s3 = peg$parseSign();\n        if (s3 !== peg$FAILED) {\n          rule$expects(peg$e93);\n          if (input.charCodeAt(peg$currPos) === 80) {\n            s4 = peg$c90;\n            peg$currPos++;\n          } else {\n            s4 = peg$FAILED;\n          }\n          if (s4 !== peg$FAILED) {\n            s5 = peg$currPos;\n            s6 = peg$parseUnsignedInteger();\n            if (s6 !== peg$FAILED) {\n              rule$expects(peg$e94);\n              if (input.charCodeAt(peg$currPos) === 68) {\n                s7 = peg$c91;\n                peg$currPos++;\n              } else {\n                s7 = peg$FAILED;\n              }\n              if (s7 !== peg$FAILED) {\n                s5 = s6;\n              } else {\n                peg$currPos = s5;\n                s5 = peg$FAILED;\n              }\n            } else {\n              peg$currPos = s5;\n              s5 = peg$FAILED;\n            }\n            if (s5 === peg$FAILED) {\n              s5 = null;\n            }\n            s6 = peg$currPos;\n            rule$expects(peg$e95);\n            if (input.charCodeAt(peg$currPos) === 84) {\n              s7 = peg$c92;\n              peg$currPos++;\n            } else {\n              s7 = peg$FAILED;\n            }\n            if (s7 !== peg$FAILED) {\n              s8 = peg$currPos;\n              s9 = peg$parseUnsignedInteger();\n              if (s9 !== peg$FAILED) {\n                rule$expects(peg$e96);\n                if (input.charCodeAt(peg$currPos) === 72) {\n                  s10 = peg$c93;\n                  peg$currPos++;\n                } else {\n                  s10 = peg$FAILED;\n                }\n                if (s10 !== peg$FAILED) {\n                  s8 = s9;\n                } else {\n                  peg$currPos = s8;\n                  s8 = peg$FAILED;\n                }\n              } else {\n                peg$currPos = s8;\n                s8 = peg$FAILED;\n              }\n              if (s8 === peg$FAILED) {\n                s8 = null;\n              }\n              s9 = peg$currPos;\n              s10 = peg$parseUnsignedInteger();\n              if (s10 !== peg$FAILED) {\n                rule$expects(peg$e97);\n                if (input.charCodeAt(peg$currPos) === 77) {\n                  s11 = peg$c94;\n                  peg$currPos++;\n                } else {\n                  s11 = peg$FAILED;\n                }\n                if (s11 !== peg$FAILED) {\n                  s9 = s10;\n                } else {\n                  peg$currPos = s9;\n                  s9 = peg$FAILED;\n                }\n              } else {\n                peg$currPos = s9;\n                s9 = peg$FAILED;\n              }\n              if (s9 === peg$FAILED) {\n                s9 = null;\n              }\n              s10 = peg$currPos;\n              s11 = peg$parseDurationNumber();\n              if (s11 !== peg$FAILED) {\n                rule$expects(peg$e98);\n                if (input.charCodeAt(peg$currPos) === 83) {\n                  s12 = peg$c95;\n                  peg$currPos++;\n                } else {\n                  s12 = peg$FAILED;\n                }\n                if (s12 !== peg$FAILED) {\n                  s10 = s11;\n                } else {\n                  peg$currPos = s10;\n                  s10 = peg$FAILED;\n                }\n              } else {\n                peg$currPos = s10;\n                s10 = peg$FAILED;\n              }\n              if (s10 === peg$FAILED) {\n                s10 = null;\n              }\n              peg$savedPos = peg$currPos;\n              s11 = peg$f67(s3, s5, s8, s9, s10);\n              if (s11) {\n                s11 = undefined;\n              } else {\n                s11 = peg$FAILED;\n              }\n              if (s11 !== peg$FAILED) {\n                peg$savedPos = s6;\n                s6 = peg$f68(s3, s5, s8, s9, s10);\n              } else {\n                peg$currPos = s6;\n                s6 = peg$FAILED;\n              }\n            } else {\n              peg$currPos = s6;\n              s6 = peg$FAILED;\n            }\n            if (s6 === peg$FAILED) {\n              s6 = null;\n            }\n            peg$savedPos = peg$currPos;\n            s7 = peg$f69(s3, s5, s6);\n            if (s7) {\n              s7 = undefined;\n            } else {\n              s7 = peg$FAILED;\n            }\n            if (s7 !== peg$FAILED) {\n              s8 = peg$parseApostrophe();\n              if (s8 !== peg$FAILED) {\n                peg$savedPos = s0;\n                s0 = peg$f70(s3, s5, s6);\n              } else {\n                peg$currPos = s0;\n                s0 = peg$FAILED;\n              }\n            } else {\n              peg$currPos = s0;\n              s0 = peg$FAILED;\n            }\n          } else {\n            peg$currPos = s0;\n            s0 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseDurationNumber() {\n    var s0, s1, s2, s3, s4, s5, s6;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 47;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    s1 = peg$currPos;\n    s2 = peg$currPos;\n    s3 = [];\n    rule$expects(peg$e87);\n    if (peg$r3.test(input.charAt(peg$currPos))) {\n      s4 = input.charAt(peg$currPos);\n      peg$currPos++;\n    } else {\n      s4 = peg$FAILED;\n    }\n    if (s4 !== peg$FAILED) {\n      while (s4 !== peg$FAILED) {\n        s3.push(s4);\n        rule$expects(peg$e87);\n        if (peg$r3.test(input.charAt(peg$currPos))) {\n          s4 = input.charAt(peg$currPos);\n          peg$currPos++;\n        } else {\n          s4 = peg$FAILED;\n        }\n      }\n    } else {\n      s3 = peg$FAILED;\n    }\n    if (s3 !== peg$FAILED) {\n      rule$expects(peg$e88);\n      if (input.charCodeAt(peg$currPos) === 46) {\n        s4 = peg$c85;\n        peg$currPos++;\n      } else {\n        s4 = peg$FAILED;\n      }\n      if (s4 !== peg$FAILED) {\n        s5 = [];\n        rule$expects(peg$e87);\n        if (peg$r3.test(input.charAt(peg$currPos))) {\n          s6 = input.charAt(peg$currPos);\n          peg$currPos++;\n        } else {\n          s6 = peg$FAILED;\n        }\n        if (s6 !== peg$FAILED) {\n          while (s6 !== peg$FAILED) {\n            s5.push(s6);\n            rule$expects(peg$e87);\n            if (peg$r3.test(input.charAt(peg$currPos))) {\n              s6 = input.charAt(peg$currPos);\n              peg$currPos++;\n            } else {\n              s6 = peg$FAILED;\n            }\n          }\n        } else {\n          s5 = peg$FAILED;\n        }\n        if (s5 !== peg$FAILED) {\n          s3 = [s3, s4, s5];\n          s2 = s3;\n        } else {\n          peg$currPos = s2;\n          s2 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s2;\n        s2 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s2;\n      s2 = peg$FAILED;\n    }\n    if (s2 !== peg$FAILED) {\n      s1 = input.substring(s1, peg$currPos);\n    } else {\n      s1 = s2;\n    }\n    if (s1 !== peg$FAILED) {\n      peg$savedPos = s0;\n      s1 = peg$f71(s1);\n    }\n    s0 = s1;\n    if (s0 === peg$FAILED) {\n      s0 = peg$parseUnsignedInteger();\n    }\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseText() {\n    var s0, s1, s2, s3;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 48;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    s1 = peg$currPos;\n    s2 = [];\n    rule$expects(peg$e99);\n    if (peg$r4.test(input.charAt(peg$currPos))) {\n      s3 = input.charAt(peg$currPos);\n      peg$currPos++;\n    } else {\n      s3 = peg$FAILED;\n    }\n    while (s3 !== peg$FAILED) {\n      s2.push(s3);\n      rule$expects(peg$e99);\n      if (peg$r4.test(input.charAt(peg$currPos))) {\n        s3 = input.charAt(peg$currPos);\n        peg$currPos++;\n      } else {\n        s3 = peg$FAILED;\n      }\n    }\n    s1 = input.substring(s1, peg$currPos);\n    peg$savedPos = s0;\n    s1 = peg$f72(s1);\n    s0 = s1;\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseSign() {\n    var s0, s1;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 49;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    rule$expects(peg$e21);\n    if (input.charCodeAt(peg$currPos) === 43) {\n      s0 = peg$c21;\n      peg$currPos++;\n    } else {\n      s0 = peg$FAILED;\n    }\n    if (s0 === peg$FAILED) {\n      s0 = peg$currPos;\n      rule$expects(peg$e100);\n      if (input.substr(peg$currPos, 3) === peg$c96) {\n        s1 = peg$c96;\n        peg$currPos += 3;\n      } else {\n        s1 = peg$FAILED;\n      }\n      if (s1 !== peg$FAILED) {\n        peg$savedPos = s0;\n        s1 = peg$f73();\n      }\n      s0 = s1;\n      if (s0 === peg$FAILED) {\n        rule$expects(peg$e101);\n        if (input.charCodeAt(peg$currPos) === 45) {\n          s0 = peg$c97;\n          peg$currPos++;\n        } else {\n          s0 = peg$FAILED;\n        }\n        if (s0 === peg$FAILED) {\n          s0 = '';\n        }\n      }\n    }\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseApostrophe() {\n    var s0, s1;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 50;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    rule$expects(peg$e102);\n    if (input.charCodeAt(peg$currPos) === 39) {\n      s0 = peg$c98;\n      peg$currPos++;\n    } else {\n      s0 = peg$FAILED;\n    }\n    if (s0 === peg$FAILED) {\n      s0 = peg$currPos;\n      rule$expects(peg$e103);\n      if (input.substr(peg$currPos, 3) === peg$c99) {\n        s1 = peg$c99;\n        peg$currPos += 3;\n      } else {\n        s1 = peg$FAILED;\n      }\n      if (s1 !== peg$FAILED) {\n        peg$savedPos = s0;\n        s1 = peg$f74();\n      }\n      s0 = s1;\n    }\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseQuotedText() {\n    var s0, s1, s2, s3, s4, s5;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 51;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    s1 = peg$parseApostrophe();\n    if (s1 !== peg$FAILED) {\n      s2 = [];\n      s3 = peg$currPos;\n      s4 = peg$parseApostrophe();\n      if (s4 !== peg$FAILED) {\n        s5 = peg$parseApostrophe();\n        if (s5 !== peg$FAILED) {\n          s3 = s5;\n        } else {\n          peg$currPos = s3;\n          s3 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s3;\n        s3 = peg$FAILED;\n      }\n      if (s3 === peg$FAILED) {\n        s3 = peg$currPos;\n        s4 = peg$currPos;\n        peg$begin();\n        s5 = peg$parseApostrophe();\n        peg$end(true);\n        if (s5 === peg$FAILED) {\n          s4 = undefined;\n        } else {\n          peg$currPos = s4;\n          s4 = peg$FAILED;\n        }\n        if (s4 !== peg$FAILED) {\n          rule$expects(peg$e104);\n          if (input.length > peg$currPos) {\n            s5 = input.charAt(peg$currPos);\n            peg$currPos++;\n          } else {\n            s5 = peg$FAILED;\n          }\n          if (s5 !== peg$FAILED) {\n            s3 = s5;\n          } else {\n            peg$currPos = s3;\n            s3 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s3;\n          s3 = peg$FAILED;\n        }\n      }\n      while (s3 !== peg$FAILED) {\n        s2.push(s3);\n        s3 = peg$currPos;\n        s4 = peg$parseApostrophe();\n        if (s4 !== peg$FAILED) {\n          s5 = peg$parseApostrophe();\n          if (s5 !== peg$FAILED) {\n            s3 = s5;\n          } else {\n            peg$currPos = s3;\n            s3 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s3;\n          s3 = peg$FAILED;\n        }\n        if (s3 === peg$FAILED) {\n          s3 = peg$currPos;\n          s4 = peg$currPos;\n          peg$begin();\n          s5 = peg$parseApostrophe();\n          peg$end(true);\n          if (s5 === peg$FAILED) {\n            s4 = undefined;\n          } else {\n            peg$currPos = s4;\n            s4 = peg$FAILED;\n          }\n          if (s4 !== peg$FAILED) {\n            rule$expects(peg$e104);\n            if (input.length > peg$currPos) {\n              s5 = input.charAt(peg$currPos);\n              peg$currPos++;\n            } else {\n              s5 = peg$FAILED;\n            }\n            if (s5 !== peg$FAILED) {\n              s3 = s5;\n            } else {\n              peg$currPos = s3;\n              s3 = peg$FAILED;\n            }\n          } else {\n            peg$currPos = s3;\n            s3 = peg$FAILED;\n          }\n        }\n      }\n      s3 = peg$parseApostrophe();\n      if (s3 !== peg$FAILED) {\n        peg$savedPos = s0;\n        s0 = peg$f75(s2);\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseParameterAlias() {\n    var s0, s1, s2;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 52;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    rule$expects(peg$e4);\n    if (input.charCodeAt(peg$currPos) === 64) {\n      s1 = peg$c5;\n      peg$currPos++;\n    } else {\n      s1 = peg$FAILED;\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = peg$parseResourceName();\n      if (s2 !== peg$FAILED) {\n        peg$savedPos = s0;\n        s0 = peg$f76(s2);\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseNumberBind() {\n    var s0, s1;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 53;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    s1 = peg$parseNumber();\n    if (s1 !== peg$FAILED) {\n      peg$savedPos = s0;\n      s1 = peg$f77(s1);\n    }\n    s0 = s1;\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseDate() {\n    var s0, s1, s2, s3;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 54;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    s1 = peg$currPos;\n    rule$expects(peg$e105);\n    if (input.substr(peg$currPos, 8) === peg$c100) {\n      s2 = peg$c100;\n      peg$currPos += 8;\n    } else {\n      s2 = peg$FAILED;\n    }\n    if (s2 !== peg$FAILED) {\n      peg$savedPos = s1;\n      s2 = peg$f78();\n    }\n    s1 = s2;\n    if (s1 === peg$FAILED) {\n      s1 = peg$currPos;\n      rule$expects(peg$e52);\n      if (input.substr(peg$currPos, 4) === peg$c52) {\n        s2 = peg$c52;\n        peg$currPos += 4;\n      } else {\n        s2 = peg$FAILED;\n      }\n      if (s2 !== peg$FAILED) {\n        peg$savedPos = s1;\n        s2 = peg$f79();\n      }\n      s1 = s2;\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = peg$currPos;\n      s3 = peg$parseQuotedText();\n      if (s3 !== peg$FAILED) {\n        peg$savedPos = s2;\n        s3 = peg$f80(s1, s3);\n      }\n      s2 = s3;\n      if (s2 !== peg$FAILED) {\n        peg$savedPos = peg$currPos;\n        s3 = peg$f81(s1, s2);\n        if (s3) {\n          s3 = peg$FAILED;\n        } else {\n          s3 = undefined;\n        }\n        if (s3 !== peg$FAILED) {\n          peg$savedPos = s0;\n          s0 = peg$f82(s1, s2);\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseDateBind() {\n    var s0, s1;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 55;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    s1 = peg$parseDate();\n    if (s1 !== peg$FAILED) {\n      peg$savedPos = s0;\n      s1 = peg$f83(s1);\n    }\n    s0 = s1;\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseBooleanBind() {\n    var s0, s1;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 56;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    s1 = peg$parseBoolean();\n    if (s1 !== peg$FAILED) {\n      peg$savedPos = s0;\n      s1 = peg$f84(s1);\n    }\n    s0 = s1;\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseContentReference() {\n    var s0, s1, s2;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 57;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    rule$expects(peg$e106);\n    if (input.charCodeAt(peg$currPos) === 36) {\n      s1 = peg$c3;\n      peg$currPos++;\n    } else {\n      s1 = peg$FAILED;\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = peg$parseResourceName();\n      if (s2 !== peg$FAILED) {\n        peg$savedPos = s0;\n        s0 = peg$f85(s2);\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parseQuotedTextBind() {\n    var s0, s1;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 58;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = peg$currPos;\n    s1 = peg$parseQuotedText();\n    if (s1 !== peg$FAILED) {\n      peg$savedPos = s0;\n      s1 = peg$f86(s1);\n    }\n    s0 = s1;\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n  function peg$parsespaces() {\n    var s0, s1;\n\n    var rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n    }\n\n    var key = peg$currPos * 60 + 59;\n    var cached = peg$resultsCache[key];\n    var rule$expectations = [];\n\n    rule$expects = function (expected) {\n      if (peg$silentFails === 0) peg$expect(expected);\n      rule$expectations.push(expected);\n    }\n\n    if (cached) {\n      peg$currPos = cached.nextPos;\n\n      rule$expectations = cached.expectations;\n      if (peg$silentFails === 0) {\n        rule$expectations.forEach(peg$expect);\n      }\n\n      return cached.result;\n    }\n\n    s0 = [];\n    rule$expects(peg$e107);\n    if (input.charCodeAt(peg$currPos) === 32) {\n      s1 = peg$c101;\n      peg$currPos++;\n    } else {\n      s1 = peg$FAILED;\n    }\n    if (s1 === peg$FAILED) {\n      rule$expects(peg$e108);\n      if (input.substr(peg$currPos, 3) === peg$c102) {\n        s1 = peg$c102;\n        peg$currPos += 3;\n      } else {\n        s1 = peg$FAILED;\n      }\n      if (s1 === peg$FAILED) {\n        rule$expects(peg$e21);\n        if (input.charCodeAt(peg$currPos) === 43) {\n          s1 = peg$c21;\n          peg$currPos++;\n        } else {\n          s1 = peg$FAILED;\n        }\n      }\n    }\n    while (s1 !== peg$FAILED) {\n      s0.push(s1);\n      rule$expects(peg$e107);\n      if (input.charCodeAt(peg$currPos) === 32) {\n        s1 = peg$c101;\n        peg$currPos++;\n      } else {\n        s1 = peg$FAILED;\n      }\n      if (s1 === peg$FAILED) {\n        rule$expects(peg$e108);\n        if (input.substr(peg$currPos, 3) === peg$c102) {\n          s1 = peg$c102;\n          peg$currPos += 3;\n        } else {\n          s1 = peg$FAILED;\n        }\n        if (s1 === peg$FAILED) {\n          rule$expects(peg$e21);\n          if (input.charCodeAt(peg$currPos) === 43) {\n            s1 = peg$c21;\n            peg$currPos++;\n          } else {\n            s1 = peg$FAILED;\n          }\n        }\n      }\n    }\n\n    peg$resultsCache[key] = {\n      nextPos: peg$currPos,\n      result: s0,\n      expectations: rule$expectations\n    };\n\n    return s0;\n  }\n\n\n  \tvar methods = {\n  \t\tcast: [ 1, 2 ],\n  \t\tceiling: 1,\n  \t\tconcat: 2,\n  \t\tcontains: 2,\n  \t\tdate: 1,\n  \t\tday: 1,\n  \t\tendswith: 2,\n  \t\tfloor: 1,\n  \t\tfractionalseconds: 1,\n  \t\thour: 1,\n  \t\tindexof: 2,\n  \t\tisof: [ 1, 2 ],\n  \t\tlength: 1,\n  \t\tmaxdatetime: 0,\n  \t\tmindatetime: 0,\n  \t\tminute: 1,\n  \t\tmonth: 1,\n  \t\tnow: 0,\n  \t\treplace: 3,\n  \t\tround: 1,\n  \t\tsecond: 1,\n  \t\tstartswith: 2,\n  \t\tsubstringof: 2,\n  \t\tsubstring: [ 2, 3 ],\n  \t\ttime: 1,\n  \t\ttolower: 1,\n  \t\ttotaloffsetminutes: 1,\n  \t\ttotalseconds: 1,\n  \t\ttoupper: 1,\n  \t\ttrim: 1,\n  \t\tyear: 1\n  \t};\n\n  \tvar operatorPrecedence = {\n  \t\tor: 0,\n  \t\tand: 0,\n  \t\teq: 1,\n  \t\tne: 1,\n  \t\tgt: 1,\n  \t\tge: 1,\n  \t\tlt: 1,\n  \t\tle: 1,\n  \t\tsub: 2,\n  \t\tadd: 3,\n  \t\tmod: 4,\n  \t\tdiv: 5,\n  \t\tmul: 6\n  \t};\n\n  \t// v4 operator precedence\n  \t// var operatorPrecedence = {\n  \t// \tor: 0,\n  \t// \tand: 1,\n  \t// \teq: 2,\n  \t// \tne: 2,\n  \t// \tgt: 3,\n  \t// \tge: 3,\n  \t// \tlt: 3,\n  \t// \tle: 3,\n  \t// \tadd: 4,\n  \t// \tsub: 4,\n  \t// \tmul: 5,\n  \t// \tdiv: 5,\n  \t// \tmod: 5\n  \t// };\n\n  \tvar binds = [];\n  \tvar precedence = 0;\n  \tfunction reset() {\n  \t\tbinds = [];\n  \t\tprecedence = 0;\n  \t};\n\n  \tfunction CollapseObjectArray(options) {\n  \t\tvar optionsObj = {};\n  \t\tfor(var i in options) {\n  \t\t\toptionsObj[options[i].name] = options[i].value;\n  \t\t}\n  \t\treturn optionsObj;\n  \t};\n\n  \tfunction Bind(type, value) {\n  \t\tbinds.push([type, value])\n  \t\treturn { bind: binds.length - 1 }\n  \t}\n\n\n  peg$begin();\n  peg$result = peg$startRuleFunction();\n\n  if (peg$result !== peg$FAILED && peg$currPos === input.length) {\n    return peg$result;\n  } else {\n    if (peg$result !== peg$FAILED && peg$currPos < input.length) {\n      peg$expect(peg$endExpectation());\n    }\n\n    throw peg$buildError();\n  }\n}\n\nmodule.exports = {\n  SyntaxError: peg$SyntaxError,\n  parse: peg$parse\n};\n","import type { Resolvable } from './common-types';\n\nimport * as _ from 'lodash';\n\nexport type MappingFunction = <T, U>(\n\ta: T[],\n\tfn: (v: T) => Resolvable<U>,\n) => Promise<Array<U | Error>>;\n\n// The settle version of `Promise.mapSeries`\nexport const settleMapSeries: MappingFunction = async <T, U>(\n\ta: T[],\n\tfn: (v: T) => Resolvable<U>,\n) => {\n\tconst results: Array<U | Error> = [];\n\tfor (const p of a) {\n\t\ttry {\n\t\t\tconst result = await fn(p);\n\t\t\tresults.push(result);\n\t\t} catch (err) {\n\t\t\tresults.push(ensureError(err));\n\t\t}\n\t}\n\treturn results;\n};\n\n// This is used to guarantee that we convert a `.catch` result into an error, so that later code checking `_.isError` will work as expected\nconst ensureError = (err: any): Error => {\n\tif (err instanceof Error || _.isError(err)) {\n\t\treturn err;\n\t}\n\treturn new Error(err);\n};\n\n// Maps fn over collection and returns an array of Promises. If any promise in the\n// collection is rejected it returns an array with the error, along with all the\n// promises that were fulfilled up to that point\nconst mapTill: MappingFunction = async <T, U>(\n\ta: T[],\n\tfn: (v: T) => Resolvable<U>,\n) => {\n\tconst results: Array<U | Error> = [];\n\tfor (const p of a) {\n\t\ttry {\n\t\t\tconst result = await fn(p);\n\t\t\tresults.push(result);\n\t\t} catch (err) {\n\t\t\tresults.push(ensureError(err));\n\t\t\tbreak;\n\t\t}\n\t}\n\treturn results;\n};\n\n// Used to obtain the appropriate mapping function depending on the\n// semantics specified by the Prefer: header.\nexport const getMappingFn = (headers?: {\n\tprefer?: string | string[];\n\t[key: string]: string | string[] | undefined;\n}): MappingFunction => {\n\tif (headers != null && headers.prefer === 'odata.continue-on-error') {\n\t\treturn settleMapSeries;\n\t} else {\n\t\treturn mapTill;\n\t}\n};\n","import type * as AbstractSQLCompiler from '@balena/abstract-sql-compiler';\nimport type {\n\tODataBinds,\n\tODataOptions,\n\tODataQuery,\n\tSupportedMethod,\n} from '@balena/odata-parser';\nimport type { Tx } from '../database-layer/db';\nimport type { InstantiatedHooks } from './hooks';\nimport type { AnyObject } from './common-types';\n\nimport * as ODataParser from '@balena/odata-parser';\nimport * as Bluebird from 'bluebird';\nexport const SyntaxError = ODataParser.SyntaxError;\nimport { OData2AbstractSQL } from '@balena/odata-to-abstract-sql';\nimport * as _ from 'lodash';\nimport * as memoize from 'memoizee';\nimport memoizeWeak = require('memoizee/weak');\n\nexport { BadRequestError, ParsingError, TranslationError } from './errors';\nimport * as deepFreeze from 'deep-freeze';\nimport * as env from '../config-loader/env';\nimport {\n\tBadRequestError,\n\tParsingError,\n\tPermissionError,\n\tTranslationError,\n} from './errors';\nimport * as sbvrUtils from './sbvr-utils';\n\nexport type OdataBinds = ODataBinds;\n\nexport interface UnparsedRequest {\n\tmethod: string;\n\turl: string;\n\tdata?: any;\n\theaders?: { [header: string]: string };\n\tchangeSet?: UnparsedRequest[];\n\t_isChangeSet?: boolean;\n}\n\nexport interface ODataRequest {\n\tmethod: SupportedMethod;\n\turl: string;\n\todataQuery: ODataQuery;\n\todataBinds: OdataBinds;\n\tvalues: AnyObject;\n\tabstractSqlModel?: AbstractSQLCompiler.AbstractSqlModel;\n\tabstractSqlQuery?: AbstractSQLCompiler.AbstractSqlQuery;\n\tsqlQuery?: AbstractSQLCompiler.SqlResult | AbstractSQLCompiler.SqlResult[];\n\tresourceName: string;\n\tvocabulary: string;\n\t_defer?: boolean;\n\tid?: number;\n\tcustom: AnyObject;\n\ttx?: Tx;\n\tmodifiedFields?: ReturnType<\n\t\tAbstractSQLCompiler.EngineInstance['getModifiedFields']\n\t>;\n\taffectedIds?: number[];\n\tpendingAffectedIds?: Promise<number[]>;\n\thooks?: InstantiatedHooks;\n\tengine?: AbstractSQLCompiler.Engines;\n}\n\n// Converts a value to its string representation and tries to parse is as an\n// OData bind\nexport const parseId = (b: any) => {\n\tconst { tree, binds } = ODataParser.parse(String(b), {\n\t\tstartRule: 'ProcessRule',\n\t\trule: 'KeyBind',\n\t});\n\treturn binds[tree.bind];\n};\n\nexport const memoizedParseOdata = (() => {\n\tconst parseOdata = (url: string) => {\n\t\tconst odata = ODataParser.parse(url);\n\t\t// if we parse a canAccess action rewrite the resource to ensure we\n\t\t// do not run the resource hooks\n\t\tif (\n\t\t\todata.tree.property != null &&\n\t\t\todata.tree.property.resource === 'canAccess'\n\t\t) {\n\t\t\todata.tree.resource =\n\t\t\t\todata.tree.resource + '#' + odata.tree.property.resource;\n\t\t}\n\t\treturn odata;\n\t};\n\n\tconst _memoizedParseOdata = memoize(parseOdata, {\n\t\tprimitive: true,\n\t\tmax: env.cache.parseOData.max,\n\t});\n\treturn (url: string) => {\n\t\tconst queryParamsIndex = url.indexOf('?');\n\t\tif (queryParamsIndex !== -1) {\n\t\t\tif (/[?&(]@/.test(url)) {\n\t\t\t\t// Try to cache based on parameter aliases if there might be some\n\t\t\t\tconst parameterAliases = new URLSearchParams();\n\t\t\t\tconst queryParams = new URLSearchParams(url.slice(queryParamsIndex));\n\t\t\t\tArray.from(queryParams.entries()).forEach(([key, value]) => {\n\t\t\t\t\tif (key.startsWith('@')) {\n\t\t\t\t\t\tparameterAliases.append(key, value);\n\t\t\t\t\t\tqueryParams.delete(key);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tconst parameterAliasesString = parameterAliases.toString();\n\t\t\t\tif (parameterAliasesString !== '') {\n\t\t\t\t\tconst parsed = _.cloneDeep(\n\t\t\t\t\t\t_memoizedParseOdata(\n\t\t\t\t\t\t\turl.slice(0, queryParamsIndex) +\n\t\t\t\t\t\t\t\t'?' +\n\t\t\t\t\t\t\t\tdecodeURIComponent(queryParams.toString()),\n\t\t\t\t\t\t),\n\t\t\t\t\t);\n\t\t\t\t\tconst parsedParams = ODataParser.parse(\n\t\t\t\t\t\tdecodeURIComponent(parameterAliasesString),\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tstartRule: 'ProcessRule',\n\t\t\t\t\t\t\trule: 'QueryOptions',\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\t\t\t\t\tparsed.tree.options ??= {};\n\t\t\t\t\tfor (const key of Object.keys(parsedParams.tree)) {\n\t\t\t\t\t\tparsed.tree.options[key] = parsedParams.tree[key];\n\t\t\t\t\t\tparsed.binds[key] = parsedParams.binds[key];\n\t\t\t\t\t}\n\t\t\t\t\treturn parsed;\n\t\t\t\t}\n\t\t\t}\n\t\t\t// If we're doing a complex url then skip caching due to # of permutations\n\t\t\treturn parseOdata(url);\n\t\t} else if (url.includes('(')) {\n\t\t\t// We're parsing a url like `/pilot(1)` so whilst there are no query options\n\t\t\t// there are still enough permutations to ruin the hit %\n\t\t\treturn parseOdata(url);\n\t\t} else {\n\t\t\t// Else if it's simple we can easily skip the parsing as we know we'll get a high % hit rate\n\t\t\t// We deep clone to avoid mutations polluting the cache\n\t\t\treturn _.cloneDeep(_memoizedParseOdata(url));\n\t\t}\n\t};\n})();\n\nexport const memoizedGetOData2AbstractSQL = memoizeWeak(\n\t(abstractSqlModel: AbstractSQLCompiler.AbstractSqlModel) => {\n\t\treturn new OData2AbstractSQL(abstractSqlModel);\n\t},\n);\n\nconst memoizedOdata2AbstractSQL = (() => {\n\tconst $memoizedOdata2AbstractSQL = memoizeWeak(\n\t\t(\n\t\t\tabstractSqlModel: AbstractSQLCompiler.AbstractSqlModel,\n\t\t\todataQuery: ODataQuery,\n\t\t\tmethod: SupportedMethod,\n\t\t\tbodyKeys: string[],\n\t\t\texistingBindVarsLength: number,\n\t\t) => {\n\t\t\ttry {\n\t\t\t\tconst odata2AbstractSQL = memoizedGetOData2AbstractSQL(\n\t\t\t\t\tabstractSqlModel,\n\t\t\t\t);\n\t\t\t\tconst abstractSql = odata2AbstractSQL.match(\n\t\t\t\t\todataQuery,\n\t\t\t\t\tmethod,\n\t\t\t\t\tbodyKeys,\n\t\t\t\t\texistingBindVarsLength,\n\t\t\t\t);\n\t\t\t\t// We deep freeze to prevent mutations, which would pollute the cache\n\t\t\t\tdeepFreeze(abstractSql);\n\t\t\t\treturn abstractSql;\n\t\t\t} catch (e) {\n\t\t\t\tif (e instanceof PermissionError) {\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t\tconsole.error(\n\t\t\t\t\t'Failed to translate url: ',\n\t\t\t\t\tJSON.stringify(odataQuery, null, '\\t'),\n\t\t\t\t\tmethod,\n\t\t\t\t\te,\n\t\t\t\t);\n\t\t\t\tthrow new TranslationError('Failed to translate url');\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\tnormalizer: (\n\t\t\t\t_abstractSqlModel: AbstractSQLCompiler.AbstractSqlModel,\n\t\t\t\t[odataQuery, method, bodyKeys, existingBindVarsLength]: [\n\t\t\t\t\tODataQuery,\n\t\t\t\t\tSupportedMethod,\n\t\t\t\t\tstring[],\n\t\t\t\t\tnumber,\n\t\t\t\t],\n\t\t\t) => {\n\t\t\t\treturn (\n\t\t\t\t\tJSON.stringify(odataQuery) +\n\t\t\t\t\tmethod +\n\t\t\t\t\tbodyKeys +\n\t\t\t\t\texistingBindVarsLength\n\t\t\t\t);\n\t\t\t},\n\t\t\tmax: env.cache.odataToAbstractSql.max,\n\t\t},\n\t);\n\n\treturn (\n\t\trequest: Pick<\n\t\t\tODataRequest,\n\t\t\t| 'method'\n\t\t\t| 'odataQuery'\n\t\t\t| 'odataBinds'\n\t\t\t| 'values'\n\t\t\t| 'vocabulary'\n\t\t\t| 'abstractSqlModel'\n\t\t>,\n\t) => {\n\t\tconst { method, odataBinds, values } = request;\n\t\tlet { odataQuery } = request;\n\t\tconst abstractSqlModel = sbvrUtils.getAbstractSqlModel(request);\n\t\t// Sort the body keys to improve cache hits\n\t\tconst sortedBody = Object.keys(values).sort();\n\t\t// Remove unused options for odata-to-abstract-sql to improve cache hits\n\t\tif (odataQuery.options) {\n\t\t\todataQuery = {\n\t\t\t\t...odataQuery,\n\t\t\t\toptions: _.pick(\n\t\t\t\t\todataQuery.options,\n\t\t\t\t\t'$select',\n\t\t\t\t\t'$filter',\n\t\t\t\t\t'$expand',\n\t\t\t\t\t'$orderby',\n\t\t\t\t\t'$top',\n\t\t\t\t\t'$skip',\n\t\t\t\t\t'$count',\n\t\t\t\t\t'$inlinecount',\n\t\t\t\t\t'$format',\n\t\t\t\t) as ODataOptions,\n\t\t\t};\n\t\t}\n\t\tconst { tree, extraBodyVars, extraBindVars } = $memoizedOdata2AbstractSQL(\n\t\t\tabstractSqlModel,\n\t\t\todataQuery,\n\t\t\tmethod,\n\t\t\tsortedBody,\n\t\t\todataBinds.length,\n\t\t);\n\t\tObject.assign(values, extraBodyVars);\n\t\todataBinds.push(...extraBindVars);\n\t\treturn tree;\n\t};\n})();\n\nexport const metadataEndpoints = ['$metadata', '$serviceroot'];\n\nexport async function parseOData(\n\tb: UnparsedRequest & { _isChangeSet?: false },\n): Promise<ODataRequest>;\nexport async function parseOData(\n\tb: UnparsedRequest & { _isChangeSet: true },\n): Promise<ODataRequest[]>;\nexport async function parseOData(\n\tb: UnparsedRequest,\n): Promise<ODataRequest | ODataRequest[]>;\nexport async function parseOData(\n\tb: UnparsedRequest,\n): Promise<ODataRequest | ODataRequest[]> {\n\ttry {\n\t\tif (b._isChangeSet && b.changeSet != null) {\n\t\t\t// We sort the CS set once, we must assure that requests which reference\n\t\t\t// other requests in the changeset are placed last. Once they are sorted\n\t\t\t// Map will guarantee retrival of results in insertion order\n\t\t\tconst sortedCS = _.sortBy(b.changeSet, (el) => el.url[0] !== '/');\n\t\t\tconst csReferences = await Bluebird.reduce(\n\t\t\t\tsortedCS,\n\t\t\t\tparseODataChangeset,\n\t\t\t\tnew Map<ODataRequest['id'], ODataRequest>(),\n\t\t\t);\n\t\t\treturn Array.from(csReferences.values()) as ODataRequest[];\n\t\t} else {\n\t\t\tconst { url, apiRoot } = splitApiRoot(b.url);\n\t\t\tconst odata = memoizedParseOdata(url);\n\n\t\t\treturn {\n\t\t\t\tmethod: b.method as SupportedMethod,\n\t\t\t\turl,\n\t\t\t\tvocabulary: apiRoot,\n\t\t\t\tresourceName: odata.tree.resource,\n\t\t\t\todataBinds: odata.binds,\n\t\t\t\todataQuery: odata.tree,\n\t\t\t\tvalues: b.data ?? {},\n\t\t\t\tcustom: {},\n\t\t\t\t_defer: false,\n\t\t\t};\n\t\t}\n\t} catch (err) {\n\t\tif (err instanceof ODataParser.SyntaxError) {\n\t\t\tthrow new BadRequestError(`Malformed url: '${b.url}'`);\n\t\t}\n\t\tif (!(err instanceof BadRequestError || err instanceof ParsingError)) {\n\t\t\tconsole.error('Failed to parse url: ', b.method, b.url, err);\n\t\t\tthrow new ParsingError(`Failed to parse url: '${b.url}'`);\n\t\t}\n\t\tthrow err;\n\t}\n}\n\nconst parseODataChangeset = (\n\tcsReferences: Map<ODataRequest['id'], ODataRequest>,\n\tb: UnparsedRequest,\n) => {\n\tconst contentId: ODataRequest['id'] = mustExtractHeader(b, 'content-id');\n\n\tif (csReferences.has(contentId)) {\n\t\tthrow new BadRequestError('Content-Id must be unique inside a changeset');\n\t}\n\n\tlet defer: boolean;\n\tlet odata;\n\tlet apiRoot: string;\n\tlet url;\n\n\tif (b.url[0] === '/') {\n\t\t({ url, apiRoot } = splitApiRoot(b.url));\n\t\todata = memoizedParseOdata(url);\n\t\tdefer = false;\n\t} else {\n\t\turl = b.url;\n\t\todata = memoizedParseOdata(url);\n\t\tconst { bind } = odata.tree.resource;\n\t\tconst [, id] = odata.binds[bind];\n\t\t// Use reference to collect information\n\t\tconst ref = csReferences.get(id);\n\t\tif (ref === undefined) {\n\t\t\tthrow new BadRequestError('Content-Id refers to a non existent resource');\n\t\t}\n\t\tapiRoot = ref.vocabulary;\n\t\t// Update resource with actual resourceName\n\t\todata.tree.resource = ref.resourceName;\n\t\tdefer = true;\n\t}\n\n\tconst parseResult: ODataRequest = {\n\t\tmethod: b.method as SupportedMethod,\n\t\turl,\n\t\tvocabulary: apiRoot,\n\t\tresourceName: odata.tree.resource,\n\t\todataBinds: odata.binds,\n\t\todataQuery: odata.tree,\n\t\tvalues: b.data ?? {},\n\t\tcustom: {},\n\t\tid: contentId,\n\t\t_defer: defer,\n\t};\n\tcsReferences.set(contentId, parseResult);\n\treturn csReferences;\n};\n\nconst splitApiRoot = (url: string) => {\n\tconst urlParts = url.split('/');\n\tconst apiRoot = urlParts[1];\n\tif (apiRoot == null) {\n\t\tthrow new ParsingError(`No such api root: ${apiRoot}`);\n\t}\n\turl = '/' + urlParts.slice(2).join('/');\n\treturn { url, apiRoot };\n};\n\nconst mustExtractHeader = (\n\tbody: { headers?: { [header: string]: string } },\n\theader: string,\n) => {\n\tconst h: any = body.headers?.[header]?.[0];\n\tif (_.isEmpty(h)) {\n\t\tthrow new BadRequestError(`${header} must be specified`);\n\t}\n\treturn h;\n};\n\nexport const translateUri = <\n\tT extends Pick<\n\t\tODataRequest,\n\t\t| 'method'\n\t\t| 'odataQuery'\n\t\t| 'odataBinds'\n\t\t| 'values'\n\t\t| 'vocabulary'\n\t\t| 'resourceName'\n\t\t| 'abstractSqlModel'\n\t>\n>(\n\trequest: T & {\n\t\tabstractSqlQuery?: ODataRequest['abstractSqlQuery'];\n\t},\n): typeof request => {\n\tif (request.abstractSqlQuery != null) {\n\t\treturn request;\n\t}\n\tconst isMetadataEndpoint =\n\t\tmetadataEndpoints.includes(request.resourceName) ||\n\t\trequest.method === 'OPTIONS';\n\tif (!isMetadataEndpoint) {\n\t\tconst abstractSqlQuery = memoizedOdata2AbstractSQL(request);\n\t\trequest = { ...request };\n\t\trequest.abstractSqlQuery = abstractSqlQuery;\n\t\treturn request;\n\t}\n\treturn request;\n};\n","\"use strict\";\n\nvar aFrom  = require(\"../array/from\")\n  , assign = require(\"./assign\")\n  , value  = require(\"./valid-value\");\n\nmodule.exports = function (obj/*, propertyNames, options*/) {\n\tvar copy = Object(value(obj)), propertyNames = arguments[1], options = Object(arguments[2]);\n\tif (copy !== obj && !propertyNames) return copy;\n\tvar result = {};\n\tif (propertyNames) {\n\t\taFrom(propertyNames, function (propertyName) {\n\t\t\tif (options.ensure || propertyName in obj) result[propertyName] = obj[propertyName];\n\t\t});\n\t} else {\n\t\tassign(result, obj);\n\t}\n\treturn result;\n};\n","\"use strict\";\n\nvar create = Object.create, getPrototypeOf = Object.getPrototypeOf, plainObject = {};\n\nmodule.exports = function (/* CustomCreate*/) {\n\tvar setPrototypeOf = Object.setPrototypeOf, customCreate = arguments[0] || create;\n\tif (typeof setPrototypeOf !== \"function\") return false;\n\treturn getPrototypeOf(setPrototypeOf(customCreate(null), plainObject)) === plainObject;\n};\n","/* eslint no-proto: \"off\" */\n\n// Big thanks to @WebReflection for sorting this out\n// https://gist.github.com/WebReflection/5593554\n\n\"use strict\";\n\nvar isObject         = require(\"../is-object\")\n  , value            = require(\"../valid-value\")\n  , objIsPrototypeOf = Object.prototype.isPrototypeOf\n  , defineProperty   = Object.defineProperty\n  , nullDesc         = { configurable: true, enumerable: false, writable: true, value: undefined }\n  , validate;\n\nvalidate = function (obj, prototype) {\n\tvalue(obj);\n\tif (prototype === null || isObject(prototype)) return obj;\n\tthrow new TypeError(\"Prototype must be null or an object\");\n};\n\nmodule.exports = (function (status) {\n\tvar fn, set;\n\tif (!status) return null;\n\tif (status.level === 2) {\n\t\tif (status.set) {\n\t\t\tset = status.set;\n\t\t\tfn = function (obj, prototype) {\n\t\t\t\tset.call(validate(obj, prototype), prototype);\n\t\t\t\treturn obj;\n\t\t\t};\n\t\t} else {\n\t\t\tfn = function (obj, prototype) {\n\t\t\t\tvalidate(obj, prototype).__proto__ = prototype;\n\t\t\t\treturn obj;\n\t\t\t};\n\t\t}\n\t} else {\n\t\tfn = function self(obj, prototype) {\n\t\t\tvar isNullBase;\n\t\t\tvalidate(obj, prototype);\n\t\t\tisNullBase = objIsPrototypeOf.call(self.nullPolyfill, obj);\n\t\t\tif (isNullBase) delete self.nullPolyfill.__proto__;\n\t\t\tif (prototype === null) prototype = self.nullPolyfill;\n\t\t\tobj.__proto__ = prototype;\n\t\t\tif (isNullBase) defineProperty(self.nullPolyfill, \"__proto__\", nullDesc);\n\t\t\treturn obj;\n\t\t};\n\t}\n\treturn Object.defineProperty(fn, \"level\", {\n\t\tconfigurable: false,\n\t\tenumerable: false,\n\t\twritable: false,\n\t\tvalue: status.level\n\t});\n})(\n\t(function () {\n\t\tvar tmpObj1 = Object.create(null)\n\t\t  , tmpObj2 = {}\n\t\t  , set\n\t\t  , desc = Object.getOwnPropertyDescriptor(Object.prototype, \"__proto__\");\n\n\t\tif (desc) {\n\t\t\ttry {\n\t\t\t\tset = desc.set; // Opera crashes at this point\n\t\t\t\tset.call(tmpObj1, tmpObj2);\n\t\t\t} catch (ignore) {}\n\t\t\tif (Object.getPrototypeOf(tmpObj1) === tmpObj2) return { set: set, level: 2 };\n\t\t}\n\n\t\ttmpObj1.__proto__ = tmpObj2;\n\t\tif (Object.getPrototypeOf(tmpObj1) === tmpObj2) return { level: 2 };\n\n\t\ttmpObj1 = {};\n\t\ttmpObj1.__proto__ = tmpObj2;\n\t\tif (Object.getPrototypeOf(tmpObj1) === tmpObj2) return { level: 1 };\n\n\t\treturn false;\n\t})()\n);\n\nrequire(\"../create\");\n","\"use strict\";\n\nvar isArguments    = require(\"es5-ext/function/is-arguments\")\n  , isString       = require(\"es5-ext/string/is-string\")\n  , ArrayIterator  = require(\"./array\")\n  , StringIterator = require(\"./string\")\n  , iterable       = require(\"./valid-iterable\")\n  , iteratorSymbol = require(\"es6-symbol\").iterator;\n\nmodule.exports = function (obj) {\n\tif (typeof iterable(obj)[iteratorSymbol] === \"function\") return obj[iteratorSymbol]();\n\tif (isArguments(obj)) return new ArrayIterator(obj);\n\tif (isString(obj)) return new StringIterator(obj);\n\treturn new ArrayIterator(obj);\n};\n","\"use strict\";\n\nvar clear    = require(\"es5-ext/array/#/clear\")\n  , assign   = require(\"es5-ext/object/assign\")\n  , callable = require(\"es5-ext/object/valid-callable\")\n  , value    = require(\"es5-ext/object/valid-value\")\n  , d        = require(\"d\")\n  , autoBind = require(\"d/auto-bind\")\n  , Symbol   = require(\"es6-symbol\");\n\nvar defineProperty = Object.defineProperty, defineProperties = Object.defineProperties, Iterator;\n\nmodule.exports = Iterator = function (list, context) {\n\tif (!(this instanceof Iterator)) throw new TypeError(\"Constructor requires 'new'\");\n\tdefineProperties(this, {\n\t\t__list__: d(\"w\", value(list)),\n\t\t__context__: d(\"w\", context),\n\t\t__nextIndex__: d(\"w\", 0)\n\t});\n\tif (!context) return;\n\tcallable(context.on);\n\tcontext.on(\"_add\", this._onAdd);\n\tcontext.on(\"_delete\", this._onDelete);\n\tcontext.on(\"_clear\", this._onClear);\n};\n\n// Internal %IteratorPrototype% doesn't expose its constructor\ndelete Iterator.prototype.constructor;\n\ndefineProperties(\n\tIterator.prototype,\n\tassign(\n\t\t{\n\t\t\t_next: d(function () {\n\t\t\t\tvar i;\n\t\t\t\tif (!this.__list__) return undefined;\n\t\t\t\tif (this.__redo__) {\n\t\t\t\t\ti = this.__redo__.shift();\n\t\t\t\t\tif (i !== undefined) return i;\n\t\t\t\t}\n\t\t\t\tif (this.__nextIndex__ < this.__list__.length) return this.__nextIndex__++;\n\t\t\t\tthis._unBind();\n\t\t\t\treturn undefined;\n\t\t\t}),\n\t\t\tnext: d(function () {\n\t\t\t\treturn this._createResult(this._next());\n\t\t\t}),\n\t\t\t_createResult: d(function (i) {\n\t\t\t\tif (i === undefined) return { done: true, value: undefined };\n\t\t\t\treturn { done: false, value: this._resolve(i) };\n\t\t\t}),\n\t\t\t_resolve: d(function (i) {\n\t\t\t\treturn this.__list__[i];\n\t\t\t}),\n\t\t\t_unBind: d(function () {\n\t\t\t\tthis.__list__ = null;\n\t\t\t\tdelete this.__redo__;\n\t\t\t\tif (!this.__context__) return;\n\t\t\t\tthis.__context__.off(\"_add\", this._onAdd);\n\t\t\t\tthis.__context__.off(\"_delete\", this._onDelete);\n\t\t\t\tthis.__context__.off(\"_clear\", this._onClear);\n\t\t\t\tthis.__context__ = null;\n\t\t\t}),\n\t\t\ttoString: d(function () {\n\t\t\t\treturn \"[object \" + (this[Symbol.toStringTag] || \"Object\") + \"]\";\n\t\t\t})\n\t\t},\n\t\tautoBind({\n\t\t\t_onAdd: d(function (index) {\n\t\t\t\tif (index >= this.__nextIndex__) return;\n\t\t\t\t++this.__nextIndex__;\n\t\t\t\tif (!this.__redo__) {\n\t\t\t\t\tdefineProperty(this, \"__redo__\", d(\"c\", [index]));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.__redo__.forEach(function (redo, i) {\n\t\t\t\t\tif (redo >= index) this.__redo__[i] = ++redo;\n\t\t\t\t}, this);\n\t\t\t\tthis.__redo__.push(index);\n\t\t\t}),\n\t\t\t_onDelete: d(function (index) {\n\t\t\t\tvar i;\n\t\t\t\tif (index >= this.__nextIndex__) return;\n\t\t\t\t--this.__nextIndex__;\n\t\t\t\tif (!this.__redo__) return;\n\t\t\t\ti = this.__redo__.indexOf(index);\n\t\t\t\tif (i !== -1) this.__redo__.splice(i, 1);\n\t\t\t\tthis.__redo__.forEach(function (redo, j) {\n\t\t\t\t\tif (redo > index) this.__redo__[j] = --redo;\n\t\t\t\t}, this);\n\t\t\t}),\n\t\t\t_onClear: d(function () {\n\t\t\t\tif (this.__redo__) clear.call(this.__redo__);\n\t\t\t\tthis.__nextIndex__ = 0;\n\t\t\t})\n\t\t})\n\t)\n);\n\ndefineProperty(\n\tIterator.prototype,\n\tSymbol.iterator,\n\td(function () {\n\t\treturn this;\n\t})\n);\n","\"use strict\";\n\nvar isValue       = require(\"../value/is\")\n  , isObject      = require(\"../object/is\")\n  , stringCoerce  = require(\"../string/coerce\")\n  , toShortString = require(\"./to-short-string\");\n\nvar resolveMessage = function (message, value) {\n\treturn message.replace(\"%v\", toShortString(value));\n};\n\nmodule.exports = function (value, defaultMessage, inputOptions) {\n\tif (!isObject(inputOptions)) throw new TypeError(resolveMessage(defaultMessage, value));\n\tif (!isValue(value)) {\n\t\tif (\"default\" in inputOptions) return inputOptions[\"default\"];\n\t\tif (inputOptions.isOptional) return null;\n\t}\n\tvar errorMessage = stringCoerce(inputOptions.errorMessage);\n\tif (!isValue(errorMessage)) errorMessage = defaultMessage;\n\tthrow new TypeError(resolveMessage(errorMessage, value));\n};\n","import * as _ from 'lodash';\r\n\r\nimport * as AbstractSQLCompiler from '@balena/abstract-sql-compiler';\r\nimport {\r\n\tODataBinds,\r\n\todataNameToSqlName,\r\n\tisBindReference,\r\n} from '@balena/odata-to-abstract-sql';\r\nimport deepFreeze = require('deep-freeze');\r\nimport * as memoize from 'memoizee';\r\nimport memoizeWeak = require('memoizee/weak');\r\nimport * as env from '../config-loader/env';\r\nimport { BadRequestError, SqlCompilationError } from './errors';\r\nimport * as sbvrUtils from './sbvr-utils';\r\nimport { ODataRequest } from './uri-parser';\r\n\r\nconst getMemoizedCompileRule = memoize(\r\n\t(engine: AbstractSQLCompiler.Engines) =>\r\n\t\tmemoizeWeak(\r\n\t\t\t(abstractSqlQuery: AbstractSQLCompiler.AbstractSqlQuery) => {\r\n\t\t\t\tconst sqlQuery = AbstractSQLCompiler[engine].compileRule(\r\n\t\t\t\t\tabstractSqlQuery,\r\n\t\t\t\t);\r\n\t\t\t\tconst modifiedFields = AbstractSQLCompiler[engine].getModifiedFields(\r\n\t\t\t\t\tabstractSqlQuery,\r\n\t\t\t\t);\r\n\t\t\t\tif (modifiedFields != null) {\r\n\t\t\t\t\tdeepFreeze(modifiedFields);\r\n\t\t\t\t}\r\n\t\t\t\treturn {\r\n\t\t\t\t\tsqlQuery,\r\n\t\t\t\t\tmodifiedFields,\r\n\t\t\t\t};\r\n\t\t\t},\r\n\t\t\t{ max: env.cache.abstractSqlCompiler.max },\r\n\t\t),\r\n\t{ primitive: true },\r\n);\r\n\r\nexport const compileRequest = (request: ODataRequest) => {\r\n\tif (request.abstractSqlQuery != null) {\r\n\t\tconst { engine } = request;\r\n\t\tif (engine == null) {\r\n\t\t\tthrow new SqlCompilationError('No database engine specified');\r\n\t\t}\r\n\t\ttry {\r\n\t\t\tconst { sqlQuery, modifiedFields } = getMemoizedCompileRule(engine)(\r\n\t\t\t\trequest.abstractSqlQuery,\r\n\t\t\t);\r\n\t\t\trequest.sqlQuery = sqlQuery;\r\n\t\t\trequest.modifiedFields = modifiedFields;\r\n\t\t} catch (err) {\r\n\t\t\tsbvrUtils.api[request.vocabulary].logger.error(\r\n\t\t\t\t'Failed to compile abstract sql: ',\r\n\t\t\t\trequest.abstractSqlQuery,\r\n\t\t\t\terr,\r\n\t\t\t);\r\n\t\t\tthrow new SqlCompilationError(err);\r\n\t\t}\r\n\t}\r\n\treturn request;\r\n};\r\n\r\nexport const resolveOdataBind = (odataBinds: ODataBinds, value: any) => {\r\n\tif (value != null && typeof value === 'object' && isBindReference(value)) {\r\n\t\t[, value] = odataBinds[value.bind];\r\n\t}\r\n\treturn value;\r\n};\r\n\r\nexport const getAndCheckBindValues = async (\r\n\trequest: Required<\r\n\t\tPick<ODataRequest, 'vocabulary' | 'odataBinds' | 'values' | 'engine'>\r\n\t>,\r\n\tbindings: AbstractSQLCompiler.Binding[],\r\n) => {\r\n\tconst { odataBinds, values, engine } = request;\r\n\tconst sqlModelTables = sbvrUtils.getAbstractSqlModel(request).tables;\r\n\treturn await Promise.all(\r\n\t\tbindings.map(async (binding) => {\r\n\t\t\tlet fieldName: string = '';\r\n\t\t\tlet field: { dataType: string };\r\n\t\t\tlet value: any;\r\n\t\t\tif (binding[0] === 'Bind') {\r\n\t\t\t\tconst bindValue = binding[1];\r\n\t\t\t\tif (Array.isArray(bindValue)) {\r\n\t\t\t\t\tlet tableName;\r\n\t\t\t\t\t[tableName, fieldName] = bindValue;\r\n\r\n\t\t\t\t\tconst referencedName = tableName + '.' + fieldName;\r\n\t\t\t\t\tvalue = values[referencedName];\r\n\t\t\t\t\tif (value === undefined) {\r\n\t\t\t\t\t\tvalue = values[fieldName];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvalue = resolveOdataBind(odataBinds, value);\r\n\r\n\t\t\t\t\tconst sqlTableName = odataNameToSqlName(tableName);\r\n\t\t\t\t\tconst sqlFieldName = odataNameToSqlName(fieldName);\r\n\t\t\t\t\tconst maybeField = sqlModelTables[sqlTableName].fields.find(\r\n\t\t\t\t\t\t(f) => f.fieldName === sqlFieldName,\r\n\t\t\t\t\t);\r\n\t\t\t\t\tif (maybeField == null) {\r\n\t\t\t\t\t\tthrow new Error(`Could not find field '${fieldName}'`);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfield = maybeField;\r\n\t\t\t\t} else if (Number.isInteger(bindValue)) {\r\n\t\t\t\t\tif (bindValue >= odataBinds.length) {\r\n\t\t\t\t\t\tconsole.error(\r\n\t\t\t\t\t\t\t`Invalid binding number '${bindValue}' for binds: `,\r\n\t\t\t\t\t\t\todataBinds,\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\tthrow new Error('Invalid binding');\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet dataType;\r\n\t\t\t\t\t[dataType, value] = odataBinds[bindValue];\r\n\t\t\t\t\tfield = { dataType };\r\n\t\t\t\t} else if (typeof bindValue === 'string') {\r\n\t\t\t\t\tif (!odataBinds.hasOwnProperty(bindValue)) {\r\n\t\t\t\t\t\tconsole.error(\r\n\t\t\t\t\t\t\t`Invalid binding '${bindValue}' for binds: `,\r\n\t\t\t\t\t\t\todataBinds,\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\tthrow new Error('Invalid binding');\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet dataType;\r\n\t\t\t\t\t[dataType, value] = odataBinds[bindValue];\r\n\t\t\t\t\tfield = { dataType };\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthrow new Error(`Unknown binding: ${binding}`);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tlet dataType;\r\n\t\t\t\t[dataType, value] = binding;\r\n\t\t\t\tfield = { dataType };\r\n\t\t\t}\r\n\r\n\t\t\tif (value === undefined) {\r\n\t\t\t\tthrow new Error(`Bind value cannot be undefined: ${binding}`);\r\n\t\t\t}\r\n\r\n\t\t\ttry {\r\n\t\t\t\treturn await AbstractSQLCompiler[engine].dataTypeValidate(value, field);\r\n\t\t\t} catch (err) {\r\n\t\t\t\tthrow new BadRequestError(`\"${fieldName}\" ${err.message}`);\r\n\t\t\t}\r\n\t\t}),\r\n\t);\r\n};\r\n\r\nconst checkModifiedFields = (\r\n\truleReferencedFields: AbstractSQLCompiler.RuleReferencedFields,\r\n\tmodifiedFields: AbstractSQLCompiler.ModifiedFields,\r\n) => {\r\n\tconst refs = ruleReferencedFields[modifiedFields.table];\r\n\t// If there are no referenced fields of the modified table then the rule is not affected\r\n\tif (refs == null) {\r\n\t\treturn false;\r\n\t}\r\n\t// If there are no referenced fields for the given action type then the rule is not affected\r\n\tif (refs[modifiedFields.action].length === 0) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\t// If there are no specific fields listed then that means they were all modified (ie insert/delete) and so the rule can be affected\r\n\tif (modifiedFields.fields == null) {\r\n\t\treturn true;\r\n\t}\r\n\r\n\t// Otherwise check if there are any matching fields to see if the rule is affected\r\n\treturn (\r\n\t\t_.intersection(refs[modifiedFields.action], modifiedFields.fields).length >\r\n\t\t0\r\n\t);\r\n};\r\nexport const isRuleAffected = (\r\n\trule: AbstractSQLCompiler.SqlRule,\r\n\trequest?: ODataRequest,\r\n) => {\r\n\t// If there is no abstract sql query then nothing was modified\r\n\tif (request?.abstractSqlQuery == null) {\r\n\t\treturn false;\r\n\t}\r\n\t// If for some reason there are no referenced fields known for the rule then we just assume it may have been modified\r\n\tif (rule.ruleReferencedFields == null) {\r\n\t\treturn true;\r\n\t}\r\n\tconst { modifiedFields } = request;\r\n\t// If we can't get any modified fields we assume the rule may have been modified\r\n\tif (modifiedFields == null) {\r\n\t\tconsole.warn(\r\n\t\t\t`Could not determine the modified table/fields info for '${request.method}' to ${request.vocabulary}`,\r\n\t\t\trequest.abstractSqlQuery,\r\n\t\t);\r\n\t\treturn true;\r\n\t}\r\n\tif (Array.isArray(modifiedFields)) {\r\n\t\treturn modifiedFields.some(\r\n\t\t\t_.partial(checkModifiedFields, rule.ruleReferencedFields),\r\n\t\t);\r\n\t}\r\n\treturn checkModifiedFields(rule.ruleReferencedFields, modifiedFields);\r\n};\r\n","import type * as BodyParser from 'body-parser';\r\nimport type * as Compression from 'compression';\r\nimport type * as CookieParser from 'cookie-parser';\r\nimport type * as ExpressSession from 'express-session';\r\nimport type * as MethodOverride from 'method-override';\r\nimport type * as Multer from 'multer';\r\nimport type * as Passport from 'passport';\r\nimport type * as Path from 'path';\r\nimport type * as ServeStatic from 'serve-static';\r\n\r\nimport * as Pinejs from './module';\r\nexport { sbvrUtils, PinejsSessionStore } from './module';\r\n\r\nexport { ExtendedSBVRParser } from '../extended-sbvr-parser/extended-sbvr-parser';\r\n\r\nimport * as passportPinejs from '../passport-pinejs/passport-pinejs';\r\n\r\nimport * as express from 'express';\r\n\r\nconst app = express();\r\n\r\nswitch (app.get('env')) {\r\n\tcase 'production':\r\n\t\tconsole.log = () => {\r\n\t\t\t// noop\r\n\t\t};\r\n\t\tbreak;\r\n}\r\n\r\nif (!process.browser) {\r\n\t// tslint:disable:no-var-requires\r\n\tconst passport: typeof Passport = require('passport');\r\n\tconst path: typeof Path = require('path');\r\n\tconst compression: typeof Compression = require('compression');\r\n\tconst serveStatic: typeof ServeStatic = require('serve-static');\r\n\tconst cookieParser: typeof CookieParser = require('cookie-parser');\r\n\tconst bodyParser: typeof BodyParser = require('body-parser');\r\n\tconst multer: typeof Multer = require('multer');\r\n\tconst methodOverride: typeof MethodOverride = require('method-override');\r\n\tconst expressSession: typeof ExpressSession = require('express-session');\r\n\t// tslint:enable:no-var-requires\r\n\r\n\tapp.use(compression());\r\n\r\n\tconst root = process.argv[2] || __dirname;\r\n\tapp.use('/', serveStatic(path.join(root, 'static')));\r\n\r\n\tapp.use(cookieParser());\r\n\tapp.use(bodyParser());\r\n\tapp.use(multer().any());\r\n\tapp.use(methodOverride());\r\n\tapp.use(\r\n\t\texpressSession({\r\n\t\t\tsecret: 'A pink cat jumped over a rainbow',\r\n\t\t\tstore: new Pinejs.PinejsSessionStore(),\r\n\t\t}),\r\n\t);\r\n\tapp.use(passport.initialize());\r\n\tapp.use(passport.session());\r\n\r\n\tapp.use((req, res, next) => {\r\n\t\tconst origin = req.get('Origin') || '*';\r\n\t\tres.header('Access-Control-Allow-Origin', origin);\r\n\t\tres.header(\r\n\t\t\t'Access-Control-Allow-Methods',\r\n\t\t\t'GET, PUT, POST, PATCH, DELETE, OPTIONS, HEAD',\r\n\t\t);\r\n\t\tres.header(\r\n\t\t\t'Access-Control-Allow-Headers',\r\n\t\t\t'Content-Type, Authorization, Application-Record-Count, MaxDataServiceVersion, X-Requested-With',\r\n\t\t);\r\n\t\tres.header('Access-Control-Allow-Credentials', 'true');\r\n\t\tnext();\r\n\t});\r\n\r\n\tapp.use((req, _res, next) => {\r\n\t\tconsole.log('%s %s', req.method, req.url);\r\n\t\tnext();\r\n\t});\r\n}\r\n\r\nexport const initialised = Pinejs.init(app)\r\n\t.then(async (configLoader) => {\r\n\t\tawait Promise.all([\r\n\t\t\tconfigLoader.loadConfig(passportPinejs.config),\r\n\t\t\tconfigLoader.loadConfig(Pinejs.PinejsSessionStore.config),\r\n\t\t]);\r\n\r\n\t\tif (\r\n\t\t\ttypeof process === 'undefined' ||\r\n\t\t\tprocess == null ||\r\n\t\t\t!process.env.DISABLE_DEFAULT_AUTH\r\n\t\t) {\r\n\t\t\tapp.post(\r\n\t\t\t\t'/login',\r\n\t\t\t\tpassportPinejs.login((err, user, req, res) => {\r\n\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\tconsole.error('Error logging in', err, err.stack);\r\n\t\t\t\t\t\tres.sendStatus(500);\r\n\t\t\t\t\t} else if (user === false) {\r\n\t\t\t\t\t\tif (req.xhr === true) {\r\n\t\t\t\t\t\t\tres.sendStatus(401);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tres.redirect('/login.html');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (req.xhr === true) {\r\n\t\t\t\t\t\t\tres.sendStatus(200);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tres.redirect('/');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}),\r\n\t\t\t);\r\n\r\n\t\t\tapp.get('/logout', passportPinejs.logout, (_req, res) => {\r\n\t\t\t\tres.redirect('/');\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tapp.listen(process.env.PORT || 1337, () => {\r\n\t\t\tconsole.info('Server started');\r\n\t\t});\r\n\t})\r\n\t.catch((err) => {\r\n\t\tconsole.error('Error initialising server', err, err.stack);\r\n\t\tprocess.exit(1);\r\n\t});\r\n","import type * as Fs from 'fs';\n\nif (!process.browser) {\n\tif (typeof nodeRequire === 'undefined' || nodeRequire == null) {\n\t\t// `nodeRequire` is a special variable we use to bypass webpack's resolving of `require`\n\t\t// statements on build for the cases where we need to always use the nodejs require, eg\n\t\t// in the config-loader which dynamically loads code at runtime, and for adding custom\n\t\t// filetype handlers - it works by being replaced with `require` after the webpack build\n\t\t// finishes.\n\t\t// In the case of `nodeRequire` being undefined it means we're being run in a nodejs\n\t\t// environment directly, without a webpack build, and have to manually create it as an\n\t\t// alias for the nodejs require so that things continue to work.\n\n\t\t// Alias require as nodeRequire for the config-loader hack.\n\t\tglobal.nodeRequire = require;\n\t}\n\t// Register a .sbvr loader\n\t// tslint:disable-next-line:no-var-requires\n\tconst fs: typeof Fs = require('fs');\n\tnodeRequire.extensions['.sbvr'] = (module: NodeModule, filename: string) =>\n\t\t(module.exports = fs.readFileSync(filename, 'utf8'));\n}\n","'use strict';\n\nvar has = Object.prototype.hasOwnProperty\n  , prefix = '~';\n\n/**\n * Constructor to create a storage for our `EE` objects.\n * An `Events` instance is a plain object whose properties are event names.\n *\n * @constructor\n * @private\n */\nfunction Events() {}\n\n//\n// We try to not inherit from `Object.prototype`. In some engines creating an\n// instance in this way is faster than calling `Object.create(null)` directly.\n// If `Object.create(null)` is not supported we prefix the event names with a\n// character to make sure that the built-in object properties are not\n// overridden or used as an attack vector.\n//\nif (Object.create) {\n  Events.prototype = Object.create(null);\n\n  //\n  // This hack is needed because the `__proto__` property is still inherited in\n  // some old browsers like Android 4, iPhone 5.1, Opera 11 and Safari 5.\n  //\n  if (!new Events().__proto__) prefix = false;\n}\n\n/**\n * Representation of a single event listener.\n *\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} [once=false] Specify if the listener is a one-time listener.\n * @constructor\n * @private\n */\nfunction EE(fn, context, once) {\n  this.fn = fn;\n  this.context = context;\n  this.once = once || false;\n}\n\n/**\n * Add a listener for a given event.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} once Specify if the listener is a one-time listener.\n * @returns {EventEmitter}\n * @private\n */\nfunction addListener(emitter, event, fn, context, once) {\n  if (typeof fn !== 'function') {\n    throw new TypeError('The listener must be a function');\n  }\n\n  var listener = new EE(fn, context || emitter, once)\n    , evt = prefix ? prefix + event : event;\n\n  if (!emitter._events[evt]) emitter._events[evt] = listener, emitter._eventsCount++;\n  else if (!emitter._events[evt].fn) emitter._events[evt].push(listener);\n  else emitter._events[evt] = [emitter._events[evt], listener];\n\n  return emitter;\n}\n\n/**\n * Clear event by name.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} evt The Event name.\n * @private\n */\nfunction clearEvent(emitter, evt) {\n  if (--emitter._eventsCount === 0) emitter._events = new Events();\n  else delete emitter._events[evt];\n}\n\n/**\n * Minimal `EventEmitter` interface that is molded against the Node.js\n * `EventEmitter` interface.\n *\n * @constructor\n * @public\n */\nfunction EventEmitter() {\n  this._events = new Events();\n  this._eventsCount = 0;\n}\n\n/**\n * Return an array listing the events for which the emitter has registered\n * listeners.\n *\n * @returns {Array}\n * @public\n */\nEventEmitter.prototype.eventNames = function eventNames() {\n  var names = []\n    , events\n    , name;\n\n  if (this._eventsCount === 0) return names;\n\n  for (name in (events = this._events)) {\n    if (has.call(events, name)) names.push(prefix ? name.slice(1) : name);\n  }\n\n  if (Object.getOwnPropertySymbols) {\n    return names.concat(Object.getOwnPropertySymbols(events));\n  }\n\n  return names;\n};\n\n/**\n * Return the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Array} The registered listeners.\n * @public\n */\nEventEmitter.prototype.listeners = function listeners(event) {\n  var evt = prefix ? prefix + event : event\n    , handlers = this._events[evt];\n\n  if (!handlers) return [];\n  if (handlers.fn) return [handlers.fn];\n\n  for (var i = 0, l = handlers.length, ee = new Array(l); i < l; i++) {\n    ee[i] = handlers[i].fn;\n  }\n\n  return ee;\n};\n\n/**\n * Return the number of listeners listening to a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Number} The number of listeners.\n * @public\n */\nEventEmitter.prototype.listenerCount = function listenerCount(event) {\n  var evt = prefix ? prefix + event : event\n    , listeners = this._events[evt];\n\n  if (!listeners) return 0;\n  if (listeners.fn) return 1;\n  return listeners.length;\n};\n\n/**\n * Calls each of the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Boolean} `true` if the event had listeners, else `false`.\n * @public\n */\nEventEmitter.prototype.emit = function emit(event, a1, a2, a3, a4, a5) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return false;\n\n  var listeners = this._events[evt]\n    , len = arguments.length\n    , args\n    , i;\n\n  if (listeners.fn) {\n    if (listeners.once) this.removeListener(event, listeners.fn, undefined, true);\n\n    switch (len) {\n      case 1: return listeners.fn.call(listeners.context), true;\n      case 2: return listeners.fn.call(listeners.context, a1), true;\n      case 3: return listeners.fn.call(listeners.context, a1, a2), true;\n      case 4: return listeners.fn.call(listeners.context, a1, a2, a3), true;\n      case 5: return listeners.fn.call(listeners.context, a1, a2, a3, a4), true;\n      case 6: return listeners.fn.call(listeners.context, a1, a2, a3, a4, a5), true;\n    }\n\n    for (i = 1, args = new Array(len -1); i < len; i++) {\n      args[i - 1] = arguments[i];\n    }\n\n    listeners.fn.apply(listeners.context, args);\n  } else {\n    var length = listeners.length\n      , j;\n\n    for (i = 0; i < length; i++) {\n      if (listeners[i].once) this.removeListener(event, listeners[i].fn, undefined, true);\n\n      switch (len) {\n        case 1: listeners[i].fn.call(listeners[i].context); break;\n        case 2: listeners[i].fn.call(listeners[i].context, a1); break;\n        case 3: listeners[i].fn.call(listeners[i].context, a1, a2); break;\n        case 4: listeners[i].fn.call(listeners[i].context, a1, a2, a3); break;\n        default:\n          if (!args) for (j = 1, args = new Array(len -1); j < len; j++) {\n            args[j - 1] = arguments[j];\n          }\n\n          listeners[i].fn.apply(listeners[i].context, args);\n      }\n    }\n  }\n\n  return true;\n};\n\n/**\n * Add a listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.on = function on(event, fn, context) {\n  return addListener(this, event, fn, context, false);\n};\n\n/**\n * Add a one-time listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.once = function once(event, fn, context) {\n  return addListener(this, event, fn, context, true);\n};\n\n/**\n * Remove the listeners of a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn Only remove the listeners that match this function.\n * @param {*} context Only remove the listeners that have this context.\n * @param {Boolean} once Only remove one-time listeners.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeListener = function removeListener(event, fn, context, once) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return this;\n  if (!fn) {\n    clearEvent(this, evt);\n    return this;\n  }\n\n  var listeners = this._events[evt];\n\n  if (listeners.fn) {\n    if (\n      listeners.fn === fn &&\n      (!once || listeners.once) &&\n      (!context || listeners.context === context)\n    ) {\n      clearEvent(this, evt);\n    }\n  } else {\n    for (var i = 0, events = [], length = listeners.length; i < length; i++) {\n      if (\n        listeners[i].fn !== fn ||\n        (once && !listeners[i].once) ||\n        (context && listeners[i].context !== context)\n      ) {\n        events.push(listeners[i]);\n      }\n    }\n\n    //\n    // Reset the array, or remove it completely if we have no more listeners.\n    //\n    if (events.length) this._events[evt] = events.length === 1 ? events[0] : events;\n    else clearEvent(this, evt);\n  }\n\n  return this;\n};\n\n/**\n * Remove all listeners, or those of the specified event.\n *\n * @param {(String|Symbol)} [event] The event name.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeAllListeners = function removeAllListeners(event) {\n  var evt;\n\n  if (event) {\n    evt = prefix ? prefix + event : event;\n    if (this._events[evt]) clearEvent(this, evt);\n  } else {\n    this._events = new Events();\n    this._eventsCount = 0;\n  }\n\n  return this;\n};\n\n//\n// Alias methods names because people roll like that.\n//\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\nEventEmitter.prototype.addListener = EventEmitter.prototype.on;\n\n//\n// Expose the prefix.\n//\nEventEmitter.prefixed = prefix;\n\n//\n// Allow `EventEmitter` to be imported as module namespace.\n//\nEventEmitter.EventEmitter = EventEmitter;\n\n//\n// Expose the module.\n//\nif ('undefined' !== typeof module) {\n  module.exports = EventEmitter;\n}\n","module.exports = require(\"pg\");","'use strict'\n\nvar url = require('url')\nvar fs = require('fs')\n\n//Parse method copied from https://github.com/brianc/node-postgres\n//Copyright (c) 2010-2014 Brian Carlson (brian.m.carlson@gmail.com)\n//MIT License\n\n//parses a connection string\nfunction parse(str) {\n  //unix socket\n  if (str.charAt(0) === '/') {\n    var config = str.split(' ')\n    return { host: config[0], database: config[1] }\n  }\n\n  // url parse expects spaces encoded as %20\n  var result = url.parse(\n    / |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(str) ? encodeURI(str).replace(/\\%25(\\d\\d)/g, '%$1') : str,\n    true\n  )\n  var config = result.query\n  for (var k in config) {\n    if (Array.isArray(config[k])) {\n      config[k] = config[k][config[k].length - 1]\n    }\n  }\n\n  var auth = (result.auth || ':').split(':')\n  config.user = auth[0]\n  config.password = auth.splice(1).join(':')\n\n  config.port = result.port\n  if (result.protocol == 'socket:') {\n    config.host = decodeURI(result.pathname)\n    config.database = result.query.db\n    config.client_encoding = result.query.encoding\n    return config\n  }\n  if (!config.host) {\n    // Only set the host if there is no equivalent query param.\n    config.host = result.hostname\n  }\n\n  // If the host is missing it might be a URL-encoded path to a socket.\n  var pathname = result.pathname\n  if (!config.host && pathname && /^%2f/i.test(pathname)) {\n    var pathnameSplit = pathname.split('/')\n    config.host = decodeURIComponent(pathnameSplit[0])\n    pathname = pathnameSplit.splice(1).join('/')\n  }\n  // result.pathname is not always guaranteed to have a '/' prefix (e.g. relative urls)\n  // only strip the slash if it is present.\n  if (pathname && pathname.charAt(0) === '/') {\n    pathname = pathname.slice(1) || null\n  }\n  config.database = pathname && decodeURI(pathname)\n\n  if (config.ssl === 'true' || config.ssl === '1') {\n    config.ssl = true\n  }\n\n  if (config.ssl === '0') {\n    config.ssl = false\n  }\n\n  if (config.sslcert || config.sslkey || config.sslrootcert || config.sslmode) {\n    config.ssl = {}\n  }\n\n  if (config.sslcert) {\n    config.ssl.cert = fs.readFileSync(config.sslcert).toString()\n  }\n\n  if (config.sslkey) {\n    config.ssl.key = fs.readFileSync(config.sslkey).toString()\n  }\n\n  if (config.sslrootcert) {\n    config.ssl.ca = fs.readFileSync(config.sslrootcert).toString()\n  }\n\n  switch (config.sslmode) {\n    case 'disable': {\n      config.ssl = false\n      break\n    }\n    case 'prefer':\n    case 'require':\n    case 'verify-ca':\n    case 'verify-full': {\n      break\n    }\n    case 'no-verify': {\n      config.ssl.rejectUnauthorized = false\n      break\n    }\n  }\n\n  return config\n}\n\nmodule.exports = parse\n\nparse.parse = parse\n","module.exports = require(\"url\");","module.exports = require(\"mysql\");","import type * as Express from 'express';\nimport type { AbstractSqlModel } from '@balena/abstract-sql-compiler';\nimport type { Database } from '../database-layer/db';\nimport type { Migration } from '../migrator/migrator';\nimport type { AnyObject, Resolvable } from '../sbvr-api/common-types';\n\nimport * as fs from 'fs';\nimport * as _ from 'lodash';\nimport * as path from 'path';\n\nimport * as sbvrUtils from '../sbvr-api/sbvr-utils';\n\nimport * as permissions from '../sbvr-api/permissions';\n\nexport type SetupFunction = (\n\tapp: Express.Application,\n\tsbvrUtilsInstance: typeof sbvrUtils,\n\tdb: Database,\n) => Resolvable<void>;\n\nexport interface Model {\n\tapiRoot?: string;\n\tmodelName?: string;\n\tmodelFile?: string;\n\tmodelText?: string;\n\tabstractSql?: AbstractSqlModel;\n\tmigrationsPath?: string;\n\tmigrations?: {\n\t\t[index: string]: Migration;\n\t};\n\tinitSqlPath?: string;\n\tinitSql?: string;\n\tcustomServerCode?:\n\t\t| string\n\t\t| {\n\t\t\t\tsetup: SetupFunction;\n\t\t  };\n\tlogging?: { [key in keyof Console | 'default']?: boolean };\n}\nexport interface User {\n\tusername: string;\n\tpassword: string;\n\tpermissions: string[];\n}\nexport interface Config {\n\tmodels: Model[];\n\tusers?: User[];\n}\n\nconst getOrCreate = async (\n\tauthApiTx: sbvrUtils.PinejsClient,\n\tresource: string,\n\tuniqueFields: AnyObject,\n\textraFields?: AnyObject,\n) => {\n\tconst result = (await authApiTx.get({\n\t\tresource,\n\t\tid: uniqueFields,\n\t\toptions: {\n\t\t\t$select: 'id',\n\t\t},\n\t})) as { id: number } | undefined;\n\tif (result != null) {\n\t\treturn result.id;\n\t}\n\tconst { id } = (await authApiTx.post({\n\t\tresource,\n\t\tbody: { ...uniqueFields, ...extraFields },\n\t\toptions: { returnResource: false },\n\t})) as { id: number };\n\treturn id;\n};\n\nconst getOrCreatePermission = async (\n\tauthApiTx: sbvrUtils.PinejsClient,\n\tpermissionName: string,\n) => {\n\ttry {\n\t\treturn await getOrCreate(authApiTx, 'permission', { name: permissionName });\n\t} catch (e) {\n\t\te.message = `Could not create or find permission \"${permissionName}\": ${e.message}`;\n\t\tthrow e;\n\t}\n};\n\n// Setup function\nexport const setup = (app: Express.Application) => {\n\tconst loadConfig = (data: Config): Promise<void> =>\n\t\tsbvrUtils.db.transaction(async (tx) => {\n\t\t\tconst authApiTx = sbvrUtils.api.Auth.clone({\n\t\t\t\tpassthrough: {\n\t\t\t\t\ttx,\n\t\t\t\t\treq: permissions.root,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tconst { users } = data;\n\t\t\tif (users != null) {\n\t\t\t\tconst permissionsCache: {\n\t\t\t\t\t[index: string]: Promise<number>;\n\t\t\t\t} = {};\n\t\t\t\tusers.forEach((user) => {\n\t\t\t\t\tif (user.permissions == null) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tuser.permissions.forEach((permissionName) => {\n\t\t\t\t\t\tif (permissionsCache[permissionName] != null) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tpermissionsCache[permissionName] = getOrCreatePermission(\n\t\t\t\t\t\t\tauthApiTx,\n\t\t\t\t\t\t\tpermissionName,\n\t\t\t\t\t\t);\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\tawait Promise.all(\n\t\t\t\t\tusers.map(async (user) => {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst userID = await getOrCreate(\n\t\t\t\t\t\t\t\tauthApiTx,\n\t\t\t\t\t\t\t\t'user',\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tusername: user.username,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tpassword: user.password,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tif (user.permissions != null) {\n\t\t\t\t\t\t\t\tawait Promise.all(\n\t\t\t\t\t\t\t\t\tuser.permissions.map(async (permissionName) => {\n\t\t\t\t\t\t\t\t\t\tconst permissionID = await permissionsCache[permissionName];\n\t\t\t\t\t\t\t\t\t\tawait getOrCreate(authApiTx, 'user__has__permission', {\n\t\t\t\t\t\t\t\t\t\t\tuser: userID,\n\t\t\t\t\t\t\t\t\t\t\tpermission: permissionID,\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\te.message = `Could not create or find user \"${user.username}\": ${e.message}`;\n\t\t\t\t\t\t\tthrow e;\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tawait Promise.all(\n\t\t\t\tdata.models.map(async (model) => {\n\t\t\t\t\tif (\n\t\t\t\t\t\t(model.abstractSql != null || model.modelText != null) &&\n\t\t\t\t\t\tmodel.apiRoot != null\n\t\t\t\t\t) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tawait sbvrUtils.executeModel(\n\t\t\t\t\t\t\t\ttx,\n\t\t\t\t\t\t\t\tmodel as sbvrUtils.ExecutableModel,\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tconst apiRoute = `/${model.apiRoot}/*`;\n\t\t\t\t\t\t\tapp.options(apiRoute, (_req, res) => res.sendStatus(200));\n\t\t\t\t\t\t\tapp.all(apiRoute, sbvrUtils.handleODataRequest);\n\n\t\t\t\t\t\t\tconsole.info(\n\t\t\t\t\t\t\t\t'Successfully executed ' + model.modelName + ' model.',\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t\tconst message = `Failed to execute ${model.modelName} model from ${model.modelFile}`;\n\t\t\t\t\t\t\tif (_.isError(err)) {\n\t\t\t\t\t\t\t\terr.message = message;\n\t\t\t\t\t\t\t\tthrow err;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tthrow new Error(message);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (model.customServerCode != null) {\n\t\t\t\t\t\tlet customCode: SetupFunction;\n\t\t\t\t\t\tif (typeof model.customServerCode === 'string') {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tcustomCode = nodeRequire(model.customServerCode).setup;\n\t\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\t\te.message = `Error loading custom server code: '${e.message}'`;\n\t\t\t\t\t\t\t\tthrow e;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (_.isObject(model.customServerCode)) {\n\t\t\t\t\t\t\tcustomCode = model.customServerCode.setup;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t\t\t`Invalid type for customServerCode '${typeof model.customServerCode}'`,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (typeof customCode !== 'function') {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tawait customCode(app, sbvrUtils, sbvrUtils.db);\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t);\n\t\t});\n\n\tconst loadConfigFile = async (configPath: string): Promise<Config> => {\n\t\tconsole.info('Loading config:', configPath);\n\t\treturn await import(configPath);\n\t};\n\n\tconst loadApplicationConfig = async (config: string | Config | undefined) => {\n\t\ttry {\n\t\t\tconsole.info('Loading application config');\n\t\t\tlet root: string;\n\t\t\tlet configObj: Config;\n\t\t\tif (config == null) {\n\t\t\t\troot = path.resolve(process.argv[2]) || __dirname;\n\t\t\t\tconfigObj = await loadConfigFile(path.join(root, 'config.json'));\n\t\t\t} else if (typeof config === 'string') {\n\t\t\t\troot = path.dirname(config);\n\t\t\t\tconfigObj = await loadConfigFile(config);\n\t\t\t} else if (_.isObject(config)) {\n\t\t\t\troot = process.cwd();\n\t\t\t\tconfigObj = config;\n\t\t\t} else {\n\t\t\t\tthrow new Error(`Invalid type for config '${typeof config}'`);\n\t\t\t}\n\t\t\tconst resolvePath = (s: string): string => {\n\t\t\t\tif (path.isAbsolute(s)) {\n\t\t\t\t\treturn s;\n\t\t\t\t}\n\t\t\t\treturn path.join(root, s);\n\t\t\t};\n\n\t\t\tawait Promise.all(\n\t\t\t\tconfigObj.models.map(async (model) => {\n\t\t\t\t\tif (model.modelFile != null) {\n\t\t\t\t\t\tmodel.modelText = await fs.promises.readFile(\n\t\t\t\t\t\t\tresolvePath(model.modelFile),\n\t\t\t\t\t\t\t'utf8',\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tif (typeof model.customServerCode === 'string') {\n\t\t\t\t\t\tmodel.customServerCode = resolvePath(model.customServerCode);\n\t\t\t\t\t}\n\t\t\t\t\tmodel.migrations ??= {};\n\t\t\t\t\tconst { migrations } = model;\n\n\t\t\t\t\tif (model.migrationsPath) {\n\t\t\t\t\t\tconst migrationsPath = resolvePath(model.migrationsPath);\n\n\t\t\t\t\t\tconst fileNames = await fs.promises.readdir(migrationsPath);\n\t\t\t\t\t\tawait Promise.all(\n\t\t\t\t\t\t\tfileNames.map(async (filename) => {\n\t\t\t\t\t\t\t\tconst filePath = path.join(migrationsPath, filename);\n\t\t\t\t\t\t\t\tconst [migrationKey] = filename.split('-', 1);\n\n\t\t\t\t\t\t\t\tswitch (path.extname(filename)) {\n\t\t\t\t\t\t\t\t\tcase '.coffee':\n\t\t\t\t\t\t\t\t\tcase '.ts':\n\t\t\t\t\t\t\t\t\tcase '.js':\n\t\t\t\t\t\t\t\t\t\tmigrations[migrationKey] = nodeRequire(filePath);\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\tcase '.sql':\n\t\t\t\t\t\t\t\t\t\tmigrations[migrationKey] = await fs.promises.readFile(\n\t\t\t\t\t\t\t\t\t\t\tfilePath,\n\t\t\t\t\t\t\t\t\t\t\t'utf8',\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\t\t\tconsole.error(\n\t\t\t\t\t\t\t\t\t\t\t`Unrecognised migration file extension, skipping: ${path.extname(\n\t\t\t\t\t\t\t\t\t\t\t\tfilename,\n\t\t\t\t\t\t\t\t\t\t\t)}`,\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tif (model.initSqlPath) {\n\t\t\t\t\t\tconst initSqlPath = resolvePath(model.initSqlPath);\n\t\t\t\t\t\tmodel.initSql = await fs.promises.readFile(initSqlPath, 'utf8');\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t);\n\t\t\tawait loadConfig(configObj);\n\t\t} catch (err) {\n\t\t\tconsole.error('Error loading application config', err, err.stack);\n\t\t\tprocess.exit(1);\n\t\t}\n\t};\n\n\treturn {\n\t\tloadConfig,\n\t\tloadApplicationConfig,\n\t};\n};\n","module.exports = require(\"path\");","import type * as Fs from 'fs';\n\nimport * as _ from 'lodash';\n\nconst cacheFile = process.env.PINEJS_CACHE_FILE || '.pinejs-cache.json';\nlet cache: null | {\n\t[name: string]: {\n\t\t[version: string]: {\n\t\t\t[srcJson: string]: any;\n\t\t};\n\t};\n} = null;\nlet fs: undefined | typeof Fs;\ntry {\n\t// tslint:disable-next-line:no-var-requires\n\tfs = require('fs');\n} catch (e) {\n\t// Ignore error\n}\n\nconst SAVE_DEBOUNCE_TIME = 5000;\n\nconst saveCache = _.debounce(() => {\n\tif (fs != null) {\n\t\tfs.writeFile(cacheFile, JSON.stringify(cache), 'utf8', (err) => {\n\t\t\tif (err) {\n\t\t\t\tconsole.warn('Error saving pinejs cache:', err);\n\t\t\t}\n\t\t});\n\t}\n}, SAVE_DEBOUNCE_TIME);\n\nconst clearCache = _.debounce(() => {\n\tcache = null;\n}, SAVE_DEBOUNCE_TIME * 2);\n\nexport const cachedCompile = <T>(\n\tname: string,\n\tversion: string,\n\tsrc: any,\n\tfn: () => T,\n): T => {\n\tif (cache == null) {\n\t\tif (fs != null) {\n\t\t\ttry {\n\t\t\t\tcache = JSON.parse(fs.readFileSync(cacheFile, 'utf8'));\n\t\t\t} catch (e) {\n\t\t\t\t// Ignore error\n\t\t\t}\n\t\t}\n\t\tcache ??= {};\n\t}\n\tconst key = [name, version, JSON.stringify(src)];\n\tlet result = _.get(cache, key);\n\tif (result == null) {\n\t\tresult = fn();\n\t\t_.set(cache, key, result);\n\t\tsaveCache();\n\t}\n\t// Schedule clearing the cache once we have made use of it since it usually means we're\n\t// done with it and it allows us to free up the memory - if it does end up being\n\t// requested again after being cleared then it will just trigger a reload of the cache\n\t// but that should be a rare case, as long as the clear timeout is a reasonable length\n\tclearCache();\n\treturn _.cloneDeep(result);\n};\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.validate = exports.nativeFactTypes = exports.types = void 0;\nconst TypeUtils = require(\"../type-utils\");\nexports.types = {\n    postgres: 'BIGINT',\n    mysql: 'BIGINT',\n    websql: 'BIGINT',\n    odata: {\n        name: 'Edm.Int64',\n    },\n};\nexports.nativeFactTypes = {\n    Integer: TypeUtils.nativeFactTypeTemplates.comparison,\n    Real: TypeUtils.nativeFactTypeTemplates.comparison,\n};\nexports.validate = TypeUtils.validate.integer;\n//# sourceMappingURL=big-integer.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.validate = exports.fetchProcessing = exports.types = void 0;\nconst TypeUtils = require(\"../type-utils\");\nconst typeFunc = (necessity, index, defaultValue = ' DEFAULT 0') => 'INTEGER' + defaultValue + necessity + index;\ntypeFunc.castType = 'INTEGER';\nexports.types = {\n    postgres: typeFunc,\n    mysql: typeFunc,\n    websql: typeFunc,\n    odata: {\n        name: 'Edm.Boolean',\n    },\n};\nconst fetchProcessing = (data) => data === 1;\nexports.fetchProcessing = fetchProcessing;\nexports.validate = TypeUtils.validate.checkRequired((originalValue) => {\n    const value = Number(originalValue);\n    if (Number.isNaN(value) || ![0, 1].includes(value)) {\n        throw new Error(`is not a boolean: ${JSON.stringify(originalValue)} (${typeof originalValue})`);\n    }\n    return value;\n});\n//# sourceMappingURL=boolean.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.validate = exports.types = void 0;\nconst TypeUtils = require(\"../type-utils\");\nexports.types = {\n    postgres: 'CITEXT',\n    mysql: 'TEXT COLLATE utf8_unicode_ci',\n    websql: 'TEXT COLLATE NOCASE',\n    odata: {\n        name: 'Edm.String',\n    },\n};\nexports.validate = TypeUtils.validate.text();\n//# sourceMappingURL=case-insensitive-text.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.validate = exports.fetchProcessing = exports.nativeProperties = exports.types = void 0;\nconst TypeUtils = require(\"../type-utils\");\nexports.types = {\n    postgres: 'INTEGER',\n    mysql: 'INTEGER',\n    websql: 'INTEGER',\n    odata: {\n        name: 'Self.Color',\n        complexType: `\\\n<ComplexType Name=\"Color\">\n\t<Property Name=\"r\" Nullable=\"false\" Type=\"Edm.Int8\"/>\\\n\t<Property Name=\"g\" Nullable=\"false\" Type=\"Edm.Int8\"/>\\\n\t<Property Name=\"b\" Nullable=\"false\" Type=\"Edm.Int8\"/>\\\n\t<Property Name=\"a\" Nullable=\"false\" Type=\"Edm.Int8\"/>\\\n</ComplexType>`,\n    },\n};\nexports.nativeProperties = {\n    has: {\n        'Red Component': (from) => [\n            'BitwiseAnd',\n            ['BitwiseShiftRight', from, 16],\n            255,\n        ],\n        'Green Component': (from) => [\n            'BitwiseAnd',\n            ['BitwiseShiftRight', from, 8],\n            255,\n        ],\n        'Blue Component': (from) => ['BitwiseShiftRight', from, 255],\n        'Alpha Component': (from) => [\n            'BitwiseAnd',\n            ['BitwiseShiftRight', from, 24],\n            255,\n        ],\n    },\n};\nconst fetchProcessing = (data) => {\n    return {\n        r: (data >> 16) & 0xff,\n        g: (data >> 8) & 0xff,\n        b: data & 0xff,\n        a: (data >> 24) & 0xff,\n    };\n};\nexports.fetchProcessing = fetchProcessing;\nexports.validate = TypeUtils.validate.checkRequired((value) => {\n    let processedValue;\n    if (typeof value !== 'object') {\n        processedValue = parseInt(value, 10);\n        if (Number.isNaN(processedValue)) {\n            throw new Error('is neither an integer or color object: ' + value);\n        }\n    }\n    else {\n        processedValue = 0;\n        Object.keys(value).forEach((component) => {\n            const componentValue = value[component];\n            if (Number.isNaN(componentValue) || componentValue > 255) {\n                throw new Error('has invalid component value of ' +\n                    componentValue +\n                    ' for component ' +\n                    component);\n            }\n            switch (component.toLowerCase()) {\n                case 'r':\n                case 'red':\n                    processedValue |= componentValue << 16;\n                    break;\n                case 'g':\n                case 'green':\n                    processedValue |= componentValue << 8;\n                    break;\n                case 'b':\n                case 'blue':\n                    processedValue |= componentValue;\n                    break;\n                case 'a':\n                case 'alpha':\n                    processedValue |= componentValue << 24;\n                    break;\n                default:\n                    throw new Error('has an unknown component: ' + component);\n            }\n        });\n    }\n    return processedValue;\n});\n//# sourceMappingURL=color.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.validate = exports.nativeFactTypes = exports.types = void 0;\nconst TypeUtils = require(\"../type-utils\");\nexports.types = {\n    postgres: 'INTEGER',\n    mysql: 'INTEGER',\n    websql: 'INTEGER',\n    odata: {\n        name: 'Edm.Int64',\n    },\n};\nexports.nativeFactTypes = {\n    Integer: TypeUtils.nativeFactTypeTemplates.comparison,\n    Real: TypeUtils.nativeFactTypeTemplates.comparison,\n};\nexports.validate = TypeUtils.validate.integer;\n//# sourceMappingURL=concept-type.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.validate = exports.nativeFactTypes = exports.fetchProcessing = exports.types = void 0;\nconst TypeUtils = require(\"../type-utils\");\nexports.types = {\n    postgres: 'DATE',\n    mysql: 'DATE',\n    websql: 'INTEGER',\n    odata: {\n        name: 'Edm.DateTime',\n    },\n};\nconst fetchProcessing = (data) => {\n    if (data != null) {\n        return new Date(data);\n    }\n    return data;\n};\nexports.fetchProcessing = fetchProcessing;\nexports.nativeFactTypes = {\n    Date: {\n        ...TypeUtils.nativeFactTypeTemplates.equality,\n        'is before': (from, to) => ['LessThan', from, to],\n        'is after': (from, to) => ['GreaterThan', from, to],\n    },\n};\nexports.validate = TypeUtils.validate.date;\n//# sourceMappingURL=date.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.validate = exports.nativeNames = exports.nativeFactTypes = exports.fetchProcessing = exports.types = void 0;\nconst TypeUtils = require(\"../type-utils\");\nexports.types = {\n    postgres: 'TIMESTAMP',\n    mysql: 'TIMESTAMP',\n    websql: 'INTEGER',\n    odata: {\n        name: 'Edm.DateTime',\n    },\n};\nconst fetchProcessing = (data) => {\n    if (data != null) {\n        return new Date(data);\n    }\n    return data;\n};\nexports.fetchProcessing = fetchProcessing;\nexports.nativeFactTypes = {\n    'Date Time': {\n        ...TypeUtils.nativeFactTypeTemplates.equality,\n        'is before': (from, to) => ['LessThan', from, to],\n        'is after': (from, to) => ['GreaterThan', from, to],\n    },\n};\nexports.nativeNames = {\n    'Current Time': ['Now'],\n};\nexports.validate = TypeUtils.validate.date;\n//# sourceMappingURL=date-time.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.validate = exports.types = void 0;\nconst TypeUtils = require(\"../type-utils\");\nexports.types = {\n    postgres: 'BYTEA',\n    mysql: 'BLOB',\n    websql: 'BLOB',\n    odata: {\n        name: 'Edm.String',\n    },\n};\nexports.validate = TypeUtils.validate.checkRequired((value) => {\n    if (Buffer.isBuffer(value)) {\n        return value;\n    }\n    if (typeof value !== 'string') {\n        throw new Error(`could not be converted to binary: ${typeof value}`);\n    }\n    if (value.length % 2 !== 0) {\n        throw new Error('could not be converted to binary: hex string must have an even length');\n    }\n    if (!/^[a-fA-F0-9]*$/.test(value)) {\n        throw new Error('could not be converted to binary: hex string must contain only hex characters');\n    }\n    try {\n        return new Buffer(value, 'hex');\n    }\n    catch (e) {\n        throw new Error(`could not be converted to binary: ${e.message}`);\n    }\n});\n//# sourceMappingURL=file.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.validate = exports.nativeFactTypes = exports.types = void 0;\nconst TypeUtils = require(\"../type-utils\");\nexports.types = {\n    postgres: 'INTEGER',\n    mysql: 'INTEGER',\n    websql: 'INTEGER',\n    odata: {\n        name: 'Edm.Int64',\n    },\n};\nexports.nativeFactTypes = {\n    Integer: TypeUtils.nativeFactTypeTemplates.comparison,\n    Real: TypeUtils.nativeFactTypeTemplates.comparison,\n};\nexports.validate = TypeUtils.validate.integer;\n//# sourceMappingURL=foreign-key.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.compare = exports.validate = exports.types = void 0;\nconst TypeUtils = require(\"../type-utils\");\nlet bcrypt;\ntry {\n    bcrypt = require('bcrypt');\n}\ncatch (_a) {\n    bcrypt = require('bcryptjs');\n}\nexports.types = {\n    postgres: 'CHAR(60)',\n    mysql: 'CHAR(60)',\n    websql: 'CHAR(60)',\n    odata: {\n        name: 'Edm.String',\n    },\n};\nexports.validate = TypeUtils.validate.checkRequired(async (value) => {\n    if (typeof value !== 'string') {\n        throw new Error('is not a string');\n    }\n    const salt = await bcrypt.genSalt();\n    return bcrypt.hash(value, salt);\n});\nexports.compare = bcrypt.compare.bind(bcrypt);\n//# sourceMappingURL=hashed.js.map","module.exports = require(\"bcrypt\");","module.exports = require(\"bcryptjs\");","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.validate = exports.nativeFactTypes = exports.types = void 0;\nconst TypeUtils = require(\"../type-utils\");\nexports.types = {\n    postgres: 'INTEGER',\n    mysql: 'INTEGER',\n    websql: 'INTEGER',\n    odata: {\n        name: 'Edm.Int32',\n    },\n};\nexports.nativeFactTypes = {\n    Integer: TypeUtils.nativeFactTypeTemplates.comparison,\n    Real: TypeUtils.nativeFactTypeTemplates.comparison,\n};\nexports.validate = TypeUtils.validate.integer;\n//# sourceMappingURL=integer.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.validate = exports.types = void 0;\nconst TypeUtils = require(\"../type-utils\");\nexports.types = {\n    postgres: 'INTERVAL',\n    mysql: 'INTEGER',\n    websql: 'INTEGER',\n    odata: {\n        name: 'Edm.Int64',\n    },\n};\nexports.validate = TypeUtils.validate.integer;\n//# sourceMappingURL=interval.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.validate = exports.fetchProcessing = exports.types = void 0;\nconst TypeUtils = require(\"../type-utils\");\nexports.types = {\n    postgres: 'TEXT',\n    mysql: 'TEXT',\n    websql: 'TEXT',\n    odata: {\n        name: 'Edm.String',\n    },\n};\nconst fetchProcessing = (data) => JSON.parse(data);\nexports.fetchProcessing = fetchProcessing;\nexports.validate = TypeUtils.validate.checkRequired((value) => {\n    try {\n        return JSON.stringify(value);\n    }\n    catch (_a) {\n        throw new Error('cannot be turned into JSON: ' + value);\n    }\n});\n//# sourceMappingURL=json.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.validate = exports.nativeFactTypes = exports.types = void 0;\nconst TypeUtils = require(\"../type-utils\");\nexports.types = {\n    postgres: 'REAL',\n    mysql: 'REAL',\n    websql: 'REAL',\n    odata: {\n        name: 'Edm.Double',\n    },\n};\nexports.nativeFactTypes = {\n    Integer: TypeUtils.nativeFactTypeTemplates.comparison,\n    Real: TypeUtils.nativeFactTypeTemplates.comparison,\n};\nexports.validate = TypeUtils.validate.checkRequired((value) => {\n    const processedValue = parseFloat(value);\n    if (Number.isNaN(processedValue)) {\n        throw new Error('is not a number: ' + value);\n    }\n    return processedValue;\n});\n//# sourceMappingURL=real.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.validate = exports.types = void 0;\nconst TypeUtils = require(\"../type-utils\");\nconst mysqlType = (necessity, index, defaultValue = '') => 'INTEGER' + defaultValue + necessity + index + ' AUTO_INCREMENT';\nmysqlType.castType = 'INTEGER';\nconst websqlType = (necessity, index, defaultValue = '') => 'INTEGER' + defaultValue + necessity + index + ' AUTOINCREMENT';\nwebsqlType.castType = 'INTEGER';\nexports.types = {\n    postgres: 'SERIAL',\n    mysql: mysqlType,\n    websql: websqlType,\n    odata: {\n        name: 'Edm.Int64',\n    },\n};\nexports.validate = TypeUtils.validate.integer;\n//# sourceMappingURL=serial.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.compare = exports.validate = exports.validateSync = exports.types = void 0;\nconst TypeUtils = require(\"../type-utils\");\nlet sha256;\ntry {\n    const crypto = require('crypto');\n    sha256 = (value) => {\n        const hash = crypto.createHash('sha256');\n        hash.update(value);\n        return `$sha256$${hash.digest('base64')}`;\n    };\n}\ncatch (_a) {\n    const shajs = require('sha.js');\n    sha256 = (value) => {\n        const hash = shajs('sha256');\n        hash.update(value);\n        return `$sha256$${hash.digest('base64')}`;\n    };\n}\nexports.types = {\n    postgres: 'CHAR(54)',\n    mysql: 'CHAR(54)',\n    websql: 'CHAR(54)',\n    odata: {\n        name: 'Edm.String',\n    },\n};\nexports.validateSync = sha256;\nexports.validate = TypeUtils.validate.checkRequired((value) => {\n    if (typeof value !== 'string') {\n        throw new Error('is not a string');\n    }\n    return sha256(value);\n});\nconst compare = async (value, result) => {\n    return sha256(value) === result;\n};\nexports.compare = compare;\n//# sourceMappingURL=sha.js.map","var exports = module.exports = function SHA (algorithm) {\n  algorithm = algorithm.toLowerCase()\n\n  var Algorithm = exports[algorithm]\n  if (!Algorithm) throw new Error(algorithm + ' is not supported (we accept pull requests)')\n\n  return new Algorithm()\n}\n\nexports.sha = require('./sha')\nexports.sha1 = require('./sha1')\nexports.sha224 = require('./sha224')\nexports.sha256 = require('./sha256')\nexports.sha384 = require('./sha384')\nexports.sha512 = require('./sha512')\n","/*\n * A JavaScript implementation of the Secure Hash Algorithm, SHA-0, as defined\n * in FIPS PUB 180-1\n * This source code is derived from sha1.js of the same repository.\n * The difference between SHA-0 and SHA-1 is just a bitwise rotate left\n * operation was added.\n */\n\nvar inherits = require('inherits')\nvar Hash = require('./hash')\nvar Buffer = require('safe-buffer').Buffer\n\nvar K = [\n  0x5a827999, 0x6ed9eba1, 0x8f1bbcdc | 0, 0xca62c1d6 | 0\n]\n\nvar W = new Array(80)\n\nfunction Sha () {\n  this.init()\n  this._w = W\n\n  Hash.call(this, 64, 56)\n}\n\ninherits(Sha, Hash)\n\nSha.prototype.init = function () {\n  this._a = 0x67452301\n  this._b = 0xefcdab89\n  this._c = 0x98badcfe\n  this._d = 0x10325476\n  this._e = 0xc3d2e1f0\n\n  return this\n}\n\nfunction rotl5 (num) {\n  return (num << 5) | (num >>> 27)\n}\n\nfunction rotl30 (num) {\n  return (num << 30) | (num >>> 2)\n}\n\nfunction ft (s, b, c, d) {\n  if (s === 0) return (b & c) | ((~b) & d)\n  if (s === 2) return (b & c) | (b & d) | (c & d)\n  return b ^ c ^ d\n}\n\nSha.prototype._update = function (M) {\n  var W = this._w\n\n  var a = this._a | 0\n  var b = this._b | 0\n  var c = this._c | 0\n  var d = this._d | 0\n  var e = this._e | 0\n\n  for (var i = 0; i < 16; ++i) W[i] = M.readInt32BE(i * 4)\n  for (; i < 80; ++i) W[i] = W[i - 3] ^ W[i - 8] ^ W[i - 14] ^ W[i - 16]\n\n  for (var j = 0; j < 80; ++j) {\n    var s = ~~(j / 20)\n    var t = (rotl5(a) + ft(s, b, c, d) + e + W[j] + K[s]) | 0\n\n    e = d\n    d = c\n    c = rotl30(b)\n    b = a\n    a = t\n  }\n\n  this._a = (a + this._a) | 0\n  this._b = (b + this._b) | 0\n  this._c = (c + this._c) | 0\n  this._d = (d + this._d) | 0\n  this._e = (e + this._e) | 0\n}\n\nSha.prototype._hash = function () {\n  var H = Buffer.allocUnsafe(20)\n\n  H.writeInt32BE(this._a | 0, 0)\n  H.writeInt32BE(this._b | 0, 4)\n  H.writeInt32BE(this._c | 0, 8)\n  H.writeInt32BE(this._d | 0, 12)\n  H.writeInt32BE(this._e | 0, 16)\n\n  return H\n}\n\nmodule.exports = Sha\n","module.exports = require(\"util\");","if (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    if (superCtor) {\n      ctor.super_ = superCtor\n      ctor.prototype = Object.create(superCtor.prototype, {\n        constructor: {\n          value: ctor,\n          enumerable: false,\n          writable: true,\n          configurable: true\n        }\n      })\n    }\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    if (superCtor) {\n      ctor.super_ = superCtor\n      var TempCtor = function () {}\n      TempCtor.prototype = superCtor.prototype\n      ctor.prototype = new TempCtor()\n      ctor.prototype.constructor = ctor\n    }\n  }\n}\n","module.exports = require(\"buffer\");","/*\n * A JavaScript implementation of the Secure Hash Algorithm, SHA-1, as defined\n * in FIPS PUB 180-1\n * Version 2.1a Copyright Paul Johnston 2000 - 2002.\n * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet\n * Distributed under the BSD License\n * See http://pajhome.org.uk/crypt/md5 for details.\n */\n\nvar inherits = require('inherits')\nvar Hash = require('./hash')\nvar Buffer = require('safe-buffer').Buffer\n\nvar K = [\n  0x5a827999, 0x6ed9eba1, 0x8f1bbcdc | 0, 0xca62c1d6 | 0\n]\n\nvar W = new Array(80)\n\nfunction Sha1 () {\n  this.init()\n  this._w = W\n\n  Hash.call(this, 64, 56)\n}\n\ninherits(Sha1, Hash)\n\nSha1.prototype.init = function () {\n  this._a = 0x67452301\n  this._b = 0xefcdab89\n  this._c = 0x98badcfe\n  this._d = 0x10325476\n  this._e = 0xc3d2e1f0\n\n  return this\n}\n\nfunction rotl1 (num) {\n  return (num << 1) | (num >>> 31)\n}\n\nfunction rotl5 (num) {\n  return (num << 5) | (num >>> 27)\n}\n\nfunction rotl30 (num) {\n  return (num << 30) | (num >>> 2)\n}\n\nfunction ft (s, b, c, d) {\n  if (s === 0) return (b & c) | ((~b) & d)\n  if (s === 2) return (b & c) | (b & d) | (c & d)\n  return b ^ c ^ d\n}\n\nSha1.prototype._update = function (M) {\n  var W = this._w\n\n  var a = this._a | 0\n  var b = this._b | 0\n  var c = this._c | 0\n  var d = this._d | 0\n  var e = this._e | 0\n\n  for (var i = 0; i < 16; ++i) W[i] = M.readInt32BE(i * 4)\n  for (; i < 80; ++i) W[i] = rotl1(W[i - 3] ^ W[i - 8] ^ W[i - 14] ^ W[i - 16])\n\n  for (var j = 0; j < 80; ++j) {\n    var s = ~~(j / 20)\n    var t = (rotl5(a) + ft(s, b, c, d) + e + W[j] + K[s]) | 0\n\n    e = d\n    d = c\n    c = rotl30(b)\n    b = a\n    a = t\n  }\n\n  this._a = (a + this._a) | 0\n  this._b = (b + this._b) | 0\n  this._c = (c + this._c) | 0\n  this._d = (d + this._d) | 0\n  this._e = (e + this._e) | 0\n}\n\nSha1.prototype._hash = function () {\n  var H = Buffer.allocUnsafe(20)\n\n  H.writeInt32BE(this._a | 0, 0)\n  H.writeInt32BE(this._b | 0, 4)\n  H.writeInt32BE(this._c | 0, 8)\n  H.writeInt32BE(this._d | 0, 12)\n  H.writeInt32BE(this._e | 0, 16)\n\n  return H\n}\n\nmodule.exports = Sha1\n","/**\n * A JavaScript implementation of the Secure Hash Algorithm, SHA-256, as defined\n * in FIPS 180-2\n * Version 2.2-beta Copyright Angel Marin, Paul Johnston 2000 - 2009.\n * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet\n *\n */\n\nvar inherits = require('inherits')\nvar Sha256 = require('./sha256')\nvar Hash = require('./hash')\nvar Buffer = require('safe-buffer').Buffer\n\nvar W = new Array(64)\n\nfunction Sha224 () {\n  this.init()\n\n  this._w = W // new Array(64)\n\n  Hash.call(this, 64, 56)\n}\n\ninherits(Sha224, Sha256)\n\nSha224.prototype.init = function () {\n  this._a = 0xc1059ed8\n  this._b = 0x367cd507\n  this._c = 0x3070dd17\n  this._d = 0xf70e5939\n  this._e = 0xffc00b31\n  this._f = 0x68581511\n  this._g = 0x64f98fa7\n  this._h = 0xbefa4fa4\n\n  return this\n}\n\nSha224.prototype._hash = function () {\n  var H = Buffer.allocUnsafe(28)\n\n  H.writeInt32BE(this._a, 0)\n  H.writeInt32BE(this._b, 4)\n  H.writeInt32BE(this._c, 8)\n  H.writeInt32BE(this._d, 12)\n  H.writeInt32BE(this._e, 16)\n  H.writeInt32BE(this._f, 20)\n  H.writeInt32BE(this._g, 24)\n\n  return H\n}\n\nmodule.exports = Sha224\n","var inherits = require('inherits')\nvar SHA512 = require('./sha512')\nvar Hash = require('./hash')\nvar Buffer = require('safe-buffer').Buffer\n\nvar W = new Array(160)\n\nfunction Sha384 () {\n  this.init()\n  this._w = W\n\n  Hash.call(this, 128, 112)\n}\n\ninherits(Sha384, SHA512)\n\nSha384.prototype.init = function () {\n  this._ah = 0xcbbb9d5d\n  this._bh = 0x629a292a\n  this._ch = 0x9159015a\n  this._dh = 0x152fecd8\n  this._eh = 0x67332667\n  this._fh = 0x8eb44a87\n  this._gh = 0xdb0c2e0d\n  this._hh = 0x47b5481d\n\n  this._al = 0xc1059ed8\n  this._bl = 0x367cd507\n  this._cl = 0x3070dd17\n  this._dl = 0xf70e5939\n  this._el = 0xffc00b31\n  this._fl = 0x68581511\n  this._gl = 0x64f98fa7\n  this._hl = 0xbefa4fa4\n\n  return this\n}\n\nSha384.prototype._hash = function () {\n  var H = Buffer.allocUnsafe(48)\n\n  function writeInt64BE (h, l, offset) {\n    H.writeInt32BE(h, offset)\n    H.writeInt32BE(l, offset + 4)\n  }\n\n  writeInt64BE(this._ah, this._al, 0)\n  writeInt64BE(this._bh, this._bl, 8)\n  writeInt64BE(this._ch, this._cl, 16)\n  writeInt64BE(this._dh, this._dl, 24)\n  writeInt64BE(this._eh, this._el, 32)\n  writeInt64BE(this._fh, this._fl, 40)\n\n  return H\n}\n\nmodule.exports = Sha384\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.validate = exports.types = void 0;\nconst TypeUtils = require(\"../type-utils\");\nexports.types = {\n    postgres: 'VARCHAR(255)',\n    mysql: 'VARCHAR(255)',\n    websql: 'VARCHAR(255)',\n    odata: {\n        name: 'Edm.String',\n    },\n};\nexports.validate = TypeUtils.validate.text(255);\n//# sourceMappingURL=short-text.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.validate = exports.nativeFactTypes = exports.nativeProperties = exports.types = void 0;\nconst TypeUtils = require(\"../type-utils\");\nexports.types = {\n    postgres: 'TEXT',\n    mysql: 'TEXT',\n    websql: 'TEXT',\n    odata: {\n        name: 'Edm.String',\n    },\n};\nexports.nativeProperties = {\n    has: {\n        Length: (from) => ['CharacterLength', from],\n    },\n};\nexports.nativeFactTypes = {\n    Text: {\n        ...TypeUtils.nativeFactTypeTemplates.equality,\n        'starts with': (from, to) => ['Startswith', from, to],\n        'ends with': (from, to) => ['Endswith', from, to],\n        contains: (from, to) => ['Contains', from, to],\n        'is contained in': (from, to) => ['Contains', to, from],\n    },\n};\nexports.validate = TypeUtils.validate.text();\n//# sourceMappingURL=text.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.validate = exports.fetchProcessing = exports.types = void 0;\nconst TypeUtils = require(\"../type-utils\");\nexports.types = {\n    postgres: 'TIME',\n    mysql: 'TIME',\n    websql: 'INTEGER',\n    odata: {\n        name: 'Edm.DateTime',\n    },\n};\nconst fetchProcessing = (data) => {\n    if (data != null) {\n        return new Date('Thu, 01 Jan 1970 ' + data);\n    }\n    return data;\n};\nexports.fetchProcessing = fetchProcessing;\nconst validate = async (value, required) => {\n    const date = await TypeUtils.validate.date(value, required);\n    if (date == null) {\n        return date;\n    }\n    return date.toLocaleTimeString();\n};\nexports.validate = validate;\n//# sourceMappingURL=time.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.optimizeSchema = exports.Engines = void 0;\nvar Engines;\n(function (Engines) {\n    Engines[\"postgres\"] = \"postgres\";\n    Engines[\"mysql\"] = \"mysql\";\n    Engines[\"websql\"] = \"websql\";\n})(Engines = exports.Engines || (exports.Engines = {}));\nconst AbstractSQLOptimiser_1 = require(\"./AbstractSQLOptimiser\");\nconst sbvrTypes = require(\"@balena/sbvr-types\");\nconst _ = require(\"lodash\");\nconst AbstractSQLCompiler_1 = require(\"./AbstractSQLCompiler\");\nconst countFroms = (n) => {\n    let count = 0;\n    n.forEach((p) => {\n        if (Array.isArray(p)) {\n            if (AbstractSQLCompiler_1.isFromNode(p)) {\n                count++;\n            }\n            else {\n                count += countFroms(p);\n            }\n        }\n    });\n    return count;\n};\nconst optimizeSchema = (abstractSqlModel) => {\n    abstractSqlModel.rules = abstractSqlModel.rules\n        .map((rule) => {\n        var _a;\n        const ruleBodyNode = rule.find((r) => r[0] === 'Body');\n        if (ruleBodyNode == null || typeof ruleBodyNode === 'string') {\n            throw new Error('Invalid rule');\n        }\n        let ruleBody = ruleBodyNode[1];\n        if (typeof ruleBody === 'string') {\n            throw new Error('Invalid rule');\n        }\n        const ruleSENode = rule.find((r) => r[0] === 'StructuredEnglish');\n        if (ruleSENode == null) {\n            throw new Error('Invalid structured English');\n        }\n        const ruleSE = ruleSENode[1];\n        if (typeof ruleSE !== 'string') {\n            throw new Error('Invalid structured English');\n        }\n        ruleBodyNode[1] = ruleBody = AbstractSQLOptimiser_1.AbstractSQLOptimiser(ruleBody, true);\n        const count = countFroms(ruleBody);\n        if (count === 1 &&\n            ruleBody[0] === 'NotExists' &&\n            ruleBody[1][0] === 'SelectQuery') {\n            const selectQueryNodes = ruleBody[1].slice(1);\n            if (selectQueryNodes.every((n) => ['Select', 'From', 'Where'].includes(n[0]))) {\n                let fromNode = selectQueryNodes.find(AbstractSQLCompiler_1.isFromNode)[1];\n                if (fromNode[0] === 'Alias') {\n                    fromNode = fromNode[1];\n                }\n                if (fromNode[0] === 'Table') {\n                    const whereNodes = selectQueryNodes.filter((n) => n[0] === 'Where');\n                    let whereNode;\n                    if (whereNodes.length > 1) {\n                        whereNode = ['And', ...whereNodes.map((n) => n[1])];\n                    }\n                    else {\n                        whereNode = whereNodes[0][1];\n                    }\n                    whereNode = ['Not', whereNode];\n                    const convertReferencedFieldsToFields = (n) => {\n                        n.forEach((p, i) => {\n                            if (Array.isArray(p)) {\n                                if (p[0] === 'ReferencedField') {\n                                    n[i] = ['Field', p[2]];\n                                }\n                                else {\n                                    convertReferencedFieldsToFields(p);\n                                }\n                            }\n                        });\n                    };\n                    convertReferencedFieldsToFields(whereNode);\n                    const tableName = fromNode[1];\n                    const sha = sbvrTypes.SHA.validateSync(`${tableName}$${JSON.stringify(ruleBody)}`).replace(/^\\$sha256\\$/, '');\n                    const table = _.find(abstractSqlModel.tables, (t) => t.name === tableName);\n                    if (table) {\n                        (_a = table.checks) !== null && _a !== void 0 ? _a : (table.checks = []);\n                        table.checks.push({\n                            description: ruleSE,\n                            name: `${tableName.slice(0, 30)}$${sha}`.slice(0, 63),\n                            abstractSql: whereNode,\n                        });\n                        return;\n                    }\n                }\n            }\n        }\n        return rule;\n    })\n        .filter((v) => v != null);\n    return abstractSqlModel;\n};\nexports.optimizeSchema = optimizeSchema;\n//# sourceMappingURL=AbstractSQLSchemaOptimiser.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.getModifiedFields = exports.getRuleReferencedFields = exports.getReferencedFields = void 0;\nconst _ = require(\"lodash\");\nconst AbstractSQLCompiler_1 = require(\"./AbstractSQLCompiler\");\nconst AbstractSQLOptimiser_1 = require(\"./AbstractSQLOptimiser\");\nconst getScope = (rulePart, scope) => {\n    scope = { ...scope };\n    const fromNodes = rulePart.filter(AbstractSQLCompiler_1.isFromNode);\n    fromNodes.forEach((node) => {\n        const nested = node[1];\n        if (nested[0] === 'Alias') {\n            const [, from, alias] = nested;\n            if (typeof alias !== 'string') {\n                throw new Error('Cannot handle non-string aliases');\n            }\n            switch (from[0]) {\n                case 'Table':\n                    scope[alias] = from[1];\n                    break;\n                case 'SelectQuery':\n                    scope[alias] = '';\n                    break;\n                default:\n                    throw new Error(`Cannot handle aliased ${from[0]} nodes`);\n            }\n        }\n        else if (nested[0] === 'Table') {\n            scope[nested[1]] = nested[1];\n        }\n        else {\n            throw Error(`Unsupported FromNode for scoping: ${nested[0]}`);\n        }\n    });\n    return scope;\n};\nconst $getReferencedFields = (referencedFields, rulePart, scope = {}) => {\n    if (!Array.isArray(rulePart)) {\n        return;\n    }\n    switch (rulePart[0]) {\n        case 'SelectQuery':\n            scope = getScope(rulePart, scope);\n            rulePart.forEach((node) => {\n                $getReferencedFields(referencedFields, node, scope);\n            });\n            break;\n        case 'ReferencedField':\n            let tableName = rulePart[1];\n            const fieldName = rulePart[2];\n            if (typeof tableName !== 'string' || typeof fieldName !== 'string') {\n                throw new Error(`Invalid ReferencedField: ${rulePart}`);\n            }\n            tableName = scope[tableName];\n            if (tableName !== '') {\n                if (referencedFields[tableName] == null) {\n                    referencedFields[tableName] = [];\n                }\n                referencedFields[tableName].push(fieldName);\n            }\n            return;\n        case 'Field':\n            throw new Error('Cannot find queried fields for unreferenced fields');\n        default:\n            rulePart.forEach((node) => {\n                $getReferencedFields(referencedFields, node, scope);\n            });\n    }\n};\nconst getReferencedFields = (ruleBody) => {\n    ruleBody = AbstractSQLOptimiser_1.AbstractSQLOptimiser(ruleBody);\n    const referencedFields = {};\n    $getReferencedFields(referencedFields, ruleBody);\n    return _.mapValues(referencedFields, _.uniq);\n};\nexports.getReferencedFields = getReferencedFields;\nconst dealiasTableNode = (n) => {\n    if (AbstractSQLCompiler_1.isTableNode(n)) {\n        return n;\n    }\n    if (n[0] === 'Alias' && AbstractSQLCompiler_1.isTableNode(n[1])) {\n        return n[1];\n    }\n};\nconst getRuleReferencedFields = (ruleBody) => {\n    ruleBody = AbstractSQLOptimiser_1.AbstractSQLOptimiser(ruleBody);\n    let referencedFields = {};\n    const deletable = new Set();\n    if (ruleBody[0] === 'NotExists') {\n        const s = ruleBody[1];\n        if (s[0] === 'SelectQuery') {\n            s.forEach((m) => {\n                if (!AbstractSQLCompiler_1.isFromNode(m)) {\n                    return;\n                }\n                const table = dealiasTableNode(m[1]);\n                if (table == null) {\n                    return;\n                }\n                deletable.add(table[1]);\n            });\n        }\n    }\n    $getReferencedFields(referencedFields, ruleBody);\n    referencedFields = _.mapValues(referencedFields, _.uniq);\n    const refFields = {};\n    for (const f of Object.keys(referencedFields)) {\n        refFields[f] = {\n            create: referencedFields[f],\n            update: referencedFields[f],\n            delete: referencedFields[f],\n        };\n        if (deletable.has(f)) {\n            const countFroms = (n) => {\n                let count = 0;\n                n.forEach((p) => {\n                    var _a;\n                    if (Array.isArray(p)) {\n                        if (AbstractSQLCompiler_1.isFromNode(p) && ((_a = dealiasTableNode(p[1])) === null || _a === void 0 ? void 0 : _a[1]) === f) {\n                            count++;\n                        }\n                        else {\n                            count += countFroms(p);\n                        }\n                    }\n                });\n                return count;\n            };\n            if (countFroms(ruleBody) === 1) {\n                refFields[f].delete = [];\n            }\n        }\n    }\n    return refFields;\n};\nexports.getRuleReferencedFields = getRuleReferencedFields;\nconst checkQuery = (query) => {\n    const queryType = query[0];\n    if (!['InsertQuery', 'UpdateQuery', 'DeleteQuery'].includes(queryType)) {\n        return;\n    }\n    const froms = query.filter(AbstractSQLCompiler_1.isFromNode);\n    if (froms.length !== 1) {\n        return;\n    }\n    const table = froms[0][1];\n    let tableName;\n    if (table[0] === 'Table') {\n        tableName = table[1];\n    }\n    else if (typeof table === 'string') {\n        tableName = table;\n    }\n    else {\n        return;\n    }\n    if (queryType === 'InsertQuery') {\n        return { table: tableName, action: 'create' };\n    }\n    if (queryType === 'DeleteQuery') {\n        return { table: tableName, action: 'delete' };\n    }\n    const fields = _(query)\n        .filter((v) => v != null && v[0] === 'Fields')\n        .flatMap((v) => v[1])\n        .value();\n    return { table: tableName, action: 'update', fields };\n};\nconst getModifiedFields = (abstractSqlQuery) => {\n    if (Array.isArray(abstractSqlQuery[0])) {\n        return abstractSqlQuery.map(checkQuery);\n    }\n    else {\n        return checkQuery(abstractSqlQuery);\n    }\n};\nexports.getModifiedFields = getModifiedFields;\n//# sourceMappingURL=referenced-fields.js.map","const { LF2AbstractSQLPrep } = require('./lf-to-abstract-sql-prep');\nconst { LF2AbstractSQL } = require('./lf-to-abstract-sql');\nmodule.exports = {\n\tLF2AbstractSQLPrep: LF2AbstractSQLPrep,\n\tLF2AbstractSQL: LF2AbstractSQL,\n\ttranslate: function (lf, types) {\n\t\tlf = LF2AbstractSQLPrep.match(lf, 'Process');\n\t\tvar translator = LF2AbstractSQL.createInstance();\n\t\ttranslator.addTypes(types);\n\t\treturn translator.match(lf, 'Process');\n\t},\n\tcreateTranslator: function (types) {\n\t\tvar translator = LF2AbstractSQL.createInstance();\n\t\ttranslator.addTypes(types);\n\t\treturn function (lf) {\n\t\t\tlf = LF2AbstractSQLPrep.match(lf, 'Process');\n\t\t\ttranslator.reset();\n\t\t\treturn translator.match(lf, 'Process');\n\t\t};\n\t},\n};\n","var OMeta = require(\"ometa-js/lib/ometajs/core\"), SBVRCompilerLibs = require(\"./sbvr-compiler-libs\").SBVRCompilerLibs, LFOptimiser = require(\"@balena/sbvr-parser/lf-optimiser\").LFOptimiser, LF2AbstractSQLPrep = exports.LF2AbstractSQLPrep = LFOptimiser._extend({\n    AttrConceptType: function(termName) {\n        var $elf = this, _fromIdx = this.input.idx, conceptType;\n        conceptType = LFOptimiser._superApplyWithArgs(this, \"AttrConceptType\", termName);\n        this._opt(function() {\n            this._pred(!1 === this.primitives[termName] && !1 !== this.primitives[conceptType]);\n            this.primitives[conceptType] = !1;\n            return this._apply(\"SetHelped\");\n        });\n        return conceptType;\n    },\n    AttrDatabaseAttribute: function(termOrFactType) {\n        var $elf = this, _fromIdx = this.input.idx, attrVal, newAttrVal;\n        attrVal = this.anything();\n        newAttrVal = \"Term\" == termOrFactType[0] && (!this.attributes.hasOwnProperty(termOrFactType[3]) || !0 === this.attributes[termOrFactType[3]]) || \"FactType\" == termOrFactType[0] && 4 == termOrFactType.length && (!this.attributes.hasOwnProperty(termOrFactType[3]) || !0 === this.attributes[termOrFactType[3]]) && this.primitives.hasOwnProperty(termOrFactType[3]) && !1 !== this.primitives[termOrFactType[3]];\n        this.attributes[termOrFactType] = newAttrVal;\n        this._opt(function() {\n            this._pred(newAttrVal != attrVal);\n            return this._apply(\"SetHelped\");\n        });\n        return newAttrVal;\n    },\n    AttrDatabasePrimitive: function(termOrFactType) {\n        var $elf = this, _fromIdx = this.input.idx, attrVal, newAttrVal;\n        attrVal = this.anything();\n        newAttrVal = attrVal;\n        this._opt(function() {\n            this._pred(this.primitives.hasOwnProperty(termOrFactType));\n            newAttrVal = this.primitives[termOrFactType];\n            this._pred(newAttrVal != attrVal);\n            return this._apply(\"SetHelped\");\n        });\n        this.primitives[termOrFactType] = newAttrVal;\n        return newAttrVal;\n    },\n    AttrTermForm: function(factType) {\n        var $elf = this, _fromIdx = this.input.idx;\n        this.termForms[factType] = !0;\n        return this.anything();\n    },\n    UniversalQuantification: function() {\n        var $elf = this, _fromIdx = this.input.idx, v, xs;\n        v = this._applyWithArgs(\"token\", \"Variable\");\n        xs = this._many(function() {\n            return this._apply(\"trans\");\n        });\n        this._apply(\"SetHelped\");\n        return [ \"LogicalNegation\", [ \"ExistentialQuantification\", v, [ \"LogicalNegation\" ].concat(xs) ] ];\n    },\n    AtMostNQuantification: function() {\n        var $elf = this, _fromIdx = this.input.idx, maxCard, v, xs;\n        maxCard = this._applyWithArgs(\"token\", \"MaximumCardinality\");\n        v = this._applyWithArgs(\"token\", \"Variable\");\n        xs = this._many(function() {\n            return this._apply(\"trans\");\n        });\n        this._apply(\"SetHelped\");\n        maxCard[1][1]++;\n        return [ \"LogicalNegation\", [ \"AtLeastNQuantification\", [ \"MinimumCardinality\", maxCard[1] ], v ].concat(xs) ];\n    },\n    CardinalityOptimisation2: function(v1) {\n        var $elf = this, _fromIdx = this.input.idx, actualFactType, atomicForm, card, factType, required, v2;\n        this._pred(3 == v1.length);\n        required = this._or(function() {\n            this._form(function() {\n                this._applyWithArgs(\"exactly\", \"ExactQuantification\");\n                card = this._applyWithArgs(\"token\", \"Cardinality\");\n                this._pred(1 == card[1][1]);\n                v2 = this._applyWithArgs(\"token\", \"Variable\");\n                return atomicForm = this._applyWithArgs(\"token\", \"AtomicFormulation\");\n            });\n            return !0;\n        }, function() {\n            this._form(function() {\n                this._applyWithArgs(\"exactly\", \"AtMostNQuantification\");\n                card = this._applyWithArgs(\"token\", \"MaximumCardinality\");\n                this._pred(1 == card[1][1]);\n                v2 = this._applyWithArgs(\"token\", \"Variable\");\n                return atomicForm = this._applyWithArgs(\"token\", \"AtomicFormulation\");\n            });\n            return !1;\n        });\n        this._apply(\"end\");\n        this._pred(3 == v2.length);\n        factType = atomicForm[1];\n        this._pred(!this.termForms[factType]);\n        this._pred(4 == atomicForm.length && 4 == factType.length);\n        actualFactType = this._applyWithArgs(\"UnmappedFactType\", factType.slice(1));\n        actualFactType = [ \"FactType\" ].concat(actualFactType);\n        this._or(function() {\n            this._pred(this.IdentifiersEqual(v1[2], actualFactType[1]) && this.IdentifiersEqual(v2[2], actualFactType[3]));\n            return this.foreignKeys[actualFactType] = required;\n        }, function() {\n            this._pred(this.IdentifiersEqual(v1[2], actualFactType[3]) && this.IdentifiersEqual(v2[2], actualFactType[1]));\n            return this.uniqueKeys[actualFactType] = required;\n        });\n        return this._apply(\"SetHelped\");\n    },\n    CardinalityOptimisation: function() {\n        var $elf = this, _fromIdx = this.input.idx, v1;\n        return this._form(function() {\n            switch (this.anything()) {\n              case \"LogicalNegation\":\n                return this._form(function() {\n                    this._applyWithArgs(\"exactly\", \"ExistentialQuantification\");\n                    v1 = this._applyWithArgs(\"token\", \"Variable\");\n                    return this._form(function() {\n                        this._applyWithArgs(\"exactly\", \"LogicalNegation\");\n                        return this._applyWithArgs(\"CardinalityOptimisation2\", v1);\n                    });\n                });\n\n              case \"UniversalQuantification\":\n                v1 = this._applyWithArgs(\"token\", \"Variable\");\n                return this._applyWithArgs(\"CardinalityOptimisation2\", v1);\n\n              default:\n                throw this._fail();\n            }\n        });\n    },\n    NecessityOptimisation: function() {\n        var $elf = this, _fromIdx = this.input.idx;\n        return this._apply(\"CardinalityOptimisation\");\n    },\n    ObligationOptimisation: function() {\n        var $elf = this, _fromIdx = this.input.idx;\n        return this._apply(\"CardinalityOptimisation\");\n    },\n    Rule: function() {\n        var $elf = this, _fromIdx = this.input.idx;\n        return this._or(function() {\n            this._form(function() {\n                switch (this.anything()) {\n                  case \"NecessityFormulation\":\n                    return this._apply(\"NecessityOptimisation\");\n\n                  case \"ObligationFormulation\":\n                    return this._apply(\"ObligationOptimisation\");\n\n                  default:\n                    throw this._fail();\n                }\n            });\n            this._applyWithArgs(\"token\", \"StructuredEnglish\");\n            return null;\n        }, function() {\n            return LFOptimiser._superApply(this, \"Rule\");\n        });\n    }\n});\n\nLF2AbstractSQLPrep.initialize = function() {\n    Object.assign(this, SBVRCompilerLibs);\n    SBVRCompilerLibs.initialize.call(this);\n    LFOptimiser.initialize.call(this);\n    this.foreignKeys = {};\n    this.uniqueKeys = {};\n    this.primitives = {};\n    this.attributes = {};\n    this.termForms = {};\n};\n\nLF2AbstractSQLPrep.defaultAttributes = function(termOrFactType, attrsFound, attrs) {\n    switch (termOrFactType[0]) {\n      case \"Name\":\n      case \"Term\":\n        if (!this.IsPrimitive(termOrFactType) && !attrsFound.hasOwnProperty(\"DatabaseIDField\")) {\n            attrs.splice(1, 0, [ \"DatabaseIDField\", \"id\" ]);\n            this.SetHelped();\n        }\n        if (!attrsFound.hasOwnProperty(\"ReferenceScheme\")) {\n            attrs.splice(1, 0, [ \"ReferenceScheme\", \"id\" ]);\n            this.SetHelped();\n        }\n        if (!attrsFound.hasOwnProperty(\"DatabaseTableName\")) {\n            var tableName = this.GetResourceName(termOrFactType[1]);\n            attrs.splice(1, 0, [ \"DatabaseTableName\", tableName ]);\n            this.SetHelped();\n        }\n        if (!attrsFound.hasOwnProperty(\"DatabasePrimitive\")) {\n            this.primitives.hasOwnProperty(termOrFactType) || (this.primitives[termOrFactType] = this.IsPrimitive(termOrFactType));\n            attrs.splice(1, 0, [ \"DatabasePrimitive\", this.primitives[termOrFactType] ]);\n            this.SetHelped();\n        }\n        break;\n\n      case \"FactType\":\n        var actualFactType = this.UnmappedFactType(termOrFactType.slice(1));\n        actualFactType = [ \"FactType\" ].concat(actualFactType);\n        if (!this.IsPrimitive(actualFactType[1])) {\n            if (!attrsFound.hasOwnProperty(\"DatabaseIDField\")) {\n                attrs.splice(1, 0, [ \"DatabaseIDField\", \"id\" ]);\n                this.SetHelped();\n            }\n            if (!attrsFound.hasOwnProperty(\"DatabaseTableName\")) {\n                var tableName = this.GetResourceName(actualFactType.slice(1));\n                attrs.splice(1, 0, [ \"DatabaseTableName\", tableName ]);\n                this.SetHelped();\n            }\n            if (this.uniqueKeys.hasOwnProperty(actualFactType)) if (attrsFound.hasOwnProperty(\"Unique\")) {\n                if (attrsFound.Unique != this.uniqueKeys[actualFactType]) {\n                    console.error(attrsFound.Unique, this.uniqueKeys[actualFactType]);\n                    ___MISMATCHED_UNIQUE_KEY___.die();\n                }\n            } else {\n                attrs.splice(1, 0, [ \"Unique\", this.uniqueKeys[actualFactType] ]);\n                this.SetHelped();\n            }\n            if (this.foreignKeys.hasOwnProperty(actualFactType)) {\n                if (!attrsFound.hasOwnProperty(\"DatabaseAttribute\")) {\n                    attrs.splice(1, 0, [ \"DatabaseAttribute\", !1 ]);\n                    this.SetHelped();\n                }\n                if (attrsFound.hasOwnProperty(\"ForeignKey\")) {\n                    if (attrsFound.ForeignKey != this.foreignKeys[actualFactType]) {\n                        console.error(attrsFound.ForeignKey, this.foreignKeys[actualFactType]);\n                        ___MISMATCHED_FOREIGN_KEY___.die();\n                    }\n                } else {\n                    attrs.splice(1, 0, [ \"ForeignKey\", this.foreignKeys[actualFactType] ]);\n                    this.SetHelped();\n                }\n            }\n            if (3 == actualFactType.length) {\n                this.primitives.hasOwnProperty(actualFactType[1]) && !1 === this.primitives[actualFactType[1]] || this.SetHelped();\n                this.primitives[actualFactType[1]] = !1;\n            } else if (actualFactType.length > 4) for (var i = 1; i < actualFactType.length; i += 2) {\n                this.attributes.hasOwnProperty(actualFactType[i]) && !1 === this.attributes[actualFactType[i]] || this.SetHelped();\n                this.attributes[actualFactType[i]] = !1;\n            }\n        }\n    }\n    termOrFactType.push(attrs);\n};","var OMeta = require(\"ometa-js/lib/ometajs/core\"), LFValidator = require(\"./lf-validator\").LFValidator, LFOptimiser = exports.LFOptimiser = LFValidator._extend({\n    Helped: function() {\n        var $elf = this, _fromIdx = this.input.idx;\n        this._pred(!0 === this.helped);\n        return this.helped = !1;\n    },\n    SetHelped: function() {\n        var $elf = this, _fromIdx = this.input.idx;\n        return this.helped = !0;\n    },\n    Process: function() {\n        var $elf = this, _fromIdx = this.input.idx, x;\n        x = this.anything();\n        x = this._applyWithArgs(\"trans\", x);\n        this._many(function() {\n            this._applyWithArgs(\"Helped\", \"disableMemoisation\");\n            return this._or(function() {\n                return x = this._applyWithArgs(\"trans\", x);\n            }, function() {\n                console.error(\"Failed to reprocess?!\");\n                return this._pred(!1);\n            });\n        });\n        return x;\n    },\n    AtLeastNQuantification: function() {\n        var $elf = this, _fromIdx = this.input.idx, i, v, xs;\n        return this._or(function() {\n            i = this._applyWithArgs(\"token\", \"MinimumCardinality\");\n            this._pred(1 == i[1][1]);\n            v = this._applyWithArgs(\"token\", \"Variable\");\n            xs = this._many(function() {\n                return this._apply(\"trans\");\n            });\n            this._apply(\"SetHelped\");\n            return [ \"ExistentialQuantification\", v ].concat(xs);\n        }, function() {\n            return LFValidator._superApply(this, \"AtLeastNQuantification\");\n        });\n    },\n    NumericalRangeQuantification: function() {\n        var $elf = this, _fromIdx = this.input.idx, i, j, v, xs;\n        return this._or(function() {\n            i = this._applyWithArgs(\"token\", \"MinimumCardinality\");\n            j = this._applyWithArgs(\"token\", \"MaximumCardinality\");\n            this._pred(i[1][1] == j[1][1]);\n            v = this._applyWithArgs(\"token\", \"Variable\");\n            xs = this._many(function() {\n                return this._apply(\"trans\");\n            });\n            this._apply(\"SetHelped\");\n            return [ \"ExactQuantification\", [ \"Cardinality\", i[1] ], v ].concat(xs);\n        }, function() {\n            return LFValidator._superApply(this, \"NumericalRangeQuantification\");\n        });\n    },\n    LogicalNegation: function() {\n        var $elf = this, _fromIdx = this.input.idx, xs;\n        return this._or(function() {\n            this._form(function() {\n                this._applyWithArgs(\"exactly\", \"LogicalNegation\");\n                return xs = this._apply(\"trans\");\n            });\n            this._apply(\"SetHelped\");\n            return xs;\n        }, function() {\n            return LFValidator._superApply(this, \"LogicalNegation\");\n        });\n    },\n    ExactQuantification: function() {\n        var $elf = this, _fromIdx = this.input.idx, i, v, xs;\n        return this._or(function() {\n            i = this._applyWithArgs(\"token\", \"Cardinality\");\n            v = this._applyWithArgs(\"token\", \"Variable\");\n            xs = this._many(function() {\n                return this._apply(\"trans\");\n            });\n            this._pred(0 === i[1][1]);\n            this._apply(\"SetHelped\");\n            return [ \"LogicalNegation\", [ \"ExistentialQuantification\", v ].concat(xs) ];\n        }, function() {\n            return LFValidator._superApply(this, \"ExactQuantification\");\n        });\n    }\n});\n\nLFOptimiser.initialize = function() {\n    LFValidator.initialize.call(this);\n    this._didSomething = !1;\n};","var OMeta = require(\"ometa-js/lib/ometajs/core\"), SBVRLibs = require(\"./sbvr-libs\").SBVRLibs, LFValidator = exports.LFValidator = SBVRLibs._extend({\n    trans: function() {\n        var $elf = this, _fromIdx = this.input.idx, a, t;\n        this._form(function() {\n            t = this.anything();\n            return a = this._applyWithArgs(\"apply\", t);\n        });\n        return a;\n    },\n    token: function(x) {\n        var $elf = this, _fromIdx = this.input.idx, a, t;\n        this._form(function() {\n            t = this.anything();\n            this._pred(t == x);\n            return a = this._applyWithArgs(\"apply\", x);\n        });\n        return a;\n    },\n    letters: function() {\n        var $elf = this, _fromIdx = this.input.idx, l;\n        l = this._many1(function() {\n            return this._apply(\"letter\");\n        });\n        this._many(function() {\n            return this._apply(\"space\");\n        });\n        return l.join(\"\");\n    },\n    Number: function() {\n        var $elf = this, _fromIdx = this.input.idx, n;\n        n = this._apply(\"number\");\n        this._pred(!isNaN(n));\n        return [ \"Number\", parseInt(n, 10) ];\n    },\n    Model: function() {\n        var $elf = this, _fromIdx = this.input.idx, x, xs;\n        xs = [];\n        this._many(function() {\n            x = this._or(function() {\n                return this._applyWithArgs(\"token\", \"Vocabulary\");\n            }, function() {\n                return this._applyWithArgs(\"token\", \"Term\");\n            }, function() {\n                return this._applyWithArgs(\"token\", \"Name\");\n            }, function() {\n                return this._applyWithArgs(\"token\", \"FactType\");\n            }, function() {\n                return this._applyWithArgs(\"token\", \"Rule\");\n            });\n            return this._opt(function() {\n                this._pred(null != x);\n                return xs.push(x);\n            });\n        });\n        return [ \"Model\" ].concat(xs);\n    },\n    FactType: function() {\n        var $elf = this, _fromIdx = this.input.idx, attrs, factType, identifier, verb;\n        factType = [];\n        this._many(function() {\n            identifier = this._or(function() {\n                return this._applyWithArgs(\"token\", \"Term\");\n            }, function() {\n                return this._applyWithArgs(\"token\", \"Name\");\n            });\n            verb = this._applyWithArgs(\"token\", \"Verb\");\n            return factType = factType.concat([ identifier, verb ]);\n        });\n        this._opt(function() {\n            identifier = this._or(function() {\n                return this._applyWithArgs(\"token\", \"Term\");\n            }, function() {\n                return this._applyWithArgs(\"token\", \"Name\");\n            });\n            return factType.push(identifier);\n        });\n        this._opt(function() {\n            return this._lookahead(function() {\n                attrs = this.anything();\n                return this._applyWithArgs(\"AddFactType\", factType, factType);\n            });\n        });\n        return this._applyWithArgs(\"addAttributes\", [ \"FactType\" ].concat(factType));\n    },\n    Vocabulary: function() {\n        var $elf = this, _fromIdx = this.input.idx, vocab;\n        vocab = this.anything();\n        this._applyWithArgs(\"AddVocabulary\", vocab, vocab);\n        return this._applyWithArgs(\"addAttributes\", [ \"Vocabulary\", vocab ]);\n    },\n    Term: function() {\n        var $elf = this, _fromIdx = this.input.idx, data, term, vocab;\n        term = this.anything();\n        vocab = this.anything();\n        return this._or(function() {\n            data = this._or(function() {\n                return this._applyWithArgs(\"token\", \"Number\");\n            }, function() {\n                return this._apply(\"Value\");\n            });\n            return [ \"Term\", term, vocab, data ];\n        }, function() {\n            return this._applyWithArgs(\"addAttributes\", [ \"Term\", term, vocab ]);\n        });\n    },\n    Name: function() {\n        var $elf = this, _fromIdx = this.input.idx, name, vocab;\n        name = this.anything();\n        vocab = this.anything();\n        return this._applyWithArgs(\"addAttributes\", [ \"Name\", name, vocab ]);\n    },\n    Verb: function() {\n        var $elf = this, _fromIdx = this.input.idx, negated, v;\n        v = this.anything();\n        negated = this._or(function() {\n            return this._apply(\"true\");\n        }, function() {\n            return this._apply(\"false\");\n        });\n        return [ \"Verb\", v, negated ];\n    },\n    Disjunction: function() {\n        var $elf = this, _fromIdx = this.input.idx, xs;\n        xs = this._many(function() {\n            return this._apply(\"trans\");\n        });\n        return [ \"Disjunction\" ].concat(xs);\n    },\n    Conjunction: function() {\n        var $elf = this, _fromIdx = this.input.idx, xs;\n        xs = this._many(function() {\n            return this._apply(\"trans\");\n        });\n        return [ \"Conjunction\" ].concat(xs);\n    },\n    Rule: function() {\n        var $elf = this, _fromIdx = this.input.idx, t, x;\n        x = this._or(function() {\n            return this._applyWithArgs(\"token\", \"ObligationFormulation\");\n        }, function() {\n            return this._applyWithArgs(\"token\", \"NecessityFormulation\");\n        }, function() {\n            return this._applyWithArgs(\"token\", \"PossibilityFormulation\");\n        }, function() {\n            return this._applyWithArgs(\"token\", \"PermissibilityFormulation\");\n        });\n        t = this._applyWithArgs(\"token\", \"StructuredEnglish\");\n        return [ \"Rule\", x, t ];\n    },\n    addAttributes: function(termOrFactType) {\n        var $elf = this, _fromIdx = this.input.idx, attrName, attrVal, attrs, attrsFound;\n        this._or(function() {\n            return this._apply(\"end\");\n        }, function() {\n            attrsFound = {};\n            attrs = [ \"Attributes\" ];\n            this._form(function() {\n                this._applyWithArgs(\"exactly\", \"Attributes\");\n                this._many(function() {\n                    return this._form(function() {\n                        attrName = this.anything();\n                        attrVal = this._applyWithArgs(\"ApplyFirstExisting\", [ \"Attr\" + attrName, \"DefaultAttr\" ], [ termOrFactType ]);\n                        return this._opt(function() {\n                            this._pred(null != attrVal);\n                            attrsFound[attrName] = attrVal;\n                            return attrs.push([ attrName, attrVal ]);\n                        });\n                    });\n                });\n                return this._apply(\"end\");\n            });\n            return this._applyWithArgs(\"defaultAttributes\", termOrFactType, attrsFound, attrs);\n        });\n        return termOrFactType;\n    },\n    DefaultAttr: function(tableID) {\n        var $elf = this, _fromIdx = this.input.idx;\n        return this.anything();\n    },\n    AttrConceptType: function(termOrFactType) {\n        var $elf = this, _fromIdx = this.input.idx, conceptType, term, vocab;\n        term = this._form(function() {\n            this._applyWithArgs(\"exactly\", \"Term\");\n            conceptType = this.anything();\n            return vocab = this.anything();\n        });\n        this.vocabularies[this.currentVocabulary].ConceptTypes[termOrFactType] = term;\n        return term;\n    },\n    AttrDefinition: function(termOrFactType) {\n        var $elf = this, _fromIdx = this.input.idx, values;\n        return this._or(function() {\n            return this._form(function() {\n                this._applyWithArgs(\"exactly\", \"Enum\");\n                return values = this._many1(function() {\n                    return this.anything();\n                });\n            });\n        }, function() {\n            return this._apply(\"trans\");\n        });\n    },\n    AttrNecessity: function(termOrFactType) {\n        var $elf = this, _fromIdx = this.input.idx;\n        return this._or(function() {\n            return this._applyWithArgs(\"token\", \"Rule\");\n        }, function() {\n            return this._apply(\"DefaultAttr\");\n        });\n    },\n    AttrSynonymousForm: function(factType) {\n        var $elf = this, _fromIdx = this.input.idx, synForm;\n        synForm = this.anything();\n        this._applyWithArgs(\"AddFactType\", synForm, factType.slice(1));\n        return synForm;\n    },\n    StructuredEnglish: function() {\n        var $elf = this, _fromIdx = this.input.idx, a;\n        a = this.anything();\n        return [ \"StructuredEnglish\", a ];\n    },\n    ObligationFormulation: function() {\n        var $elf = this, _fromIdx = this.input.idx, xs;\n        xs = this._many(function() {\n            return this._apply(\"trans\");\n        });\n        return [ \"ObligationFormulation\" ].concat(xs);\n    },\n    NecessityFormulation: function() {\n        var $elf = this, _fromIdx = this.input.idx, xs;\n        xs = this._many(function() {\n            return this._apply(\"trans\");\n        });\n        return [ \"NecessityFormulation\" ].concat(xs);\n    },\n    PossibilityFormulation: function() {\n        var $elf = this, _fromIdx = this.input.idx, xs;\n        xs = this._many(function() {\n            return this._apply(\"trans\");\n        });\n        return [ \"PossibilityFormulation\" ].concat(xs);\n    },\n    PermissibilityFormulation: function() {\n        var $elf = this, _fromIdx = this.input.idx, xs;\n        xs = this._many(function() {\n            return this._apply(\"trans\");\n        });\n        return [ \"PermissibilityFormulation\" ].concat(xs);\n    },\n    LogicalNegation: function() {\n        var $elf = this, _fromIdx = this.input.idx, xs;\n        xs = this._apply(\"trans\");\n        return [ \"LogicalNegation\" ].concat([ xs ]);\n    },\n    quant: function() {\n        var $elf = this, _fromIdx = this.input.idx, x;\n        return this._or(function() {\n            return this._applyWithArgs(\"token\", \"Disjunction\");\n        }, function() {\n            return this._applyWithArgs(\"token\", \"Conjunction\");\n        }, function() {\n            return this._applyWithArgs(\"token\", \"UniversalQuantification\");\n        }, function() {\n            return this._applyWithArgs(\"token\", \"ExistentialQuantification\");\n        }, function() {\n            return this._applyWithArgs(\"token\", \"ExactQuantification\");\n        }, function() {\n            return this._applyWithArgs(\"token\", \"AtMostNQuantification\");\n        }, function() {\n            return this._applyWithArgs(\"token\", \"AtLeastNQuantification\");\n        }, function() {\n            return this._applyWithArgs(\"token\", \"NumericalRangeQuantification\");\n        }, function() {\n            this._form(function() {\n                this._applyWithArgs(\"exactly\", \"LogicalNegation\");\n                return x = this._apply(\"quant\");\n            });\n            return [ \"LogicalNegation\", x ];\n        });\n    },\n    UniversalQuantification: function() {\n        var $elf = this, _fromIdx = this.input.idx, v, xs;\n        v = this._applyWithArgs(\"token\", \"Variable\");\n        xs = this._many(function() {\n            return this._apply(\"trans\");\n        });\n        return [ \"UniversalQuantification\", v ].concat(xs);\n    },\n    ExistentialQuantification: function() {\n        var $elf = this, _fromIdx = this.input.idx, v, xs;\n        v = this._applyWithArgs(\"token\", \"Variable\");\n        xs = this._many(function() {\n            return this._apply(\"trans\");\n        });\n        return [ \"ExistentialQuantification\", v ].concat(xs);\n    },\n    ExactQuantification: function() {\n        var $elf = this, _fromIdx = this.input.idx, i, v, xs;\n        i = this._applyWithArgs(\"token\", \"Cardinality\");\n        v = this._applyWithArgs(\"token\", \"Variable\");\n        xs = this._many(function() {\n            return this._apply(\"trans\");\n        });\n        return [ \"ExactQuantification\", i, v ].concat(xs);\n    },\n    AtMostNQuantification: function() {\n        var $elf = this, _fromIdx = this.input.idx, a, v, xs;\n        a = this._applyWithArgs(\"token\", \"MaximumCardinality\");\n        v = this._applyWithArgs(\"token\", \"Variable\");\n        xs = this._many(function() {\n            return this._apply(\"trans\");\n        });\n        return [ \"AtMostNQuantification\", a, v ].concat(xs);\n    },\n    AtLeastNQuantification: function() {\n        var $elf = this, _fromIdx = this.input.idx, i, v, xs;\n        i = this._applyWithArgs(\"token\", \"MinimumCardinality\");\n        v = this._applyWithArgs(\"token\", \"Variable\");\n        xs = this._many(function() {\n            return this._apply(\"trans\");\n        });\n        return [ \"AtLeastNQuantification\", i, v ].concat(xs);\n    },\n    NumericalRangeQuantification: function() {\n        var $elf = this, _fromIdx = this.input.idx, a, i, v, xs;\n        i = this._applyWithArgs(\"token\", \"MinimumCardinality\");\n        a = this._applyWithArgs(\"token\", \"MaximumCardinality\");\n        v = this._applyWithArgs(\"token\", \"Variable\");\n        xs = this._many(function() {\n            return this._apply(\"trans\");\n        });\n        return [ \"NumericalRangeQuantification\", i, a, v ].concat(xs);\n    },\n    Cardinality: function() {\n        var $elf = this, _fromIdx = this.input.idx, n;\n        n = this._applyWithArgs(\"token\", \"Number\");\n        return [ \"Cardinality\", n ];\n    },\n    MinimumCardinality: function() {\n        var $elf = this, _fromIdx = this.input.idx, n;\n        n = this._applyWithArgs(\"token\", \"Number\");\n        return [ \"MinimumCardinality\", n ];\n    },\n    MaximumCardinality: function() {\n        var $elf = this, _fromIdx = this.input.idx, n;\n        n = this._applyWithArgs(\"token\", \"Number\");\n        return [ \"MaximumCardinality\", n ];\n    },\n    Variable: function() {\n        var $elf = this, _fromIdx = this.input.idx, num, term, w;\n        num = this._applyWithArgs(\"token\", \"Number\");\n        term = this._applyWithArgs(\"token\", \"Term\");\n        w = this._many(function() {\n            return this._or(function() {\n                return this._applyWithArgs(\"token\", \"AtomicFormulation\");\n            }, function() {\n                return this._apply(\"quant\");\n            });\n        });\n        return [ \"Variable\", num, term ].concat(w);\n    },\n    Real: function() {\n        var $elf = this, _fromIdx = this.input.idx, num;\n        num = this._apply(\"number\");\n        this._pred(!isNaN(num));\n        return [ \"Real\", num ];\n    },\n    Integer: function() {\n        var $elf = this, _fromIdx = this.input.idx, num;\n        num = this._apply(\"number\");\n        this._pred(!isNaN(num));\n        return [ \"Integer\", num ];\n    },\n    Text: function() {\n        var $elf = this, _fromIdx = this.input.idx, text;\n        text = this.anything();\n        return [ \"Text\", text ];\n    },\n    Value: function() {\n        var $elf = this, _fromIdx = this.input.idx;\n        return this._or(function() {\n            return this._applyWithArgs(\"token\", \"Real\");\n        }, function() {\n            return this._applyWithArgs(\"token\", \"Integer\");\n        }, function() {\n            return this._applyWithArgs(\"token\", \"Text\");\n        });\n    },\n    RoleBinding: function() {\n        var $elf = this, _fromIdx = this.input.idx, bindIdentifier, identifier;\n        identifier = this._or(function() {\n            return this._applyWithArgs(\"token\", \"Term\");\n        }, function() {\n            return this._applyWithArgs(\"token\", \"Name\");\n        });\n        bindIdentifier = this._or(function() {\n            return this._apply(\"number\");\n        }, function() {\n            return this._apply(\"Value\");\n        }, function() {\n            return this._applyWithArgs(\"token\", \"Name\");\n        });\n        return [ \"RoleBinding\", identifier, bindIdentifier ];\n    },\n    AtomicFormulation: function() {\n        var $elf = this, _fromIdx = this.input.idx, b, f;\n        f = this._applyWithArgs(\"token\", \"FactType\");\n        b = this._many(function() {\n            return this._applyWithArgs(\"token\", \"RoleBinding\");\n        });\n        return [ \"AtomicFormulation\", f ].concat(b);\n    }\n});\n\nLFValidator.initialize = function() {\n    SBVRLibs.initialize.call(this);\n};\n\nLFValidator.defaultAttributes = function(termOrVerb, attrsFound, attrs) {\n    termOrVerb.push(attrs);\n};","var OMeta = require(\"ometa-js/lib/ometajs/core\"), SBVRCompilerLibs = require(\"./sbvr-compiler-libs\").SBVRCompilerLibs, _ = require(\"lodash\"), updateModifiedAt = {\n    type: \"trigger\",\n    body: 'NEW.\"modified at\" = NOW();\\nRETURN NEW;',\n    language: \"plpgsql\"\n}, LINK_RESOLVE_QUEUED = !0, LINK_RESOLVE_DONE = !1, LF2AbstractSQL = exports.LF2AbstractSQL = SBVRCompilerLibs._extend({\n    Number: function() {\n        var $elf = this, _fromIdx = this.input.idx, num;\n        this._form(function() {\n            this._applyWithArgs(\"exactly\", \"Number\");\n            num = this._apply(\"number\");\n            return this._pred(!isNaN(num));\n        });\n        return num;\n    },\n    Real: function() {\n        var $elf = this, _fromIdx = this.input.idx, num;\n        this._form(function() {\n            this._applyWithArgs(\"exactly\", \"Real\");\n            num = this._apply(\"number\");\n            return this._pred(!isNaN(num));\n        });\n        return [ \"Real\", num ];\n    },\n    Integer: function() {\n        var $elf = this, _fromIdx = this.input.idx, num;\n        this._form(function() {\n            this._applyWithArgs(\"exactly\", \"Integer\");\n            num = this._apply(\"number\");\n            return this._pred(!isNaN(num));\n        });\n        return [ \"Integer\", num ];\n    },\n    Text: function() {\n        var $elf = this, _fromIdx = this.input.idx, text;\n        this._form(function() {\n            this._applyWithArgs(\"exactly\", \"Text\");\n            return text = this.anything();\n        });\n        return [ \"Text\", text ];\n    },\n    Value: function() {\n        var $elf = this, _fromIdx = this.input.idx;\n        return this._or(function() {\n            return this._apply(\"Real\");\n        }, function() {\n            return this._apply(\"Integer\");\n        }, function() {\n            return this._apply(\"Text\");\n        });\n    },\n    Identifier: function() {\n        var $elf = this, _fromIdx = this.input.idx, name, num, type, vocab;\n        this._form(function() {\n            type = function() {\n                switch (this.anything()) {\n                  case \"Name\":\n                    return \"Name\";\n\n                  case \"Term\":\n                    return \"Term\";\n\n                  default:\n                    throw this._fail();\n                }\n            }.call(this);\n            name = this.anything();\n            vocab = this.anything();\n            return this._opt(function() {\n                return this._or(function() {\n                    return num = this._apply(\"Number\");\n                }, function() {\n                    return this._apply(\"Value\");\n                });\n            });\n        });\n        return {\n            type: type,\n            name: name,\n            num: num,\n            vocab: vocab\n        };\n    },\n    IdentifierName: function() {\n        var $elf = this, _fromIdx = this.input.idx, identifierName, resourceName;\n        identifierName = this.anything();\n        resourceName = this._applyWithArgs(\"GetResourceName\", identifierName);\n        this._or(function() {\n            return this._pred(!this.tables.hasOwnProperty(resourceName));\n        }, function() {\n            console.error(\"We already have an identifier with a name of: \" + identifierName);\n            return this._pred(!1);\n        });\n        this._applyWithArgs(\"CreateTable\", resourceName, identifierName);\n        return identifierName;\n    },\n    Attributes: function(termOrFactType) {\n        var $elf = this, _fromIdx = this.input.idx, attrOrder, attributeName, attributeVals, attributes;\n        return this._or(function() {\n            return this._apply(\"end\");\n        }, function() {\n            this._form(function() {\n                this._applyWithArgs(\"exactly\", \"Attributes\");\n                attributes = {};\n                return this._many(function() {\n                    this._form(function() {\n                        attributeName = this.anything();\n                        return attributeVals = this._many(function() {\n                            return this.anything();\n                        });\n                    });\n                    return attributes[attributeName] = attributeVals;\n                });\n            });\n            attrOrder = [ \"DatabaseTableName\", \"DatabaseIDField\", \"DatabasePrimitive\", \"TermForm\", \"ConceptType\", \"SynonymousForm\", \"Synonym\", \"ReferenceScheme\", \"ForeignKey\", \"Attribute\", \"Unique\" ];\n            return function() {\n                attrOrder.forEach(function(attributeName) {\n                    attributes.hasOwnProperty(attributeName) && $elf._applyWithArgs.apply($elf, [ \"Attr\" + attributeName, termOrFactType ].concat(attributes[attributeName]));\n                });\n                return _(attributes).omit(attrOrder).each(function(attributeVals, attributeName) {\n                    $elf._applyWithArgs.apply($elf, [ \"ApplyFirstExisting\", [ \"Attr\" + attributeName, \"DefaultAttr\" ], [ termOrFactType ].concat(attributeVals) ]);\n                });\n            }.call(this);\n        });\n    },\n    DefaultAttr: function(termOrFactType) {\n        var $elf = this, _fromIdx = this.input.idx;\n        return this.anything();\n    },\n    AttrConceptType: function(termOrFactType) {\n        var $elf = this, _fromIdx = this.input.idx, conceptTable, conceptTerm, conceptType, dataType, fieldID, identifierTable, primitive, references, vocab;\n        conceptTerm = this._form(function() {\n            this._applyWithArgs(\"exactly\", \"Term\");\n            conceptType = this.anything();\n            return vocab = this.anything();\n        });\n        (function() {\n            this.termForms[termOrFactType] && (termOrFactType = this.termForms[termOrFactType]);\n        }).call(this);\n        this.vocabularies[termOrFactType[2]].ConceptTypes[termOrFactType] = conceptTerm;\n        primitive = this._applyWithArgs(\"IsPrimitive\", conceptTerm);\n        conceptTable = this._applyWithArgs(\"GetTable\", conceptType);\n        identifierTable = this._applyWithArgs(\"GetTable\", termOrFactType[1]);\n        this._or(function() {\n            this._pred(!1 !== primitive && conceptType === primitive);\n            dataType = primitive;\n            this._opt(function() {\n                this._pred(identifierTable.hasOwnProperty(\"referenceScheme\"));\n                fieldID = this._applyWithArgs(\"GetTableFieldID\", identifierTable, identifierTable.referenceScheme);\n                this._pred(!1 !== fieldID);\n                return identifierTable.fields.splice(fieldID, 1);\n            });\n            return identifierTable.referenceScheme = conceptType;\n        }, function() {\n            dataType = \"ConceptType\";\n            return references = this._applyWithArgs(\"GetReference\", conceptTable);\n        });\n        this._applyWithArgs(\"AddTableField\", identifierTable, conceptType, dataType, !0, null, references);\n        return this._applyWithArgs(\"AddRelationship\", identifierTable, [ [ \"Verb\", \"has\" ], conceptTerm ], conceptType, references);\n    },\n    AttrDatabaseIDField: function(termOrFactType) {\n        var $elf = this, _fromIdx = this.input.idx, fieldID, idField, table, tableID;\n        idField = this.anything();\n        tableID = this._applyWithArgs(\"GetTableID\", termOrFactType);\n        table = this._applyWithArgs(\"GetTable\", tableID);\n        return this._or(function() {\n            return this._pred(\"string\" == typeof table);\n        }, function() {\n            fieldID = this._applyWithArgs(\"AddTableField\", table, idField, \"Serial\", !0, \"PRIMARY KEY\");\n            this._opt(function() {\n                this._pred(!1 !== fieldID);\n                return table.fields[fieldID].index = \"PRIMARY KEY\";\n            });\n            return table.idField = idField;\n        });\n    },\n    AttrReferenceScheme: function(termOrFactType) {\n        var $elf = this, _fromIdx = this.input.idx, fieldID, referenceScheme, table, tableID;\n        referenceScheme = this.anything();\n        referenceScheme = this._or(function() {\n            this._pred(Array.isArray(referenceScheme));\n            return referenceScheme[1];\n        }, function() {\n            return referenceScheme;\n        });\n        tableID = this._applyWithArgs(\"GetTableID\", termOrFactType);\n        table = this._applyWithArgs(\"GetTable\", tableID);\n        return this._or(function() {\n            return this._pred(\"string\" == typeof table);\n        }, function() {\n            this._opt(function() {\n                this._pred(table.hasOwnProperty(\"referenceScheme\"));\n                fieldID = this._applyWithArgs(\"GetTableFieldID\", table, table.referenceScheme);\n                this._pred(!1 !== fieldID);\n                return table.fields[fieldID].fieldName = referenceScheme;\n            });\n            return table.referenceScheme = referenceScheme;\n        });\n    },\n    AttrDatabaseTableName: function(termOrFactType) {\n        var $elf = this, _fromIdx = this.input.idx, baseTable, fieldName, linkResourceName, references, table, tableID, tableName;\n        tableName = this.anything();\n        tableID = this._applyWithArgs(\"GetTableID\", termOrFactType);\n        table = this._applyWithArgs(\"GetTable\", tableID);\n        this._or(function() {\n            return this._pred(\"string\" == typeof table);\n        }, function() {\n            return table.name = tableName;\n        });\n        return this._opt(function() {\n            this._pred(Array.isArray(termOrFactType[0]) && termOrFactType.length > 2);\n            linkResourceName = this._applyWithArgs(\"GetResourceName\", termOrFactType);\n            baseTable = this._applyWithArgs(\"GetTable\", termOrFactType[0][1]);\n            fieldName = this._applyWithArgs(\"FactTypeFieldName\", [ [ \"Term\", linkResourceName ], [ \"Verb\", \"has\" ], termOrFactType[0] ]);\n            references = this._applyWithArgs(\"GetReference\", table, fieldName);\n            this._applyWithArgs(\"AddRelationship\", baseTable, termOrFactType.slice(1), baseTable.idField, references, !0);\n            return this._applyWithArgs(\"AddRelationship\", baseTable, termOrFactType, baseTable.idField, references, !0);\n        });\n    },\n    AttrDatabasePrimitive: function(termOrFactType) {\n        var $elf = this, _fromIdx = this.input.idx, attrVal, tableID;\n        attrVal = this.anything();\n        tableID = this._applyWithArgs(\"GetTableID\", termOrFactType);\n        return this.GetTable(tableID).primitive = attrVal;\n    },\n    AttrDatabaseAttribute: function(factType) {\n        var $elf = this, _fromIdx = this.input.idx, attrVal, attributeTable, baseTable, fieldID, fieldName, linkResourceName;\n        attrVal = this.anything();\n        return this._opt(function() {\n            this._pred(attrVal);\n            this.attributes[factType] = attrVal;\n            linkResourceName = this._applyWithArgs(\"GetResourceName\", factType);\n            delete this.relationships[linkResourceName];\n            this.tables[linkResourceName] = \"Attribute\";\n            baseTable = this._applyWithArgs(\"GetTable\", factType[0][1]);\n            fieldName = this._applyWithArgs(\"FactTypeFieldName\", factType);\n            attributeTable = this._applyWithArgs(\"GetTable\", factType[2][1]);\n            fieldID = this._applyWithArgs(\"GetTableFieldID\", baseTable, fieldName);\n            baseTable.fields[fieldID].dataType = attributeTable.primitive;\n            this._applyWithArgs(\"AddRelationship\", baseTable, factType, fieldName);\n            return this._applyWithArgs(\"AddRelationship\", baseTable, factType.slice(1), fieldName);\n        });\n    },\n    AttrForeignKey: function(factType) {\n        var $elf = this, _fromIdx = this.input.idx, baseTable, factTypeResourceName, fieldID, fkName, fkTable, foreignTerm, index, linkResourceName, references, required;\n        required = this.anything();\n        baseTable = this._applyWithArgs(\"GetTable\", factType[0][1]);\n        foreignTerm = factType[2][1];\n        fkName = this._applyWithArgs(\"FactTypeFieldName\", factType);\n        fkTable = this._applyWithArgs(\"GetTable\", foreignTerm);\n        this._opt(function() {\n            this._pred(baseTable.idField == fkName);\n            fieldID = this._applyWithArgs(\"GetTableFieldID\", baseTable, fkName);\n            this._pred(!1 !== fieldID);\n            index = baseTable.fields[fieldID].index;\n            return baseTable.fields.splice(fieldID, 1);\n        });\n        references = this._applyWithArgs(\"GetReference\", fkTable);\n        fieldID = this._applyWithArgs(\"AddTableField\", baseTable, fkName, \"ForeignKey\", required, index, references);\n        this._applyWithArgs(\"AddRelationship\", baseTable, factType.slice(1), fkName, references);\n        factTypeResourceName = this._applyWithArgs(\"GetResourceName\", factType);\n        _.forEach($elf.synonymousForms[factTypeResourceName], function(synForm) {\n            if (0 === $elf.MappedFactType(synForm)[0][3]) $elf.AddRelationship(baseTable, synForm.slice(1), fkName, references); else {\n                var synResourceName = $elf.GetResourceName(synForm[0][1]), reverseReferences = $elf.GetReference(baseTable, fkName);\n                $elf.AddRelationship(synResourceName, synForm.slice(1), references.fieldName, reverseReferences);\n            }\n        });\n        this._opt(function() {\n            this._pred(fieldID);\n            return baseTable.fields[fieldID].required = required;\n        });\n        linkResourceName = this._applyWithArgs(\"GetResourceName\", factType);\n        delete this.relationships[linkResourceName];\n        return this.tables[linkResourceName] = \"ForeignKey\";\n    },\n    AttrUnique: function(factType) {\n        var $elf = this, _fromIdx = this.input.idx, baseTable, fieldID, required, uniqueField;\n        required = this.anything();\n        baseTable = this._applyWithArgs(\"GetTable\", factType);\n        this._opt(function() {\n            this._pred(\"Attribute\" === baseTable || \"ForeignKey\" === baseTable);\n            return baseTable = this._applyWithArgs(\"GetTable\", factType[0][1]);\n        });\n        uniqueField = this._applyWithArgs(\"FactTypeFieldName\", factType);\n        fieldID = this._applyWithArgs(\"GetTableFieldID\", baseTable, uniqueField);\n        this._pred(!1 !== fieldID);\n        return baseTable.fields[fieldID].index = \"UNIQUE\";\n    },\n    AttrSynonym: function(term) {\n        var $elf = this, _fromIdx = this.input.idx, synonym;\n        synonym = this.anything();\n        return this.synonyms[synonym[1]] = term[1];\n    },\n    AttrSynonymousForm: function(factType) {\n        var $elf = this, _fromIdx = this.input.idx, fieldName, fkTable, fromTable, linkRef, linkTable, references, resourceName, synForm;\n        synForm = this.anything();\n        this._applyWithArgs(\"AddFactType\", synForm, factType);\n        return this._or(function() {\n            return this._pred(this.IsPrimitive(factType[0]) || this.IsPrimitive(synForm[0]));\n        }, function() {\n            resourceName = this._applyWithArgs(\"GetResourceName\", factType);\n            (function() {\n                null == this.synonymousForms[resourceName] && (this.synonymousForms[resourceName] = []);\n                return this.synonymousForms[resourceName].push(synForm);\n            }).call(this);\n            fieldName = this._applyWithArgs(\"FactTypeFieldName\", factType);\n            return this._or(function() {\n                this._pred(2 == factType.length);\n                resourceName = this._applyWithArgs(\"GetResourceName\", factType[0][1]);\n                return this._applyWithArgs(\"AddRelationship\", resourceName, synForm.slice(1), fieldName);\n            }, function() {\n                fkTable = this._applyWithArgs(\"GetTable\", synForm[2][1]);\n                references = this._opt(function() {\n                    this._pred(!fkTable.primitive);\n                    return this._applyWithArgs(\"GetReference\", fkTable);\n                });\n                this._applyWithArgs(\"AddRelationship\", resourceName, synForm.slice(1), synForm[2][1], references);\n                return this._opt(function() {\n                    this._pred(references);\n                    linkTable = this._applyWithArgs(\"GetTable\", factType);\n                    fromTable = this._applyWithArgs(\"GetTable\", synForm[0][1]);\n                    linkRef = this._applyWithArgs(\"GetReference\", linkTable, fieldName);\n                    return this._applyWithArgs(\"AddRelationship\", fromTable, synForm.slice(1), references.fieldName, linkRef);\n                });\n            });\n        });\n    },\n    AttrTermForm: function(factType) {\n        var $elf = this, _fromIdx = this.input.idx, linkResourceName, linkTable, termForm;\n        termForm = this.anything();\n        linkResourceName = this._applyWithArgs(\"GetResourceName\", factType);\n        linkTable = this._applyWithArgs(\"GetTable\", factType);\n        return function() {\n            var linkVerb;\n            this.termForms[factType] = termForm;\n            this.synonyms[termForm[1]] = linkResourceName;\n            for (var i = 0; i < factType.length; i++) if (\"Term\" === factType[i][0]) {\n                var hasFactType = [ termForm, [ \"Verb\", \"has\", !1 ], factType[i] ], extraFactType = [ termForm, linkVerb || [ \"Verb\", \"has\" ], factType[i] ];\n                this.AddFactType(hasFactType, extraFactType);\n                linkVerb && \"has\" !== linkVerb[1] && this.AddFactType(extraFactType, extraFactType);\n                var termTable = this.GetTable(factType[i][1]);\n                if (termTable.primitive) this.tables[this.GetResourceName(extraFactType)] = \"Attribute\"; else {\n                    this.tables[this.GetResourceName(extraFactType)] = \"ForeignKey\";\n                    var fieldName = this.FactTypeFieldName(extraFactType), references = this.GetReference(linkTable, fieldName);\n                    this.AddRelationship(termTable, [ [ \"Verb\", \"has\" ], termForm ], termTable.idField, references);\n                }\n            } else \"Verb\" === factType[i][0] && (linkVerb = factType[i]);\n        }.call(this);\n    },\n    AttrNecessity: function(tableID) {\n        var $elf = this, _fromIdx = this.input.idx;\n        return this._apply(\"Rule\");\n    },\n    AttrDefinition: function(factType) {\n        var $elf = this, _fromIdx = this.input.idx, baseTable, checks, fieldID, uniqueField, values;\n        return this._or(function() {\n            this._form(function() {\n                this._applyWithArgs(\"exactly\", \"Enum\");\n                return values = this._many1(function() {\n                    return this._apply(\"Value\");\n                });\n            });\n            baseTable = this._applyWithArgs(\"GetTable\", factType);\n            this._opt(function() {\n                this._pred(\"Attribute\" === baseTable || \"ForeignKey\" === baseTable);\n                return baseTable = this._applyWithArgs(\"GetTable\", factType[0][1]);\n            });\n            this._pred(baseTable);\n            uniqueField = this._applyWithArgs(\"FactTypeFieldName\", factType);\n            fieldID = this._applyWithArgs(\"GetTableFieldID\", baseTable, uniqueField);\n            this._pred(!1 !== fieldID);\n            checks = baseTable.fields[fieldID].checks = baseTable.fields[fieldID].checks || [];\n            return checks.push([ \"In\", [ \"Field\", baseTable.fields[fieldID].fieldName ] ].concat(values));\n        }, function() {\n            return this.anything();\n        });\n    },\n    FactType: function() {\n        var $elf = this, _fromIdx = this.input.idx, attributes, factType, factTypePart, fieldID, fieldName, fkTable, identifier, identifierTable, linkHasFactType, linkTable, linkVerb, linkVerbFactType, negated, references, resourceName, uniqueFields, verb;\n        this._lookahead(function() {\n            return factType = this._many1(function() {\n                factTypePart = this.anything();\n                this._lookahead(function() {\n                    return attributes = this.anything();\n                });\n                return factTypePart;\n            });\n        });\n        this._applyWithArgs(\"AddFactType\", factType, factType);\n        this._or(function() {\n            this._pred(this.IsPrimitive(factType[0]));\n            return this._many1(function() {\n                factTypePart = this.anything();\n                return this._lookahead(function() {\n                    return attributes = this.anything();\n                });\n            });\n        }, function() {\n            resourceName = this._applyWithArgs(\"GetResourceName\", factType);\n            return this._or(function() {\n                this._pred(2 == factType.length);\n                this._many1(function() {\n                    factTypePart = this.anything();\n                    return this._lookahead(function() {\n                        return attributes = this.anything();\n                    });\n                });\n                identifierTable = this._applyWithArgs(\"GetTable\", factType[0][1]);\n                fieldName = this._applyWithArgs(\"FactTypeFieldName\", factType);\n                this._applyWithArgs(\"AddTableField\", identifierTable, fieldName, \"Boolean\", !0);\n                delete this.relationships[resourceName];\n                this.tables[resourceName] = \"BooleanAttribute\";\n                return this._applyWithArgs(\"AddRelationship\", identifierTable, factType.slice(1), fieldName);\n            }, function() {\n                linkTable = this._applyWithArgs(\"CreateTable\", resourceName, _(factType).map(1).join(\" \"));\n                uniqueFields = [];\n                this._many1(function() {\n                    return this._or(function() {\n                        identifier = this._apply(\"Identifier\");\n                        linkHasFactType = [ [ \"Term\", resourceName ], [ \"Verb\", \"has\" ], [ \"Term\", identifier.name ] ];\n                        linkVerbFactType = [ [ \"Term\", resourceName ], linkVerb, [ \"Term\", identifier.name ] ];\n                        fieldName = this._or(function() {\n                            this._pred(linkVerb);\n                            return this._applyWithArgs(\"FactTypeFieldName\", linkVerbFactType);\n                        }, function() {\n                            return this._applyWithArgs(\"FactTypeFieldName\", linkHasFactType);\n                        });\n                        uniqueFields.push(fieldName);\n                        fkTable = this._applyWithArgs(\"GetTable\", identifier.name);\n                        references = this._or(function() {\n                            this._pred(fkTable.primitive);\n                            this._applyWithArgs(\"AddTableField\", linkTable, fieldName, fkTable.primitive, !0);\n                            return null;\n                        }, function() {\n                            references = this._applyWithArgs(\"GetReference\", fkTable);\n                            fieldID = this._applyWithArgs(\"AddTableField\", linkTable, fieldName, \"ForeignKey\", !0, null, references);\n                            return references;\n                        });\n                        this._applyWithArgs(\"AddRelationship\", resourceName, linkHasFactType.slice(2), fieldName, references);\n                        return this._opt(function() {\n                            this._pred(linkVerb);\n                            return this._applyWithArgs(\"AddRelationship\", resourceName, linkVerbFactType.slice(1), fieldName, references);\n                        });\n                    }, function() {\n                        this._form(function() {\n                            this._applyWithArgs(\"exactly\", \"Verb\");\n                            verb = this.anything();\n                            return negated = this.anything();\n                        });\n                        return linkVerb = [ \"Verb\", verb ];\n                    });\n                });\n                return linkTable.indexes.push({\n                    type: \"UNIQUE\",\n                    fields: uniqueFields\n                });\n            });\n        });\n        return factType;\n    },\n    Cardinality: function() {\n        var $elf = this, _fromIdx = this.input.idx, cardinality;\n        this._form(function() {\n            (function() {\n                switch (this.anything()) {\n                  case \"Cardinality\":\n                    return \"Cardinality\";\n\n                  case \"MaximumCardinality\":\n                    return \"MaximumCardinality\";\n\n                  case \"MinimumCardinality\":\n                    return \"MinimumCardinality\";\n\n                  default:\n                    throw this._fail();\n                }\n            }).call(this);\n            return cardinality = this._apply(\"Number\");\n        });\n        return cardinality;\n    },\n    Variable: function() {\n        var $elf = this, _fromIdx = this.input.idx, bind, checkConceptTypeResolver, identifier, num, query, selectBody, varNum, whereBody;\n        this._form(function() {\n            this._applyWithArgs(\"exactly\", \"Variable\");\n            num = this._apply(\"Number\");\n            identifier = this._apply(\"Identifier\");\n            query = this._or(function() {\n                bind = this.bindAttributes[num];\n                this._pred(bind);\n                selectBody = _.clone(bind.binding);\n                return [ \"SelectQuery\", [ \"Select\", [ selectBody ] ] ];\n            }, function() {\n                varNum = \".\" + num;\n                query = [ \"SelectQuery\", [ \"Select\", [] ] ];\n                checkConceptTypeResolver = this._applyWithArgs(\"CreateConceptTypesResolver\", query, identifier, varNum);\n                return query;\n            });\n            return this._opt(function() {\n                checkConceptTypeResolver && checkConceptTypeResolver();\n                whereBody = this._apply(\"RulePart\");\n                return this._applyWithArgs(\"AddWhereClause\", query, whereBody);\n            });\n        });\n        this._opt(function() {\n            checkConceptTypeResolver && checkConceptTypeResolver();\n            whereBody = this._apply(\"RulePart\");\n            return this._applyWithArgs(\"AddWhereClause\", query, whereBody);\n        });\n        return this._or(function() {\n            this._pred(selectBody && !query.some(function(p) {\n                return \"From\" === p[0];\n            }));\n            this._opt(function() {\n                whereBody = query.find(function(part) {\n                    return \"Where\" === part[0];\n                });\n                this._pred(whereBody);\n                return selectBody.whereBody = whereBody[1];\n            });\n            return selectBody;\n        }, function() {\n            return query;\n        });\n    },\n    RoleBindings: function(actualFactType) {\n        var $elf = this, _fromIdx = this.input.idx, binds;\n        binds = [];\n        (function() {\n            for (var i = 0; i < actualFactType.length; i += 2) {\n                var j = actualFactType.findIndex(function(p) {\n                    return p[3] === i;\n                });\n                binds[j / 2] = this.RoleBinding(actualFactType[j][1]);\n            }\n        }).call(this);\n        this._apply(\"end\");\n        return binds;\n    },\n    RoleBinding: function(baseTermName) {\n        var $elf = this, _fromIdx = this.input.idx, baseBind, binding, conceptTypeResolver, data, identifier, number;\n        this._form(function() {\n            this._applyWithArgs(\"exactly\", \"RoleBinding\");\n            identifier = this._apply(\"Identifier\");\n            return this._or(function() {\n                return number = this._apply(\"number\");\n            }, function() {\n                return data = this._apply(\"Value\");\n            }, function() {\n                return this._applyWithArgs(\"NativeNameBinding\", baseTermName);\n            });\n        });\n        baseBind = this.bindAttributes[number];\n        binding = this._or(function() {\n            this._pred(data);\n            return data;\n        }, function() {\n            this._pred(baseBind);\n            return baseBind.binding;\n        }, function() {\n            conceptTypeResolver = this.conceptTypeResolvers[identifier.name + \".\" + number];\n            return [ \"ReferencedField\", baseTermName + \".\" + number, identifier.name ];\n        });\n        return {\n            identifier: identifier,\n            number: number,\n            data: data,\n            binding: binding,\n            used: function() {\n                conceptTypeResolver && conceptTypeResolver(baseTermName);\n            }\n        };\n    },\n    NativeNameBinding: function(baseTermName) {\n        var $elf = this, _fromIdx = this.input.idx, name;\n        name = this._apply(\"Identifier\");\n        this._pred(\"Name\" === name.type);\n        this._pred(this.IsPrimitive(this.ReconstructIdentifier(name)));\n        this._pred(this.sbvrTypes[baseTermName] && this.sbvrTypes[baseTermName].nativeNames && this.sbvrTypes[baseTermName].nativeNames[name.name]);\n        return this.sbvrTypes[baseTermName].nativeNames[name.name];\n    },\n    NativeProperty: function(actualFactType) {\n        var $elf = this, _fromIdx = this.input.idx, binds, negated, operator, primitive, property, verb;\n        this._pred(this.IsPrimitive(actualFactType[0]));\n        this._pred(this.IsPrimitive(actualFactType[2]));\n        binds = this._applyWithArgs(\"RoleBindings\", actualFactType);\n        negated = actualFactType[1][2];\n        operator = this._or(function() {\n            this._pred(negated);\n            return \"NotEquals\";\n        }, function() {\n            return \"Equals\";\n        });\n        this._pred(2 == binds.length);\n        primitive = actualFactType[0][1];\n        verb = actualFactType[1][1];\n        property = actualFactType[2][1];\n        this._pred(this.sbvrTypes[primitive] && this.sbvrTypes[primitive].nativeProperties && this.sbvrTypes[primitive].nativeProperties[verb] && this.sbvrTypes[primitive].nativeProperties[verb][property]);\n        return [ operator, [ \"Boolean\", !0 ], [ \"Boolean\", !0 ] ];\n    },\n    NativeFactType: function(actualFactType) {\n        var $elf = this, _fromIdx = this.input.idx, binds, comparison, negated, primitive, secondPrimitive, verb;\n        this._pred(3 == actualFactType.length);\n        this._pred(this.IsPrimitive(actualFactType[0]));\n        this._pred(this.IsPrimitive(actualFactType[2]));\n        return this._or(function() {\n            binds = this._applyWithArgs(\"RoleBindings\", actualFactType);\n            this._pred(2 == binds.length);\n            primitive = actualFactType[0][1];\n            verb = actualFactType[1][1];\n            secondPrimitive = actualFactType[2][1];\n            this._pred(this.sbvrTypes[primitive] && this.sbvrTypes[primitive].nativeFactTypes && this.sbvrTypes[primitive].nativeFactTypes[secondPrimitive] && this.sbvrTypes[primitive].nativeFactTypes[secondPrimitive][verb]);\n            comparison = this.sbvrTypes[primitive].nativeFactTypes[secondPrimitive][verb](binds[0].binding, binds[1].binding);\n            negated = actualFactType[1][2];\n            return this._or(function() {\n                this._pred(negated);\n                return [ \"Not\", comparison ];\n            }, function() {\n                return comparison;\n            });\n        }, function() {\n            return this._applyWithArgs(\"foreign\", ___NativeFactTypeMatchingFailed___, \"die\");\n        });\n    },\n    LinkTableAlias: function() {\n        var $elf = this, _fromIdx = this.input.idx, bindNumbers, binding, factType, identifierName, identifierType, mapping, partAlias, verb, vocab;\n        this._form(function() {\n            return bindNumbers = this._many1(function() {\n                binding = this.anything();\n                return binding.number;\n            });\n        });\n        this._form(function() {\n            return factType = this._many(function() {\n                this._form(function() {\n                    return partAlias = this._or(function() {\n                        switch (this.anything()) {\n                          case \"Verb\":\n                            verb = this.anything();\n                            this.anything();\n                            return verb;\n\n                          default:\n                            throw this._fail();\n                        }\n                    }, function() {\n                        identifierType = this.anything();\n                        identifierName = this.anything();\n                        vocab = this.anything();\n                        mapping = this._opt(function() {\n                            return this.anything();\n                        });\n                        return identifierName + \".\" + bindNumbers.shift();\n                    });\n                });\n                return partAlias;\n            });\n        });\n        return factType.join(\"-\");\n    },\n    LinkTable: function(actualFactType) {\n        var $elf = this, _fromIdx = this.input.idx, binds, linkTable, query, tableAlias;\n        binds = this._applyWithArgs(\"RoleBindings\", actualFactType);\n        tableAlias = this._applyWithArgs(\"LinkTableAlias\", binds, actualFactType);\n        linkTable = this._applyWithArgs(\"GetTable\", actualFactType);\n        query = [ \"SelectQuery\", [ \"Select\", [] ], [ \"From\", [ linkTable.name, tableAlias ] ] ];\n        binds.forEach(function(bind, i) {\n            var baseIdentifierName = actualFactType[2 * i][1];\n            if (!$elf.GetTable(baseIdentifierName).primitive) {\n                var relationships = $elf.relationships[linkTable.resourceName];\n                $elf.ResolveSynonym(baseIdentifierName).split(\"-\").forEach(function(partName) {\n                    relationships = relationships[partName];\n                });\n                var relationshipMapping = relationships.$;\n                $elf.CreateLinkTableResolver(query, tableAlias, bind, relationshipMapping);\n            }\n        });\n        return [ \"Exists\", query ];\n    },\n    ForeignKey: function(actualFactType) {\n        var $elf = this, _fromIdx = this.input.idx, bindFrom, bindTo, binds, fieldName, tableTo;\n        this._pred(\"ForeignKey\" == this.GetTable(actualFactType));\n        this._or(function() {\n            binds = this._applyWithArgs(\"RoleBindings\", actualFactType);\n            this._pred(2 == binds.length);\n            bindFrom = binds[0];\n            bindTo = binds[1];\n            fieldName = this._applyWithArgs(\"FactTypeFieldName\", actualFactType);\n            return tableTo = this._applyWithArgs(\"GetTable\", actualFactType[2][1]);\n        }, function() {\n            return this._applyWithArgs(\"foreign\", ___ForeignKeyMatchingFailed___, \"die\");\n        });\n        (function() {\n            bindFrom.used();\n            return bindTo.used();\n        }).call(this);\n        return [ \"Equals\", [ \"ReferencedField\", bindFrom.binding[1], fieldName ], [ \"ReferencedField\", bindTo.binding[1], tableTo.idField ] ];\n    },\n    BooleanAttribute: function(actualFactType) {\n        var $elf = this, _fromIdx = this.input.idx, attributeName, binds, negated;\n        this._pred(\"BooleanAttribute\" == this.GetTable(actualFactType));\n        this._or(function() {\n            binds = this._applyWithArgs(\"RoleBindings\", actualFactType);\n            this._pred(1 == binds.length);\n            attributeName = this._applyWithArgs(\"FactTypeFieldName\", actualFactType);\n            return negated = actualFactType[1][2];\n        }, function() {\n            console.error(this.input);\n            return this._applyWithArgs(\"foreign\", ___BooleanAttributeMatchingFailed___, \"die\");\n        });\n        binds[0].used();\n        return [ \"Equals\", [ \"ReferencedField\", binds[0].binding[1], attributeName ], [ \"Boolean\", !negated ] ];\n    },\n    Attribute: function(actualFactType) {\n        var $elf = this, _fromIdx = this.input.idx, bind, bindAttr, bindReal, binds, negated, operator;\n        this._pred(\"Attribute\" == this.GetTable(actualFactType));\n        this._or(function() {\n            binds = this._applyWithArgs(\"RoleBindings\", actualFactType);\n            this._pred(2 == binds.length);\n            bindReal = binds[0];\n            return bindAttr = binds[1];\n        }, function() {\n            return this._applyWithArgs(\"foreign\", ___AttributeMatchingFailed___, \"die\");\n        });\n        negated = actualFactType[1][2];\n        operator = this._or(function() {\n            this._pred(negated);\n            return \"NotEquals\";\n        }, function() {\n            return \"Equals\";\n        });\n        return this._or(function() {\n            bind = this.bindAttributes[bindAttr.number];\n            (function() {\n                bindReal.used();\n                return bindAttr.binding = [ \"ReferencedField\", bindReal.binding[1], bind.binding[2] ];\n            }).call(this);\n            this._pred(!_.isEqual(bindAttr.binding, bind.binding));\n            return [ operator, bindAttr.binding, bind.binding ];\n        }, function() {\n            return [ operator, [ \"Boolean\", !0 ], [ \"Boolean\", !0 ] ];\n        });\n    },\n    AtomicFormulation: function() {\n        var $elf = this, _fromIdx = this.input.idx, actualFactType, factType, whereClause;\n        this._form(function() {\n            this._applyWithArgs(\"exactly\", \"AtomicFormulation\");\n            this._form(function() {\n                this._applyWithArgs(\"exactly\", \"FactType\");\n                return factType = this._many1(function() {\n                    return this.anything();\n                });\n            });\n            actualFactType = this._applyWithArgs(\"MappedFactType\", factType);\n            return whereClause = this._or(function() {\n                return this._applyWithArgs(\"NativeProperty\", actualFactType);\n            }, function() {\n                return this._applyWithArgs(\"NativeFactType\", actualFactType);\n            }, function() {\n                return this._applyWithArgs(\"ForeignKey\", actualFactType);\n            }, function() {\n                return this._applyWithArgs(\"BooleanAttribute\", actualFactType);\n            }, function() {\n                return this._applyWithArgs(\"Attribute\", actualFactType);\n            }, function() {\n                return this._applyWithArgs(\"LinkTable\", actualFactType);\n            });\n        });\n        return whereClause;\n    },\n    AtLeast: function() {\n        var $elf = this, _fromIdx = this.input.idx, minCard, variable, where;\n        this._form(function() {\n            this._applyWithArgs(\"exactly\", \"AtLeastNQuantification\");\n            minCard = this._apply(\"Cardinality\");\n            return variable = this._apply(\"Variable\");\n        });\n        where = this._or(function() {\n            this._pred(0 == minCard);\n            return [ \"Boolean\", !0 ];\n        }, function() {\n            this._pred(\"SelectQuery\" == variable[0] && 0 == variable[1][1].length);\n            variable[1][1].push([ \"Count\", \"*\" ]);\n            return [ \"GreaterThanOrEqual\", variable, [ \"Number\", minCard ] ];\n        }, function() {\n            this._pred(minCard > 1);\n            return [ \"Boolean\", !1 ];\n        }, function() {\n            return [ \"Exists\", variable ];\n        });\n        return this._or(function() {\n            this._pred(variable.whereBody);\n            return [ \"And\", variable.whereBody, where ];\n        }, function() {\n            return where;\n        });\n    },\n    Exactly: function() {\n        var $elf = this, _fromIdx = this.input.idx, card, exists, variable, where;\n        this._form(function() {\n            this._applyWithArgs(\"exactly\", \"ExactQuantification\");\n            card = this._apply(\"Cardinality\");\n            return variable = this._apply(\"Variable\");\n        });\n        where = this._or(function() {\n            this._pred(\"SelectQuery\" == variable[0] && 0 == variable[1][1].length);\n            variable[1][1].push([ \"Count\", \"*\" ]);\n            return [ \"Equals\", variable, [ \"Number\", card ] ];\n        }, function() {\n            exists = [ \"Exists\", variable ];\n            return this._or(function() {\n                this._pred(0 == card);\n                return [ \"Not\", exists ];\n            }, function() {\n                this._pred(1 == card);\n                return exists;\n            }, function() {\n                return [ \"Boolean\", !1 ];\n            });\n        });\n        return this._or(function() {\n            this._pred(variable.whereBody);\n            return [ \"And\", variable.whereBody, where ];\n        }, function() {\n            return where;\n        });\n    },\n    Range: function() {\n        var $elf = this, _fromIdx = this.input.idx, exists, maxCard, minCard, variable, where;\n        this._form(function() {\n            this._applyWithArgs(\"exactly\", \"NumericalRangeQuantification\");\n            minCard = this._apply(\"Cardinality\");\n            maxCard = this._apply(\"Cardinality\");\n            return variable = this._apply(\"Variable\");\n        });\n        where = this._or(function() {\n            this._pred(\"SelectQuery\" == variable[0] && 0 == variable[1][1].length);\n            variable[1][1].push([ \"Count\", \"*\" ]);\n            return [ \"Between\", variable, [ \"Number\", minCard ], [ \"Number\", maxCard ] ];\n        }, function() {\n            exists = [ \"Exists\", variable ];\n            return this._or(function() {\n                this._pred(0 == minCard);\n                return this._or(function() {\n                    this._pred(0 == maxCard);\n                    return [ \"Not\", exists ];\n                }, function() {\n                    return [ \"Boolean\", !0 ];\n                });\n            }, function() {\n                this._pred(1 == minCard);\n                return exists;\n            }, function() {\n                return [ \"Boolean\", !1 ];\n            });\n        });\n        return this._or(function() {\n            this._pred(variable.whereBody);\n            return [ \"And\", variable.whereBody, where ];\n        }, function() {\n            return where;\n        });\n    },\n    Disjunction: function() {\n        var $elf = this, _fromIdx = this.input.idx, first, rest;\n        this._form(function() {\n            this._applyWithArgs(\"exactly\", \"Disjunction\");\n            first = this._apply(\"RulePart\");\n            return rest = this._many1(function() {\n                return this._apply(\"RulePart\");\n            });\n        });\n        return [ \"Or\", first ].concat(rest);\n    },\n    Conjunction: function() {\n        var $elf = this, _fromIdx = this.input.idx, first, rest;\n        this._form(function() {\n            this._applyWithArgs(\"exactly\", \"Conjunction\");\n            first = this._apply(\"RulePart\");\n            return rest = this._many1(function() {\n                return this._apply(\"RulePart\");\n            });\n        });\n        return [ \"And\", first ].concat(rest);\n    },\n    Exists: function() {\n        var $elf = this, _fromIdx = this.input.idx, variable, where;\n        this._form(function() {\n            this._applyWithArgs(\"exactly\", \"ExistentialQuantification\");\n            return variable = this._apply(\"Variable\");\n        });\n        where = [ \"Exists\", variable ];\n        return this._or(function() {\n            this._pred(variable.whereBody);\n            return [ \"And\", variable.whereBody, where ];\n        }, function() {\n            return where;\n        });\n    },\n    Negation: function() {\n        var $elf = this, _fromIdx = this.input.idx, whereBody;\n        this._form(function() {\n            this._applyWithArgs(\"exactly\", \"LogicalNegation\");\n            return whereBody = this._apply(\"RulePart\");\n        });\n        return [ \"Not\", whereBody ];\n    },\n    RulePart: function() {\n        var $elf = this, _fromIdx = this.input.idx, x;\n        return this._or(function() {\n            return this._apply(\"AtomicFormulation\");\n        }, function() {\n            return this._apply(\"AtLeast\");\n        }, function() {\n            return this._apply(\"Exactly\");\n        }, function() {\n            return this._apply(\"Exists\");\n        }, function() {\n            return this._apply(\"Negation\");\n        }, function() {\n            return this._apply(\"Range\");\n        }, function() {\n            return this._apply(\"Disjunction\");\n        }, function() {\n            return this._apply(\"Conjunction\");\n        }, function() {\n            x = this.anything();\n            console.error(\"Hit unhandled operation:\", x);\n            return this._pred(!1);\n        });\n    },\n    RuleBody: function() {\n        var $elf = this, _fromIdx = this.input.idx, rule;\n        this._form(function() {\n            (function() {\n                switch (this.anything()) {\n                  case \"NecessityFormulation\":\n                    return \"NecessityFormulation\";\n\n                  case \"ObligationFormulation\":\n                    return \"ObligationFormulation\";\n\n                  case \"PermissibilityFormulation\":\n                    return \"PermissibilityFormulation\";\n\n                  case \"PossibilityFormulation\":\n                    return \"PossibilityFormulation\";\n\n                  default:\n                    throw this._fail();\n                }\n            }).call(this);\n            return rule = this._apply(\"RulePart\");\n        });\n        return rule;\n    },\n    ReconstructIdentifier: function(bindIdentifier) {\n        var $elf = this, _fromIdx = this.input.idx;\n        return [ bindIdentifier.type, bindIdentifier.name, bindIdentifier.vocab ];\n    },\n    ProcessAtomicFormulations: function() {\n        var $elf = this, _fromIdx = this.input.idx;\n        this.bindAttributes = [];\n        this.bindAttributeDepth = [];\n        this.nonPrimitiveExists = !1;\n        this._lookahead(function() {\n            return this._applyWithArgs(\"ProcessAtomicFormulationsRecurse\", 0, \"ProcessAtomicFormulationsAttributes\");\n        });\n        this._lookahead(function() {\n            return this._applyWithArgs(\"ProcessAtomicFormulationsRecurse\", 0, \"ProcessAtomicFormulationsNonPrimitive\");\n        });\n        return this._lookahead(function() {\n            return this._applyWithArgs(\"ProcessAtomicFormulationsRecurse\", 0, \"ProcessAtomicFormulationsNativeProperties\");\n        });\n    },\n    ProcessAtomicFormulationsRecurse: function(depth, rule) {\n        var $elf = this, _fromIdx = this.input.idx, actualFactType, factType, unmappedFactType;\n        return this._many(function() {\n            return this._or(function() {\n                this._pred(Array.isArray(this.input.hd));\n                return this._form(function() {\n                    return this._or(function() {\n                        switch (this.anything()) {\n                          case \"AtomicFormulation\":\n                            this._form(function() {\n                                this._applyWithArgs(\"exactly\", \"FactType\");\n                                return factType = this._many1(function() {\n                                    return this.anything();\n                                });\n                            });\n                            unmappedFactType = this._applyWithArgs(\"UnmappedFactType\", factType);\n                            actualFactType = this._applyWithArgs(\"MappedFactType\", factType);\n                            return this._applyWithArgs(rule, depth, unmappedFactType, actualFactType);\n\n                          default:\n                            throw this._fail();\n                        }\n                    }, function() {\n                        return this._applyWithArgs(\"ProcessAtomicFormulationsRecurse\", depth + 1, rule);\n                    });\n                });\n            }, function() {\n                return this.anything();\n            });\n        });\n    },\n    ProcessAtomicFormulationsNonPrimitive: function(depth, unmappedFactType, actualFactType) {\n        var $elf = this, _fromIdx = this.input.idx, binds;\n        binds = this._applyWithArgs(\"RoleBindings\", actualFactType);\n        return function() {\n            for (var i = 0; i < binds.length; i++) if (!this.IsPrimitive(this.ReconstructIdentifier(binds[i].identifier))) {\n                this.nonPrimitiveExists = !0;\n                break;\n            }\n        }.call(this);\n    },\n    ProcessAtomicFormulationsAttributes: function(depth, unmappedFactType, actualFactType) {\n        var $elf = this, _fromIdx = this.input.idx, attrBinding, attrFieldName, baseAttrFactType, baseBinding, binds, tableAlias;\n        binds = this._applyWithArgs(\"RoleBindings\", actualFactType);\n        return this._or(function() {\n            this._pred(this.attributes.hasOwnProperty(unmappedFactType) && this.attributes[unmappedFactType]);\n            baseBinding = binds.find(function(bind) {\n                return !$elf.IsPrimitive($elf.ReconstructIdentifier(bind.identifier));\n            });\n            attrBinding = binds.find(function(bind) {\n                return $elf.IsPrimitive($elf.ReconstructIdentifier(bind.identifier)) && (null == $elf.bindAttributeDepth[bind.number] || $elf.bindAttributeDepth[bind.number] > depth);\n            });\n            baseAttrFactType = _.cloneDeep(unmappedFactType);\n            baseAttrFactType[2][1] = attrBinding.identifier.name;\n            attrFieldName = this._applyWithArgs(\"FactTypeFieldName\", baseAttrFactType);\n            return function() {\n                this.bindAttributeDepth[attrBinding.number] = depth;\n                return this.bindAttributes[attrBinding.number] = {\n                    binding: [ \"ReferencedField\", baseBinding.binding[1], attrFieldName ]\n                };\n            }.call(this);\n        }, function() {\n            this._pred(binds.some(function(bind) {\n                return !$elf.IsPrimitive($elf.ReconstructIdentifier(bind.identifier));\n            }));\n            tableAlias = this._applyWithArgs(\"LinkTableAlias\", binds, actualFactType);\n            return function() {\n                for (var i = 0; i < actualFactType.length; i += 2) {\n                    var table = this.GetTable(actualFactType[i][1]), bindNumber = binds[i / 2].number;\n                    if (table && table.primitive && (null == this.bindAttributeDepth[bindNumber] || this.bindAttributeDepth[bindNumber] > depth)) {\n                        this.bindAttributeDepth[bindNumber] = depth;\n                        this.bindAttributes[bindNumber] = {\n                            binding: [ \"ReferencedField\", tableAlias, actualFactType[i][1] ]\n                        };\n                    }\n                }\n            }.call(this);\n        });\n    },\n    ProcessAtomicFormulationsNativeProperties: function(depth, unmappedFactType, actualFactType) {\n        var $elf = this, _fromIdx = this.input.idx, binding, binds, primitive, property, verb;\n        binds = this._applyWithArgs(\"RoleBindings\", actualFactType);\n        this._pred(binds.every(function(bind) {\n            return $elf.IsPrimitive($elf.ReconstructIdentifier(bind.identifier));\n        }));\n        this._pred(2 == binds.length);\n        primitive = actualFactType[0][1];\n        verb = actualFactType[1][1];\n        property = actualFactType[2][1];\n        this._pred(this.sbvrTypes[primitive] && this.sbvrTypes[primitive].nativeProperties && this.sbvrTypes[primitive].nativeProperties[verb] && this.sbvrTypes[primitive].nativeProperties[verb][property]);\n        binding = this.sbvrTypes[primitive].nativeProperties[verb][property](binds[0].binding, binds[1].binding);\n        return function() {\n            this.bindAttributeDepth[binds[1].number] = depth;\n            return this.bindAttributes[binds[1].number] = {\n                binding: binding\n            };\n        }.call(this);\n    },\n    Rule: function() {\n        var $elf = this, _fromIdx = this.input.idx, ruleBody, ruleText;\n        this._apply(\"ResetRuleState\");\n        return this._form(function() {\n            this._applyWithArgs(\"exactly\", \"Rule\");\n            this._lookahead(function() {\n                return this._apply(\"ProcessAtomicFormulations\");\n            });\n            ruleBody = this._or(function() {\n                this._pred(this.nonPrimitiveExists);\n                return this._apply(\"RuleBody\");\n            }, function() {\n                return this.anything();\n            });\n            this._form(function() {\n                this._applyWithArgs(\"exactly\", \"StructuredEnglish\");\n                return ruleText = this.anything();\n            });\n            return this._opt(function() {\n                this._pred(this.nonPrimitiveExists);\n                return this.rules.push([ \"Rule\", [ \"Body\", ruleBody ], [ \"StructuredEnglish\", ruleText ] ]);\n            });\n        });\n    },\n    Process: function() {\n        var $elf = this, _fromIdx = this.input.idx, attributes, factType, hasDependants, identifierName, type, vocab;\n        this._form(function() {\n            this._applyWithArgs(\"exactly\", \"Model\");\n            return this._many1(function() {\n                return this._or(function() {\n                    return this._form(function() {\n                        return this._or(function() {\n                            switch (this.anything()) {\n                              case \"Vocabulary\":\n                                vocab = this.anything();\n                                return attributes = this.anything();\n\n                              default:\n                                throw this._fail();\n                            }\n                        }, function() {\n                            type = function() {\n                                switch (this.anything()) {\n                                  case \"Name\":\n                                    return \"Name\";\n\n                                  case \"Term\":\n                                    return \"Term\";\n\n                                  default:\n                                    throw this._fail();\n                                }\n                            }.call(this);\n                            identifierName = this._apply(\"IdentifierName\");\n                            vocab = this.anything();\n                            this._applyWithArgs(\"AddVocabulary\", vocab);\n                            return this._applyWithArgs(\"Attributes\", [ type, identifierName, vocab ]);\n                        }, function() {\n                            switch (this.anything()) {\n                              case \"FactType\":\n                                factType = this._apply(\"FactType\");\n                                return this._applyWithArgs(\"Attributes\", factType);\n\n                              default:\n                                throw this._fail();\n                            }\n                        });\n                    });\n                }, function() {\n                    return this._apply(\"Rule\");\n                });\n            });\n        });\n        hasDependants = {};\n        _.forEach(this.tables, function(table) {\n            _.forEach(table.fields, function(field) {\n                \"ForeignKey\" !== field.dataType && \"ConceptType\" !== field.dataType || (hasDependants[field.references.resourceName] = !0);\n            });\n        });\n        return {\n            tables: _.omitBy(this.tables, function(table, resourceName) {\n                return \"string\" == typeof table || table.primitive && !hasDependants[resourceName];\n            }),\n            functions: {\n                trigger_update_modified_at: updateModifiedAt\n            },\n            relationships: this.relationships,\n            rules: this.rules,\n            synonyms: this.synonyms\n        };\n    },\n    GetReference: function(table, field) {\n        var $elf = this, _fromIdx = this.input.idx;\n        return {\n            resourceName: table.resourceName,\n            fieldName: field || table.idField\n        };\n    }\n});\n\nLF2AbstractSQL.CreateTable = function(resourceName, modelName) {\n    var table = {\n        fields: [],\n        primitive: !1,\n        name: null,\n        indexes: [],\n        idField: null,\n        resourceName: resourceName,\n        modelName: modelName,\n        triggers: []\n    };\n    this.AddTableField(table, \"created at\", \"Date Time\", !0, null, null, \"CURRENT_TIMESTAMP\");\n    this.AddTableField(table, \"modified at\", \"Date Time\", !0, null, null, \"CURRENT_TIMESTAMP\");\n    this.AddTableTrigger(table, \"BEFORE\", \"UPDATE\", \"ROW\", \"trigger_update_modified_at\");\n    return this.tables[resourceName] = table;\n};\n\nLF2AbstractSQL.AddTableTrigger = function(table, when, operation, level, fnName) {\n    table.triggers.push({\n        when: when,\n        operation: operation,\n        level: level,\n        fnName: fnName\n    });\n};\n\nLF2AbstractSQL.AddTableField = function(table, fieldName, dataType, required, index, references, defaultValue) {\n    var fieldID = this.GetTableFieldID(table, fieldName);\n    if (!1 === fieldID) {\n        var f = {\n            dataType: dataType,\n            fieldName: fieldName,\n            required: required\n        };\n        null != references && (f.references = references);\n        null != index && (f.index = index);\n        null != defaultValue && (f.defaultValue = defaultValue);\n        table.fields.push(f);\n    }\n    return fieldID;\n};\n\nLF2AbstractSQL.AddRelationship = function(resourceName, factType, fieldName, references, forceHas) {\n    var $elf = this;\n    if (!0 !== forceHas && \"has\" === factType[0][1]) {\n        var strippedFactType = _.clone(factType);\n        strippedFactType.shift();\n        this.AddRelationship(resourceName, strippedFactType, fieldName, references);\n    }\n    _.isObject(resourceName) && (resourceName = resourceName.resourceName);\n    null == this.relationships[resourceName] && (this.relationships[resourceName] = {});\n    var relationships = this.relationships[resourceName];\n    _(factType).flatMap(function(factTypePart) {\n        return $elf.ResolveSynonym(factTypePart[1]).split(\"-\");\n    }).each(function(partName) {\n        null == relationships[partName] && (relationships[partName] = {});\n        relationships = relationships[partName];\n    });\n    var relationReference = [ fieldName ];\n    null != references && relationReference.push([ references.resourceName, references.fieldName ]);\n    relationships.$ = relationReference;\n};\n\nLF2AbstractSQL.FactTypeFieldName = function(factType) {\n    if (factType.length > 3) throw new Error(\"Multiple term fact types are unsupported\");\n    return 2 === factType.length ? factType[1][1] : \"has\" === factType[1][1] ? factType[2][1] : factType[1][1] + \"-\" + factType[2][1];\n};\n\nLF2AbstractSQL.AddWhereClause = function(query, whereBody) {\n    if (!_.isEqual(whereBody, [ \"Equals\", [ \"Boolean\", !0 ], [ \"Boolean\", !0 ] ])) if (\"Exists\" != whereBody[0] || \"SelectQuery\" != whereBody[1][0] && \"InsertQuery\" != whereBody[1][0] && \"UpdateQuery\" != whereBody[1][0] && \"UpsertQuery\" != whereBody[1][0]) {\n        for (var i = 1; i < query.length; i++) if (\"Where\" == query[i][0]) {\n            query[i][1] = [ \"And\", query[i][1], whereBody ];\n            return;\n        }\n        query.push([ \"Where\", whereBody ]);\n    } else {\n        whereBody = whereBody[1].slice(1);\n        for (var i = 0; i < whereBody.length; i++) \"From\" == whereBody[i][0] && query.push(whereBody[i]);\n        for (var i = 0; i < whereBody.length; i++) \"Where\" == whereBody[i][0] && this.AddWhereClause(query, whereBody[i][1]);\n    }\n};\n\nLF2AbstractSQL.CreateConceptTypesResolver = function(query, identifier, varNum) {\n    var parentAlias = identifier.name + varNum, concept = this.ReconstructIdentifier(identifier), conceptTypeResolutions, $elf = this;\n    if (this.conceptTypeResolvers[parentAlias]) throw new Error('Concept type resolver already added for \"' + parentAlias + '\"!');\n    conceptTypeResolutions = [];\n    var conceptTypeResolver = function(untilConcept) {\n        var conceptTable, conceptAlias;\n        if (0 === conceptTypeResolutions.length) {\n            conceptTypeResolutions.push(identifier.name);\n            query.push([ \"From\", [ this.GetTable(identifier.name).name, parentAlias ] ]);\n            this.ResolveLinkTable(parentAlias);\n        }\n        parentAlias = _.last(conceptTypeResolutions);\n        if (!0 !== parentAlias && !conceptTypeResolutions.includes(untilConcept)) {\n            for (;!1 !== (concept = this.FollowConceptType(concept)); ) {\n                conceptAlias = concept[1] + varNum;\n                conceptTable = this.GetTable(concept[1]);\n                if (!1 !== conceptTable.primitive) break;\n                query.push([ \"From\", [ conceptTable.name, conceptAlias ] ]);\n                this.AddWhereClause(query, [ \"Equals\", [ \"ReferencedField\", parentAlias, concept[1] ], [ \"ReferencedField\", conceptAlias, conceptTable.idField ] ]);\n                this.ResolveLinkTable(parentAlias);\n                parentAlias = conceptAlias;\n                conceptTypeResolutions.push(parentAlias);\n                if (null != untilConcept && !this.IdentifiersEqual(concept, untilConcept)) break;\n            }\n            !1 === concept && conceptTypeResolutions.push(!0);\n        }\n    }.bind(this);\n    this.conceptTypeResolvers[parentAlias] = conceptTypeResolver;\n    return function() {\n        var next = $elf.input.head();\n        next && \"AtomicFormulation\" !== next[0] && conceptTypeResolver(identifier.name);\n    };\n};\n\nLF2AbstractSQL.ResolveLinkTable = function(tableAlias) {\n    this.linkTableResolvers[tableAlias] !== LINK_RESOLVE_DONE && (\"function\" == typeof this.linkTableResolvers[tableAlias] ? this.linkTableResolvers[tableAlias]() : this.linkTableResolvers[tableAlias] = LINK_RESOLVE_QUEUED);\n};\n\nLF2AbstractSQL.CreateLinkTableResolver = function(query, linkTableAlias, bind, relationshipMapping) {\n    var parentAlias = bind.identifier.name + \".\" + bind.number, $elf = this, linkTableResolver = function() {\n        $elf.linkTableResolvers[parentAlias] = LINK_RESOLVE_DONE;\n        bind.used();\n        $elf.AddWhereClause(query, [ \"Equals\", [ \"ReferencedField\", linkTableAlias, relationshipMapping[0] ], [ \"ReferencedField\", bind.binding[1], relationshipMapping[1][1] ] ]);\n    };\n    if (this.linkTableResolvers[parentAlias] === LINK_RESOLVE_QUEUED || this.linkTableResolvers[parentAlias] === LINK_RESOLVE_DONE || null != bind.identifier.num) linkTableResolver(); else if (\"function\" == typeof this.linkTableResolvers[parentAlias]) {\n        var existingLinkTableResolver = this.linkTableResolvers[parentAlias];\n        this.linkTableResolvers[parentAlias] = function() {\n            existingLinkTableResolver();\n            linkTableResolver();\n        };\n    } else this.linkTableResolvers[parentAlias] = linkTableResolver;\n};\n\nLF2AbstractSQL.initialize = function() {\n    this.reset();\n    this.sbvrTypes = {};\n    this.termForms = {};\n};\n\nLF2AbstractSQL.reset = function() {\n    SBVRCompilerLibs.initialize.call(this);\n    this.tables = {};\n    this.relationships = {};\n    this.synonymousForms = {};\n    this.rules = [];\n    this.attributes = {};\n    this.bindAttributes = [];\n    this.bindAttributeDepth = [];\n    this.ResetRuleState();\n};\n\nLF2AbstractSQL.ResetRuleState = function() {\n    this.conceptTypeResolvers = {};\n    this.linkTableResolvers = {};\n};\n\nLF2AbstractSQL.addTypes = function(types) {\n    Object.assign(this.sbvrTypes, types);\n};","\"use strict\";\n\n// eslint-disable-next-line no-empty-function\nmodule.exports = function () {};\n","\"use strict\";\n\nvar sign  = require(\"../math/sign\")\n  , abs   = Math.abs\n  , floor = Math.floor;\n\nmodule.exports = function (value) {\n\tif (isNaN(value)) return 0;\n\tvalue = Number(value);\n\tif (value === 0 || !isFinite(value)) return value;\n\treturn sign(value) * floor(abs(value));\n};\n","\"use strict\";\n\nmodule.exports = require(\"./is-implemented\")() ? Math.sign : require(\"./shim\");\n","\"use strict\";\n\nmodule.exports = function () {\n\tvar sign = Math.sign;\n\tif (typeof sign !== \"function\") return false;\n\treturn sign(10) === 1 && sign(-20) === -1;\n};\n","\"use strict\";\n\nmodule.exports = function (value) {\n\tvalue = Number(value);\n\tif (isNaN(value) || value === 0) return value;\n\treturn value > 0 ? 1 : -1;\n};\n","\"use strict\";\n\nvar callable      = require(\"es5-ext/object/valid-callable\")\n  , forEach       = require(\"es5-ext/object/for-each\")\n  , extensions    = require(\"./lib/registered-extensions\")\n  , configure     = require(\"./lib/configure-map\")\n  , resolveLength = require(\"./lib/resolve-length\");\n\nmodule.exports = function self(fn /*, options */) {\n\tvar options, length, conf;\n\n\tcallable(fn);\n\toptions = Object(arguments[1]);\n\n\tif (options.async && options.promise) {\n\t\tthrow new Error(\"Options 'async' and 'promise' cannot be used together\");\n\t}\n\n\t// Do not memoize already memoized function\n\tif (hasOwnProperty.call(fn, \"__memoized__\") && !options.force) return fn;\n\n\t// Resolve length;\n\tlength = resolveLength(options.length, fn.length, options.async && extensions.async);\n\n\t// Configure cache map\n\tconf = configure(fn, length, options);\n\n\t// Bind eventual extensions\n\tforEach(extensions, function (extFn, name) {\n\t\tif (options[name]) extFn(options[name], conf, options);\n\t});\n\n\tif (self.__profiler__) self.__profiler__(conf);\n\n\tconf.updateEnv();\n\treturn conf.memoized;\n};\n","// Internal method, used by iteration functions.\n// Calls a function for each key-value pair found in object\n// Optionally takes compareFn to iterate object in specific order\n\n\"use strict\";\n\nvar callable                = require(\"./valid-callable\")\n  , value                   = require(\"./valid-value\")\n  , bind                    = Function.prototype.bind\n  , call                    = Function.prototype.call\n  , keys                    = Object.keys\n  , objPropertyIsEnumerable = Object.prototype.propertyIsEnumerable;\n\nmodule.exports = function (method, defVal) {\n\treturn function (obj, cb/*, thisArg, compareFn*/) {\n\t\tvar list, thisArg = arguments[2], compareFn = arguments[3];\n\t\tobj = Object(value(obj));\n\t\tcallable(cb);\n\n\t\tlist = keys(obj);\n\t\tif (compareFn) {\n\t\t\tlist.sort(typeof compareFn === \"function\" ? bind.call(compareFn, obj) : undefined);\n\t\t}\n\t\tif (typeof method !== \"function\") method = list[method];\n\t\treturn call.call(method, list, function (key, index) {\n\t\t\tif (!objPropertyIsEnumerable.call(obj, key)) return defVal;\n\t\t\treturn call.call(cb, thisArg, obj[key], key, obj, index);\n\t\t});\n\t};\n};\n","/* eslint no-eq-null: 0, eqeqeq: 0, no-unused-vars: 0 */\n\n\"use strict\";\n\nvar customError      = require(\"es5-ext/error/custom\")\n  , defineLength     = require(\"es5-ext/function/_define-length\")\n  , d                = require(\"d\")\n  , ee               = require(\"event-emitter\").methods\n  , resolveResolve   = require(\"./resolve-resolve\")\n  , resolveNormalize = require(\"./resolve-normalize\");\n\nvar apply = Function.prototype.apply\n  , call = Function.prototype.call\n  , create = Object.create\n  , defineProperties = Object.defineProperties\n  , on = ee.on\n  , emit = ee.emit;\n\nmodule.exports = function (original, length, options) {\n\tvar cache = create(null)\n\t  , conf\n\t  , memLength\n\t  , get\n\t  , set\n\t  , del\n\t  , clear\n\t  , extDel\n\t  , extGet\n\t  , extHas\n\t  , normalizer\n\t  , getListeners\n\t  , setListeners\n\t  , deleteListeners\n\t  , memoized\n\t  , resolve;\n\tif (length !== false) memLength = length;\n\telse if (isNaN(original.length)) memLength = 1;\n\telse memLength = original.length;\n\n\tif (options.normalizer) {\n\t\tnormalizer = resolveNormalize(options.normalizer);\n\t\tget = normalizer.get;\n\t\tset = normalizer.set;\n\t\tdel = normalizer.delete;\n\t\tclear = normalizer.clear;\n\t}\n\tif (options.resolvers != null) resolve = resolveResolve(options.resolvers);\n\n\tif (get) {\n\t\tmemoized = defineLength(function (arg) {\n\t\t\tvar id, result, args = arguments;\n\t\t\tif (resolve) args = resolve(args);\n\t\t\tid = get(args);\n\t\t\tif (id !== null) {\n\t\t\t\tif (hasOwnProperty.call(cache, id)) {\n\t\t\t\t\tif (getListeners) conf.emit(\"get\", id, args, this);\n\t\t\t\t\treturn cache[id];\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (args.length === 1) result = call.call(original, this, args[0]);\n\t\t\telse result = apply.call(original, this, args);\n\t\t\tif (id === null) {\n\t\t\t\tid = get(args);\n\t\t\t\tif (id !== null) throw customError(\"Circular invocation\", \"CIRCULAR_INVOCATION\");\n\t\t\t\tid = set(args);\n\t\t\t} else if (hasOwnProperty.call(cache, id)) {\n\t\t\t\tthrow customError(\"Circular invocation\", \"CIRCULAR_INVOCATION\");\n\t\t\t}\n\t\t\tcache[id] = result;\n\t\t\tif (setListeners) conf.emit(\"set\", id, null, result);\n\t\t\treturn result;\n\t\t}, memLength);\n\t} else if (length === 0) {\n\t\tmemoized = function () {\n\t\t\tvar result;\n\t\t\tif (hasOwnProperty.call(cache, \"data\")) {\n\t\t\t\tif (getListeners) conf.emit(\"get\", \"data\", arguments, this);\n\t\t\t\treturn cache.data;\n\t\t\t}\n\t\t\tif (arguments.length) result = apply.call(original, this, arguments);\n\t\t\telse result = call.call(original, this);\n\t\t\tif (hasOwnProperty.call(cache, \"data\")) {\n\t\t\t\tthrow customError(\"Circular invocation\", \"CIRCULAR_INVOCATION\");\n\t\t\t}\n\t\t\tcache.data = result;\n\t\t\tif (setListeners) conf.emit(\"set\", \"data\", null, result);\n\t\t\treturn result;\n\t\t};\n\t} else {\n\t\tmemoized = function (arg) {\n\t\t\tvar result, args = arguments, id;\n\t\t\tif (resolve) args = resolve(arguments);\n\t\t\tid = String(args[0]);\n\t\t\tif (hasOwnProperty.call(cache, id)) {\n\t\t\t\tif (getListeners) conf.emit(\"get\", id, args, this);\n\t\t\t\treturn cache[id];\n\t\t\t}\n\t\t\tif (args.length === 1) result = call.call(original, this, args[0]);\n\t\t\telse result = apply.call(original, this, args);\n\t\t\tif (hasOwnProperty.call(cache, id)) {\n\t\t\t\tthrow customError(\"Circular invocation\", \"CIRCULAR_INVOCATION\");\n\t\t\t}\n\t\t\tcache[id] = result;\n\t\t\tif (setListeners) conf.emit(\"set\", id, null, result);\n\t\t\treturn result;\n\t\t};\n\t}\n\tconf = {\n\t\toriginal: original,\n\t\tmemoized: memoized,\n\t\tprofileName: options.profileName,\n\t\tget: function (args) {\n\t\t\tif (resolve) args = resolve(args);\n\t\t\tif (get) return get(args);\n\t\t\treturn String(args[0]);\n\t\t},\n\t\thas: function (id) { return hasOwnProperty.call(cache, id); },\n\t\tdelete: function (id) {\n\t\t\tvar result;\n\t\t\tif (!hasOwnProperty.call(cache, id)) return;\n\t\t\tif (del) del(id);\n\t\t\tresult = cache[id];\n\t\t\tdelete cache[id];\n\t\t\tif (deleteListeners) conf.emit(\"delete\", id, result);\n\t\t},\n\t\tclear: function () {\n\t\t\tvar oldCache = cache;\n\t\t\tif (clear) clear();\n\t\t\tcache = create(null);\n\t\t\tconf.emit(\"clear\", oldCache);\n\t\t},\n\t\ton: function (type, listener) {\n\t\t\tif (type === \"get\") getListeners = true;\n\t\t\telse if (type === \"set\") setListeners = true;\n\t\t\telse if (type === \"delete\") deleteListeners = true;\n\t\t\treturn on.call(this, type, listener);\n\t\t},\n\t\temit: emit,\n\t\tupdateEnv: function () { original = conf.original; }\n\t};\n\tif (get) {\n\t\textDel = defineLength(function (arg) {\n\t\t\tvar id, args = arguments;\n\t\t\tif (resolve) args = resolve(args);\n\t\t\tid = get(args);\n\t\t\tif (id === null) return;\n\t\t\tconf.delete(id);\n\t\t}, memLength);\n\t} else if (length === 0) {\n\t\textDel = function () { return conf.delete(\"data\"); };\n\t} else {\n\t\textDel = function (arg) {\n\t\t\tif (resolve) arg = resolve(arguments)[0];\n\t\t\treturn conf.delete(arg);\n\t\t};\n\t}\n\textGet = defineLength(function () {\n\t\tvar id, args = arguments;\n\t\tif (length === 0) return cache.data;\n\t\tif (resolve) args = resolve(args);\n\t\tif (get) id = get(args);\n\t\telse id = String(args[0]);\n\t\treturn cache[id];\n\t});\n\textHas = defineLength(function () {\n\t\tvar id, args = arguments;\n\t\tif (length === 0) return conf.has(\"data\");\n\t\tif (resolve) args = resolve(args);\n\t\tif (get) id = get(args);\n\t\telse id = String(args[0]);\n\t\tif (id === null) return false;\n\t\treturn conf.has(id);\n\t});\n\tdefineProperties(memoized, {\n\t\t__memoized__: d(true),\n\t\tdelete: d(extDel),\n\t\tclear: d(conf.clear),\n\t\t_get: d(extGet),\n\t\t_has: d(extHas)\n\t});\n\treturn conf;\n};\n","\"use strict\";\n\nmodule.exports = function () {\n\tvar assign = Object.assign, obj;\n\tif (typeof assign !== \"function\") return false;\n\tobj = { foo: \"raz\" };\n\tassign(obj, { bar: \"dwa\" }, { trzy: \"trzy\" });\n\treturn obj.foo + obj.bar + obj.trzy === \"razdwatrzy\";\n};\n","\"use strict\";\n\nvar keys  = require(\"../keys\")\n  , value = require(\"../valid-value\")\n  , max   = Math.max;\n\nmodule.exports = function (dest, src/*, srcn*/) {\n\tvar error, i, length = max(arguments.length, 2), assign;\n\tdest = Object(value(dest));\n\tassign = function (key) {\n\t\ttry {\n\t\t\tdest[key] = src[key];\n\t\t} catch (e) {\n\t\t\tif (!error) error = e;\n\t\t}\n\t};\n\tfor (i = 1; i < length; ++i) {\n\t\tsrc = arguments[i];\n\t\tkeys(src).forEach(assign);\n\t}\n\tif (error !== undefined) throw error;\n\treturn dest;\n};\n","\"use strict\";\n\nmodule.exports = require(\"./is-implemented\")() ? Object.keys : require(\"./shim\");\n","\"use strict\";\n\nmodule.exports = function () {\n\ttry {\n\t\tObject.keys(\"primitive\");\n\t\treturn true;\n\t} catch (e) {\n\t\treturn false;\n\t}\n};\n","\"use strict\";\n\nvar isValue = require(\"../is-value\");\n\nvar keys = Object.keys;\n\nmodule.exports = function (object) { return keys(isValue(object) ? Object(object) : object); };\n","\"use strict\";\n\nvar isPrototype = require(\"../prototype/is\");\n\nmodule.exports = function (value) {\n\tif (typeof value !== \"function\") return false;\n\n\tif (!hasOwnProperty.call(value, \"length\")) return false;\n\n\ttry {\n\t\tif (typeof value.length !== \"number\") return false;\n\t\tif (typeof value.call !== \"function\") return false;\n\t\tif (typeof value.apply !== \"function\") return false;\n\t} catch (error) {\n\t\treturn false;\n\t}\n\n\treturn !isPrototype(value);\n};\n","\"use strict\";\n\nvar isObject = require(\"../object/is\");\n\nmodule.exports = function (value) {\n\tif (!isObject(value)) return false;\n\ttry {\n\t\tif (!value.constructor) return false;\n\t\treturn value.constructor.prototype === value;\n\t} catch (error) {\n\t\treturn false;\n\t}\n};\n","\"use strict\";\n\nvar str = \"razdwatrzy\";\n\nmodule.exports = function () {\n\tif (typeof str.contains !== \"function\") return false;\n\treturn str.contains(\"dwa\") === true && str.contains(\"foo\") === false;\n};\n","\"use strict\";\n\nvar indexOf = String.prototype.indexOf;\n\nmodule.exports = function (searchString/*, position*/) {\n\treturn indexOf.call(this, searchString, arguments[1]) > -1;\n};\n","'use strict';\n\nvar d        = require('d')\n  , callable = require('es5-ext/object/valid-callable')\n\n  , apply = Function.prototype.apply, call = Function.prototype.call\n  , create = Object.create, defineProperty = Object.defineProperty\n  , defineProperties = Object.defineProperties\n  , hasOwnProperty = Object.prototype.hasOwnProperty\n  , descriptor = { configurable: true, enumerable: false, writable: true }\n\n  , on, once, off, emit, methods, descriptors, base;\n\non = function (type, listener) {\n\tvar data;\n\n\tcallable(listener);\n\n\tif (!hasOwnProperty.call(this, '__ee__')) {\n\t\tdata = descriptor.value = create(null);\n\t\tdefineProperty(this, '__ee__', descriptor);\n\t\tdescriptor.value = null;\n\t} else {\n\t\tdata = this.__ee__;\n\t}\n\tif (!data[type]) data[type] = listener;\n\telse if (typeof data[type] === 'object') data[type].push(listener);\n\telse data[type] = [data[type], listener];\n\n\treturn this;\n};\n\nonce = function (type, listener) {\n\tvar once, self;\n\n\tcallable(listener);\n\tself = this;\n\ton.call(this, type, once = function () {\n\t\toff.call(self, type, once);\n\t\tapply.call(listener, this, arguments);\n\t});\n\n\tonce.__eeOnceListener__ = listener;\n\treturn this;\n};\n\noff = function (type, listener) {\n\tvar data, listeners, candidate, i;\n\n\tcallable(listener);\n\n\tif (!hasOwnProperty.call(this, '__ee__')) return this;\n\tdata = this.__ee__;\n\tif (!data[type]) return this;\n\tlisteners = data[type];\n\n\tif (typeof listeners === 'object') {\n\t\tfor (i = 0; (candidate = listeners[i]); ++i) {\n\t\t\tif ((candidate === listener) ||\n\t\t\t\t\t(candidate.__eeOnceListener__ === listener)) {\n\t\t\t\tif (listeners.length === 2) data[type] = listeners[i ? 0 : 1];\n\t\t\t\telse listeners.splice(i, 1);\n\t\t\t}\n\t\t}\n\t} else {\n\t\tif ((listeners === listener) ||\n\t\t\t\t(listeners.__eeOnceListener__ === listener)) {\n\t\t\tdelete data[type];\n\t\t}\n\t}\n\n\treturn this;\n};\n\nemit = function (type) {\n\tvar i, l, listener, listeners, args;\n\n\tif (!hasOwnProperty.call(this, '__ee__')) return;\n\tlisteners = this.__ee__[type];\n\tif (!listeners) return;\n\n\tif (typeof listeners === 'object') {\n\t\tl = arguments.length;\n\t\targs = new Array(l - 1);\n\t\tfor (i = 1; i < l; ++i) args[i - 1] = arguments[i];\n\n\t\tlisteners = listeners.slice();\n\t\tfor (i = 0; (listener = listeners[i]); ++i) {\n\t\t\tapply.call(listener, this, args);\n\t\t}\n\t} else {\n\t\tswitch (arguments.length) {\n\t\tcase 1:\n\t\t\tcall.call(listeners, this);\n\t\t\tbreak;\n\t\tcase 2:\n\t\t\tcall.call(listeners, this, arguments[1]);\n\t\t\tbreak;\n\t\tcase 3:\n\t\t\tcall.call(listeners, this, arguments[1], arguments[2]);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tl = arguments.length;\n\t\t\targs = new Array(l - 1);\n\t\t\tfor (i = 1; i < l; ++i) {\n\t\t\t\targs[i - 1] = arguments[i];\n\t\t\t}\n\t\t\tapply.call(listeners, this, args);\n\t\t}\n\t}\n};\n\nmethods = {\n\ton: on,\n\tonce: once,\n\toff: off,\n\temit: emit\n};\n\ndescriptors = {\n\ton: d(on),\n\tonce: d(once),\n\toff: d(off),\n\temit: d(emit)\n};\n\nbase = defineProperties({}, descriptors);\n\nmodule.exports = exports = function (o) {\n\treturn (o == null) ? create(base) : defineProperties(Object(o), descriptors);\n};\nexports.methods = methods;\n","\"use strict\";\n\nvar from    = require(\"./from\")\n  , isArray = Array.isArray;\n\nmodule.exports = function (arrayLike) { return isArray(arrayLike) ? arrayLike : from(arrayLike); };\n","\"use strict\";\n\nmodule.exports = function () {\n\tvar from = Array.from, arr, result;\n\tif (typeof from !== \"function\") return false;\n\tarr = [\"raz\", \"dwa\"];\n\tresult = from(arr);\n\treturn Boolean(result && result !== arr && result[1] === \"dwa\");\n};\n","\"use strict\";\n\nvar iteratorSymbol = require(\"es6-symbol\").iterator\n  , isArguments    = require(\"../../function/is-arguments\")\n  , isFunction     = require(\"../../function/is-function\")\n  , toPosInt       = require(\"../../number/to-pos-integer\")\n  , callable       = require(\"../../object/valid-callable\")\n  , validValue     = require(\"../../object/valid-value\")\n  , isValue        = require(\"../../object/is-value\")\n  , isString       = require(\"../../string/is-string\")\n  , isArray        = Array.isArray\n  , call           = Function.prototype.call\n  , desc           = { configurable: true, enumerable: true, writable: true, value: null }\n  , defineProperty = Object.defineProperty;\n\n// eslint-disable-next-line complexity, max-lines-per-function\nmodule.exports = function (arrayLike/*, mapFn, thisArg*/) {\n\tvar mapFn = arguments[1]\n\t  , thisArg = arguments[2]\n\t  , Context\n\t  , i\n\t  , j\n\t  , arr\n\t  , length\n\t  , code\n\t  , iterator\n\t  , result\n\t  , getIterator\n\t  , value;\n\n\tarrayLike = Object(validValue(arrayLike));\n\n\tif (isValue(mapFn)) callable(mapFn);\n\tif (!this || this === Array || !isFunction(this)) {\n\t\t// Result: Plain array\n\t\tif (!mapFn) {\n\t\t\tif (isArguments(arrayLike)) {\n\t\t\t\t// Source: Arguments\n\t\t\t\tlength = arrayLike.length;\n\t\t\t\tif (length !== 1) return Array.apply(null, arrayLike);\n\t\t\t\tarr = new Array(1);\n\t\t\t\tarr[0] = arrayLike[0];\n\t\t\t\treturn arr;\n\t\t\t}\n\t\t\tif (isArray(arrayLike)) {\n\t\t\t\t// Source: Array\n\t\t\t\tarr = new Array((length = arrayLike.length));\n\t\t\t\tfor (i = 0; i < length; ++i) arr[i] = arrayLike[i];\n\t\t\t\treturn arr;\n\t\t\t}\n\t\t}\n\t\tarr = [];\n\t} else {\n\t\t// Result: Non plain array\n\t\tContext = this;\n\t}\n\n\tif (!isArray(arrayLike)) {\n\t\tif ((getIterator = arrayLike[iteratorSymbol]) !== undefined) {\n\t\t\t// Source: Iterator\n\t\t\titerator = callable(getIterator).call(arrayLike);\n\t\t\tif (Context) arr = new Context();\n\t\t\tresult = iterator.next();\n\t\t\ti = 0;\n\t\t\twhile (!result.done) {\n\t\t\t\tvalue = mapFn ? call.call(mapFn, thisArg, result.value, i) : result.value;\n\t\t\t\tif (Context) {\n\t\t\t\t\tdesc.value = value;\n\t\t\t\t\tdefineProperty(arr, i, desc);\n\t\t\t\t} else {\n\t\t\t\t\tarr[i] = value;\n\t\t\t\t}\n\t\t\t\tresult = iterator.next();\n\t\t\t\t++i;\n\t\t\t}\n\t\t\tlength = i;\n\t\t} else if (isString(arrayLike)) {\n\t\t\t// Source: String\n\t\t\tlength = arrayLike.length;\n\t\t\tif (Context) arr = new Context();\n\t\t\tfor (i = 0, j = 0; i < length; ++i) {\n\t\t\t\tvalue = arrayLike[i];\n\t\t\t\tif (i + 1 < length) {\n\t\t\t\t\tcode = value.charCodeAt(0);\n\t\t\t\t\t// eslint-disable-next-line max-depth\n\t\t\t\t\tif (code >= 0xd800 && code <= 0xdbff) value += arrayLike[++i];\n\t\t\t\t}\n\t\t\t\tvalue = mapFn ? call.call(mapFn, thisArg, value, j) : value;\n\t\t\t\tif (Context) {\n\t\t\t\t\tdesc.value = value;\n\t\t\t\t\tdefineProperty(arr, j, desc);\n\t\t\t\t} else {\n\t\t\t\t\tarr[j] = value;\n\t\t\t\t}\n\t\t\t\t++j;\n\t\t\t}\n\t\t\tlength = j;\n\t\t}\n\t}\n\tif (length === undefined) {\n\t\t// Source: array or array-like\n\t\tlength = toPosInt(arrayLike.length);\n\t\tif (Context) arr = new Context(length);\n\t\tfor (i = 0; i < length; ++i) {\n\t\t\tvalue = mapFn ? call.call(mapFn, thisArg, arrayLike[i], i) : arrayLike[i];\n\t\t\tif (Context) {\n\t\t\t\tdesc.value = value;\n\t\t\t\tdefineProperty(arr, i, desc);\n\t\t\t} else {\n\t\t\t\tarr[i] = value;\n\t\t\t}\n\t\t}\n\t}\n\tif (Context) {\n\t\tdesc.value = null;\n\t\tarr.length = length;\n\t}\n\treturn arr;\n};\n","\"use strict\";\n\nvar global     = require(\"ext/global-this\")\n  , validTypes = { object: true, symbol: true };\n\nmodule.exports = function () {\n\tvar Symbol = global.Symbol;\n\tvar symbol;\n\tif (typeof Symbol !== \"function\") return false;\n\tsymbol = Symbol(\"test symbol\");\n\ttry { String(symbol); }\n\tcatch (e) { return false; }\n\n\t// Return 'true' also for polyfills\n\tif (!validTypes[typeof Symbol.iterator]) return false;\n\tif (!validTypes[typeof Symbol.toPrimitive]) return false;\n\tif (!validTypes[typeof Symbol.toStringTag]) return false;\n\n\treturn true;\n};\n","\"use strict\";\n\nmodule.exports = function () {\n\tif (typeof globalThis !== \"object\") return false;\n\tif (!globalThis) return false;\n\treturn globalThis.Array === Array;\n};\n","var naiveFallback = function () {\n\tif (typeof self === \"object\" && self) return self;\n\tif (typeof window === \"object\" && window) return window;\n\tthrow new Error(\"Unable to resolve global `this`\");\n};\n\nmodule.exports = (function () {\n\tif (this) return this;\n\n\t// Unexpected strict mode (may happen if e.g. bundled into ESM module)\n\n\t// Thanks @mathiasbynens -> https://mathiasbynens.be/notes/globalthis\n\t// In all ES5+ engines global object inherits from Object.prototype\n\t// (if you approached one that doesn't please report)\n\ttry {\n\t\tObject.defineProperty(Object.prototype, \"__global__\", {\n\t\t\tget: function () { return this; },\n\t\t\tconfigurable: true\n\t\t});\n\t} catch (error) {\n\t\t// Unfortunate case of Object.prototype being sealed (via preventExtensions, seal or freeze)\n\t\treturn naiveFallback();\n\t}\n\ttry {\n\t\t// Safari case (window.__global__ is resolved with global context, but __global__ does not)\n\t\tif (!__global__) return naiveFallback();\n\t\treturn __global__;\n\t} finally {\n\t\tdelete Object.prototype.__global__;\n\t}\n})();\n","// ES2015 Symbol polyfill for environments that do not (or partially) support it\n\n\"use strict\";\n\nvar d                    = require(\"d\")\n  , validateSymbol       = require(\"./validate-symbol\")\n  , NativeSymbol         = require(\"ext/global-this\").Symbol\n  , generateName         = require(\"./lib/private/generate-name\")\n  , setupStandardSymbols = require(\"./lib/private/setup/standard-symbols\")\n  , setupSymbolRegistry  = require(\"./lib/private/setup/symbol-registry\");\n\nvar create = Object.create\n  , defineProperties = Object.defineProperties\n  , defineProperty = Object.defineProperty;\n\nvar SymbolPolyfill, HiddenSymbol, isNativeSafe;\n\nif (typeof NativeSymbol === \"function\") {\n\ttry {\n\t\tString(NativeSymbol());\n\t\tisNativeSafe = true;\n\t} catch (ignore) {}\n} else {\n\tNativeSymbol = null;\n}\n\n// Internal constructor (not one exposed) for creating Symbol instances.\n// This one is used to ensure that `someSymbol instanceof Symbol` always return false\nHiddenSymbol = function Symbol(description) {\n\tif (this instanceof HiddenSymbol) throw new TypeError(\"Symbol is not a constructor\");\n\treturn SymbolPolyfill(description);\n};\n\n// Exposed `Symbol` constructor\n// (returns instances of HiddenSymbol)\nmodule.exports = SymbolPolyfill = function Symbol(description) {\n\tvar symbol;\n\tif (this instanceof Symbol) throw new TypeError(\"Symbol is not a constructor\");\n\tif (isNativeSafe) return NativeSymbol(description);\n\tsymbol = create(HiddenSymbol.prototype);\n\tdescription = description === undefined ? \"\" : String(description);\n\treturn defineProperties(symbol, {\n\t\t__description__: d(\"\", description),\n\t\t__name__: d(\"\", generateName(description))\n\t});\n};\n\nsetupStandardSymbols(SymbolPolyfill);\nsetupSymbolRegistry(SymbolPolyfill);\n\n// Internal tweaks for real symbol producer\ndefineProperties(HiddenSymbol.prototype, {\n\tconstructor: d(SymbolPolyfill),\n\ttoString: d(\"\", function () { return this.__name__; })\n});\n\n// Proper implementation of methods exposed on Symbol.prototype\n// They won't be accessible on produced symbol instances as they derive from HiddenSymbol.prototype\ndefineProperties(SymbolPolyfill.prototype, {\n\ttoString: d(function () { return \"Symbol (\" + validateSymbol(this).__description__ + \")\"; }),\n\tvalueOf: d(function () { return validateSymbol(this); })\n});\ndefineProperty(\n\tSymbolPolyfill.prototype,\n\tSymbolPolyfill.toPrimitive,\n\td(\"\", function () {\n\t\tvar symbol = validateSymbol(this);\n\t\tif (typeof symbol === \"symbol\") return symbol;\n\t\treturn symbol.toString();\n\t})\n);\ndefineProperty(SymbolPolyfill.prototype, SymbolPolyfill.toStringTag, d(\"c\", \"Symbol\"));\n\n// Proper implementaton of toPrimitive and toStringTag for returned symbol instances\ndefineProperty(\n\tHiddenSymbol.prototype, SymbolPolyfill.toStringTag,\n\td(\"c\", SymbolPolyfill.prototype[SymbolPolyfill.toStringTag])\n);\n\n// Note: It's important to define `toPrimitive` as last one, as some implementations\n// implement `toPrimitive` natively without implementing `toStringTag` (or other specified symbols)\n// And that may invoke error in definition flow:\n// See: https://github.com/medikoo/es6-symbol/issues/13#issuecomment-164146149\ndefineProperty(\n\tHiddenSymbol.prototype, SymbolPolyfill.toPrimitive,\n\td(\"c\", SymbolPolyfill.prototype[SymbolPolyfill.toPrimitive])\n);\n","\"use strict\";\n\nmodule.exports = function (value) {\n\tif (!value) return false;\n\tif (typeof value === \"symbol\") return true;\n\tif (!value.constructor) return false;\n\tif (value.constructor.name !== \"Symbol\") return false;\n\treturn value[value.constructor.toStringTag] === \"Symbol\";\n};\n","\"use strict\";\n\nvar d = require(\"d\");\n\nvar create = Object.create, defineProperty = Object.defineProperty, objPrototype = Object.prototype;\n\nvar created = create(null);\nmodule.exports = function (desc) {\n\tvar postfix = 0, name, ie11BugWorkaround;\n\twhile (created[desc + (postfix || \"\")]) ++postfix;\n\tdesc += postfix || \"\";\n\tcreated[desc] = true;\n\tname = \"@@\" + desc;\n\tdefineProperty(\n\t\tobjPrototype,\n\t\tname,\n\t\td.gs(null, function (value) {\n\t\t\t// For IE11 issue see:\n\t\t\t// https://connect.microsoft.com/IE/feedbackdetail/view/1928508/\n\t\t\t//    ie11-broken-getters-on-dom-objects\n\t\t\t// https://github.com/medikoo/es6-symbol/issues/12\n\t\t\tif (ie11BugWorkaround) return;\n\t\t\tie11BugWorkaround = true;\n\t\t\tdefineProperty(this, name, d(value));\n\t\t\tie11BugWorkaround = false;\n\t\t})\n\t);\n\treturn name;\n};\n","\"use strict\";\n\nvar d            = require(\"d\")\n  , NativeSymbol = require(\"ext/global-this\").Symbol;\n\nmodule.exports = function (SymbolPolyfill) {\n\treturn Object.defineProperties(SymbolPolyfill, {\n\t\t// To ensure proper interoperability with other native functions (e.g. Array.from)\n\t\t// fallback to eventual native implementation of given symbol\n\t\thasInstance: d(\n\t\t\t\"\", (NativeSymbol && NativeSymbol.hasInstance) || SymbolPolyfill(\"hasInstance\")\n\t\t),\n\t\tisConcatSpreadable: d(\n\t\t\t\"\",\n\t\t\t(NativeSymbol && NativeSymbol.isConcatSpreadable) ||\n\t\t\t\tSymbolPolyfill(\"isConcatSpreadable\")\n\t\t),\n\t\titerator: d(\"\", (NativeSymbol && NativeSymbol.iterator) || SymbolPolyfill(\"iterator\")),\n\t\tmatch: d(\"\", (NativeSymbol && NativeSymbol.match) || SymbolPolyfill(\"match\")),\n\t\treplace: d(\"\", (NativeSymbol && NativeSymbol.replace) || SymbolPolyfill(\"replace\")),\n\t\tsearch: d(\"\", (NativeSymbol && NativeSymbol.search) || SymbolPolyfill(\"search\")),\n\t\tspecies: d(\"\", (NativeSymbol && NativeSymbol.species) || SymbolPolyfill(\"species\")),\n\t\tsplit: d(\"\", (NativeSymbol && NativeSymbol.split) || SymbolPolyfill(\"split\")),\n\t\ttoPrimitive: d(\n\t\t\t\"\", (NativeSymbol && NativeSymbol.toPrimitive) || SymbolPolyfill(\"toPrimitive\")\n\t\t),\n\t\ttoStringTag: d(\n\t\t\t\"\", (NativeSymbol && NativeSymbol.toStringTag) || SymbolPolyfill(\"toStringTag\")\n\t\t),\n\t\tunscopables: d(\n\t\t\t\"\", (NativeSymbol && NativeSymbol.unscopables) || SymbolPolyfill(\"unscopables\")\n\t\t)\n\t});\n};\n","\"use strict\";\n\nvar d              = require(\"d\")\n  , validateSymbol = require(\"../../../validate-symbol\");\n\nvar registry = Object.create(null);\n\nmodule.exports = function (SymbolPolyfill) {\n\treturn Object.defineProperties(SymbolPolyfill, {\n\t\tfor: d(function (key) {\n\t\t\tif (registry[key]) return registry[key];\n\t\t\treturn (registry[key] = SymbolPolyfill(String(key)));\n\t\t}),\n\t\tkeyFor: d(function (symbol) {\n\t\t\tvar key;\n\t\t\tvalidateSymbol(symbol);\n\t\t\tfor (key in registry) {\n\t\t\t\tif (registry[key] === symbol) return key;\n\t\t\t}\n\t\t\treturn undefined;\n\t\t})\n\t});\n};\n","\"use strict\";\n\nvar objToString = Object.prototype.toString\n  , isFunctionStringTag = RegExp.prototype.test.bind(/^[object [A-Za-z0-9]*Function]$/);\n\nmodule.exports = function (value) {\n\treturn typeof value === \"function\" && isFunctionStringTag(objToString.call(value));\n};\n","\"use strict\";\n\nmodule.exports = function (args) {\n\tvar id, i, length = args.length;\n\tif (!length) return \"\\u0002\";\n\tid = String(args[i = 0]);\n\twhile (--length) id += \"\\u0001\" + args[++i];\n\treturn id;\n};\n","\"use strict\";\n\nmodule.exports = function (length) {\n\tif (!length) {\n\t\treturn function () {\n\t\t\treturn \"\";\n\t\t};\n\t}\n\treturn function (args) {\n\t\tvar id = String(args[0]), i = 0, currentLength = length;\n\t\twhile (--currentLength) {\n\t\t\tid += \"\\u0001\" + args[++i];\n\t\t}\n\t\treturn id;\n\t};\n};\n","/* eslint max-statements: 0 */\n\n\"use strict\";\n\nvar indexOf = require(\"es5-ext/array/#/e-index-of\");\n\nvar create = Object.create;\n\nmodule.exports = function () {\n\tvar lastId = 0, map = [], cache = create(null);\n\treturn {\n\t\tget: function (args) {\n\t\t\tvar index = 0, set = map, i, length = args.length;\n\t\t\tif (length === 0) return set[length] || null;\n\t\t\tif ((set = set[length])) {\n\t\t\t\twhile (index < length - 1) {\n\t\t\t\t\ti = indexOf.call(set[0], args[index]);\n\t\t\t\t\tif (i === -1) return null;\n\t\t\t\t\tset = set[1][i];\n\t\t\t\t\t++index;\n\t\t\t\t}\n\t\t\t\ti = indexOf.call(set[0], args[index]);\n\t\t\t\tif (i === -1) return null;\n\t\t\t\treturn set[1][i] || null;\n\t\t\t}\n\t\t\treturn null;\n\t\t},\n\t\tset: function (args) {\n\t\t\tvar index = 0, set = map, i, length = args.length;\n\t\t\tif (length === 0) {\n\t\t\t\tset[length] = ++lastId;\n\t\t\t} else {\n\t\t\t\tif (!set[length]) {\n\t\t\t\t\tset[length] = [[], []];\n\t\t\t\t}\n\t\t\t\tset = set[length];\n\t\t\t\twhile (index < length - 1) {\n\t\t\t\t\ti = indexOf.call(set[0], args[index]);\n\t\t\t\t\tif (i === -1) {\n\t\t\t\t\t\ti = set[0].push(args[index]) - 1;\n\t\t\t\t\t\tset[1].push([[], []]);\n\t\t\t\t\t}\n\t\t\t\t\tset = set[1][i];\n\t\t\t\t\t++index;\n\t\t\t\t}\n\t\t\t\ti = indexOf.call(set[0], args[index]);\n\t\t\t\tif (i === -1) {\n\t\t\t\t\ti = set[0].push(args[index]) - 1;\n\t\t\t\t}\n\t\t\t\tset[1][i] = ++lastId;\n\t\t\t}\n\t\t\tcache[lastId] = args;\n\t\t\treturn lastId;\n\t\t},\n\t\tdelete: function (id) {\n\t\t\tvar index = 0, set = map, i, args = cache[id], length = args.length, path = [];\n\t\t\tif (length === 0) {\n\t\t\t\tdelete set[length];\n\t\t\t} else if ((set = set[length])) {\n\t\t\t\twhile (index < length - 1) {\n\t\t\t\t\ti = indexOf.call(set[0], args[index]);\n\t\t\t\t\tif (i === -1) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tpath.push(set, i);\n\t\t\t\t\tset = set[1][i];\n\t\t\t\t\t++index;\n\t\t\t\t}\n\t\t\t\ti = indexOf.call(set[0], args[index]);\n\t\t\t\tif (i === -1) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tid = set[1][i];\n\t\t\t\tset[0].splice(i, 1);\n\t\t\t\tset[1].splice(i, 1);\n\t\t\t\twhile (!set[0].length && path.length) {\n\t\t\t\t\ti = path.pop();\n\t\t\t\t\tset = path.pop();\n\t\t\t\t\tset[0].splice(i, 1);\n\t\t\t\t\tset[1].splice(i, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t\tdelete cache[id];\n\t\t},\n\t\tclear: function () {\n\t\t\tmap = [];\n\t\t\tcache = create(null);\n\t\t}\n\t};\n};\n","\"use strict\";\n\nmodule.exports = require(\"./is-implemented\")() ? Number.isNaN : require(\"./shim\");\n","\"use strict\";\n\nmodule.exports = function () {\n\tvar numberIsNaN = Number.isNaN;\n\tif (typeof numberIsNaN !== \"function\") return false;\n\treturn !numberIsNaN({}) && numberIsNaN(NaN) && !numberIsNaN(34);\n};\n","\"use strict\";\n\nmodule.exports = function (value) {\n\t// eslint-disable-next-line no-self-compare\n\treturn value !== value;\n};\n","\"use strict\";\n\nvar indexOf = require(\"es5-ext/array/#/e-index-of\");\n\nmodule.exports = function () {\n\tvar lastId = 0, argsMap = [], cache = [];\n\treturn {\n\t\tget: function (args) {\n\t\t\tvar index = indexOf.call(argsMap, args[0]);\n\t\t\treturn index === -1 ? null : cache[index];\n\t\t},\n\t\tset: function (args) {\n\t\t\targsMap.push(args[0]);\n\t\t\tcache.push(++lastId);\n\t\t\treturn lastId;\n\t\t},\n\t\tdelete: function (id) {\n\t\t\tvar index = indexOf.call(cache, id);\n\t\t\tif (index !== -1) {\n\t\t\t\targsMap.splice(index, 1);\n\t\t\t\tcache.splice(index, 1);\n\t\t\t}\n\t\t},\n\t\tclear: function () {\n\t\t\targsMap = [];\n\t\t\tcache = [];\n\t\t}\n\t};\n};\n","\"use strict\";\n\nvar indexOf = require(\"es5-ext/array/#/e-index-of\")\n  , create  = Object.create;\n\nmodule.exports = function (length) {\n\tvar lastId = 0, map = [[], []], cache = create(null);\n\treturn {\n\t\tget: function (args) {\n\t\t\tvar index = 0, set = map, i;\n\t\t\twhile (index < length - 1) {\n\t\t\t\ti = indexOf.call(set[0], args[index]);\n\t\t\t\tif (i === -1) return null;\n\t\t\t\tset = set[1][i];\n\t\t\t\t++index;\n\t\t\t}\n\t\t\ti = indexOf.call(set[0], args[index]);\n\t\t\tif (i === -1) return null;\n\t\t\treturn set[1][i] || null;\n\t\t},\n\t\tset: function (args) {\n\t\t\tvar index = 0, set = map, i;\n\t\t\twhile (index < length - 1) {\n\t\t\t\ti = indexOf.call(set[0], args[index]);\n\t\t\t\tif (i === -1) {\n\t\t\t\t\ti = set[0].push(args[index]) - 1;\n\t\t\t\t\tset[1].push([[], []]);\n\t\t\t\t}\n\t\t\t\tset = set[1][i];\n\t\t\t\t++index;\n\t\t\t}\n\t\t\ti = indexOf.call(set[0], args[index]);\n\t\t\tif (i === -1) {\n\t\t\t\ti = set[0].push(args[index]) - 1;\n\t\t\t}\n\t\t\tset[1][i] = ++lastId;\n\t\t\tcache[lastId] = args;\n\t\t\treturn lastId;\n\t\t},\n\t\tdelete: function (id) {\n\t\t\tvar index = 0, set = map, i, path = [], args = cache[id];\n\t\t\twhile (index < length - 1) {\n\t\t\t\ti = indexOf.call(set[0], args[index]);\n\t\t\t\tif (i === -1) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tpath.push(set, i);\n\t\t\t\tset = set[1][i];\n\t\t\t\t++index;\n\t\t\t}\n\t\t\ti = indexOf.call(set[0], args[index]);\n\t\t\tif (i === -1) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tid = set[1][i];\n\t\t\tset[0].splice(i, 1);\n\t\t\tset[1].splice(i, 1);\n\t\t\twhile (!set[0].length && path.length) {\n\t\t\t\ti = path.pop();\n\t\t\t\tset = path.pop();\n\t\t\t\tset[0].splice(i, 1);\n\t\t\t\tset[1].splice(i, 1);\n\t\t\t}\n\t\t\tdelete cache[id];\n\t\t},\n\t\tclear: function () {\n\t\t\tmap = [[], []];\n\t\t\tcache = create(null);\n\t\t}\n\t};\n};\n","/* eslint consistent-this: 0, no-shadow:0, no-eq-null: 0, eqeqeq: 0, no-unused-vars: 0 */\n\n// Support for asynchronous functions\n\n\"use strict\";\n\nvar aFrom        = require(\"es5-ext/array/from\")\n  , objectMap    = require(\"es5-ext/object/map\")\n  , mixin        = require(\"es5-ext/object/mixin\")\n  , defineLength = require(\"es5-ext/function/_define-length\")\n  , nextTick     = require(\"next-tick\");\n\nvar slice = Array.prototype.slice, apply = Function.prototype.apply, create = Object.create;\n\nrequire(\"../lib/registered-extensions\").async = function (tbi, conf) {\n\tvar waiting = create(null)\n\t  , cache = create(null)\n\t  , base = conf.memoized\n\t  , original = conf.original\n\t  , currentCallback\n\t  , currentContext\n\t  , currentArgs;\n\n\t// Initial\n\tconf.memoized = defineLength(function (arg) {\n\t\tvar args = arguments, last = args[args.length - 1];\n\t\tif (typeof last === \"function\") {\n\t\t\tcurrentCallback = last;\n\t\t\targs = slice.call(args, 0, -1);\n\t\t}\n\t\treturn base.apply(currentContext = this, currentArgs = args);\n\t}, base);\n\ttry { mixin(conf.memoized, base); }\n\tcatch (ignore) {}\n\n\t// From cache (sync)\n\tconf.on(\"get\", function (id) {\n\t\tvar cb, context, args;\n\t\tif (!currentCallback) return;\n\n\t\t// Unresolved\n\t\tif (waiting[id]) {\n\t\t\tif (typeof waiting[id] === \"function\") waiting[id] = [waiting[id], currentCallback];\n\t\t\telse waiting[id].push(currentCallback);\n\t\t\tcurrentCallback = null;\n\t\t\treturn;\n\t\t}\n\n\t\t// Resolved, assure next tick invocation\n\t\tcb = currentCallback;\n\t\tcontext = currentContext;\n\t\targs = currentArgs;\n\t\tcurrentCallback = currentContext = currentArgs = null;\n\t\tnextTick(function () {\n\t\t\tvar data;\n\t\t\tif (hasOwnProperty.call(cache, id)) {\n\t\t\t\tdata = cache[id];\n\t\t\t\tconf.emit(\"getasync\", id, args, context);\n\t\t\t\tapply.call(cb, data.context, data.args);\n\t\t\t} else {\n\t\t\t\t// Purged in a meantime, we shouldn't rely on cached value, recall\n\t\t\t\tcurrentCallback = cb;\n\t\t\t\tcurrentContext = context;\n\t\t\t\tcurrentArgs = args;\n\t\t\t\tbase.apply(context, args);\n\t\t\t}\n\t\t});\n\t});\n\n\t// Not from cache\n\tconf.original = function () {\n\t\tvar args, cb, origCb, result;\n\t\tif (!currentCallback) return apply.call(original, this, arguments);\n\t\targs = aFrom(arguments);\n\t\tcb = function self(err) {\n\t\t\tvar cb, args, id = self.id;\n\t\t\tif (id == null) {\n\t\t\t\t// Shouldn't happen, means async callback was called sync way\n\t\t\t\tnextTick(apply.bind(self, this, arguments));\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\tdelete self.id;\n\t\t\tcb = waiting[id];\n\t\t\tdelete waiting[id];\n\t\t\tif (!cb) {\n\t\t\t\t// Already processed,\n\t\t\t\t// outcome of race condition: asyncFn(1, cb), asyncFn.clear(), asyncFn(1, cb)\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\targs = aFrom(arguments);\n\t\t\tif (conf.has(id)) {\n\t\t\t\tif (err) {\n\t\t\t\t\tconf.delete(id);\n\t\t\t\t} else {\n\t\t\t\t\tcache[id] = { context: this, args: args };\n\t\t\t\t\tconf.emit(\"setasync\", id, typeof cb === \"function\" ? 1 : cb.length);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (typeof cb === \"function\") {\n\t\t\t\tresult = apply.call(cb, this, args);\n\t\t\t} else {\n\t\t\t\tcb.forEach(function (cb) { result = apply.call(cb, this, args); }, this);\n\t\t\t}\n\t\t\treturn result;\n\t\t};\n\t\torigCb = currentCallback;\n\t\tcurrentCallback = currentContext = currentArgs = null;\n\t\targs.push(cb);\n\t\tresult = apply.call(original, this, args);\n\t\tcb.cb = origCb;\n\t\tcurrentCallback = cb;\n\t\treturn result;\n\t};\n\n\t// After not from cache call\n\tconf.on(\"set\", function (id) {\n\t\tif (!currentCallback) {\n\t\t\tconf.delete(id);\n\t\t\treturn;\n\t\t}\n\t\tif (waiting[id]) {\n\t\t\t// Race condition: asyncFn(1, cb), asyncFn.clear(), asyncFn(1, cb)\n\t\t\tif (typeof waiting[id] === \"function\") waiting[id] = [waiting[id], currentCallback.cb];\n\t\t\telse waiting[id].push(currentCallback.cb);\n\t\t} else {\n\t\t\twaiting[id] = currentCallback.cb;\n\t\t}\n\t\tdelete currentCallback.cb;\n\t\tcurrentCallback.id = id;\n\t\tcurrentCallback = null;\n\t});\n\n\t// On delete\n\tconf.on(\"delete\", function (id) {\n\t\tvar result;\n\t\t// If false, we don't have value yet, so we assume that intention is not\n\t\t// to memoize this call. After value is obtained we don't cache it but\n\t\t// gracefully pass to callback\n\t\tif (hasOwnProperty.call(waiting, id)) return;\n\t\tif (!cache[id]) return;\n\t\tresult = cache[id];\n\t\tdelete cache[id];\n\t\tconf.emit(\"deleteasync\", id, slice.call(result.args, 1));\n\t});\n\n\t// On clear\n\tconf.on(\"clear\", function () {\n\t\tvar oldCache = cache;\n\t\tcache = create(null);\n\t\tconf.emit(\n\t\t\t\"clearasync\", objectMap(oldCache, function (data) { return slice.call(data.args, 1); })\n\t\t);\n\t});\n};\n","/* eslint max-statements: 0 */\n\n// Support for functions returning promise\n\n\"use strict\";\n\nvar objectMap     = require(\"es5-ext/object/map\")\n  , primitiveSet  = require(\"es5-ext/object/primitive-set\")\n  , ensureString  = require(\"es5-ext/object/validate-stringifiable-value\")\n  , toShortString = require(\"es5-ext/to-short-string-representation\")\n  , isPromise     = require(\"is-promise\")\n  , nextTick      = require(\"next-tick\");\n\nvar create = Object.create\n  , supportedModes = primitiveSet(\"then\", \"then:finally\", \"done\", \"done:finally\");\n\nrequire(\"../lib/registered-extensions\").promise = function (mode, conf) {\n\tvar waiting = create(null), cache = create(null), promises = create(null);\n\n\tif (mode === true) {\n\t\tmode = null;\n\t} else {\n\t\tmode = ensureString(mode);\n\t\tif (!supportedModes[mode]) {\n\t\t\tthrow new TypeError(\"'\" + toShortString(mode) + \"' is not valid promise mode\");\n\t\t}\n\t}\n\n\t// After not from cache call\n\tconf.on(\"set\", function (id, ignore, promise) {\n\t\tvar isFailed = false;\n\n\t\tif (!isPromise(promise)) {\n\t\t\t// Non promise result\n\t\t\tcache[id] = promise;\n\t\t\tconf.emit(\"setasync\", id, 1);\n\t\t\treturn;\n\t\t}\n\t\twaiting[id] = 1;\n\t\tpromises[id] = promise;\n\t\tvar onSuccess = function (result) {\n\t\t\tvar count = waiting[id];\n\t\t\tif (isFailed) {\n\t\t\t\tthrow new Error(\n\t\t\t\t\t\"Memoizee error: Detected unordered then|done & finally resolution, which \" +\n\t\t\t\t\t\t\"in turn makes proper detection of success/failure impossible (when in \" +\n\t\t\t\t\t\t\"'done:finally' mode)\\n\" +\n\t\t\t\t\t\t\"Consider to rely on 'then' or 'done' mode instead.\"\n\t\t\t\t);\n\t\t\t}\n\t\t\tif (!count) return; // Deleted from cache before resolved\n\t\t\tdelete waiting[id];\n\t\t\tcache[id] = result;\n\t\t\tconf.emit(\"setasync\", id, count);\n\t\t};\n\t\tvar onFailure = function () {\n\t\t\tisFailed = true;\n\t\t\tif (!waiting[id]) return; // Deleted from cache (or succeed in case of finally)\n\t\t\tdelete waiting[id];\n\t\t\tdelete promises[id];\n\t\t\tconf.delete(id);\n\t\t};\n\n\t\tvar resolvedMode = mode;\n\t\tif (!resolvedMode) resolvedMode = \"then\";\n\n\t\tif (resolvedMode === \"then\") {\n\t\t\tvar nextTickFailure = function () { nextTick(onFailure); };\n\t\t\t// Eventual finally needs to be attached to non rejected promise\n\t\t\t// (so we not force propagation of unhandled rejection)\n\t\t\tpromise = promise.then(function (result) {\n\t\t\t\tnextTick(onSuccess.bind(this, result));\n\t\t\t}, nextTickFailure);\n\t\t\t// If `finally` is a function we attach to it to remove cancelled promises.\n\t\t\tif (typeof promise.finally === \"function\") {\n\t\t\t\tpromise.finally(nextTickFailure);\n\t\t\t}\n\t\t} else if (resolvedMode === \"done\") {\n\t\t\t// Not recommended, as it may mute any eventual \"Unhandled error\" events\n\t\t\tif (typeof promise.done !== \"function\") {\n\t\t\t\tthrow new Error(\n\t\t\t\t\t\"Memoizee error: Retrieved promise does not implement 'done' \" +\n\t\t\t\t\t\t\"in 'done' mode\"\n\t\t\t\t);\n\t\t\t}\n\t\t\tpromise.done(onSuccess, onFailure);\n\t\t} else if (resolvedMode === \"done:finally\") {\n\t\t\t// The only mode with no side effects assuming library does not throw unconditionally\n\t\t\t// for rejected promises.\n\t\t\tif (typeof promise.done !== \"function\") {\n\t\t\t\tthrow new Error(\n\t\t\t\t\t\"Memoizee error: Retrieved promise does not implement 'done' \" +\n\t\t\t\t\t\t\"in 'done:finally' mode\"\n\t\t\t\t);\n\t\t\t}\n\t\t\tif (typeof promise.finally !== \"function\") {\n\t\t\t\tthrow new Error(\n\t\t\t\t\t\"Memoizee error: Retrieved promise does not implement 'finally' \" +\n\t\t\t\t\t\t\"in 'done:finally' mode\"\n\t\t\t\t);\n\t\t\t}\n\t\t\tpromise.done(onSuccess);\n\t\t\tpromise.finally(onFailure);\n\t\t}\n\t});\n\n\t// From cache (sync)\n\tconf.on(\"get\", function (id, args, context) {\n\t\tvar promise;\n\t\tif (waiting[id]) {\n\t\t\t++waiting[id]; // Still waiting\n\t\t\treturn;\n\t\t}\n\t\tpromise = promises[id];\n\t\tvar emit = function () { conf.emit(\"getasync\", id, args, context); };\n\t\tif (isPromise(promise)) {\n\t\t\tif (typeof promise.done === \"function\") promise.done(emit);\n\t\t\telse {\n\t\t\t\tpromise.then(function () { nextTick(emit); });\n\t\t\t}\n\t\t} else {\n\t\t\temit();\n\t\t}\n\t});\n\n\t// On delete\n\tconf.on(\"delete\", function (id) {\n\t\tdelete promises[id];\n\t\tif (waiting[id]) {\n\t\t\tdelete waiting[id];\n\t\t\treturn; // Not yet resolved\n\t\t}\n\t\tif (!hasOwnProperty.call(cache, id)) return;\n\t\tvar result = cache[id];\n\t\tdelete cache[id];\n\t\tconf.emit(\"deleteasync\", id, [result]);\n\t});\n\n\t// On clear\n\tconf.on(\"clear\", function () {\n\t\tvar oldCache = cache;\n\t\tcache = create(null);\n\t\twaiting = create(null);\n\t\tpromises = create(null);\n\t\tconf.emit(\"clearasync\", objectMap(oldCache, function (data) { return [data]; }));\n\t});\n};\n","\"use strict\";\n\nvar forEach = Array.prototype.forEach, create = Object.create;\n\n// eslint-disable-next-line no-unused-vars\nmodule.exports = function (arg/*, args*/) {\n\tvar set = create(null);\n\tforEach.call(arguments, function (name) { set[name] = true; });\n\treturn set;\n};\n","\"use strict\";\n\nvar ensureValue   = require(\"./valid-value\")\n  , stringifiable = require(\"./validate-stringifiable\");\n\nmodule.exports = function (value) { return stringifiable(ensureValue(value)); };\n","\"use strict\";\n\nvar isCallable = require(\"./is-callable\");\n\nmodule.exports = function (stringifiable) {\n\ttry {\n\t\tif (stringifiable && isCallable(stringifiable.toString)) return stringifiable.toString();\n\t\treturn String(stringifiable);\n\t} catch (e) {\n\t\tthrow new TypeError(\"Passed argument cannot be stringifed\");\n\t}\n};\n","\"use strict\";\n\nvar safeToString = require(\"./safe-to-string\");\n\nvar reNewLine = /[\\n\\r\\u2028\\u2029]/g;\n\nmodule.exports = function (value) {\n\tvar string = safeToString(value);\n\t// Trim if too long\n\tif (string.length > 100) string = string.slice(0, 99) + \"\";\n\t// Replace eventual new lines\n\tstring = string.replace(reNewLine, function (char) {\n\t\treturn JSON.stringify(char).slice(1, -1);\n\t});\n\treturn string;\n};\n","\"use strict\";\n\nvar isCallable = require(\"./object/is-callable\");\n\nmodule.exports = function (value) {\n\ttry {\n\t\tif (value && isCallable(value.toString)) return value.toString();\n\t\treturn String(value);\n\t} catch (e) {\n\t\treturn \"<Non-coercible to string value>\";\n\t}\n};\n","// Call dispose callback on each cache purge\n\n\"use strict\";\n\nvar callable   = require(\"es5-ext/object/valid-callable\")\n  , forEach    = require(\"es5-ext/object/for-each\")\n  , extensions = require(\"../lib/registered-extensions\")\n\n  , apply = Function.prototype.apply;\n\nextensions.dispose = function (dispose, conf, options) {\n\tvar del;\n\tcallable(dispose);\n\tif ((options.async && extensions.async) || (options.promise && extensions.promise)) {\n\t\tconf.on(\"deleteasync\", del = function (id, resultArray) {\n\t\t\tapply.call(dispose, null, resultArray);\n\t\t});\n\t\tconf.on(\"clearasync\", function (cache) {\n\t\t\tforEach(cache, function (result, id) {\n del(id, result);\n});\n\t\t});\n\t\treturn;\n\t}\n\tconf.on(\"delete\", del = function (id, result) {\n dispose(result);\n});\n\tconf.on(\"clear\", function (cache) {\n\t\tforEach(cache, function (result, id) {\n del(id, result);\n});\n\t});\n};\n","/* eslint consistent-this: 0 */\n\n// Timeout cached values\n\n\"use strict\";\n\nvar aFrom      = require(\"es5-ext/array/from\")\n  , forEach    = require(\"es5-ext/object/for-each\")\n  , nextTick   = require(\"next-tick\")\n  , isPromise  = require(\"is-promise\")\n  , timeout    = require(\"timers-ext/valid-timeout\")\n  , extensions = require(\"../lib/registered-extensions\");\n\nvar noop = Function.prototype, max = Math.max, min = Math.min, create = Object.create;\n\nextensions.maxAge = function (maxAge, conf, options) {\n\tvar timeouts, postfix, preFetchAge, preFetchTimeouts;\n\n\tmaxAge = timeout(maxAge);\n\tif (!maxAge) return;\n\n\ttimeouts = create(null);\n\tpostfix =\n\t\t(options.async && extensions.async) || (options.promise && extensions.promise)\n\t\t\t? \"async\"\n\t\t\t: \"\";\n\tconf.on(\"set\" + postfix, function (id) {\n\t\ttimeouts[id] = setTimeout(function () { conf.delete(id); }, maxAge);\n\t\tif (typeof timeouts[id].unref === \"function\") timeouts[id].unref();\n\t\tif (!preFetchTimeouts) return;\n\t\tif (preFetchTimeouts[id]) {\n\t\t\tif (preFetchTimeouts[id] !== \"nextTick\") clearTimeout(preFetchTimeouts[id]);\n\t\t}\n\t\tpreFetchTimeouts[id] = setTimeout(function () {\n\t\t\tdelete preFetchTimeouts[id];\n\t\t}, preFetchAge);\n\t\tif (typeof preFetchTimeouts[id].unref === \"function\") preFetchTimeouts[id].unref();\n\t});\n\tconf.on(\"delete\" + postfix, function (id) {\n\t\tclearTimeout(timeouts[id]);\n\t\tdelete timeouts[id];\n\t\tif (!preFetchTimeouts) return;\n\t\tif (preFetchTimeouts[id] !== \"nextTick\") clearTimeout(preFetchTimeouts[id]);\n\t\tdelete preFetchTimeouts[id];\n\t});\n\n\tif (options.preFetch) {\n\t\tif (options.preFetch === true || isNaN(options.preFetch)) {\n\t\t\tpreFetchAge = 0.333;\n\t\t} else {\n\t\t\tpreFetchAge = max(min(Number(options.preFetch), 1), 0);\n\t\t}\n\t\tif (preFetchAge) {\n\t\t\tpreFetchTimeouts = {};\n\t\t\tpreFetchAge = (1 - preFetchAge) * maxAge;\n\t\t\tconf.on(\"get\" + postfix, function (id, args, context) {\n\t\t\t\tif (!preFetchTimeouts[id]) {\n\t\t\t\t\tpreFetchTimeouts[id] = \"nextTick\";\n\t\t\t\t\tnextTick(function () {\n\t\t\t\t\t\tvar result;\n\t\t\t\t\t\tif (preFetchTimeouts[id] !== \"nextTick\") return;\n\t\t\t\t\t\tdelete preFetchTimeouts[id];\n\t\t\t\t\t\tconf.delete(id);\n\t\t\t\t\t\tif (options.async) {\n\t\t\t\t\t\t\targs = aFrom(args);\n\t\t\t\t\t\t\targs.push(noop);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tresult = conf.memoized.apply(context, args);\n\t\t\t\t\t\tif (options.promise) {\n\t\t\t\t\t\t\t// Supress eventual error warnings\n\t\t\t\t\t\t\tif (isPromise(result)) {\n\t\t\t\t\t\t\t\tif (typeof result.done === \"function\") result.done(noop, noop);\n\t\t\t\t\t\t\t\telse result.then(noop, noop);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tconf.on(\"clear\" + postfix, function () {\n\t\tforEach(timeouts, function (id) { clearTimeout(id); });\n\t\ttimeouts = {};\n\t\tif (preFetchTimeouts) {\n\t\t\tforEach(preFetchTimeouts, function (id) { if (id !== \"nextTick\") clearTimeout(id); });\n\t\t\tpreFetchTimeouts = {};\n\t\t}\n\t});\n};\n","\"use strict\";\n\nvar toPosInt   = require(\"es5-ext/number/to-pos-integer\")\n  , maxTimeout = require(\"./max-timeout\");\n\nmodule.exports = function (value) {\n\tvalue = toPosInt(value);\n\tif (value > maxTimeout) throw new TypeError(value + \" exceeds maximum possible timeout\");\n\treturn value;\n};\n","\"use strict\";\n\nmodule.exports = 2147483647;\n","// Limit cache size, LRU (least recently used) algorithm.\n\n\"use strict\";\n\nvar toPosInteger = require(\"es5-ext/number/to-pos-integer\")\n  , lruQueue     = require(\"lru-queue\")\n  , extensions   = require(\"../lib/registered-extensions\");\n\nextensions.max = function (max, conf, options) {\n\tvar postfix, queue, hit;\n\n\tmax = toPosInteger(max);\n\tif (!max) return;\n\n\tqueue = lruQueue(max);\n\tpostfix = (options.async && extensions.async) || (options.promise && extensions.promise)\n\t\t? \"async\" : \"\";\n\n\tconf.on(\"set\" + postfix, hit = function (id) {\n\t\tid = queue.hit(id);\n\t\tif (id === undefined) return;\n\t\tconf.delete(id);\n\t});\n\tconf.on(\"get\" + postfix, hit);\n\tconf.on(\"delete\" + postfix, queue.delete);\n\tconf.on(\"clear\" + postfix, queue.clear);\n};\n","'use strict';\n\nvar toPosInt = require('es5-ext/number/to-pos-integer')\n\n  , create = Object.create, hasOwnProperty = Object.prototype.hasOwnProperty;\n\nmodule.exports = function (limit) {\n\tvar size = 0, base = 1, queue = create(null), map = create(null), index = 0, del;\n\tlimit = toPosInt(limit);\n\treturn {\n\t\thit: function (id) {\n\t\t\tvar oldIndex = map[id], nuIndex = ++index;\n\t\t\tqueue[nuIndex] = id;\n\t\t\tmap[id] = nuIndex;\n\t\t\tif (!oldIndex) {\n\t\t\t\t++size;\n\t\t\t\tif (size <= limit) return;\n\t\t\t\tid = queue[base];\n\t\t\t\tdel(id);\n\t\t\t\treturn id;\n\t\t\t}\n\t\t\tdelete queue[oldIndex];\n\t\t\tif (base !== oldIndex) return;\n\t\t\twhile (!hasOwnProperty.call(queue, ++base)) continue; //jslint: skip\n\t\t},\n\t\tdelete: del = function (id) {\n\t\t\tvar oldIndex = map[id];\n\t\t\tif (!oldIndex) return;\n\t\t\tdelete queue[oldIndex];\n\t\t\tdelete map[id];\n\t\t\t--size;\n\t\t\tif (base !== oldIndex) return;\n\t\t\tif (!size) {\n\t\t\t\tindex = 0;\n\t\t\t\tbase = 1;\n\t\t\t\treturn;\n\t\t\t}\n\t\t\twhile (!hasOwnProperty.call(queue, ++base)) continue; //jslint: skip\n\t\t},\n\t\tclear: function () {\n\t\t\tsize = 0;\n\t\t\tbase = 1;\n\t\t\tqueue = create(null);\n\t\t\tmap = create(null);\n\t\t\tindex = 0;\n\t\t}\n\t};\n};\n","// Reference counter, useful for garbage collector like functionality\n\n\"use strict\";\n\nvar d          = require(\"d\")\n  , extensions = require(\"../lib/registered-extensions\")\n\n  , create = Object.create, defineProperties = Object.defineProperties;\n\nextensions.refCounter = function (ignore, conf, options) {\n\tvar cache, postfix;\n\n\tcache = create(null);\n\tpostfix = (options.async && extensions.async) || (options.promise && extensions.promise)\n\t\t? \"async\" : \"\";\n\n\tconf.on(\"set\" + postfix, function (id, length) {\n cache[id] = length || 1;\n});\n\tconf.on(\"get\" + postfix, function (id) {\n ++cache[id];\n});\n\tconf.on(\"delete\" + postfix, function (id) {\n delete cache[id];\n});\n\tconf.on(\"clear\" + postfix, function () {\n cache = {};\n});\n\n\tdefineProperties(conf.memoized, {\n\t\tdeleteRef: d(function () {\n\t\t\tvar id = conf.get(arguments);\n\t\t\tif (id === null) return null;\n\t\t\tif (!cache[id]) return null;\n\t\t\tif (!--cache[id]) {\n\t\t\t\tconf.delete(id);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t}),\n\t\tgetRefCount: d(function () {\n\t\t\tvar id = conf.get(arguments);\n\t\t\tif (id === null) return 0;\n\t\t\tif (!cache[id]) return 0;\n\t\t\treturn cache[id];\n\t\t})\n\t});\n};\n","\"use strict\";\n\nvar crypto  = require('crypto');\nvar Charset = require('./charset.js');\n\nfunction safeRandomBytes(length) {\n  while (true) {\n    try {\n      return crypto.randomBytes(length);\n    } catch(e) {\n      continue;\n    }\n  }\n}\n\nexports.generate = function(options) {\n  \n  var charset = new Charset();\n  \n  var length, chars, capitalization, string = '';\n  \n  // Handle options\n  if (typeof options === 'object') {\n    length = options.length || 32;\n    \n    if (options.charset) {\n      charset.setType(options.charset);\n    }\n    else {\n      charset.setType('alphanumeric');\n    }\n    \n    if (options.capitalization) {\n      charset.setcapitalization(options.capitalization);\n    }\n    \n    if (options.readable) {\n      charset.removeUnreadable();\n    }\n    \n    charset.removeDuplicates();\n  }\n  else if (typeof options === 'number') {\n    length = options;\n    charset.setType('alphanumeric');\n  }\n  else {\n    length = 32;\n    charset.setType('alphanumeric');\n  }\n  \n  // Generate the string\n  var charsLen = charset.chars.length;\n  var maxByte = 256 - (256 % charsLen);\n  while (length > 0) {\n    var buf = safeRandomBytes(Math.ceil(length * 256 / maxByte));\n    for (var i = 0; i < buf.length && length > 0; i++) {\n      var randomByte = buf.readUInt8(i);\n      if (randomByte < maxByte) {\n        string += charset.chars.charAt(randomByte % charsLen);\n        length--;\n      }\n    }\n  }\n\n  return string;\n};\n","var arrayUniq = require('array-uniq');\n\nfunction Charset() {\n  this.chars = '';\n}\n\nCharset.prototype.setType = function(type) {\n  var chars;\n  \n  var numbers    = '0123456789';\n  var charsLower = 'abcdefghijklmnopqrstuvwxyz';\n  var charsUpper = charsLower.toUpperCase();\n  var hexChars   = 'abcdef';\n  \n  if (type === 'alphanumeric') {\n    chars = numbers + charsLower + charsUpper;\n  }\n  else if (type === 'numeric') {\n    chars = numbers;\n  }\n  else if (type === 'alphabetic') {\n    chars = charsLower + charsUpper;\n  }\n  else if (type === 'hex') {\n    chars = numbers + hexChars;\n  }\n  else {\n    chars = type;\n  }\n  \n  this.chars = chars;\n}\n\nCharset.prototype.removeUnreadable = function() {\n  var unreadableChars = /[0OIl]/g;\n  this.chars = this.chars.replace(unreadableChars, '');\n}\n\nCharset.prototype.setcapitalization = function(capitalization) {\n  if (capitalization === 'uppercase') {\n    this.chars = this.chars.toUpperCase();\n  }\n  else if (capitalization === 'lowercase') {\n    this.chars = this.chars.toLowerCase();\n  }\n}\n\nCharset.prototype.removeDuplicates = function() {\n  var charMap = this.chars.split('');\n  charMap = arrayUniq(charMap);\n  this.chars = charMap.join('');\n}\n\nmodule.exports = exports = Charset;","'use strict';\n\n// there's 3 implementations written in increasing order of efficiency\n\n// 1 - no Set type is defined\nfunction uniqNoSet(arr) {\n\tvar ret = [];\n\n\tfor (var i = 0; i < arr.length; i++) {\n\t\tif (ret.indexOf(arr[i]) === -1) {\n\t\t\tret.push(arr[i]);\n\t\t}\n\t}\n\n\treturn ret;\n}\n\n// 2 - a simple Set type is defined\nfunction uniqSet(arr) {\n\tvar seen = new Set();\n\treturn arr.filter(function (el) {\n\t\tif (!seen.has(el)) {\n\t\t\tseen.add(el);\n\t\t\treturn true;\n\t\t}\n\t});\n}\n\n// 3 - a standard Set type is defined and it has a forEach method\nfunction uniqSetWithForEach(arr) {\n\tvar ret = [];\n\n\t(new Set(arr)).forEach(function (el) {\n\t\tret.push(el);\n\t});\n\n\treturn ret;\n}\n\n// V8 currently has a broken implementation\n// https://github.com/joyent/node/issues/8449\nfunction doesForEachActuallyWork() {\n\tvar ret = false;\n\n\t(new Set([true])).forEach(function (el) {\n\t\tret = el;\n\t});\n\n\treturn ret === true;\n}\n\nif ('Set' in global) {\n\tif (typeof Set.prototype.forEach === 'function' && doesForEachActuallyWork()) {\n\t\tmodule.exports = uniqSetWithForEach;\n\t} else {\n\t\tmodule.exports = uniqSet;\n\t}\n} else {\n\tmodule.exports = uniqNoSet;\n}\n","module.exports = require(\"pinejs-client-core\");","var OMeta = require(\"ometa-js/lib/ometajs/core\"), SBVRLibs = require(\"./sbvr-libs\").SBVRLibs, _ = require(\"lodash\");\n\nrequire(\"./inflection\");\n\nvar SBVRParser = exports.SBVRParser = SBVRLibs._extend({\n    EOL: function() {\n        var $elf = this, _fromIdx = this.input.idx;\n        return function() {\n            switch (this.anything()) {\n              case \"\\n\":\n                return \"\\n\";\n\n              case \"\\r\":\n                return this._opt(function() {\n                    return this._applyWithArgs(\"exactly\", \"\\n\");\n                });\n\n              default:\n                throw this._fail();\n            }\n        }.call(this);\n    },\n    EOLSpaces: function() {\n        var $elf = this, _fromIdx = this.input.idx, eol;\n        eol = !1;\n        this._many(function() {\n            return this._or(function() {\n                this._apply(\"EOL\");\n                return eol = !0;\n            }, function() {\n                return this._apply(\"space\");\n            });\n        });\n        return this._pred(eol);\n    },\n    IdentifierKey: function(identifier) {\n        var $elf = this, _fromIdx = this.input.idx, index;\n        index = this._or(function() {\n            this._pred(Array.isArray(identifier[3]));\n            this._pred(\"Number\" == identifier[3][0]);\n            return identifier[3][1];\n        }, function() {\n            return \"\";\n        });\n        return identifier[1] + \"|\" + identifier[2] + \"|\" + index;\n    },\n    Bind: function(identifier, bindings) {\n        var $elf = this, _fromIdx = this.input.idx, binding, identifierKey, varNumber;\n        identifierKey = this._applyWithArgs(\"IdentifierKey\", identifier);\n        varNumber = this.ruleVars[identifierKey];\n        this._pred(null != varNumber);\n        binding = [ \"RoleBinding\", identifier, varNumber ];\n        this._opt(function() {\n            this._pred(bindings);\n            return bindings.push(binding);\n        });\n        return binding;\n    },\n    spaces: function() {\n        var $elf = this, _fromIdx = this.input.idx;\n        return this._many(function() {\n            this._not(function() {\n                return this._apply(\"EOL\");\n            });\n            return this._apply(\"space\");\n        });\n    },\n    Number: function() {\n        var $elf = this, _fromIdx = this.input.idx, n;\n        return this._or(function() {\n            this._apply(\"spaces\");\n            n = this._consumedBy(function() {\n                return this._many1(function() {\n                    return this._apply(\"digit\");\n                });\n            });\n            return [ \"Number\", parseInt(n, 10) ];\n        }, function() {\n            this._applyWithArgs(\"token\", \"one\");\n            return [ \"Number\", 1 ];\n        });\n    },\n    Real: function() {\n        var $elf = this, _fromIdx = this.input.idx, n;\n        this._apply(\"spaces\");\n        n = this._consumedBy(function() {\n            this._opt(function() {\n                return this._applyWithArgs(\"exactly\", \"-\");\n            });\n            this._many1(function() {\n                return this._apply(\"digit\");\n            });\n            this._applyWithArgs(\"exactly\", \".\");\n            return this._many1(function() {\n                return this._apply(\"digit\");\n            });\n        });\n        return [ \"Real\", Number(n) ];\n    },\n    Integer: function() {\n        var $elf = this, _fromIdx = this.input.idx, n;\n        this._apply(\"spaces\");\n        n = this._consumedBy(function() {\n            this._opt(function() {\n                return this._applyWithArgs(\"exactly\", \"-\");\n            });\n            return this._many1(function() {\n                return this._apply(\"digit\");\n            });\n        });\n        return [ \"Integer\", Number(n) ];\n    },\n    Text: function() {\n        var $elf = this, _fromIdx = this.input.idx, text;\n        this._apply(\"spaces\");\n        this._applyWithArgs(\"exactly\", '\"');\n        text = this._consumedBy(function() {\n            return this._many1(function() {\n                return this._or(function() {\n                    switch (this.anything()) {\n                      case \"\\\\\":\n                        return this._applyWithArgs(\"exactly\", '\"');\n\n                      default:\n                        throw this._fail();\n                    }\n                }, function() {\n                    this._not(function() {\n                        return this._applyWithArgs(\"exactly\", '\"');\n                    });\n                    return this.anything();\n                });\n            });\n        });\n        this._applyWithArgs(\"exactly\", '\"');\n        return [ \"Text\", text ];\n    },\n    Value: function() {\n        var $elf = this, _fromIdx = this.input.idx;\n        return this._or(function() {\n            return this._apply(\"Real\");\n        }, function() {\n            return this._apply(\"Integer\");\n        }, function() {\n            return this._apply(\"Text\");\n        });\n    },\n    toSBVREOL: function() {\n        var $elf = this, _fromIdx = this.input.idx;\n        this._apply(\"spaces\");\n        return this._consumedBy(function() {\n            return this._many(function() {\n                this._apply(\"spaces\");\n                return this._or(function() {\n                    return this._apply(\"InformalIdentifier\");\n                }, function() {\n                    switch (this.anything()) {\n                      case \"'\":\n                        this._apply(\"InformalIdentifier\");\n                        return this._applyWithArgs(\"exactly\", \"'\");\n\n                      default:\n                        throw this._fail();\n                    }\n                }, function() {\n                    return this._many1(function() {\n                        this._not(function() {\n                            return this._apply(\"space\");\n                        });\n                        return this.anything();\n                    });\n                });\n            });\n        });\n    },\n    toEOL: function() {\n        var $elf = this, _fromIdx = this.input.idx;\n        return this._consumedBy(function() {\n            return this._many(function() {\n                this._not(function() {\n                    return this._apply(\"EOL\");\n                });\n                return this.anything();\n            });\n        });\n    },\n    token: function(x) {\n        var $elf = this, _fromIdx = this.input.idx, s;\n        this._apply(\"spaces\");\n        s = this._applyWithArgs(\"seq\", x);\n        this._lookahead(function() {\n            return this._or(function() {\n                return this._apply(\"space\");\n            }, function() {\n                return this._apply(\"end\");\n            });\n        });\n        return s;\n    },\n    AddIdentifier: function(identifierType, baseSynonym) {\n        var $elf = this, _fromIdx = this.input.idx, identifier, startInput;\n        startInput = this.input;\n        identifier = this._many1(function() {\n            return this._apply(\"IdentifierPart\");\n        });\n        identifier = identifier.join(\" \");\n        this._addToken(startInput, this.input, identifierType, []);\n        return function() {\n            return $elf._AddIdentifier(identifierType, identifier, baseSynonym);\n        };\n    },\n    InformalIdentifier: function() {\n        var $elf = this, _fromIdx = this.input.idx;\n        return this._applyWithArgs(\"Identifier\", void 0, !0);\n    },\n    Identifier: function(factTypeSoFar, noAutoComplete) {\n        var $elf = this, _fromIdx = this.input.idx, name, term;\n        this._opt(function() {\n            return this._not(function() {\n                return term = this._consumedBy(function() {\n                    return this._opt(function() {\n                        return this._applyWithArgs(\"Term\", factTypeSoFar);\n                    });\n                });\n            });\n        });\n        this._opt(function() {\n            return this._not(function() {\n                return name = this._consumedBy(function() {\n                    return this._opt(function() {\n                        return this._applyWithArgs(\"Name\", factTypeSoFar);\n                    });\n                });\n            });\n        });\n        return this._or(function() {\n            this._pred(term || name);\n            return this._or(function() {\n                this._pred(term.length > name.length);\n                return this._applyWithArgs(\"Term\", factTypeSoFar);\n            }, function() {\n                return this._applyWithArgs(\"Name\", factTypeSoFar);\n            });\n        }, function() {\n            this._pred(!noAutoComplete && void 0 !== this._getBranches());\n            return this._or(function() {\n                return this._applyWithArgs(\"Term\", factTypeSoFar);\n            }, function() {\n                return this._applyWithArgs(\"Name\", factTypeSoFar);\n            });\n        });\n    },\n    Vocabulary: function() {\n        var $elf = this, _fromIdx = this.input.idx, vocabulary;\n        vocabulary = this._apply(\"FindVocabulary\");\n        return [ \"Vocabulary\", vocabulary ];\n    },\n    Name: function(factTypeSoFar) {\n        var $elf = this, _fromIdx = this.input.idx;\n        return this._applyWithArgs(\"FindIdentifier\", \"Name\", factTypeSoFar);\n    },\n    Term: function(factTypeSoFar) {\n        var $elf = this, _fromIdx = this.input.idx, n, term;\n        term = this._applyWithArgs(\"FindIdentifier\", \"Term\", factTypeSoFar);\n        this._opt(function() {\n            n = this._consumedBy(function() {\n                return this._many1(function() {\n                    return this._apply(\"digit\");\n                });\n            });\n            return term.push([ \"Number\", Number(n) ]);\n        });\n        return term;\n    },\n    FindIdentifier: function(identifierType, factTypeSoFar) {\n        var $elf = this, _fromIdx = this.input.idx, identifier, quote;\n        this._apply(\"spaces\");\n        quote = this._opt(function() {\n            return this._applyWithArgs(\"exactly\", \"'\");\n        });\n        identifier = this._applyWithArgs(\"FindIdentifierNest\", identifierType, factTypeSoFar);\n        this._or(function() {\n            return this._pred(!quote);\n        }, function() {\n            switch (this.anything()) {\n              case \"'\":\n                return \"'\";\n\n              default:\n                throw this._fail();\n            }\n        });\n        return identifier;\n    },\n    FindIdentifierNest: function(identifierType, factTypeSoFar, identifierSoFar) {\n        var $elf = this, _fromIdx = this.input.idx, identifierSoFar, part, vocabulary;\n        part = this._apply(\"IdentifierPart\");\n        identifierSoFar = this._or(function() {\n            this._pred(identifierSoFar);\n            return identifierSoFar + \" \" + part;\n        }, function() {\n            return part;\n        });\n        this._pred(identifierSoFar.length <= this.longestIdentifier[identifierType]);\n        return this._or(function() {\n            return this._applyWithArgs(\"FindIdentifierNest\", identifierType, factTypeSoFar, identifierSoFar);\n        }, function() {\n            vocabulary = this._or(function() {\n                return this._applyWithArgs(\"FindVocabulary\", identifierSoFar);\n            }, function() {\n                return this.currentVocabulary;\n            });\n            return this._applyWithArgs(\"IsFactTypeIdentifier\", [ identifierType, identifierSoFar, vocabulary ], factTypeSoFar);\n        });\n    },\n    FindVocabulary: function(identifier) {\n        var $elf = this, _fromIdx = this.input.idx, bracket, vocabulary;\n        this._apply(\"spaces\");\n        bracket = this._opt(function() {\n            return this._applyWithArgs(\"exactly\", \"(\");\n        });\n        vocabulary = this._apply(\"FindVocabularyNest\");\n        this._pred(!identifier || this.vocabularies[vocabulary].IdentifierChildren.hasOwnProperty(identifier));\n        this._or(function() {\n            return this._pred(!bracket);\n        }, function() {\n            switch (this.anything()) {\n              case \")\":\n                return \")\";\n\n              default:\n                throw this._fail();\n            }\n        });\n        return vocabulary;\n    },\n    FindVocabularyNest: function(vocabularySoFar) {\n        var $elf = this, _fromIdx = this.input.idx, part, vocabularySoFar;\n        part = this._apply(\"IdentifierPart\");\n        vocabularySoFar = this._or(function() {\n            this._pred(vocabularySoFar);\n            return vocabularySoFar + \" \" + part;\n        }, function() {\n            return part;\n        });\n        this._pred(vocabularySoFar.length <= this.longestIdentifier.Vocabulary);\n        return this._or(function() {\n            return this._applyWithArgs(\"FindVocabularyNest\", vocabularySoFar);\n        }, function() {\n            this._pred(this.vocabularies.hasOwnProperty(vocabularySoFar));\n            return vocabularySoFar;\n        });\n    },\n    IdentifierPart: function() {\n        var $elf = this, _fromIdx = this.input.idx, r;\n        this._apply(\"spaces\");\n        return this._consumedBy(function() {\n            return this._many1(function() {\n                r = this.anything();\n                return this._pred(r >= \"a\" && r <= \"z\" || r >= \"A\" && r <= \"Z\" || \"-\" === r);\n            });\n        });\n    },\n    addVerb: function() {\n        var $elf = this, _fromIdx = this.input.idx;\n        this._apply(\"ClearSuggestions\");\n        return this._applyWithArgs(\"Verb\", !0);\n    },\n    Verb: function(factTypeSoFar) {\n        var $elf = this, _fromIdx = this.input.idx, bracket, verb;\n        this._apply(\"spaces\");\n        bracket = this._opt(function() {\n            return this._applyWithArgs(\"exactly\", \"[\");\n        });\n        verb = this._applyWithArgs(\"FindVerb\", factTypeSoFar, bracket);\n        this._or(function() {\n            return this._pred(!bracket);\n        }, function() {\n            this._apply(\"spaces\");\n            return this._applyWithArgs(\"exactly\", \"]\");\n        });\n        return verb;\n    },\n    FindVerb: function(factTypeSoFar, bracketed, verbSoFar, negated) {\n        var $elf = this, _fromIdx = this.input.idx, negated, part, verb, verbSoFar;\n        this._opt(function() {\n            this._pred(factTypeSoFar && !verbSoFar);\n            this._or(function() {\n                return this._applyWithArgs(\"Keyword\", \"isn't\");\n            }, function() {\n                return this._applyWithArgs(\"Keyword\", \"aren't\");\n            });\n            verbSoFar = \"is\";\n            return negated = !0;\n        });\n        this._apply(\"spaces\");\n        this._or(function() {\n            return this._pred(bracketed);\n        }, function() {\n            return this._not(function() {\n                return this._apply(\"Identifier\");\n            });\n        });\n        part = this._apply(\"IdentifierPart\");\n        verbSoFar = this._or(function() {\n            this._pred(verbSoFar);\n            return verbSoFar + \" \" + part;\n        }, function() {\n            return this._verbForm(part);\n        });\n        this._opt(function() {\n            this._pred(factTypeSoFar && \"is\" === verbSoFar);\n            this._apply(\"spaces\");\n            this._applyWithArgs(\"Keyword\", \"not\");\n            return negated = !0;\n        });\n        return this._or(function() {\n            return this._applyWithArgs(\"FindVerb\", factTypeSoFar, bracketed, verbSoFar, negated);\n        }, function() {\n            this._or(function() {\n                return this._pred(!0 === factTypeSoFar);\n            }, function() {\n                return this._applyWithArgs(\"IsVerb\", factTypeSoFar, verbSoFar);\n            });\n            verb = [ \"Verb\", verbSoFar, !0 === negated ];\n            return verb;\n        });\n    },\n    JoiningQuantifier: function() {\n        var $elf = this, _fromIdx = this.input.idx;\n        return this._applyWithArgs(\"matchForAll\", \"Keyword\", [ \"and\", \"at\", \"most\" ]);\n    },\n    Quantifier: function() {\n        var $elf = this, _fromIdx = this.input.idx, m, n;\n        return this._or(function() {\n            this._applyWithArgs(\"matchForAny\", \"Keyword\", [ \"each\", \"a given\" ]);\n            return [ \"UniversalQuantification\" ];\n        }, function() {\n            this._applyWithArgs(\"matchForAny\", \"Keyword\", [ \"a\", \"an\", \"some\" ]);\n            return [ \"ExistentialQuantification\" ];\n        }, function() {\n            this._applyWithArgs(\"matchForAll\", \"Keyword\", [ \"at\", \"most\" ]);\n            n = this._apply(\"Number\");\n            return [ \"AtMostNQuantification\", [ \"MaximumCardinality\", n ] ];\n        }, function() {\n            this._applyWithArgs(\"matchForAll\", \"Keyword\", [ \"at\", \"least\" ]);\n            n = this._apply(\"Number\");\n            return this._or(function() {\n                this._apply(\"JoiningQuantifier\");\n                m = this._apply(\"Number\");\n                return [ \"NumericalRangeQuantification\", [ \"MinimumCardinality\", n ], [ \"MaximumCardinality\", m ] ];\n            }, function() {\n                return [ \"AtLeastNQuantification\", [ \"MinimumCardinality\", n ] ];\n            });\n        }, function() {\n            this._applyWithArgs(\"matchForAll\", \"Keyword\", [ \"more\", \"than\" ]);\n            n = this._apply(\"Number\");\n            ++n[1];\n            return [ \"AtLeastNQuantification\", [ \"MinimumCardinality\", n ] ];\n        }, function() {\n            this._applyWithArgs(\"Keyword\", \"exactly\");\n            n = this._apply(\"Number\");\n            return [ \"ExactQuantification\", [ \"Cardinality\", n ] ];\n        }, function() {\n            this._applyWithArgs(\"Keyword\", \"no\");\n            return [ \"ExactQuantification\", [ \"Cardinality\", [ \"Number\", 0 ] ] ];\n        });\n    },\n    Keyword: function(word, noToken) {\n        var $elf = this, _fromIdx = this.input.idx;\n        return this._or(function() {\n            this._pred(!0 === noToken);\n            return this._applyWithArgs(\"seq\", word);\n        }, function() {\n            this._pred(!0 !== noToken);\n            return this._applyWithArgs(\"token\", word);\n        });\n    },\n    addThat: function() {\n        var $elf = this, _fromIdx = this.input.idx;\n        return this._applyWithArgs(\"Keyword\", \"that\");\n    },\n    addThe: function() {\n        var $elf = this, _fromIdx = this.input.idx;\n        return this._applyWithArgs(\"Keyword\", \"the\");\n    },\n    DisableCommas: function(bool) {\n        var $elf = this, _fromIdx = this.input.idx;\n        return this.disableCommas = bool;\n    },\n    addComma: function(force) {\n        var $elf = this, _fromIdx = this.input.idx;\n        this._pred(force || !this.disableCommas);\n        return this._applyWithArgs(\"Keyword\", \",\");\n    },\n    CreateVar: function(identifier) {\n        var $elf = this, _fromIdx = this.input.idx, identifierKey, varNumber;\n        identifierKey = this._applyWithArgs(\"IdentifierKey\", identifier);\n        varNumber = this._or(function() {\n            this._pred(\"|\" !== identifierKey.slice(-1));\n            this._pred(this.ruleVars[identifierKey]);\n            return this.ruleVars[identifierKey];\n        }, function() {\n            return this.ruleVars[identifierKey] = this.ruleVarsCount++;\n        });\n        return [ \"Variable\", [ \"Number\", varNumber ], identifier ];\n    },\n    EmbedVar: function(identifier, data) {\n        var $elf = this, _fromIdx = this.input.idx, identifierKey;\n        identifierKey = this._applyWithArgs(\"IdentifierKey\", identifier);\n        return this.ruleVars[identifierKey] = data;\n    },\n    IsAtomicFormulation: function(factType, bindings) {\n        var $elf = this, _fromIdx = this.input.idx, realFactType;\n        realFactType = this._applyWithArgs(\"IsFactType\", factType);\n        this._pred(realFactType);\n        return [ \"AtomicFormulation\" ].concat([ [ \"FactType\" ].concat(factType) ], bindings);\n    },\n    ClosedProjection: function(identifier, bind) {\n        var $elf = this, _fromIdx = this.input.idx, bindings, factType, verb;\n        return this._or(function() {\n            this._apply(\"addThat\");\n            return this._or(function() {\n                return this._applyWithArgs(\"Junction\", \"VerbContinuation\", [ [ identifier ], [ bind ] ]);\n            }, function() {\n                return this._applyWithArgs(\"Junction\", \"RuleBody\", [ [], [], identifier, bind ]);\n            });\n        }, function() {\n            this._applyWithArgs(\"Keyword\", \"of\");\n            factType = [ identifier ];\n            verb = \"is of\";\n            this._applyWithArgs(\"IsVerb\", factType, verb);\n            factType.push([ \"Verb\", verb, !1 ]);\n            bindings = [ bind ];\n            return this._or(function() {\n                return this._applyWithArgs(\"Junction\", \"RuleBody\", [ factType, bindings ]);\n            }, function() {\n                return this._applyWithArgs(\"IsAtomicFormulation\", factType, bindings);\n            });\n        });\n    },\n    TermEntity: function(factType, bindings) {\n        var $elf = this, _fromIdx = this.input.idx, bind, term, thatLF, varLF;\n        term = this._applyWithArgs(\"Term\", factType);\n        varLF = this._applyWithArgs(\"CreateVar\", term);\n        bind = this._applyWithArgs(\"Bind\", term, bindings);\n        this._opt(function() {\n            thatLF = this._applyWithArgs(\"ClosedProjection\", term, bind);\n            varLF.push(thatLF);\n            return this._opt(function() {\n                this._pred(factType);\n                return this._applyWithArgs(\"addComma\", !1);\n            });\n        });\n        return {\n            term: term,\n            lf: varLF\n        };\n    },\n    RuleBody: function(factType, bindings, parentIdentifier, parentBind) {\n        var $elf = this, _fromIdx = this.input.idx, bind, data, identifier, lf, quant, termEntity;\n        this._or(function() {\n            quant = this._apply(\"Quantifier\");\n            termEntity = this._applyWithArgs(\"TermEntity\", factType, bindings);\n            return factType.push(termEntity.term);\n        }, function() {\n            this._apply(\"addThe\");\n            identifier = this._applyWithArgs(\"Identifier\", factType);\n            this._or(function() {\n                return this._applyWithArgs(\"Bind\", identifier, bindings);\n            }, function() {\n                this._applyWithArgs(\"EmbedVar\", identifier, identifier);\n                return this._applyWithArgs(\"Bind\", identifier, bindings);\n            });\n            return factType.push(identifier);\n        }, function() {\n            data = this._apply(\"Value\");\n            identifier = this._applyWithArgs(\"IsFactTypeIdentifier\", [ \"Term\", data[0], \"Type\" ], factType);\n            identifier.push(data);\n            this._applyWithArgs(\"EmbedVar\", identifier, data);\n            bind = this._applyWithArgs(\"Bind\", identifier, bindings);\n            bind[2] = data;\n            return factType.push(identifier);\n        });\n        lf = this._or(function() {\n            return this._applyWithArgs(\"Junction\", \"VerbContinuation\", [ factType, bindings, parentIdentifier, parentBind ]);\n        }, function() {\n            return this._applyWithArgs(\"IsAtomicFormulation\", factType, bindings);\n        });\n        return null == quant ? lf : quant.concat([ termEntity.lf, lf ]);\n    },\n    VerbContinuation: function(factType, bindings, parentIdentifier, parentBind) {\n        var $elf = this, _fromIdx = this.input.idx, v;\n        v = this._applyWithArgs(\"Verb\", factType);\n        factType.push(v);\n        (function() {\n            if (null != parentIdentifier) {\n                factType.push(parentIdentifier);\n                bindings.push(parentBind);\n            }\n        }).call(this);\n        return this._or(function() {\n            return this._applyWithArgs(\"Junction\", \"RuleBody\", [ factType, bindings ]);\n        }, function() {\n            return this._applyWithArgs(\"IsAtomicFormulation\", factType, bindings);\n        });\n    },\n    Modifier: function() {\n        var $elf = this, _fromIdx = this.input.idx, r;\n        this._applyWithArgs(\"token\", \"It\");\n        this._applyWithArgs(\"token\", \"is\");\n        r = this._or(function() {\n            this._applyWithArgs(\"token\", \"obligatory\");\n            return [ \"ObligationFormulation\" ];\n        }, function() {\n            this._applyWithArgs(\"token\", \"necessary\");\n            return [ \"NecessityFormulation\" ];\n        }, function() {\n            this._or(function() {\n                return this._applyWithArgs(\"token\", \"prohibited\");\n            }, function() {\n                return this._applyWithArgs(\"token\", \"forbidden\");\n            });\n            return [ \"ObligationFormulation\", [ \"LogicalNegation\" ] ];\n        }, function() {\n            this._or(function() {\n                return this._applyWithArgs(\"token\", \"impossible\");\n            }, function() {\n                this._applyWithArgs(\"token\", \"not\");\n                return this._applyWithArgs(\"token\", \"possible\");\n            });\n            return [ \"NecessityFormulation\", [ \"LogicalNegation\" ] ];\n        }, function() {\n            this._applyWithArgs(\"token\", \"possible\");\n            return [ \"PossibilityFormulation\" ];\n        }, function() {\n            this._applyWithArgs(\"token\", \"permitted\");\n            return [ \"PermissibilityFormulation\" ];\n        });\n        this._applyWithArgs(\"token\", \"that\");\n        return r;\n    },\n    Disjunction: function() {\n        var $elf = this, _fromIdx = this.input.idx;\n        this._applyWithArgs(\"Keyword\", \"or\");\n        return \"Disjunction\";\n    },\n    Conjunction: function() {\n        var $elf = this, _fromIdx = this.input.idx;\n        this._applyWithArgs(\"Keyword\", \"and\");\n        return \"Conjunction\";\n    },\n    JunctionType: function() {\n        var $elf = this, _fromIdx = this.input.idx;\n        return this._or(function() {\n            return this._apply(\"Disjunction\");\n        }, function() {\n            return this._apply(\"Conjunction\");\n        });\n    },\n    SerialCommaCheck: function() {\n        var $elf = this, _fromIdx = this.input.idx;\n        this._applyWithArgs(\"exactly\", \",\");\n        return this._or(function() {\n            return this._applyWithArgs(\"token\", \"and\");\n        }, function() {\n            return this._applyWithArgs(\"token\", \"or\");\n        });\n    },\n    UpcomingCommaJunction: function() {\n        var $elf = this, _fromIdx = this.input.idx;\n        return this._lookahead(function() {\n            return this._or(function() {\n                this._many(function() {\n                    this._not(function() {\n                        return this._apply(\"EOL\");\n                    });\n                    this._not(function() {\n                        return this._apply(\"SerialCommaCheck\");\n                    });\n                    return this.anything();\n                });\n                this._apply(\"SerialCommaCheck\");\n                return !0;\n            }, function() {\n                return !1;\n            });\n        });\n    },\n    SimpleJunction: function(ruleName, args) {\n        var $elf = this, _fromIdx = this.input.idx, junctioned, result, type;\n        result = this._applyWithArgs.apply(this, [ ruleName ].concat(_.cloneDeep(args)));\n        return this._or(function() {\n            type = this._apply(\"JunctionType\");\n            junctioned = this._applyWithArgs(\"SimpleJunction\", ruleName, args);\n            return [ type, result, junctioned ];\n        }, function() {\n            return result;\n        });\n    },\n    Junction: function(ruleName, args) {\n        var $elf = this, _fromIdx = this.input.idx, commaSeparated, junctioned, result, type, upcoming;\n        upcoming = this._apply(\"UpcomingCommaJunction\");\n        this._applyWithArgs(\"DisableCommas\", upcoming || this.disableCommas);\n        result = this._opt(function() {\n            result = this._applyWithArgs(\"SimpleJunction\", ruleName, args);\n            return this._or(function() {\n                this._pred(upcoming);\n                commaSeparated = this._many(function() {\n                    this._applyWithArgs(\"addComma\", !0);\n                    return this._applyWithArgs(\"SimpleJunction\", ruleName, args);\n                });\n                this._applyWithArgs(\"addComma\", !0);\n                type = this._apply(\"JunctionType\");\n                junctioned = this._applyWithArgs(\"Junction\", ruleName, args, !0);\n                return [ type, result ].concat(commaSeparated).concat([ junctioned ]);\n            }, function() {\n                return result;\n            });\n        });\n        upcoming = this._apply(\"UpcomingCommaJunction\");\n        this._applyWithArgs(\"DisableCommas\", upcoming);\n        this._pred(result);\n        return result;\n    },\n    StartRule: function() {\n        var $elf = this, _fromIdx = this.input.idx;\n        return function() {\n            switch (this.anything()) {\n              case \"R\":\n                switch (this.anything()) {\n                  case \":\":\n                    return \"R:\";\n\n                  case \"u\":\n                    this._applyWithArgs(\"exactly\", \"l\");\n                    this._applyWithArgs(\"exactly\", \"e\");\n                    this._applyWithArgs(\"exactly\", \":\");\n                    return \"Rule:\";\n\n                  default:\n                    throw this._fail();\n                }\n\n              default:\n                throw this._fail();\n            }\n        }.call(this);\n    },\n    NewRule: function() {\n        var $elf = this, _fromIdx = this.input.idx, mod, ruleLF, ruleText;\n        this._apply(\"StartRule\");\n        this._apply(\"spaces\");\n        ruleText = this._lookahead(function() {\n            return this._apply(\"toEOL\");\n        });\n        this.ruleVars = {};\n        this.ruleVarsCount = 0;\n        mod = this._apply(\"Modifier\");\n        ruleLF = this._applyWithArgs(\"Junction\", \"RuleBody\", [ [], [] ]);\n        this._apply(\"EOLTerminator\");\n        mod = _.cloneDeep(mod);\n        2 === mod.length ? mod[1][1] = ruleLF : mod[1] = ruleLF;\n        return [ \"Rule\", mod, [ \"StructuredEnglish\", ruleText ] ];\n    },\n    StartFactType: function() {\n        var $elf = this, _fromIdx = this.input.idx;\n        return function() {\n            switch (this.anything()) {\n              case \"F\":\n                switch (this.anything()) {\n                  case \":\":\n                    return \"F:\";\n\n                  case \"a\":\n                    this._applyWithArgs(\"exactly\", \"c\");\n                    this._applyWithArgs(\"exactly\", \"t\");\n                    this._applyWithArgs(\"exactly\", \" \");\n                    this._applyWithArgs(\"exactly\", \"t\");\n                    this._applyWithArgs(\"exactly\", \"y\");\n                    this._applyWithArgs(\"exactly\", \"p\");\n                    this._applyWithArgs(\"exactly\", \"e\");\n                    this._applyWithArgs(\"exactly\", \":\");\n                    return \"Fact type:\";\n\n                  default:\n                    throw this._fail();\n                }\n\n              default:\n                throw this._fail();\n            }\n        }.call(this);\n    },\n    NewFactType: function() {\n        var $elf = this, _fromIdx = this.input.idx, factType, identifier, v;\n        this._apply(\"StartFactType\");\n        factType = [];\n        this._many1(function() {\n            identifier = this._apply(\"Identifier\");\n            v = this._apply(\"addVerb\");\n            return factType.push(identifier, v);\n        });\n        this._opt(function() {\n            identifier = this._apply(\"Identifier\");\n            return factType.push(identifier);\n        });\n        return function() {\n            $elf.AddFactType(factType, factType);\n            var attributes = [ \"Attributes\" ];\n            if (3 === factType.length && (\"has\" === factType[1][1] || \"is of\" === factType[1][1])) {\n                synFactType = _.cloneDeep(factType);\n                synFactType.reverse();\n                \"has\" === synFactType[1][1] ? synFactType[1][1] = \"is of\" : synFactType[1][1] = \"has\";\n                $elf.AddFactType(synFactType, factType);\n                attributes.push([ \"SynonymousForm\", synFactType ]);\n            }\n            return [ \"FactType\" ].concat(factType).concat([ attributes ]);\n        };\n    },\n    StartVocabulary: function() {\n        var $elf = this, _fromIdx = this.input.idx;\n        this._applyWithArgs(\"exactly\", \"V\");\n        this._applyWithArgs(\"exactly\", \"o\");\n        this._applyWithArgs(\"exactly\", \"c\");\n        this._applyWithArgs(\"exactly\", \"a\");\n        this._applyWithArgs(\"exactly\", \"b\");\n        this._applyWithArgs(\"exactly\", \"u\");\n        this._applyWithArgs(\"exactly\", \"l\");\n        this._applyWithArgs(\"exactly\", \"a\");\n        this._applyWithArgs(\"exactly\", \"r\");\n        this._applyWithArgs(\"exactly\", \"y\");\n        this._applyWithArgs(\"exactly\", \":\");\n        return \"Vocabulary\";\n    },\n    StartTerm: function() {\n        var $elf = this, _fromIdx = this.input.idx;\n        (function() {\n            switch (this.anything()) {\n              case \"T\":\n                switch (this.anything()) {\n                  case \":\":\n                    return \"T:\";\n\n                  case \"e\":\n                    this._applyWithArgs(\"exactly\", \"r\");\n                    this._applyWithArgs(\"exactly\", \"m\");\n                    this._applyWithArgs(\"exactly\", \":\");\n                    return \"Term:\";\n\n                  default:\n                    throw this._fail();\n                }\n\n              default:\n                throw this._fail();\n            }\n        }).call(this);\n        return \"Term\";\n    },\n    StartName: function() {\n        var $elf = this, _fromIdx = this.input.idx;\n        (function() {\n            switch (this.anything()) {\n              case \"N\":\n                switch (this.anything()) {\n                  case \":\":\n                    return \"N:\";\n\n                  case \"a\":\n                    this._applyWithArgs(\"exactly\", \"m\");\n                    this._applyWithArgs(\"exactly\", \"e\");\n                    this._applyWithArgs(\"exactly\", \":\");\n                    return \"Name:\";\n\n                  default:\n                    throw this._fail();\n                }\n\n              default:\n                throw this._fail();\n            }\n        }).call(this);\n        return \"Name\";\n    },\n    NewIdentifier: function() {\n        var $elf = this, _fromIdx = this.input.idx, func, identifierType;\n        identifierType = this._or(function() {\n            return this._apply(\"StartVocabulary\");\n        }, function() {\n            return this._apply(\"StartTerm\");\n        }, function() {\n            return this._apply(\"StartName\");\n        });\n        this._apply(\"ClearSuggestions\");\n        func = this._applyWithArgs(\"AddIdentifier\", identifierType);\n        return function() {\n            return func().concat([ [ \"Attributes\" ] ]);\n        };\n    },\n    NewAttribute: function() {\n        var $elf = this, _fromIdx = this.input.idx, attrName, attrValOrFunc, currentLine;\n        currentLine = _.last(this.lines);\n        attrName = this._applyWithArgs(\"AllowedAttrs\", currentLine[0]);\n        attrName = attrName.replace(/ /g, \"\");\n        this._apply(\"spaces\");\n        attrValOrFunc = this._applyWithArgs(\"ApplyFirstExisting\", [ \"Attr\" + attrName, \"DefaultAttr\" ]);\n        return function() {\n            var lastLine = $elf.lines.pop(), attrVal = \"function\" == typeof attrValOrFunc ? attrValOrFunc(lastLine) : attrValOrFunc;\n            _.last(lastLine).push([ attrName, attrVal ]);\n            return lastLine;\n        };\n    },\n    AllowedAttrs: function(termOrFactType) {\n        var $elf = this, _fromIdx = this.input.idx, attrName;\n        attrName = this._applyWithArgs(\"matchForAny\", \"seq\", this.branches.AllowedAttrs.call(this, termOrFactType));\n        return attrName.replace(\":\", \"\");\n    },\n    DefaultAttr: function() {\n        var $elf = this, _fromIdx = this.input.idx;\n        return this._apply(\"toSBVREOL\");\n    },\n    AttrConceptType: function() {\n        var $elf = this, _fromIdx = this.input.idx, term;\n        term = this._apply(\"Term\");\n        return function(currentLine) {\n            var identifier;\n            if (\"FactType\" === currentLine[0]) {\n                var attributes = _.last(currentLine), termForm = _.find(attributes, [ 0, \"TermForm\" ]);\n                if (!termForm) throw new Error(\"Cannot have a concept type for a fact type that does not have a term-form.\");\n                identifier = termForm[1];\n            } else identifier = currentLine.slice(0, 3);\n            var identifierName = identifier[1], identifierVocab = identifier[2];\n            if ($elf.vocabularies[identifierVocab].ConceptTypes.hasOwnProperty(identifier)) throw new Error(\"Two concept type attributes\");\n            if (\"FactType\" !== identifier[0]) {\n                if ($elf.IdentifiersEqual(identifier, term)) throw new Error(\"A term cannot have itself as its concept type\");\n                var termName = term[1], termVocab = term[2];\n                $elf.vocabularies[identifierVocab].ConceptTypes[identifier] = term;\n                $elf.vocabularies[termVocab].IdentifierChildren[termName].push(identifier.slice(1));\n            }\n            return term;\n        };\n    },\n    AttrDefinition: function() {\n        var $elf = this, _fromIdx = this.input.idx, moreValues, termEntity, value, values;\n        return this._or(function() {\n            this._opt(function() {\n                return this._apply(\"addThe\");\n            });\n            this.ruleVars = {};\n            this.ruleVarsCount = 0;\n            termEntity = this._apply(\"TermEntity\");\n            this._apply(\"EOLTerminator\");\n            return function(currentLine) {\n                if (\"FactType\" !== currentLine[0]) {\n                    $elf.vocabularies[currentLine[2]].ConceptTypes[currentLine.slice(0, 3)] = termEntity.term;\n                    $elf.vocabularies[currentLine[2]].IdentifierChildren[termEntity.term[1]].push([ currentLine[1], currentLine[2] ]);\n                }\n                return termEntity.lf;\n            };\n        }, function() {\n            value = this._apply(\"Value\");\n            values = this._many(function() {\n                this._apply(\"addComma\");\n                return this._apply(\"Value\");\n            });\n            this._or(function() {\n                return moreValues = this._many1(function() {\n                    this._opt(function() {\n                        return this._apply(\"addComma\");\n                    });\n                    this._apply(\"Disjunction\");\n                    return this._apply(\"Value\");\n                });\n            }, function() {\n                return this._pred(0 === values.length);\n            });\n            return [ \"Enum\", value ].concat(values, moreValues);\n        });\n    },\n    AttrGuidanceType: function() {\n        var $elf = this, _fromIdx = this.input.idx;\n        return this._applyWithArgs(\"matchForAny\", \"seq\", this.branches.AttrGuidanceType);\n    },\n    AttrNecessity: function() {\n        var $elf = this, _fromIdx = this.input.idx, lf, ruleText;\n        return this._or(function() {\n            ruleText = this._lookahead(function() {\n                return this._apply(\"toEOL\");\n            });\n            this.ruleVars = {};\n            this.ruleVarsCount = 0;\n            lf = this._applyWithArgs(\"RuleBody\", [], []);\n            this._apply(\"EOLTerminator\");\n            return [ \"Rule\", [ \"NecessityFormulation\", lf ], [ \"StructuredEnglish\", \"It is necessary that \" + ruleText ] ];\n        }, function() {\n            return this._apply(\"toSBVREOL\");\n        });\n    },\n    AttrReferenceScheme: function() {\n        var $elf = this, _fromIdx = this.input.idx, t;\n        return this._or(function() {\n            t = this._apply(\"Term\");\n            this._apply(\"EOLTerminator\");\n            return t;\n        }, function() {\n            return this._apply(\"toSBVREOL\");\n        });\n    },\n    AttrSynonym: function() {\n        var $elf = this, _fromIdx = this.input.idx, currentLine;\n        currentLine = _.last(this.lines);\n        return this._applyWithArgs(\"AddIdentifier\", currentLine[0], currentLine[1]);\n    },\n    AttrSynonymousForm: function() {\n        var $elf = this, _fromIdx = this.input.idx, factType, identifier, v;\n        factType = [];\n        this._many1(function() {\n            identifier = this._apply(\"Identifier\");\n            v = this._apply(\"addVerb\");\n            return factType.push(identifier, v);\n        });\n        this._opt(function() {\n            identifier = this._apply(\"Identifier\");\n            return factType.push(identifier);\n        });\n        return function(currentLine) {\n            $elf.AddFactType(factType, currentLine.slice(1, -1));\n            return factType;\n        };\n    },\n    AttrTermForm: function() {\n        var $elf = this, _fromIdx = this.input.idx, func;\n        func = this._applyWithArgs(\"AddIdentifier\", \"Term\");\n        return function(currentLine) {\n            for (var term = func(), i = 0; i < currentLine.length; i++) if (\"Term\" === currentLine[i][0]) {\n                var factType = [ term, [ \"Verb\", \"has\", !1 ], currentLine[i] ];\n                $elf.AddFactType(factType, factType);\n            }\n            return term;\n        };\n    },\n    StartComment: function() {\n        var $elf = this, _fromIdx = this.input.idx;\n        this._applyWithArgs(\"exactly\", \"-\");\n        this._applyWithArgs(\"exactly\", \"-\");\n        return \"--\";\n    },\n    NewComment: function() {\n        var $elf = this, _fromIdx = this.input.idx;\n        this._apply(\"StartComment\");\n        return this._apply(\"toEOL\");\n    },\n    EOLTerminator: function() {\n        var $elf = this, _fromIdx = this.input.idx;\n        this._opt(function() {\n            return this._apply(\"Terminator\");\n        });\n        this._apply(\"spaces\");\n        return this._lookahead(function() {\n            return this._or(function() {\n                return this._apply(\"EOL\");\n            }, function() {\n                return this._apply(\"end\");\n            });\n        });\n    },\n    Terminator: function() {\n        var $elf = this, _fromIdx = this.input.idx;\n        this._apply(\"spaces\");\n        return this._applyWithArgs(\"Keyword\", \".\", !0);\n    },\n    space: function() {\n        var $elf = this, _fromIdx = this.input.idx;\n        return this._or(function() {\n            return SBVRLibs._superApply(this, \"space\");\n        }, function() {\n            return this._apply(\"NewComment\");\n        });\n    },\n    Line: function() {\n        var $elf = this, _fromIdx = this.input.idx, func, l;\n        this._apply(\"spaces\");\n        l = this._or(function() {\n            func = this._or(function() {\n                return this._apply(\"NewIdentifier\");\n            }, function() {\n                return this._apply(\"NewFactType\");\n            }, function() {\n                return this._apply(\"NewAttribute\");\n            });\n            return func();\n        }, function() {\n            return this._apply(\"NewRule\");\n        });\n        this._apply(\"ClearSuggestions\");\n        this.lines.push(l);\n        return l;\n    },\n    Process: function() {\n        var $elf = this, _fromIdx = this.input.idx;\n        this._opt(function() {\n            return this._apply(\"EOLSpaces\");\n        });\n        this._opt(function() {\n            return this._apply(\"Line\");\n        });\n        this._many(function() {\n            this._apply(\"EOLSpaces\");\n            return this._apply(\"Line\");\n        });\n        this._many(function() {\n            return this._apply(\"space\");\n        });\n        this._apply(\"end\");\n        return this.lines;\n    }\n});\n\nSBVRParser.ClearSuggestions = function() {};\n\nSBVRParser.initialize = function() {\n    this.builtInVocab = \"\";\n    this.builtInVocabInputHead = \"\";\n    this.allowedAttrLists = _.cloneDeep(defaultAllowedAttrLists);\n    this.reset();\n};\n\nSBVRParser._enableTokens = function() {\n    SBVRLibs._enableTokens.call(this, [ \"StartVocabulary\", \"StartTerm\", \"StartName\", \"StartFactType\", \"StartRule\", \"NewComment\", \"Vocabulary\", \"Term\", \"Name\", \"Modifier\", \"Verb\", \"Keyword\", \"AllowedAttrs\", \"AttrGuidanceType\", \"Number\", \"Value\" ]);\n};\n\nSBVRParser._sideEffectingRules = [ \"Process\", \"Line\" ];\n\nSBVRParser._AddIdentifier = function(identifierType, identifier, baseSynonym) {\n    null == baseSynonym && (baseSynonym = identifier);\n    if (\"Vocabulary\" === identifierType) this.AddVocabulary(identifier, baseSynonym); else {\n        var vocabulary = this.vocabularies[this.currentVocabulary];\n        vocabulary.IdentifierChildren.hasOwnProperty(identifier) && this._pred(!1);\n        baseSynonym === identifier ? vocabulary.IdentifierChildren[baseSynonym] = [] : vocabulary.IdentifierChildren[identifier] = vocabulary.IdentifierChildren[baseSynonym];\n        vocabulary[identifierType][identifier] = baseSynonym;\n    }\n    this.longestIdentifier[identifierType] = Math.max(identifier.length, identifier.pluralize().length, this.longestIdentifier[identifierType]);\n    return \"Vocabulary\" === identifierType ? [ identifierType, identifier ] : [ identifierType, identifier, this.currentVocabulary ];\n};\n\nSBVRParser.BaseSynonym = function(identifier) {\n    var identifierType = identifier[0], identifierName = identifier[1], vocabulary = identifier[2], identifiers = this.vocabularies[vocabulary][identifierType];\n    if (identifiers.hasOwnProperty(identifierName)) identifierName = identifiers[identifierName]; else {\n        identifierName = identifierName.singularize();\n        this._pred(identifiers.hasOwnProperty(identifierName));\n        identifierName = identifiers[identifierName];\n    }\n    return [ identifierType, identifierName, vocabulary ];\n};\n\nSBVRParser.IsFactTypeIdentifier = function(identifier, factTypeSoFar) {\n    var identifierType = identifier[0], vocabulary = identifier[2], baseIdentifier = this.BaseSynonym(identifier), identifiers = this.branches[identifierType].call(this, factTypeSoFar, vocabulary);\n    this._pred(-1 !== identifiers.indexOf(baseIdentifier[1]));\n    return baseIdentifier;\n};\n\nSBVRParser.IsVerb = function(factTypeSoFar, verb) {\n    verb = [ \"Verb\", verb ];\n    var currentLevel = this._traverseFactType(factTypeSoFar);\n    this._pred(!1 !== currentLevel);\n    if (!currentLevel.hasOwnProperty(verb)) {\n        this._pred(currentLevel.hasOwnProperty(\"__valid\"));\n        return this.IsVerb([], verb);\n    }\n};\n\nSBVRParser._verbForm = function(verb) {\n    return \"are\" === verb ? \"is\" : \"have\" === verb ? \"has\" : \"are \" === verb.slice(0, 4) ? \"is \" + verb.slice(4) : verb;\n};\n\nSBVRParser.IsFactType = function(factType) {\n    var currentLevel = this._traverseFactType(factType);\n    return !1 !== currentLevel && currentLevel.__valid;\n};\n\nvar removeRegex = new RegExp(\"^(?:\" + [ [ \"Term\", \"\" ].toString(), [ \"Name\", \"\" ].toString(), [ \"Verb\", \"\" ].toString() ].join(\"|\") + \")(.*?)(?:,(.*))?$\"), defaultAllowedAttrLists = [ \"Concept Type:\", \"Definition:\", \"Definition (Informal):\", \"Description:\", \"Dictionary Basis:\", \"Example:\", \"General Concept:\", \"Namespace URI:\", \"Necessity:\", \"Note:\", \"Possibility:\", \"Reference Scheme:\", \"See:\", \"Source:\", \"Subject Field:\" ];\n\ndefaultAllowedAttrLists = {\n    Term: [ \"Synonym:\" ].concat(defaultAllowedAttrLists),\n    Name: [ \"Synonym:\" ].concat(defaultAllowedAttrLists),\n    FactType: [ \"Synonymous Form:\", \"Term Form:\" ].concat(defaultAllowedAttrLists),\n    Rule: [ \"Rule Name:\", \"Guidance Type:\", \"Source:\", \"Synonymous Statement:\", \"Note:\", \"Example:\", \"Enforcement Level:\" ]\n};\n\nvar getValidFactTypeParts = function getValidFactTypeParts(vocabulary, identifierType, factTypeSoFar) {\n    var vocabularies = this.vocabularies;\n    if (null == factTypeSoFar || 0 === factTypeSoFar.length) {\n        var identifiers;\n        identifiers = null == vocabulary ? vocabularies[this.currentVocabulary][identifierType] : vocabularies[vocabulary][identifierType];\n        return Object.keys(identifiers);\n    }\n    var factTypePart, currentLevel = this._traverseFactType(factTypeSoFar), factTypeParts = {}, followChildrenChain = function(vocabulary, identifier) {\n        vocabulary = vocabularies[vocabulary];\n        var identifiers = vocabulary[identifierType];\n        identifiers.hasOwnProperty(identifier) && (factTypeParts[identifiers[identifier]] = !0);\n        for (var i = 0; i < vocabulary.IdentifierChildren[identifier].length; i++) {\n            var child = vocabulary.IdentifierChildren[identifier][i];\n            followChildrenChain(child[1], child[0]);\n        }\n    };\n    for (factTypePart in currentLevel) if (currentLevel.hasOwnProperty(factTypePart)) {\n        var matches = removeRegex.exec(factTypePart), factTypePartVocabulary;\n        if (null != matches) {\n            factTypePart = matches[1];\n            if (matches[2]) {\n                factTypePartVocabulary = matches[2];\n                followChildrenChain(factTypePartVocabulary, factTypePart);\n            } else factTypeParts[factTypePart] = !0;\n        }\n    }\n    return Object.keys(factTypeParts);\n};\n\nSBVRParser.reset = function() {\n    SBVRLibs.initialize.call(this);\n    this.branches = {\n        ClearSuggestions: [],\n        StartVocabulary: [ \"Vocabulary:\" ],\n        StartTerm: [ \"Term:      \" ],\n        StartName: [ \"Name:      \" ],\n        StartFactType: [ \"Fact type: \" ],\n        StartRule: [ \"Rule:      \" ],\n        Vocabulary: function(factTypeSoFar) {\n            return Object.keys(this.vocabularies);\n        },\n        Term: function(factTypeSoFar, vocabulary) {\n            return getValidFactTypeParts.call(this, vocabulary, \"Term\", factTypeSoFar);\n        },\n        Name: function(factTypeSoFar, vocabulary) {\n            return getValidFactTypeParts.call(this, vocabulary, \"Name\", factTypeSoFar);\n        },\n        Verb: function(factTypeSoFar, vocabulary) {\n            return !0 === factTypeSoFar ? [] : getValidFactTypeParts.call(this, vocabulary, \"Verb\", factTypeSoFar);\n        },\n        AllowedAttrs: function(termOrFactType) {\n            return this.allowedAttrLists.hasOwnProperty(termOrFactType) ? this.allowedAttrLists[termOrFactType] : null == termOrFactType ? this.allowedAttrLists.Term.concat(this.allowedAttrLists.Name, this.allowedAttrLists.FactType) : [];\n        },\n        AttrGuidanceType: [ \"operative business rule\", \"structural business rule\", \"advice of permission\", \"advice of possibility\", \"advice of optionality\", \"advice of contingency\" ],\n        Modifier: [ \"It is obligatory that\", \"It is necessary that\", \"It is prohibited that\", \"It is forbidden that\", \"It is impossible that\", \"It is not possible that\", \"It is possible that\", \"It is permitted that\" ],\n        Quantifier: [ \"each\", \"a\", \"a given\", \"an\", \"some\", \"at most\", \"at least\", \"more than\", \"exactly\", \"no\" ],\n        JoiningQuantifier: [ \"and at most\" ],\n        Number: [ \"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"one\" ],\n        addThat: [ \"that\", \"that the\" ],\n        addThe: [ \"the\" ],\n        addComma: [ \",\" ],\n        Disjunction: [ \"or\" ],\n        Conjunction: [ \"and\" ],\n        Terminator: [ \".\" ]\n    };\n    this.longestIdentifier = {\n        Vocabulary: 0,\n        Term: 0,\n        Name: 0\n    };\n    this.ruleVars = {};\n    this.ruleVarsCount = 0;\n    this.lines = [ \"Model\" ];\n    this.disableCommas = !1;\n    var origInputHead = this.inputHead;\n    if (\"\" !== this.builtInVocab) {\n        this.inputHead = this.builtInVocabInputHead;\n        this.matchAll(this.builtInVocab, \"Process\");\n        this.builtInVocabInputHead = this.inputHead;\n    }\n    this.inputHead = null;\n    this.inputHead = null;\n    this.matchAll(\"Vocabulary: Default\", \"Process\");\n    this.inputHead = origInputHead;\n};\n\nSBVRParser.AddBuiltInVocab = function(vocabulary) {\n    try {\n        var origInputHead = this.inputHead;\n        vocabulary += \"\\n\";\n        this.matchAll(vocabulary, \"Process\");\n        this.inputHead = origInputHead;\n        this.builtInVocab += vocabulary;\n    } catch (e) {\n        throw e;\n    } finally {\n        this.reset();\n    }\n};\n\nSBVRParser.AddCustomAttribute = function(attributeName, attachedTo) {\n    if (null == attachedTo) for (attachedTo in this.allowedAttrLists) this.allowedAttrLists.hasOwnProperty(attachedTo) && this.allowedAttrLists[attachedTo].push(attributeName); else {\n        if (!this.allowedAttrLists.hasOwnProperty(attachedTo)) throw new Error(\"Unknown attachment\");\n        this.allowedAttrLists[attachedTo].push(attributeName);\n    }\n};\n\nSBVRParser.matchForAny = function(rule, arr) {\n    for (var $elf = this, origInput = this.input, ref = {}, result = ref, idx = 0; idx < arr.length; idx++) {\n        try {\n            $elf.input = origInput;\n            result = $elf._applyWithArgs.call($elf, rule, arr[idx]);\n        } catch (e) {\n            if (!(e instanceof SyntaxError)) throw e;\n        }\n        if (result !== ref) return result;\n    }\n    throw this._fail();\n};\n\nSBVRParser.matchForAll = function(rule, arr) {\n    for (var idx = 0; idx < arr.length; idx++) this._applyWithArgs.call(this, rule, arr[idx]);\n};\n\nSBVRParser.exactly = function(wanted) {\n    if (wanted.toLowerCase() === this._apply(\"lowerCaseAnything\")) return wanted;\n    throw this._fail();\n};\n\nSBVRParser._disablePrependingInput();","/*\nCopyright (c) 2010 Ryan Schuft (ryan.schuft@gmail.com)\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in\nall copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\nTHE SOFTWARE.\n*/\n\n/*\n  This code is based in part on the work done in Ruby to support\n  infection as part of Ruby on Rails in the ActiveSupport's Inflector\n  and Inflections classes.  It was initally ported to Javascript by\n  Ryan Schuft (ryan.schuft@gmail.com) in 2007.\n\n  The code is available at http://code.google.com/p/inflection-js/\n\n  The basic usage is:\n    1. Include this script on your web page.\n    2. Call functions on any String object in Javascript\n\n  Currently implemented functions:\n\n    String.pluralize(plural) == String\n      renders a singular English language noun into its plural form\n      normal results can be overridden by passing in an alternative\n\n    String.singularize(singular) == String\n      renders a plural English language noun into its singular form\n      normal results can be overridden by passing in an alterative\n\n    String.camelize(lowFirstLetter) == String\n      renders a lower case underscored word into camel case\n      the first letter of the result will be upper case unless you pass true\n      also translates \"/\" into \"::\" (underscore does the opposite)\n\n    String.underscore() == String\n      renders a camel cased word into words seperated by underscores\n      also translates \"::\" back into \"/\" (camelize does the opposite)\n\n    String.humanize(lowFirstLetter) == String\n      renders a lower case and underscored word into human readable form\n      defaults to making the first letter capitalized unless you pass true\n\n    String.capitalize() == String\n      renders all characters to lower case and then makes the first upper\n\n    String.dasherize() == String\n      renders all underbars and spaces as dashes\n\n    String.titleize() == String\n      renders words into title casing (as for book titles)\n\n    String.demodulize() == String\n      renders class names that are prepended by modules into just the class\n\n    String.tableize() == String\n      renders camel cased singular words into their underscored plural form\n\n    String.classify() == String\n      renders an underscored plural word into its camel cased singular form\n\n    String.foreign_key(dropIdUbar) == String\n      renders a class name (camel cased singular noun) into a foreign key\n      defaults to seperating the class from the id with an underbar unless\n      you pass true\n\n    String.ordinalize() == String\n      renders all numbers found in the string into their sequence like \"22nd\"\n*/\n\n/*\n  This sets up a container for some constants in its own namespace\n  We use the window (if available) to enable dynamic loading of this script\n  Window won't necessarily exist for non-browsers.\n*/\nif (typeof window !== \"undefined\" && !window.InflectionJS)\n{\n    window.InflectionJS = null;\n}\n\n/*\n  This sets up some constants for later use\n  This should use the window namespace variable if available\n*/\nInflectionJS =\n{\n    /*\n      This is a list of nouns that use the same form for both singular and plural.\n      This list should remain entirely in lower case to correctly match Strings.\n    */\n    uncountable_words: [\n        'equipment', 'information', 'rice', 'money', 'species', 'series',\n        'fish', 'sheep', 'moose', 'deer', 'news'\n    ],\n\n    /*\n      These rules translate from the singular form of a noun to its plural form.\n    */\n    plural_rules: [\n        [new RegExp('(m)an$', 'gi'),                 '$1en'],\n        [new RegExp('(pe)rson$', 'gi'),              '$1ople'],\n        [new RegExp('(child)$', 'gi'),               '$1ren'],\n        [new RegExp('^(ox)$', 'gi'),                 '$1en'],\n        [new RegExp('(ax|test)is$', 'gi'),           '$1es'],\n        [new RegExp('(octop|vir)us$', 'gi'),         '$1i'],\n        [new RegExp('(alias|status)$', 'gi'),        '$1es'],\n        [new RegExp('(bu)s$', 'gi'),                 '$1ses'],\n        [new RegExp('(buffal|tomat|potat)o$', 'gi'), '$1oes'],\n        [new RegExp('([ti])um$', 'gi'),              '$1a'],\n        [new RegExp('sis$', 'gi'),                   'ses'],\n        [new RegExp('(?:([^f])fe|([lr])f)$', 'gi'),  '$1$2ves'],\n        [new RegExp('(hive)$', 'gi'),                '$1s'],\n        [new RegExp('([^aeiouy]|qu)y$', 'gi'),       '$1ies'],\n        [new RegExp('(x|ch|ss|sh)$', 'gi'),          '$1es'],\n        [new RegExp('(matr|vert|ind)ix|ex$', 'gi'),  '$1ices'],\n        [new RegExp('([m|l])ouse$', 'gi'),           '$1ice'],\n        [new RegExp('(quiz)$', 'gi'),                '$1zes'],\n        [new RegExp('s$', 'gi'),                     's'],\n        [new RegExp('$', 'gi'),                      's']\n    ],\n\n    /*\n      These rules translate from the plural form of a noun to its singular form.\n    */\n    singular_rules: [\n        [new RegExp('(m)en$', 'gi'),                                                       '$1an'],\n        [new RegExp('(pe)ople$', 'gi'),                                                    '$1rson'],\n        [new RegExp('(child)ren$', 'gi'),                                                  '$1'],\n        [new RegExp('([ti])a$', 'gi'),                                                     '$1um'],\n        [new RegExp('((a)naly|(b)a|(d)iagno|(p)arenthe|(p)rogno|(s)ynop|(t)he)ses$','gi'), '$1$2sis'],\n        [new RegExp('(hive)s$', 'gi'),                                                     '$1'],\n        [new RegExp('(tive)s$', 'gi'),                                                     '$1'],\n        [new RegExp('(curve)s$', 'gi'),                                                    '$1'],\n        [new RegExp('([lr])ves$', 'gi'),                                                   '$1f'],\n        [new RegExp('([^fo])ves$', 'gi'),                                                  '$1fe'],\n        [new RegExp('([^aeiouy]|qu)ies$', 'gi'),                                           '$1y'],\n        [new RegExp('(s)eries$', 'gi'),                                                    '$1eries'],\n        [new RegExp('(m)ovies$', 'gi'),                                                    '$1ovie'],\n        [new RegExp('(x|ch|ss|sh)es$', 'gi'),                                              '$1'],\n        [new RegExp('([m|l])ice$', 'gi'),                                                  '$1ouse'],\n        [new RegExp('(bus)es$', 'gi'),                                                     '$1'],\n        [new RegExp('(o)es$', 'gi'),                                                       '$1'],\n        [new RegExp('(shoe)s$', 'gi'),                                                     '$1'],\n        [new RegExp('(cris|ax|test)es$', 'gi'),                                            '$1is'],\n        [new RegExp('(octop|vir)i$', 'gi'),                                                '$1us'],\n        [new RegExp('(alias|status)es$', 'gi'),                                            '$1'],\n        [new RegExp('^(ox)en', 'gi'),                                                      '$1'],\n        [new RegExp('(vert|ind)ices$', 'gi'),                                              '$1ex'],\n        [new RegExp('(matr)ices$', 'gi'),                                                  '$1ix'],\n        [new RegExp('(quiz)zes$', 'gi'),                                                   '$1'],\n        [new RegExp('s$', 'gi'),                                                           '']\n    ],\n\n    /*\n      This is a list of words that should not be capitalized for title case\n    */\n    non_titlecased_words: [\n        'and', 'or', 'nor', 'a', 'an', 'the', 'so', 'but', 'to', 'of', 'at',\n        'by', 'from', 'into', 'on', 'onto', 'off', 'out', 'in', 'over',\n        'with', 'for'\n    ],\n\n    /*\n      These are regular expressions used for converting between String formats\n    */\n    id_suffix: new RegExp('(_ids|_id)$', 'g'),\n    underbar: new RegExp('_', 'g'),\n    space_or_underbar: new RegExp('[ _]', 'g'),\n    uppercase: new RegExp('([A-Z])', 'g'),\n    underbar_prefix: new RegExp('^_'),\n    \n    /*\n      This is a helper method that applies rules based replacement to a String\n      Signature:\n        InflectionJS.apply_rules(str, rules, skip, override) == String\n      Arguments:\n        str - String - String to modify and return based on the passed rules\n        rules - Array: [RegExp, String] - Regexp to match paired with String to use for replacement\n        skip - Array: [String] - Strings to skip if they match\n      Returns:\n        String - passed String modified by passed rules\n      Examples:\n        InflectionJS.apply_rules(\"cows\", InflectionJs.singular_rules) === 'cow'\n    */\n    apply_rules: function(str, rules, skip) {\n        if (skip.indexOf(str.toLowerCase()) === -1) {\n            for (var x = 0, l = rules.length; x < l; x++) {\n                if (rules[x][0].test(str)) {\n                    return str.replace(rules[x][0], rules[x][1]);\n                }\n            }\n        }\n        return str;\n    }\n};\n\n/*\n  This lets us detect if an Array contains a given element\n  Signature:\n    Array.indexOf(item, fromIndex, compareFunc) == Integer\n  Arguments:\n    item - Object - object to locate in the Array\n    fromIndex - Integer (optional) - starts checking from this position in the Array\n    compareFunc - Function (optional) - function used to compare Array item vs passed item\n  Returns:\n    Integer - index position in the Array of the passed item\n  Examples:\n    ['hi','there'].indexOf(\"guys\") === -1\n    ['hi','there'].indexOf(\"hi\") === 0\n*/\nif (!Array.prototype.indexOf)\n{\n    Array.prototype.indexOf = function(item, fromIndex, compareFunc)\n    {\n        if (!fromIndex)\n        {\n            fromIndex = -1;\n        }\n        var index = -1;\n        for (var i = fromIndex; i < this.length; i++)\n        {\n            if (this[i] === item || compareFunc && compareFunc(this[i], item))\n            {\n                index = i;\n                break;\n            }\n        }\n        return index;\n    };\n}\n\n/*\n  You can override this list for all Strings or just one depending on if you\n  set the new values on prototype or on a given String instance.\n*/\nif (!String.prototype._uncountable_words)\n{\n    String.prototype._uncountable_words = InflectionJS.uncountable_words;\n}\n\n/*\n  You can override this list for all Strings or just one depending on if you\n  set the new values on prototype or on a given String instance.\n*/\nif (!String.prototype._plural_rules)\n{\n    String.prototype._plural_rules = InflectionJS.plural_rules;\n}\n\n/*\n  You can override this list for all Strings or just one depending on if you\n  set the new values on prototype or on a given String instance.\n*/\nif (!String.prototype._singular_rules)\n{\n    String.prototype._singular_rules = InflectionJS.singular_rules;\n}\n\n/*\n  You can override this list for all Strings or just one depending on if you\n  set the new values on prototype or on a given String instance.\n*/\nif (!String.prototype._non_titlecased_words)\n{\n    String.prototype._non_titlecased_words = InflectionJS.non_titlecased_words;\n}\n\n/*\n  This function adds plurilization support to every String object\n    Signature:\n      String.pluralize(plural) == String\n    Arguments:\n      plural - String (optional) - overrides normal output with said String\n    Returns:\n      String - singular English language nouns are returned in plural form\n    Examples:\n      \"person\".pluralize() == \"people\"\n      \"octopus\".pluralize() == \"octopi\"\n      \"Hat\".pluralize() == \"Hats\"\n      \"person\".pluralize(\"guys\") == \"guys\"\n*/\nif (!String.prototype.pluralize) {\n    (function() {\n        var memo = {};\n        String.prototype.pluralize = function(plural) {\n            if(plural) {\n                return plural;\n            }\n            var thisString = this.toString();\n            if(!memo.hasOwnProperty(thisString)) {\n                memo[thisString] = InflectionJS.apply_rules(\n                    this.toString(),\n                    this._plural_rules,\n                    this._uncountable_words\n                );\n            }\n            return memo[thisString];\n        };\n    })();\n}\n\n/*\n  This function adds singularization support to every String object\n    Signature:\n      String.singularize(singular) == String\n    Arguments:\n      singular - String (optional) - overrides normal output with said String\n    Returns:\n      String - plural English language nouns are returned in singular form\n    Examples:\n      \"people\".singularize() == \"person\"\n      \"octopi\".singularize() == \"octopus\"\n      \"Hats\".singularize() == \"Hat\"\n      \"guys\".singularize(\"person\") == \"person\"\n*/\nif (!String.prototype.singularize) {\n    (function() {\n        var memo = {};\n        String.prototype.singularize = function(singular) {\n            if(singular) {\n                return singular;\n            }\n            var thisString = this.toString();\n            if(!memo.hasOwnProperty(thisString)) {\n                memo[thisString] = InflectionJS.apply_rules(\n                    thisString,\n                    this._singular_rules,\n                    this._uncountable_words\n                );\n            }\n            return memo[thisString];\n        };\n    })();\n}\n\n/*\n  This function adds camelization support to every String object\n    Signature:\n      String.camelize(lowFirstLetter) == String\n    Arguments:\n      lowFirstLetter - boolean (optional) - default is to capitalize the first\n        letter of the results... passing true will lowercase it\n    Returns:\n      String - lower case underscored words will be returned in camel case\n        additionally '/' is translated to '::'\n    Examples:\n      \"message_properties\".camelize() == \"MessageProperties\"\n      \"message_properties\".camelize(true) == \"messageProperties\"\n*/\nif (!String.prototype.camelize)\n{\n     String.prototype.camelize = function(lowFirstLetter)\n     {\n        var str = this.toLowerCase();\n        var str_path = str.split('/');\n        for (var i = 0; i < str_path.length; i++)\n        {\n            var str_arr = str_path[i].split('_');\n            var initX = ((lowFirstLetter && i + 1 === str_path.length) ? (1) : (0));\n            for (var x = initX; x < str_arr.length; x++)\n            {\n                str_arr[x] = str_arr[x].charAt(0).toUpperCase() + str_arr[x].substring(1);\n            }\n            str_path[i] = str_arr.join('');\n        }\n        str = str_path.join('::');\n        return str;\n    };\n}\n\n/*\n  This function adds underscore support to every String object\n    Signature:\n      String.underscore() == String\n    Arguments:\n      N/A\n    Returns:\n      String - camel cased words are returned as lower cased and underscored\n        additionally '::' is translated to '/'\n    Examples:\n      \"MessageProperties\".camelize() == \"message_properties\"\n      \"messageProperties\".underscore() == \"message_properties\"\n*/\nif (!String.prototype.underscore)\n{\n     String.prototype.underscore = function()\n     {\n        var str = this;\n        var str_path = str.split('::');\n        for (var i = 0; i < str_path.length; i++)\n        {\n            str_path[i] = str_path[i].replace(InflectionJS.uppercase, '_$1');\n            str_path[i] = str_path[i].replace(InflectionJS.underbar_prefix, '');\n        }\n        str = str_path.join('/').toLowerCase();\n        return str;\n    };\n}\n\n/*\n  This function adds humanize support to every String object\n    Signature:\n      String.humanize(lowFirstLetter) == String\n    Arguments:\n      lowFirstLetter - boolean (optional) - default is to capitalize the first\n        letter of the results... passing true will lowercase it\n    Returns:\n      String - lower case underscored words will be returned in humanized form\n    Examples:\n      \"message_properties\".humanize() == \"Message properties\"\n      \"message_properties\".humanize(true) == \"message properties\"\n*/\nif (!String.prototype.humanize)\n{\n    String.prototype.humanize = function(lowFirstLetter)\n    {\n        var str = this.toLowerCase();\n        str = str.replace(InflectionJS.id_suffix, '');\n        str = str.replace(InflectionJS.underbar, ' ');\n        if (!lowFirstLetter)\n        {\n            str = str.capitalize();\n        }\n        return str;\n    };\n}\n\n/*\n  This function adds capitalization support to every String object\n    Signature:\n      String.capitalize() == String\n    Arguments:\n      N/A\n    Returns:\n      String - all characters will be lower case and the first will be upper\n    Examples:\n      \"message_properties\".capitalize() == \"Message_properties\"\n      \"message properties\".capitalize() == \"Message properties\"\n*/\nif (!String.prototype.capitalize)\n{\n    String.prototype.capitalize = function()\n    {\n        var str = this.toLowerCase();\n        str = str.substring(0, 1).toUpperCase() + str.substring(1);\n        return str;\n    };\n}\n\n/*\n  This function adds dasherization support to every String object\n    Signature:\n      String.dasherize() == String\n    Arguments:\n      N/A\n    Returns:\n      String - replaces all spaces or underbars with dashes\n    Examples:\n      \"message_properties\".capitalize() == \"message-properties\"\n      \"Message Properties\".capitalize() == \"Message-Properties\"\n*/\nif (!String.prototype.dasherize)\n{\n    String.prototype.dasherize = function()\n    {\n        var str = this;\n        str = str.replace(InflectionJS.space_or_underbar, '-');\n        return str;\n    };\n}\n\n/*\n  This function adds titleize support to every String object\n    Signature:\n      String.titleize() == String\n    Arguments:\n      N/A\n    Returns:\n      String - capitalizes words as you would for a book title\n    Examples:\n      \"message_properties\".titleize() == \"Message Properties\"\n      \"message properties to keep\".titleize() == \"Message Properties to Keep\"\n*/\nif (!String.prototype.titleize)\n{\n    String.prototype.titleize = function()\n    {\n        var str = this.toLowerCase();\n        str = str.replace(InflectionJS.underbar, ' ');\n        var str_arr = str.split(' ');\n        for (var x = 0; x < str_arr.length; x++)\n        {\n            var d = str_arr[x].split('-');\n            for (var i = 0; i < d.length; i++)\n            {\n                if (this._non_titlecased_words.indexOf(d[i].toLowerCase()) < 0)\n                {\n                    d[i] = d[i].capitalize();\n                }\n            }\n            str_arr[x] = d.join('-');\n        }\n        str = str_arr.join(' ');\n        str = str.substring(0, 1).toUpperCase() + str.substring(1);\n        return str;\n    };\n}\n\n/*\n  This function adds demodulize support to every String object\n    Signature:\n      String.demodulize() == String\n    Arguments:\n      N/A\n    Returns:\n      String - removes module names leaving only class names (Ruby style)\n    Examples:\n      \"Message::Bus::Properties\".demodulize() == \"Properties\"\n*/\nif (!String.prototype.demodulize)\n{\n    String.prototype.demodulize = function()\n    {\n        var str = this;\n        var str_arr = str.split('::');\n        str = str_arr[str_arr.length - 1];\n        return str;\n    };\n}\n\n/*\n  This function adds tableize support to every String object\n    Signature:\n      String.tableize() == String\n    Arguments:\n      N/A\n    Returns:\n      String - renders camel cased words into their underscored plural form\n    Examples:\n      \"MessageBusProperty\".tableize() == \"message_bus_properties\"\n*/\nif (!String.prototype.tableize)\n{\n    String.prototype.tableize = function()\n    {\n        var str = this;\n        str = str.underscore().pluralize();\n        return str;\n    };\n}\n\n/*\n  This function adds classification support to every String object\n    Signature:\n      String.classify() == String\n    Arguments:\n      N/A\n    Returns:\n      String - underscored plural nouns become the camel cased singular form\n    Examples:\n      \"message_bus_properties\".classify() == \"MessageBusProperty\"\n*/\nif (!String.prototype.classify)\n{\n    String.prototype.classify = function()\n    {\n        var str = this;\n        str = str.camelize().singularize();\n        return str;\n    };\n}\n\n/*\n  This function adds foreign key support to every String object\n    Signature:\n      String.foreign_key(dropIdUbar) == String\n    Arguments:\n      dropIdUbar - boolean (optional) - default is to seperate id with an\n        underbar at the end of the class name, you can pass true to skip it\n    Returns:\n      String - camel cased singular class names become underscored with id\n    Examples:\n      \"MessageBusProperty\".foreign_key() == \"message_bus_property_id\"\n      \"MessageBusProperty\".foreign_key(true) == \"message_bus_propertyid\"\n*/\nif (!String.prototype.foreign_key)\n{\n    String.prototype.foreign_key = function(dropIdUbar)\n    {\n        var str = this;\n        str = str.demodulize().underscore() + ((dropIdUbar) ? ('') : ('_')) + 'id';\n        return str;\n    };\n}\n\n/*\n  This function adds ordinalize support to every String object\n    Signature:\n      String.ordinalize() == String\n    Arguments:\n      N/A\n    Returns:\n      String - renders all found numbers their sequence like \"22nd\"\n    Examples:\n      \"the 1 pitch\".ordinalize() == \"the 1st pitch\"\n*/\nif (!String.prototype.ordinalize)\n{\n    String.prototype.ordinalize = function()\n    {\n        var str = this;\n        var str_arr = str.split(' ');\n        for (var x = 0; x < str_arr.length; x++)\n        {\n            var i = parseInt(str_arr[x], 10);\n            if (i === NaN)\n            {\n                var ltd = str_arr[x].substring(str_arr[x].length - 2);\n                var ld = str_arr[x].substring(str_arr[x].length - 1);\n                var suf = \"th\";\n                if (ltd != \"11\" && ltd != \"12\" && ltd != \"13\")\n                {\n                    if (ld === \"1\")\n                    {\n                        suf = \"st\";\n                    }\n                    else if (ld === \"2\")\n                    {\n                        suf = \"nd\";\n                    }\n                    else if (ld === \"3\")\n                    {\n                        suf = \"rd\";\n                    }\n                }\n                str_arr[x] += suf;\n            }\n        }\n        str = str_arr.join(' ');\n        return str;\n    };\n}\n","module.exports = \"Vocabulary: Type\\nTerm:       Integer\\nTerm:       Real\\nTerm:       Text\\nTerm:       Date\\nTerm:       Date Time\\nTerm:       Time\\nTerm:       Interval\\nTerm:       File\\n\\nTerm:       Big Integer\\n\\tConcept type: Integer\\n\\nTerm:       Serial\\n\\tConcept Type: Integer\\n\\tNote: An auto-incrementing 'Integer'.\\nTerm:       Case Insensitive Text\\n\\tConcept Type: Text\\n\\tNote: A 'Text' type that is compared case insensitively.\\nTerm:       JSON\\n\\tConcept Type: Text\\n\\tNote: A 'Text' type that will only allow valid JSON.\\nTerm:       Hashed\\n\\tConcept Type: Text\\n\\tNote: A 'Text' type that will automatically be converted to a hash.\\nTerm:       SHA\\n\\tConcept Type: Text\\n\\tNote: A 'Text' type that will automatically be converted to a sha256 hash.\\n\\nTerm:       Length\\n\\tConcept Type: Integer\\n\\nName:       Current Time\\n\\tConcept Type: Date Time\\n\\nFact type:  Text has Length\\n\\tNote: Length in characters\\n\\tNecessity: Each Text has exactly one Length\\n\\nFact type:  Integer1 is less than Integer2\\n\\tSynonymous Form: Integer2 is greater than Integer1\\nFact type: Integer1 is less than or equal to Integer2\\n\\tSynonymous Form: Integer2 is greater than or equal to Integer1\\nFact type:  Integer1 is equal to Integer2\\n\\tSynonymous Form: Integer2 is equal to Integer1\\n\\tSynonymous Form: Integer1 equals Integer2\\n\\tSynonymous Form: Integer2 equals Integer1\\n\\nFact type:  Real1 is less than Real2\\n\\tSynonymous Form: Real2 is greater than Real1\\nFact type: Real1 is less than or equal to Real2\\n\\tSynonymous Form: Real2 is greater than or equal to Real1\\nFact type:  Real1 is equal to Real2\\n\\tSynonymous Form: Real2 is equal to Real1\\n\\tSynonymous Form: Real1 equals Real2\\n\\tSynonymous Form: Real2 equals Real1\\n\\nFact type:  Date1 is before Date2\\n\\tSynonymous Form: Date2 is after Date1\\nFact type:  Date1 is equal to Date2\\n\\tSynonymous Form: Date2 is equal to Date1\\n\\tSynonymous Form: Date1 equals Date2\\n\\tSynonymous Form: Date2 equals Date1\\n\\nFact type:  Date Time1 is before Date Time2\\n\\tSynonymous Form: Date Time2 is after Date Time1\\nFact type:  Date Time1 is equal to Date Time2\\n\\tSynonymous Form: Date Time2 is equal to Date Time1\\n\\tSynonymous Form: Date Time1 equals Date Time2\\n\\tSynonymous Form: Date Time2 equals Date Time1\\n\\n\\nFact type:  Real is less than Integer\\n\\tSynonymous Form: Integer is greater than Real\\nFact type:  Integer is less than Real\\n\\tSynonymous Form: Real is greater than Integer\\n\\nFact type: Real is less than or equal to Integer\\n\\tSynonymous Form: Integer is greater than or equal to Real\\nFact type: Integer is less than or equal to Real\\n\\tSynonymous Form: Real is greater than or equal to Integer\\n\\nFact type:  Integer is equal to Real\\n\\tSynonymous Form: Real is equal to Integer\\n\\tSynonymous Form: Real equals Integer\\n\\tSynonymous Form: Integer equals Real\\n\\n\\nFact type:  Text1 is equal to Text2\\n\\tSynonymous Form: Text2 is equal to Text1\\n\\tSynonymous Form: Text1 equals Text2\\n\\tSynonymous Form: Text2 equals Text1\\n\\nFact type:  Text1 starts with Text2\\n\\nFact type:  Text1 ends with Text2\\n\\nFact type:  Text1 contains Text2\\n\\tSynonymous Form: Text2 is contained in Text1\\n\\nTerm:       Short Text\\n\\tConcept Type: Text\\n\\t--Necessity: each Short Text has a Length that is less than or equal to 255.\\n\\nTerm:       Red Component\\n\\tConcept Type: Integer\\nTerm:       Green Component\\n\\tConcept Type: Integer\\nTerm:       Blue Component\\n\\tConcept Type: Integer\\nTerm:       Alpha Component\\n\\tConcept Type: Integer\\nTerm:       Color\\n\\tConcept Type: Integer\\nFact type:  Color has Red Component\\n\\tNecessity: Each Color has exactly one Red Component\\nFact type:  Color has Green Component\\n\\tNecessity: Each Color has exactly one Green Component\\nFact type:  Color has Blue Component\\n\\tNecessity: Each Color has exactly one Blue Component\\nFact type:  Color has Alpha Component\\n\\tNecessity: Each Color has exactly one Alpha Component\";","module.exports = \"Vocabulary: migrations\\r\\n\\r\\nTerm: model name\\r\\n\\tConcept Type: Short Text (Type)\\r\\nTerm: executed migrations\\r\\n\\tConcept Type: JSON (Type)\\r\\nTerm: lock time\\r\\n\\tConcept Type: Date Time (Type)\\r\\n\\r\\nTerm: migration\\r\\n\\tReference Scheme: model name\\r\\n\\tDatabase ID Field: model name\\r\\nFact Type: migration has model name\\r\\n\\tNecessity: each migration has exactly one model name\\r\\nFact Type: migration has executed migrations\\r\\n\\tNecessity: each migration has exactly one executed migrations\\r\\n\\r\\nTerm: migration lock\\r\\n\\tReference Scheme: model name\\r\\n\\tDatabase ID Field: model name\\r\\n\\r\\nFact Type: migration lock has model name\\r\\n\\tNecessity: each migration lock has exactly one model name\\r\\n\";","import type {\n\tAbstractSqlModel,\n\tAbstractSqlTable,\n} from '@balena/abstract-sql-compiler';\n\nimport * as sbvrTypes from '@balena/sbvr-types';\n\n// tslint:disable-next-line:no-var-requires\nconst { version }: { version: string } = require('../../package.json');\n\nconst getResourceName = (resourceName: string): string =>\n\tresourceName\n\t\t.split('-')\n\t\t.map((namePart) => namePart.split(' ').join('_'))\n\t\t.join('__');\n\nconst forEachUniqueTable = <T>(\n\tmodel: AbstractSqlModel['tables'],\n\tcallback: (tableName: string, table: AbstractSqlTable) => T,\n): T[] => {\n\tconst usedTableNames: { [tableName: string]: true } = {};\n\n\tconst result = [];\n\tfor (const key in model) {\n\t\tif (model.hasOwnProperty(key)) {\n\t\t\tconst table = model[key];\n\t\t\tif (\n\t\t\t\ttypeof table !== 'string' &&\n\t\t\t\t!table.primitive &&\n\t\t\t\t!usedTableNames[table.name]\n\t\t\t) {\n\t\t\t\tusedTableNames[table.name] = true;\n\t\t\t\tresult.push(callback(key, table));\n\t\t\t}\n\t\t}\n\t}\n\treturn result;\n};\n\nexport const generateODataMetadata = (\n\tvocabulary: string,\n\tabstractSqlModel: AbstractSqlModel,\n) => {\n\tconst complexTypes: { [fieldType: string]: string } = {};\n\tconst resolveDataType = (fieldType: string): string => {\n\t\tif (sbvrTypes[fieldType] == null) {\n\t\t\tconsole.error('Could not resolve type', fieldType);\n\t\t\tthrow new Error('Could not resolve type' + fieldType);\n\t\t}\n\t\tconst { complexType } = sbvrTypes[fieldType].types.odata;\n\t\tif (complexType != null) {\n\t\t\tcomplexTypes[fieldType] = complexType;\n\t\t}\n\t\treturn sbvrTypes[fieldType].types.odata.name;\n\t};\n\n\tconst model = abstractSqlModel.tables;\n\tconst associations: Array<{\n\t\tname: string;\n\t\tends: Array<{\n\t\t\tresourceName: string;\n\t\t\tcardinality: '1' | '0..1' | '*';\n\t\t}>;\n\t}> = [];\n\tforEachUniqueTable(model, (_key, { name: resourceName, fields }) => {\n\t\tresourceName = getResourceName(resourceName);\n\t\tfor (const { dataType, required, references } of fields) {\n\t\t\tif (dataType === 'ForeignKey' && references != null) {\n\t\t\t\tconst { resourceName: referencedResource } = references;\n\t\t\t\tassociations.push({\n\t\t\t\t\tname: resourceName + referencedResource,\n\t\t\t\t\tends: [\n\t\t\t\t\t\t{ resourceName, cardinality: required ? '1' : '0..1' },\n\t\t\t\t\t\t{ resourceName: referencedResource, cardinality: '*' },\n\t\t\t\t\t],\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t});\n\n\treturn (\n\t\t`\n\t\t<?xml version=\"1.0\" encoding=\"iso-8859-1\" standalone=\"yes\"?>\n\t\t<edmx:Edmx Version=\"1.0\" xmlns:edmx=\"http://schemas.microsoft.com/ado/2007/06/edmx\">\n\t\t\t<edmx:DataServices xmlns:m=\"http://schemas.microsoft.com/ado/2007/08/dataservices/metadata\" m:DataServiceVersion=\"2.0\">\n\t\t\t\t<Schema Namespace=\"${vocabulary}\"\n\t\t\t\t\txmlns:d=\"http://schemas.microsoft.com/ado/2007/08/dataservices\"\n\t\t\t\t\txmlns:m=\"http://schemas.microsoft.com/ado/2007/08/dataservices/metadata\"\n\t\t\t\t\txmlns=\"http://schemas.microsoft.com/ado/2008/09/edm\">\n\n\t\t\t\t` +\n\t\tforEachUniqueTable(\n\t\t\tmodel,\n\t\t\t(_key, { idField, name: resourceName, fields }) => {\n\t\t\t\tresourceName = getResourceName(resourceName);\n\t\t\t\treturn (\n\t\t\t\t\t`\n\t\t\t\t\t<EntityType Name=\"${resourceName}\">\n\t\t\t\t\t\t<Key>\n\t\t\t\t\t\t\t<PropertyRef Name=\"${idField}\" />\n\t\t\t\t\t\t</Key>\n\n\t\t\t\t\t\t` +\n\t\t\t\t\tfields\n\t\t\t\t\t\t.filter(({ dataType }) => dataType !== 'ForeignKey')\n\t\t\t\t\t\t.map(({ dataType, fieldName, required }) => {\n\t\t\t\t\t\t\tdataType = resolveDataType(dataType);\n\t\t\t\t\t\t\tfieldName = getResourceName(fieldName);\n\t\t\t\t\t\t\treturn `<Property Name=\"${fieldName}\" Type=\"${dataType}\" Nullable=\"${!required}\" />`;\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.join('\\n') +\n\t\t\t\t\t'\\n' +\n\t\t\t\t\tfields\n\t\t\t\t\t\t.filter(\n\t\t\t\t\t\t\t({ dataType, references }) =>\n\t\t\t\t\t\t\t\tdataType === 'ForeignKey' && references != null,\n\t\t\t\t\t\t)\n\t\t\t\t\t\t.map(({ fieldName, references }) => {\n\t\t\t\t\t\t\tconst { resourceName: referencedResource } = references!;\n\t\t\t\t\t\t\tfieldName = getResourceName(fieldName);\n\t\t\t\t\t\t\treturn `<NavigationProperty Name=\"${fieldName}\" Relationship=\"${vocabulary}.${\n\t\t\t\t\t\t\t\tresourceName + referencedResource\n\t\t\t\t\t\t\t}\" FromRole=\"${resourceName}\" ToRole=\"${referencedResource}\" />`;\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.join('\\n') +\n\t\t\t\t\t'\\n' +\n\t\t\t\t\t`\n\t\t\t\t\t</EntityType>`\n\t\t\t\t);\n\t\t\t},\n\t\t).join('\\n\\n') +\n\t\tassociations\n\t\t\t.map(({ name, ends }) => {\n\t\t\t\tname = getResourceName(name);\n\t\t\t\treturn (\n\t\t\t\t\t`<Association Name=\"${name}\">` +\n\t\t\t\t\t'\\n\\t' +\n\t\t\t\t\tends\n\t\t\t\t\t\t.map(\n\t\t\t\t\t\t\t({ resourceName, cardinality }) =>\n\t\t\t\t\t\t\t\t`<End Role=\"${resourceName}\" Type=\"${vocabulary}.${resourceName}\" Multiplicity=\"${cardinality}\" />`,\n\t\t\t\t\t\t)\n\t\t\t\t\t\t.join('\\n\\t') +\n\t\t\t\t\t'\\n' +\n\t\t\t\t\t`</Association>`\n\t\t\t\t);\n\t\t\t})\n\t\t\t.join('\\n') +\n\t\t`\n\t\t\t\t\t<EntityContainer Name=\"${vocabulary}Service\" m:IsDefaultEntityContainer=\"true\">\n\n\t\t\t\t\t` +\n\t\tforEachUniqueTable(model, (_key, { name: resourceName }) => {\n\t\t\tresourceName = getResourceName(resourceName);\n\t\t\treturn `<EntitySet Name=\"${resourceName}\" EntityType=\"${vocabulary}.${resourceName}\" />`;\n\t\t}).join('\\n') +\n\t\t'\\n' +\n\t\tassociations\n\t\t\t.map(({ name, ends }) => {\n\t\t\t\tname = getResourceName(name);\n\t\t\t\treturn (\n\t\t\t\t\t`<AssociationSet Name=\"${name}\" Association=\"${vocabulary}.${name}\">` +\n\t\t\t\t\t'\\n\\t' +\n\t\t\t\t\tends\n\t\t\t\t\t\t.map(\n\t\t\t\t\t\t\t({ resourceName }) =>\n\t\t\t\t\t\t\t\t`<End Role=\"${resourceName}\" EntitySet=\"${vocabulary}.${resourceName}\" />`,\n\t\t\t\t\t\t)\n\t\t\t\t\t\t.join('\\n\\t') +\n\t\t\t\t\t`\n\t\t\t\t\t\t\t\t</AssociationSet>`\n\t\t\t\t);\n\t\t\t})\n\t\t\t.join('\\n') +\n\t\t`\n\t\t\t\t\t</EntityContainer>` +\n\t\tObject.values(complexTypes).join('\\n') +\n\t\t`\n\t\t\t\t</Schema>\n\t\t\t</edmx:DataServices>\n\t\t</edmx:Edmx>`\n\t);\n};\n\ngenerateODataMetadata.version = version;\n","module.exports = \"Vocabulary: dev\\r\\n\\r\\nTerm:       model value\\r\\n\\tConcept Type: JSON (Type)\\r\\nTerm:       model\\r\\n\\tReference Scheme: model value\\r\\nTerm:       vocabulary\\r\\n\\tConcept Type: Short Text (Type)\\r\\nTerm:       model type\\r\\n\\tConcept Type: Short Text (Type)\\r\\n\\r\\nFact Type: model is of vocabulary\\r\\n\\tNecessity: Each model is of exactly one vocabulary\\r\\nFact Type: model has model type\\r\\n\\tNecessity: Each model has exactly one model type\\r\\nFact Type: model has model value\\r\\n\\tNecessity: Each model has exactly one model value\\r\\n\";","\"use strict\";\n\nvar customError      = require(\"es5-ext/error/custom\")\n  , defineLength     = require(\"es5-ext/function/_define-length\")\n  , partial          = require(\"es5-ext/function/#/partial\")\n  , copy             = require(\"es5-ext/object/copy\")\n  , normalizeOpts    = require(\"es5-ext/object/normalize-options\")\n  , callable         = require(\"es5-ext/object/valid-callable\")\n  , d                = require(\"d\")\n  , WeakMap          = require(\"es6-weak-map\")\n  , resolveLength    = require(\"./resolve-length\")\n  , extensions       = require(\"./registered-extensions\")\n  , resolveResolve   = require(\"./resolve-resolve\")\n  , resolveNormalize = require(\"./resolve-normalize\");\n\nvar slice = Array.prototype.slice, defineProperties = Object.defineProperties;\n\nmodule.exports = function (memoize) {\n\treturn function (fn/*, options*/) {\n\t\tvar map, length, options = normalizeOpts(arguments[1]), memoized, resolve, normalizer;\n\n\t\tcallable(fn);\n\n\t\t// Do not memoize already memoized function\n\t\tif (hasOwnProperty.call(fn, \"__memoized__\") && !options.force) return fn;\n\n\t\tlength = resolveLength(options.length, fn.length, options.async && extensions.async);\n\t\toptions.length = length ? length - 1 : 0;\n\t\tmap = new WeakMap();\n\n\t\tif (options.resolvers) resolve = resolveResolve(options.resolvers);\n\t\tif (options.normalizer) normalizer = resolveNormalize(options.normalizer);\n\n\t\tif (\n\t\t\tlength === 1 &&\n\t\t\t!normalizer &&\n\t\t\t!options.async &&\n\t\t\t!options.dispose &&\n\t\t\t!options.maxAge &&\n\t\t\t!options.max &&\n\t\t\t!options.refCounter\n\t\t) {\n\t\t\treturn defineProperties(\n\t\t\t\tfunction (obj) {\n\t\t\t\t\tvar result, args = arguments;\n\t\t\t\t\tif (resolve) args = resolve(args);\n\t\t\t\t\tobj = args[0];\n\t\t\t\t\tif (map.has(obj)) return map.get(obj);\n\t\t\t\t\tresult = fn.apply(this, args);\n\t\t\t\t\tif (map.has(obj)) {\n\t\t\t\t\t\tthrow customError(\"Circular invocation\", \"CIRCULAR_INVOCATION\");\n\t\t\t\t\t}\n\t\t\t\t\tmap.set(obj, result);\n\t\t\t\t\treturn result;\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t__memoized__: d(true),\n\t\t\t\t\tdelete: d(function (obj) {\n\t\t\t\t\t\tif (resolve) obj = resolve(arguments)[0];\n\t\t\t\t\t\treturn map.delete(obj);\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t\tmemoized = defineProperties(\n\t\t\tdefineLength(function (obj) {\n\t\t\t\tvar memoizer, args = arguments;\n\t\t\t\tif (resolve) {\n\t\t\t\t\targs = resolve(args);\n\t\t\t\t\tobj = args[0];\n\t\t\t\t}\n\t\t\t\tmemoizer = map.get(obj);\n\t\t\t\tif (!memoizer) {\n\t\t\t\t\tif (normalizer) {\n\t\t\t\t\t\toptions = copy(options);\n\t\t\t\t\t\toptions.normalizer = copy(normalizer);\n\t\t\t\t\t\toptions.normalizer.get = partial.call(options.normalizer.get, obj);\n\t\t\t\t\t\toptions.normalizer.set = partial.call(options.normalizer.set, obj);\n\t\t\t\t\t\tif (options.normalizer.delete) {\n\t\t\t\t\t\t\toptions.normalizer.delete = partial.call(\n\t\t\t\t\t\t\t\toptions.normalizer.delete, obj\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tmap.set(obj, memoizer = memoize(partial.call(fn, obj), options));\n\t\t\t\t}\n\t\t\t\treturn memoizer.apply(this, slice.call(args, 1));\n\t\t\t}, length),\n\t\t\t{\n\t\t\t\t__memoized__: d(true),\n\t\t\t\tdelete: d(\n\t\t\t\t\tdefineLength(function (obj) {\n\t\t\t\t\t\tvar memoizer, args = arguments;\n\t\t\t\t\t\tif (resolve) {\n\t\t\t\t\t\t\targs = resolve(args);\n\t\t\t\t\t\t\tobj = args[0];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tmemoizer = map.get(obj);\n\t\t\t\t\t\tif (!memoizer) return;\n\t\t\t\t\t\tmemoizer.delete.apply(this, slice.call(args, 1));\n\t\t\t\t\t}, length)\n\t\t\t\t)\n\t\t\t}\n\t\t);\n\t\tif (!options.refCounter) return memoized;\n\t\tdefineProperties(memoized, {\n\t\t\tdeleteRef: d(\n\t\t\t\tdefineLength(function (obj) {\n\t\t\t\t\tvar memoizer, args = arguments;\n\t\t\t\t\tif (resolve) {\n\t\t\t\t\t\targs = resolve(args);\n\t\t\t\t\t\tobj = args[0];\n\t\t\t\t\t}\n\t\t\t\t\tmemoizer = map.get(obj);\n\t\t\t\t\tif (!memoizer) return null;\n\t\t\t\t\treturn memoizer.deleteRef.apply(this, slice.call(args, 1));\n\t\t\t\t}, length)\n\t\t\t),\n\t\t\tgetRefCount: d(\n\t\t\t\tdefineLength(function (obj) {\n\t\t\t\t\tvar memoizer, args = arguments;\n\t\t\t\t\tif (resolve) {\n\t\t\t\t\t\targs = resolve(args);\n\t\t\t\t\t\tobj = args[0];\n\t\t\t\t\t}\n\t\t\t\t\tmemoizer = map.get(obj);\n\t\t\t\t\tif (!memoizer) return 0;\n\t\t\t\t\treturn memoizer.getRefCount.apply(this, slice.call(args, 1));\n\t\t\t\t}, length)\n\t\t\t)\n\t\t});\n\t\treturn memoized;\n\t};\n};\n","\"use strict\";\n\nvar callable     = require(\"../../object/valid-callable\")\n  , aFrom        = require(\"../../array/from\")\n  , defineLength = require(\"../_define-length\")\n  , apply        = Function.prototype.apply;\n\nmodule.exports = function (/* args*/) {\n\tvar fn = callable(this), args = aFrom(arguments);\n\n\treturn defineLength(function () {\n\t\treturn apply.call(fn, this, args.concat(aFrom(arguments)));\n\t}, fn.length - args.length);\n};\n","\"use strict\";\n\nmodule.exports = require(\"./is-implemented\")() ? WeakMap : require(\"./polyfill\");\n","\"use strict\";\n\nmodule.exports = function () {\n\tvar weakMap, obj;\n\n\tif (typeof WeakMap !== \"function\") return false;\n\ttry {\n\t\t// WebKit doesn't support arguments and crashes\n\t\tweakMap = new WeakMap([[obj = {}, \"one\"], [{}, \"two\"], [{}, \"three\"]]);\n\t} catch (e) {\n\t\treturn false;\n\t}\n\tif (String(weakMap) !== \"[object WeakMap]\") return false;\n\tif (typeof weakMap.set !== \"function\") return false;\n\tif (weakMap.set({}, 1) !== weakMap) return false;\n\tif (typeof weakMap.delete !== \"function\") return false;\n\tif (typeof weakMap.has !== \"function\") return false;\n\tif (weakMap.get(obj) !== \"one\") return false;\n\n\treturn true;\n};\n","\"use strict\";\n\nvar isValue           = require(\"es5-ext/object/is-value\")\n  , setPrototypeOf    = require(\"es5-ext/object/set-prototype-of\")\n  , object            = require(\"es5-ext/object/valid-object\")\n  , ensureValue       = require(\"es5-ext/object/valid-value\")\n  , randomUniq        = require(\"es5-ext/string/random-uniq\")\n  , d                 = require(\"d\")\n  , getIterator       = require(\"es6-iterator/get\")\n  , forOf             = require(\"es6-iterator/for-of\")\n  , toStringTagSymbol = require(\"es6-symbol\").toStringTag\n  , isNative          = require(\"./is-native-implemented\")\n\n  , isArray = Array.isArray, defineProperty = Object.defineProperty\n  , objHasOwnProperty = Object.prototype.hasOwnProperty, getPrototypeOf = Object.getPrototypeOf\n  , WeakMapPoly;\n\nmodule.exports = WeakMapPoly = function (/* Iterable*/) {\n\tvar iterable = arguments[0], self;\n\n\tif (!(this instanceof WeakMapPoly)) throw new TypeError(\"Constructor requires 'new'\");\n\tself = isNative && setPrototypeOf && (WeakMap !== WeakMapPoly)\n\t\t? setPrototypeOf(new WeakMap(), getPrototypeOf(this)) : this;\n\n\tif (isValue(iterable)) {\n\t\tif (!isArray(iterable)) iterable = getIterator(iterable);\n\t}\n\tdefineProperty(self, \"__weakMapData__\", d(\"c\", \"$weakMap$\" + randomUniq()));\n\tif (!iterable) return self;\n\tforOf(iterable, function (val) {\n\t\tensureValue(val);\n\t\tself.set(val[0], val[1]);\n\t});\n\treturn self;\n};\n\nif (isNative) {\n\tif (setPrototypeOf) setPrototypeOf(WeakMapPoly, WeakMap);\n\tWeakMapPoly.prototype = Object.create(WeakMap.prototype, { constructor: d(WeakMapPoly) });\n}\n\nObject.defineProperties(WeakMapPoly.prototype, {\n\tdelete: d(function (key) {\n\t\tif (objHasOwnProperty.call(object(key), this.__weakMapData__)) {\n\t\t\tdelete key[this.__weakMapData__];\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}),\n\tget: d(function (key) {\n\t\tif (!objHasOwnProperty.call(object(key), this.__weakMapData__)) return undefined;\n\t\treturn key[this.__weakMapData__];\n\t}),\n\thas: d(function (key) {\n\t\treturn objHasOwnProperty.call(object(key), this.__weakMapData__);\n\t}),\n\tset: d(function (key, value) {\n\t\tdefineProperty(object(key), this.__weakMapData__, d(\"c\", value));\n\t\treturn this;\n\t}),\n\ttoString: d(function () {\n\t\treturn \"[object WeakMap]\";\n\t})\n});\ndefineProperty(WeakMapPoly.prototype, toStringTagSymbol, d(\"c\", \"WeakMap\"));\n","// Workaround for http://code.google.com/p/v8/issues/detail?id=2804\n\n\"use strict\";\n\nvar create = Object.create, shim;\n\nif (!require(\"./set-prototype-of/is-implemented\")()) {\n\tshim = require(\"./set-prototype-of/shim\");\n}\n\nmodule.exports = (function () {\n\tvar nullObject, polyProps, desc;\n\tif (!shim) return create;\n\tif (shim.level !== 1) return create;\n\n\tnullObject = {};\n\tpolyProps = {};\n\tdesc = { configurable: false, enumerable: false, writable: true, value: undefined };\n\tObject.getOwnPropertyNames(Object.prototype).forEach(function (name) {\n\t\tif (name === \"__proto__\") {\n\t\t\tpolyProps[name] = {\n\t\t\t\tconfigurable: true,\n\t\t\t\tenumerable: false,\n\t\t\t\twritable: true,\n\t\t\t\tvalue: undefined\n\t\t\t};\n\t\t\treturn;\n\t\t}\n\t\tpolyProps[name] = desc;\n\t});\n\tObject.defineProperties(nullObject, polyProps);\n\n\tObject.defineProperty(shim, \"nullPolyfill\", {\n\t\tconfigurable: false,\n\t\tenumerable: false,\n\t\twritable: false,\n\t\tvalue: nullObject\n\t});\n\n\treturn function (prototype, props) {\n\t\treturn create(prototype === null ? nullObject : prototype, props);\n\t};\n})();\n","\"use strict\";\n\nvar isObject = require(\"./is-object\");\n\nmodule.exports = function (value) {\n\tif (!isObject(value)) throw new TypeError(value + \" is not an Object\");\n\treturn value;\n};\n","\"use strict\";\n\nvar generated = Object.create(null), random = Math.random;\n\nmodule.exports = function () {\n\tvar str;\n\tdo {\n\t\tstr = random().toString(36).slice(2);\n\t} while (generated[str]);\n\treturn str;\n};\n","\"use strict\";\n\nvar setPrototypeOf = require(\"es5-ext/object/set-prototype-of\")\n  , contains       = require(\"es5-ext/string/#/contains\")\n  , d              = require(\"d\")\n  , Symbol         = require(\"es6-symbol\")\n  , Iterator       = require(\"./\");\n\nvar defineProperty = Object.defineProperty, ArrayIterator;\n\nArrayIterator = module.exports = function (arr, kind) {\n\tif (!(this instanceof ArrayIterator)) throw new TypeError(\"Constructor requires 'new'\");\n\tIterator.call(this, arr);\n\tif (!kind) kind = \"value\";\n\telse if (contains.call(kind, \"key+value\")) kind = \"key+value\";\n\telse if (contains.call(kind, \"key\")) kind = \"key\";\n\telse kind = \"value\";\n\tdefineProperty(this, \"__kind__\", d(\"\", kind));\n};\nif (setPrototypeOf) setPrototypeOf(ArrayIterator, Iterator);\n\n// Internal %ArrayIteratorPrototype% doesn't expose its constructor\ndelete ArrayIterator.prototype.constructor;\n\nArrayIterator.prototype = Object.create(Iterator.prototype, {\n\t_resolve: d(function (i) {\n\t\tif (this.__kind__ === \"value\") return this.__list__[i];\n\t\tif (this.__kind__ === \"key+value\") return [i, this.__list__[i]];\n\t\treturn i;\n\t})\n});\ndefineProperty(ArrayIterator.prototype, Symbol.toStringTag, d(\"c\", \"Array Iterator\"));\n","// Inspired by Google Closure:\n// http://closure-library.googlecode.com/svn/docs/\n// closure_goog_array_array.js.html#goog.array.clear\n\n\"use strict\";\n\nvar value = require(\"../../object/valid-value\");\n\nmodule.exports = function () {\n\tvalue(this).length = 0;\n\treturn this;\n};\n","\"use strict\";\n\nvar isValue             = require(\"type/value/is\")\n  , ensureValue         = require(\"type/value/ensure\")\n  , ensurePlainFunction = require(\"type/plain-function/ensure\")\n  , copy                = require(\"es5-ext/object/copy\")\n  , normalizeOptions    = require(\"es5-ext/object/normalize-options\")\n  , map                 = require(\"es5-ext/object/map\");\n\nvar bind = Function.prototype.bind\n  , defineProperty = Object.defineProperty\n  , hasOwnProperty = Object.prototype.hasOwnProperty\n  , define;\n\ndefine = function (name, desc, options) {\n\tvar value = ensureValue(desc) && ensurePlainFunction(desc.value), dgs;\n\tdgs = copy(desc);\n\tdelete dgs.writable;\n\tdelete dgs.value;\n\tdgs.get = function () {\n\t\tif (!options.overwriteDefinition && hasOwnProperty.call(this, name)) return value;\n\t\tdesc.value = bind.call(value, options.resolveContext ? options.resolveContext(this) : this);\n\t\tdefineProperty(this, name, desc);\n\t\treturn this[name];\n\t};\n\treturn dgs;\n};\n\nmodule.exports = function (props/*, options*/) {\n\tvar options = normalizeOptions(arguments[1]);\n\tif (isValue(options.resolveContext)) ensurePlainFunction(options.resolveContext);\n\treturn map(props, function (desc, name) { return define(name, desc, options); });\n};\n","\"use strict\";\n\nvar resolveException = require(\"../lib/resolve-exception\")\n  , is               = require(\"./is\");\n\nmodule.exports = function (value/*, options*/) {\n\tif (is(value)) return value;\n\treturn resolveException(value, \"Cannot use %v\", arguments[1]);\n};\n","\"use strict\";\n\nvar isValue  = require(\"../value/is\")\n  , isObject = require(\"../object/is\");\n\nvar objectToString = Object.prototype.toString;\n\nmodule.exports = function (value) {\n\tif (!isValue(value)) return null;\n\tif (isObject(value)) {\n\t\t// Reject Object.prototype.toString coercion\n\t\tvar valueToString = value.toString;\n\t\tif (typeof valueToString !== \"function\") return null;\n\t\tif (valueToString === objectToString) return null;\n\t\t// Note: It can be object coming from other realm, still as there's no ES3 and CSP compliant\n\t\t// way to resolve its realm's Object.prototype.toString it's left as not addressed edge case\n\t}\n\ttry {\n\t\treturn \"\" + value; // Ensure implicit coercion\n\t} catch (error) {\n\t\treturn null;\n\t}\n};\n","\"use strict\";\n\nvar safeToString = require(\"./safe-to-string\");\n\nvar reNewLine = /[\\n\\r\\u2028\\u2029]/g;\n\nmodule.exports = function (value) {\n\tvar string = safeToString(value);\n\tif (string === null) return \"<Non-coercible to string value>\";\n\t// Trim if too long\n\tif (string.length > 100) string = string.slice(0, 99) + \"\";\n\t// Replace eventual new lines\n\tstring = string.replace(reNewLine, function (char) {\n\t\tswitch (char) {\n\t\t\tcase \"\\n\":\n\t\t\t\treturn \"\\\\n\";\n\t\t\tcase \"\\r\":\n\t\t\t\treturn \"\\\\r\";\n\t\t\tcase \"\\u2028\":\n\t\t\t\treturn \"\\\\u2028\";\n\t\t\tcase \"\\u2029\":\n\t\t\t\treturn \"\\\\u2029\";\n\t\t\t/* istanbul ignore next */\n\t\t\tdefault:\n\t\t\t\tthrow new Error(\"Unexpected character\");\n\t\t}\n\t});\n\treturn string;\n};\n","\"use strict\";\n\nmodule.exports = function (value) {\n\ttry {\n\t\treturn value.toString();\n\t} catch (error) {\n\t\ttry { return String(value); }\n\t\tcatch (error2) { return null; }\n\t}\n};\n","\"use strict\";\n\nvar resolveException = require(\"../lib/resolve-exception\")\n  , is               = require(\"./is\");\n\nmodule.exports = function (value/*, options*/) {\n\tif (is(value)) return value;\n\treturn resolveException(value, \"%v is not a plain function\", arguments[1]);\n};\n","// Thanks @mathiasbynens\n// http://mathiasbynens.be/notes/javascript-unicode#iterating-over-symbols\n\n\"use strict\";\n\nvar setPrototypeOf = require(\"es5-ext/object/set-prototype-of\")\n  , d              = require(\"d\")\n  , Symbol         = require(\"es6-symbol\")\n  , Iterator       = require(\"./\");\n\nvar defineProperty = Object.defineProperty, StringIterator;\n\nStringIterator = module.exports = function (str) {\n\tif (!(this instanceof StringIterator)) throw new TypeError(\"Constructor requires 'new'\");\n\tstr = String(str);\n\tIterator.call(this, str);\n\tdefineProperty(this, \"__length__\", d(\"\", str.length));\n};\nif (setPrototypeOf) setPrototypeOf(StringIterator, Iterator);\n\n// Internal %ArrayIteratorPrototype% doesn't expose its constructor\ndelete StringIterator.prototype.constructor;\n\nStringIterator.prototype = Object.create(Iterator.prototype, {\n\t_next: d(function () {\n\t\tif (!this.__list__) return undefined;\n\t\tif (this.__nextIndex__ < this.__length__) return this.__nextIndex__++;\n\t\tthis._unBind();\n\t\treturn undefined;\n\t}),\n\t_resolve: d(function (i) {\n\t\tvar char = this.__list__[i], code;\n\t\tif (this.__nextIndex__ === this.__length__) return char;\n\t\tcode = char.charCodeAt(0);\n\t\tif (code >= 0xd800 && code <= 0xdbff) return char + this.__list__[this.__nextIndex__++];\n\t\treturn char;\n\t})\n});\ndefineProperty(StringIterator.prototype, Symbol.toStringTag, d(\"c\", \"String Iterator\"));\n","\"use strict\";\n\nvar isIterable = require(\"./is-iterable\");\n\nmodule.exports = function (value) {\n\tif (!isIterable(value)) throw new TypeError(value + \" is not iterable\");\n\treturn value;\n};\n","\"use strict\";\n\nvar isArguments = require(\"es5-ext/function/is-arguments\")\n  , isValue     = require(\"es5-ext/object/is-value\")\n  , isString    = require(\"es5-ext/string/is-string\");\n\nvar iteratorSymbol = require(\"es6-symbol\").iterator\n  , isArray        = Array.isArray;\n\nmodule.exports = function (value) {\n\tif (!isValue(value)) return false;\n\tif (isArray(value)) return true;\n\tif (isString(value)) return true;\n\tif (isArguments(value)) return true;\n\treturn typeof value[iteratorSymbol] === \"function\";\n};\n","\"use strict\";\n\nvar isArguments = require(\"es5-ext/function/is-arguments\")\n  , callable    = require(\"es5-ext/object/valid-callable\")\n  , isString    = require(\"es5-ext/string/is-string\")\n  , get         = require(\"./get\");\n\nvar isArray = Array.isArray, call = Function.prototype.call, some = Array.prototype.some;\n\nmodule.exports = function (iterable, cb /*, thisArg*/) {\n\tvar mode, thisArg = arguments[2], result, doBreak, broken, i, length, char, code;\n\tif (isArray(iterable) || isArguments(iterable)) mode = \"array\";\n\telse if (isString(iterable)) mode = \"string\";\n\telse iterable = get(iterable);\n\n\tcallable(cb);\n\tdoBreak = function () {\n\t\tbroken = true;\n\t};\n\tif (mode === \"array\") {\n\t\tsome.call(iterable, function (value) {\n\t\t\tcall.call(cb, thisArg, value, doBreak);\n\t\t\treturn broken;\n\t\t});\n\t\treturn;\n\t}\n\tif (mode === \"string\") {\n\t\tlength = iterable.length;\n\t\tfor (i = 0; i < length; ++i) {\n\t\t\tchar = iterable[i];\n\t\t\tif (i + 1 < length) {\n\t\t\t\tcode = char.charCodeAt(0);\n\t\t\t\tif (code >= 0xd800 && code <= 0xdbff) char += iterable[++i];\n\t\t\t}\n\t\t\tcall.call(cb, thisArg, char, doBreak);\n\t\t\tif (broken) break;\n\t\t}\n\t\treturn;\n\t}\n\tresult = iterable.next();\n\n\twhile (!result.done) {\n\t\tcall.call(cb, thisArg, result.value, doBreak);\n\t\tif (broken) return;\n\t\tresult = iterable.next();\n\t}\n};\n","// Exports true if environment provides native `WeakMap` implementation, whatever that is.\n\n\"use strict\";\n\nmodule.exports = (function () {\n\tif (typeof WeakMap !== \"function\") return false;\n\treturn Object.prototype.toString.call(new WeakMap()) === \"[object WeakMap]\";\n}());\n","module.exports = \"Vocabulary: Auth\\r\\n\\r\\nTerm:       username\\r\\n\\tConcept Type: Short Text (Type)\\r\\nTerm:       password\\r\\n\\tConcept Type: Hashed (Type)\\r\\nTerm:       name\\r\\n\\tConcept Type: Text (Type)\\r\\nTerm:       key\\r\\n\\tConcept Type: Short Text (Type)\\r\\nTerm:       expiry date\\r\\n\\tConcept Type: Date Time (Type)\\r\\nTerm:       description\\r\\n\\tConcept Type: Text (Type)\\r\\n\\r\\nTerm:       permission\\r\\n\\tReference Scheme: name\\r\\nFact type:  permission has name\\r\\n\\tNecessity: Each permission has exactly one name.\\r\\n\\tNecessity: Each name is of exactly one permission.\\r\\n\\r\\nTerm:       role\\r\\n\\tReference Scheme: name\\r\\nFact type:  role has name\\r\\n\\tNecessity: Each role has exactly one name.\\r\\n\\tNecessity: Each name is of exactly one role.\\r\\nFact type:  role has permission\\r\\n\\r\\nTerm:       actor\\r\\n\\r\\nTerm:       user\\r\\n\\tReference Scheme: username\\r\\n\\tConcept Type: actor\\r\\nFact type:  user has username\\r\\n\\tNecessity: Each user has exactly one username.\\r\\n\\tNecessity: Each username is of exactly one user.\\r\\nFact type:  user has password\\r\\n\\tNecessity: Each user has exactly one password.\\r\\nFact type:  user has role\\r\\n\\tNote: A 'user' will inherit all the 'permissions' that the 'role' has.\\r\\n\\tTerm Form: user role\\r\\n\\tFact type: user role has expiry date\\r\\n\\t\\tNecessity: Each user role has at most one expiry date.\\r\\nFact type:  user has permission\\r\\n\\tTerm Form: user permission\\r\\n\\tFact type: user permission has expiry date\\r\\n\\t\\tNecessity: Each user permission has at most one expiry date.\\r\\n\\r\\nTerm:       api key\\r\\n\\tReference Scheme: key\\r\\nFact type:  api key has key\\r\\n\\tNecessity: each api key has exactly one key\\r\\n\\tNecessity: each key is of exactly one api key\\r\\nFact type:  api key has role\\r\\n\\tNote: An 'api key' will inherit all the 'permissions' that the 'role' has.\\r\\nFact type:  api key has permission\\r\\nFact type:  api key is of actor\\r\\n\\tNecessity: each api key is of exactly one actor\\r\\nFact type:  api key has name\\r\\n\\tNecessity: Each api key has at most one name.\\r\\nFact type:  api key has description\\r\\n\\tNecessity: Each api key has at most one description.\\r\\n\";","declare module '@balena/abstract-sql-compiler' {\r\n\tinterface AbstractSqlTable {\r\n\t\tfetchProcessingFields?: {\r\n\t\t\t[field: string]: NonNullable<typeof sbvrTypes[string]['fetchProcessing']>;\r\n\t\t};\r\n\t\tlocalFields?: {\r\n\t\t\t[odataName: string]: true;\r\n\t\t};\r\n\t}\r\n}\r\n\r\nimport type {\r\n\tAbstractSqlModel,\r\n\tAbstractSqlTable,\r\n} from '@balena/abstract-sql-compiler';\r\nimport type { Result, Row } from '../database-layer/db';\r\n\r\nimport { sqlNameToODataName } from '@balena/odata-to-abstract-sql';\r\nimport * as sbvrTypes from '@balena/sbvr-types';\r\nimport * as _ from 'lodash';\r\nimport { resolveNavigationResource, resolveSynonym } from './sbvr-utils';\r\n\r\nconst checkForExpansion = async (\r\n\tvocab: string,\r\n\tabstractSqlModel: AbstractSqlModel,\r\n\tparentResourceName: string,\r\n\tfieldName: string,\r\n\trow: Row,\r\n\topts: { includeMetadata: boolean },\r\n) => {\r\n\tlet field = row[fieldName];\r\n\tif (field == null) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tif (typeof field === 'string') {\r\n\t\ttry {\r\n\t\t\tfield = JSON.parse(field);\r\n\t\t} catch (_e) {\r\n\t\t\t// If we can't JSON.parse the field then we use it directly.\r\n\t\t}\r\n\t}\r\n\r\n\tif (Array.isArray(field)) {\r\n\t\tconst mappingResourceName = resolveNavigationResource(\r\n\t\t\t{\r\n\t\t\t\tabstractSqlModel,\r\n\t\t\t\tvocabulary: vocab,\r\n\t\t\t\tresourceName: parentResourceName,\r\n\t\t\t},\r\n\t\t\tfieldName,\r\n\t\t);\r\n\t\tconst expandedField = await process(\r\n\t\t\tvocab,\r\n\t\t\tabstractSqlModel,\r\n\t\t\tmappingResourceName,\r\n\t\t\tfield,\r\n\t\t\topts,\r\n\t\t);\r\n\t\trow[fieldName] = expandedField;\r\n\t} else {\r\n\t\tconst mappingResourceName = resolveNavigationResource(\r\n\t\t\t{\r\n\t\t\t\tabstractSqlModel,\r\n\t\t\t\tvocabulary: vocab,\r\n\t\t\t\tresourceName: parentResourceName,\r\n\t\t\t},\r\n\t\t\tfieldName,\r\n\t\t);\r\n\t\trow[fieldName] = {\r\n\t\t\t__id: field,\r\n\t\t};\r\n\t\tif (opts.includeMetadata) {\r\n\t\t\trow[fieldName].__deferred = {\r\n\t\t\t\turi: resourceURI(vocab, mappingResourceName, field),\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n};\r\n\r\nexport const resourceURI = (\r\n\tvocab: string,\r\n\tresourceName: string,\r\n\tid: string | number,\r\n): string | undefined => {\r\n\tif (id == null) {\r\n\t\treturn;\r\n\t}\r\n\tif (typeof id === 'string') {\r\n\t\tid = \"'\" + encodeURIComponent(id) + \"'\";\r\n\t}\r\n\treturn `/${vocab}/${resourceName}(@id)?@id=${id}`;\r\n};\r\n\r\nconst getLocalFields = (table: AbstractSqlTable) => {\r\n\tif (table.localFields == null) {\r\n\t\ttable.localFields = {};\r\n\t\tfor (const { fieldName, dataType } of table.fields) {\r\n\t\t\t// TODO-MAJOR: This should also include ConceptType fields\r\n\t\t\tif (dataType !== 'ForeignKey') {\r\n\t\t\t\tconst odataName = sqlNameToODataName(fieldName);\r\n\t\t\t\ttable.localFields[odataName] = true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn table.localFields;\r\n};\r\nconst getFetchProcessingFields = (table: AbstractSqlTable) => {\r\n\treturn (table.fetchProcessingFields ??= _(table.fields)\r\n\t\t.filter(\r\n\t\t\t({ dataType }) =>\r\n\t\t\t\tsbvrTypes[dataType] != null &&\r\n\t\t\t\tsbvrTypes[dataType].fetchProcessing != null,\r\n\t\t)\r\n\t\t.map(({ fieldName, dataType }) => {\r\n\t\t\tconst odataName = sqlNameToODataName(fieldName);\r\n\t\t\treturn [odataName, sbvrTypes[dataType].fetchProcessing];\r\n\t\t})\r\n\t\t.fromPairs()\r\n\t\t.value());\r\n};\r\n\r\nexport const process = async (\r\n\tvocab: string,\r\n\tabstractSqlModel: AbstractSqlModel,\r\n\tresourceName: string,\r\n\trows: Result['rows'],\r\n\t{ includeMetadata }: { includeMetadata: boolean },\r\n): Promise<number | Row[]> => {\r\n\tif (rows.length === 0) {\r\n\t\treturn [];\r\n\t}\r\n\r\n\tif (rows.length === 1) {\r\n\t\tif (rows[0].$count != null) {\r\n\t\t\tconst count = parseInt(rows[0].$count, 10);\r\n\t\t\treturn count;\r\n\t\t}\r\n\t}\r\n\r\n\tconst sqlResourceName = resolveSynonym({\r\n\t\tabstractSqlModel,\r\n\t\tvocabulary: vocab,\r\n\t\tresourceName,\r\n\t});\r\n\tconst table = abstractSqlModel.tables[sqlResourceName];\r\n\r\n\tconst fieldNames = Object.keys(rows[0]);\r\n\r\n\tconst fetchProcessingFields = getFetchProcessingFields(table);\r\n\tconst processedFields = fieldNames.filter((fieldName) =>\r\n\t\tfetchProcessingFields.hasOwnProperty(fieldName),\r\n\t);\r\n\r\n\tconst localFields = getLocalFields(table);\r\n\t// We check that it's not a local field, rather than that it is a foreign key because of the case where the foreign key is on the other resource\r\n\t// and hence not known to this resource\r\n\tconst expandableFields = fieldNames.filter(\r\n\t\t(fieldName) => !localFields.hasOwnProperty(fieldName),\r\n\t);\r\n\r\n\tconst odataIdField = sqlNameToODataName(table.idField);\r\n\trows.forEach((row) => {\r\n\t\tprocessedFields.forEach((fieldName) => {\r\n\t\t\trow[fieldName] = fetchProcessingFields[fieldName](row[fieldName]);\r\n\t\t});\r\n\t\tif (includeMetadata) {\r\n\t\t\trow.__metadata = {\r\n\t\t\t\turi: resourceURI(vocab, resourceName, row[odataIdField]),\r\n\t\t\t};\r\n\t\t}\r\n\t});\r\n\r\n\tif (expandableFields.length > 0) {\r\n\t\tawait Promise.all(\r\n\t\t\trows.map(async (row) => {\r\n\t\t\t\tawait Promise.all(\r\n\t\t\t\t\texpandableFields.map(async (fieldName) => {\r\n\t\t\t\t\t\tawait checkForExpansion(\r\n\t\t\t\t\t\t\tvocab,\r\n\t\t\t\t\t\t\tabstractSqlModel,\r\n\t\t\t\t\t\t\tsqlResourceName,\r\n\t\t\t\t\t\t\tfieldName,\r\n\t\t\t\t\t\t\trow,\r\n\t\t\t\t\t\t\t{ includeMetadata },\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}),\r\n\t\t\t\t);\r\n\t\t\t}),\r\n\t\t);\r\n\t}\r\n\r\n\treturn rows;\r\n};\r\n\r\nexport const prepareModel = (abstractSqlModel: AbstractSqlModel) => {\r\n\t_.forEach(abstractSqlModel.tables, (table) => {\r\n\t\tgetLocalFields(table);\r\n\t\tgetFetchProcessingFields(table);\r\n\t});\r\n};\r\n","function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = function() { return []; };\nwebpackEmptyContext.resolve = webpackEmptyContext;\nmodule.exports = webpackEmptyContext;\nwebpackEmptyContext.id = 210;","import type { Config } from '../config-loader/config-loader';\nimport type { AnyObject } from '../sbvr-api/common-types';\n\nimport { Store } from 'express-session';\nimport * as permissions from '../sbvr-api/permissions';\nimport { api } from '../sbvr-api/sbvr-utils';\n\nexport { Store };\n\nconst sessionModel = `\n\tVocabulary: session\n\n\tTerm:       session id\n\t\tConcept Type: Short Text (Type)\n\tTerm:       data\n\t\tConcept Type: JSON (Type)\n\tTerm:       expiry time\n\t\tConcept type: Date Time (Type)\n\n\tTerm:       session\n\t\tDatabase ID Field: session id\n\t\tReference Scheme: session id\n\n\tFact type:  session has data\n\t\tNecessity: Each session has exactly 1 data\n\tFact type:  session has session id\n\t\tNecessity: Each session has exactly 1 session id\n\t\tNecessity: Each session id is of exactly 1 session\n\tFact type:  session has expiry time\n\t\tNecessity: Each session has at most 1 expiry time\n`;\n\nconst asCallback = async <T>(\n\tcallback: undefined | ((err: any, result?: T) => void),\n\tpromise: Promise<T>,\n) => {\n\tlet err;\n\tlet result;\n\ttry {\n\t\tresult = await promise;\n\t} catch ($err) {\n\t\terr = $err;\n\t}\n\ttry {\n\t\tcallback?.(err, result);\n\t} catch {\n\t\t// ignore errors in the callback\n\t}\n};\n\nexport class PinejsSessionStore extends Store {\n\tpublic get = ((sid, callback) => {\n\t\tasCallback(\n\t\t\tcallback,\n\t\t\tapi.session\n\t\t\t\t.get({\n\t\t\t\t\tresource: 'session',\n\t\t\t\t\tid: sid,\n\t\t\t\t\tpassthrough: {\n\t\t\t\t\t\treq: permissions.rootRead,\n\t\t\t\t\t},\n\t\t\t\t\toptions: {\n\t\t\t\t\t\t$select: 'data',\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t\t.then((session: AnyObject) => {\n\t\t\t\t\tif (session != null) {\n\t\t\t\t\t\treturn session.data;\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t);\n\t}) as Store['get'];\n\n\tpublic set = ((sid, data, callback) => {\n\t\tconst body = {\n\t\t\tsession_id: sid,\n\t\t\tdata,\n\t\t\texpiry_time: data?.cookie?.expires ?? null,\n\t\t};\n\t\tasCallback(\n\t\t\tcallback,\n\t\t\tapi.session.put({\n\t\t\t\tresource: 'session',\n\t\t\t\tid: sid,\n\t\t\t\tpassthrough: {\n\t\t\t\t\treq: permissions.root,\n\t\t\t\t},\n\t\t\t\tbody,\n\t\t\t}),\n\t\t);\n\t}) as Store['set'];\n\n\tpublic destroy = ((sid, callback) => {\n\t\tasCallback(\n\t\t\tcallback,\n\t\t\tapi.session.delete({\n\t\t\t\tresource: 'session',\n\t\t\t\tid: sid,\n\t\t\t\tpassthrough: {\n\t\t\t\t\treq: permissions.root,\n\t\t\t\t},\n\t\t\t}),\n\t\t);\n\t}) as Store['destroy'];\n\n\tpublic all = ((callback) => {\n\t\tasCallback(\n\t\t\tcallback,\n\t\t\tapi.session\n\t\t\t\t.get({\n\t\t\t\t\tresource: 'session',\n\t\t\t\t\tpassthrough: {\n\t\t\t\t\t\treq: permissions.root,\n\t\t\t\t\t},\n\t\t\t\t\toptions: {\n\t\t\t\t\t\t$select: 'session_id',\n\t\t\t\t\t\t$filter: {\n\t\t\t\t\t\t\texpiry_time: { $ge: Date.now() },\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t\t.then((sessions: AnyObject[]) => sessions.map((s) => s.session_id)),\n\t\t);\n\t}) as Store['all'];\n\n\tpublic clear = ((callback) => {\n\t\tasCallback(\n\t\t\tcallback,\n\t\t\t// TODO: Use a truncate\n\t\t\tapi.session.delete({\n\t\t\t\tresource: 'session',\n\t\t\t\tpassthrough: {\n\t\t\t\t\treq: permissions.root,\n\t\t\t\t},\n\t\t\t}),\n\t\t);\n\t}) as Store['clear'];\n\n\tpublic length = ((callback) => {\n\t\tasCallback(\n\t\t\tcallback,\n\t\t\tapi.session.get({\n\t\t\t\tresource: 'session/',\n\t\t\t\tpassthrough: {\n\t\t\t\t\treq: permissions.rootRead,\n\t\t\t\t},\n\t\t\t\toptions: {\n\t\t\t\t\t$count: {\n\t\t\t\t\t\t$select: 'session_id',\n\t\t\t\t\t\t$filter: {\n\t\t\t\t\t\t\texpiry_time: {\n\t\t\t\t\t\t\t\t$ge: Date.now(),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t}) as Promise<number>,\n\t\t);\n\t}) as Store['length'];\n\n\tpublic static config: Config = {\n\t\tmodels: [\n\t\t\t{\n\t\t\t\tmodelName: 'session',\n\t\t\t\tmodelText: sessionModel,\n\t\t\t\tapiRoot: 'session',\n\t\t\t\tlogging: {\n\t\t\t\t\tdefault: false,\n\t\t\t\t\terror: true,\n\t\t\t\t},\n\t\t\t\tmigrations: {\n\t\t\t\t\t'11.0.0-modified-at': `\n\t\t\t\t\t\tALTER TABLE \"session\"\n\t\t\t\t\t\tADD COLUMN IF NOT EXISTS \"modified at\" TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL;\n\t\t\t\t\t`,\n\t\t\t\t},\n\t\t\t},\n\t\t],\n\t};\n}\n","module.exports = require(\"express-session\");","import * as permissions from '../sbvr-api/permissions';\n\nconst uiModel = `\\\nVocabulary: ui\n\nTerm:       text\n\tConcept type: Text (Type)\nTerm:       name\n\tConcept type: Short Text (Type)\nTerm:       textarea\n\t--Database id Field: name\n\tReference Scheme: text\nFact type:  textarea is disabled\nFact type:  textarea has name\n\tNecessity: Each textarea has exactly 1 name\n\tNecessity: Each name is of exactly 1 textarea\nFact type:  textarea has text\n\tNecessity: Each textarea has exactly 1 text`;\n\n// Middleware\nconst isServerOnAir = (() => {\n\t/** @type { ((thenableOrResult?: import('../sbvr-api/common-types').Resolvable<boolean>) => void) | undefined } */\n\tlet resolve;\n\tlet promise = new Promise(($resolve) => {\n\t\tresolve = $resolve;\n\t});\n\treturn (/** @type {boolean} */ value) => {\n\t\tif (value != null) {\n\t\t\tif (resolve != null) {\n\t\t\t\tresolve(value);\n\t\t\t\tresolve = undefined;\n\t\t\t} else {\n\t\t\t\tpromise = Promise.resolve(value);\n\t\t\t}\n\t\t}\n\t\treturn promise;\n\t};\n})();\n\n/** @type { import('express').Handler } */\nconst serverIsOnAir = async (_req, _res, next) => {\n\tconst onAir = await isServerOnAir();\n\tif (onAir) {\n\t\tnext();\n\t} else {\n\t\tnext('route');\n\t}\n};\n\nexport let config = {\n\tmodels: [\n\t\t{\n\t\t\tmodelName: 'ui',\n\t\t\tmodelText: uiModel,\n\t\t\tapiRoot: 'ui',\n\t\t\tcustomServerCode: { setup },\n\t\t\tmigrations: {\n\t\t\t\t'11.0.0-modified-at': `\\\nALTER TABLE \"textarea\"\nADD COLUMN IF NOT EXISTS \"modified at\" TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL;\\\n`,\n\t\t\t},\n\t\t},\n\t],\n};\n\n/** @type { import('../config-loader/config-loader').SetupFunction } */\nexport async function setup(app, sbvrUtils, db) {\n\tconst uiApi = sbvrUtils.api.ui;\n\tconst devApi = sbvrUtils.api.dev;\n\tconst setupModels = async (\n\t\t/** @type { import('../database-layer/db').Tx } */ tx,\n\t) => {\n\t\ttry {\n\t\t\tconst uiApiTx = uiApi.clone({\n\t\t\t\tpassthrough: {\n\t\t\t\t\ttx,\n\t\t\t\t\treq: permissions.root,\n\t\t\t\t},\n\t\t\t});\n\t\t\tawait uiApiTx\n\t\t\t\t.get({\n\t\t\t\t\tresource: 'textarea',\n\t\t\t\t\tid: {\n\t\t\t\t\t\tname: 'model_area',\n\t\t\t\t\t},\n\t\t\t\t\toptions: {\n\t\t\t\t\t\t$select: 'id',\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t\t.then(async (/** @type { { [key: string]: any } } */ result) => {\n\t\t\t\t\tif (result == null) {\n\t\t\t\t\t\t// Add a model_area entry if it doesn't already exist.\n\t\t\t\t\t\treturn await uiApiTx.post({\n\t\t\t\t\t\t\tresource: 'textarea',\n\t\t\t\t\t\t\tbody: {\n\t\t\t\t\t\t\t\tname: 'model_area',\n\t\t\t\t\t\t\t\ttext: ' ',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\tawait devApi\n\t\t\t\t.get({\n\t\t\t\t\tresource: 'model',\n\t\t\t\t\tpassthrough: {\n\t\t\t\t\t\ttx,\n\t\t\t\t\t\treq: permissions.rootRead,\n\t\t\t\t\t},\n\t\t\t\t\toptions: {\n\t\t\t\t\t\t$select: ['is_of__vocabulary', 'model_value'],\n\t\t\t\t\t\t$filter: {\n\t\t\t\t\t\t\tmodel_type: 'se',\n\t\t\t\t\t\t\tis_of__vocabulary: 'data',\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t\t.then(async (/** @type { Array<{ [key: string]: any }> } */ result) => {\n\t\t\t\t\tif (result.length === 0) {\n\t\t\t\t\t\tthrow new Error('No SE data model found');\n\t\t\t\t\t}\n\t\t\t\t\tconst instance = result[0];\n\t\t\t\t\tawait sbvrUtils.executeModel(tx, {\n\t\t\t\t\t\tapiRoot: instance.is_of__vocabulary,\n\t\t\t\t\t\tmodelText: instance.model_value,\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\tawait isServerOnAir(true);\n\t\t} catch {\n\t\t\tawait isServerOnAir(false);\n\t\t}\n\t};\n\n\tapp.get('/onAir', async (_req, res) => {\n\t\tconst onAir = await isServerOnAir();\n\t\tres.json(onAir);\n\t});\n\n\tapp.post(\n\t\t'/update',\n\t\tpermissions.checkPermissionsMiddleware('all'),\n\t\tserverIsOnAir,\n\t\t(_req, res) => {\n\t\t\tres.sendStatus(404);\n\t\t},\n\t);\n\n\tapp.post(\n\t\t'/execute',\n\t\tpermissions.checkPermissionsMiddleware('all'),\n\t\tasync (_req, res) => {\n\t\t\ttry {\n\t\t\t\tawait uiApi\n\t\t\t\t\t.get({\n\t\t\t\t\t\tresource: 'textarea',\n\t\t\t\t\t\tpassthrough: { req: permissions.rootRead },\n\t\t\t\t\t\tid: {\n\t\t\t\t\t\t\tname: 'model_area',\n\t\t\t\t\t\t},\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t$select: 'text',\n\t\t\t\t\t\t},\n\t\t\t\t\t})\n\t\t\t\t\t.then(async (/** @type { { [key: string]: any } } */ result) => {\n\t\t\t\t\t\tif (result == null) {\n\t\t\t\t\t\t\tthrow new Error('Could not find the model to execute');\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst modelText = result.text;\n\t\t\t\t\t\tawait db.transaction(async (tx) => {\n\t\t\t\t\t\t\tawait sbvrUtils.executeModel(tx, {\n\t\t\t\t\t\t\t\tapiRoot: 'data',\n\t\t\t\t\t\t\t\tmodelText,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tawait uiApi.patch({\n\t\t\t\t\t\t\t\tresource: 'textarea',\n\t\t\t\t\t\t\t\tpassthrough: {\n\t\t\t\t\t\t\t\t\ttx,\n\t\t\t\t\t\t\t\t\treq: permissions.root,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tid: {\n\t\t\t\t\t\t\t\t\tname: 'model_area',\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tbody: {\n\t\t\t\t\t\t\t\t\tis_disabled: true,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\tawait isServerOnAir(true);\n\t\t\t\tres.sendStatus(200);\n\t\t\t} catch (err) {\n\t\t\t\tawait isServerOnAir(false);\n\t\t\t\tres.status(404).json(err);\n\t\t\t}\n\t\t},\n\t);\n\tapp.post(\n\t\t'/validate',\n\t\tpermissions.checkPermissionsMiddleware('read'),\n\t\tasync (req, res) => {\n\t\t\ttry {\n\t\t\t\tconst results = await sbvrUtils.runRule('data', req.body.rule);\n\t\t\t\tres.json(results);\n\t\t\t} catch (err) {\n\t\t\t\tconsole.log('Error validating', err);\n\t\t\t\tres.sendStatus(404);\n\t\t\t}\n\t\t},\n\t);\n\tapp.delete(\n\t\t'/cleardb',\n\t\tpermissions.checkPermissionsMiddleware('delete'),\n\t\tasync (_req, res) => {\n\t\t\ttry {\n\t\t\t\tawait db.transaction(async (tx) => {\n\t\t\t\t\tconst result = await tx.tableList();\n\n\t\t\t\t\tawait Promise.all(\n\t\t\t\t\t\tresult.rows.map((table) => tx.dropTable(table.name)),\n\t\t\t\t\t);\n\t\t\t\t\tawait sbvrUtils.executeStandardModels(tx);\n\t\t\t\t\t// TODO: HACK: This is usually done by config-loader and should be done there\n\t\t\t\t\t// In general cleardb is very destructive and should really go through a full \"reboot\" procedure to set everything up again.\n\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t'DEL /cleardb is very destructive and should really be followed by a full restart/reload.',\n\t\t\t\t\t);\n\t\t\t\t\tawait sbvrUtils.executeModels(tx, exports.config.models);\n\t\t\t\t\tawait setupModels(tx);\n\t\t\t\t});\n\t\t\t\tres.sendStatus(200);\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error('Error clearing db', err, err.stack);\n\t\t\t\tres.sendStatus(503);\n\t\t\t}\n\t\t},\n\t);\n\tapp.put(\n\t\t'/importdb',\n\t\tpermissions.checkPermissionsMiddleware({\n\t\t\tand: ['create', 'update', 'delete'],\n\t\t}),\n\t\tasync (req, res) => {\n\t\t\ttry {\n\t\t\t\tconst queries = req.body.split(';');\n\t\t\t\tawait db.transaction(async (tx) => {\n\t\t\t\t\tfor (let query of queries) {\n\t\t\t\t\t\tquery = query.trim();\n\t\t\t\t\t\tif (query.length > 0) {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tawait tx.executeSql(query);\n\t\t\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t\t\tthrow [query, err];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tres.sendStatus(200);\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error('Error importing db', err, err.stack);\n\t\t\t\tres.sendStatus(404);\n\t\t\t}\n\t\t},\n\t);\n\tapp.get(\n\t\t'/exportdb',\n\t\tpermissions.checkPermissionsMiddleware('read'),\n\t\tasync (_req, res) => {\n\t\t\ttry {\n\t\t\t\tlet exported = '';\n\t\t\t\tawait db.transaction(async (tx) => {\n\t\t\t\t\tconst tables = await tx.tableList(\"name NOT LIKE '%_buk'\");\n\t\t\t\t\tawait Promise.all(\n\t\t\t\t\t\ttables.rows.map(async (table) => {\n\t\t\t\t\t\t\tconst tableName = table.name;\n\t\t\t\t\t\t\texported += 'DROP TABLE IF EXISTS \"' + tableName + '\";\\n';\n\t\t\t\t\t\t\texported += table.sql + ';\\n';\n\t\t\t\t\t\t\tconst result = await tx.executeSql(\n\t\t\t\t\t\t\t\t'SELECT * FROM \"' + tableName + '\";',\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tlet insQuery = '';\n\t\t\t\t\t\t\tresult.rows.forEach((currRow) => {\n\t\t\t\t\t\t\t\tlet notFirst = false;\n\t\t\t\t\t\t\t\tinsQuery += 'INSERT INTO \"' + tableName + '\" (';\n\t\t\t\t\t\t\t\tlet valQuery = '';\n\t\t\t\t\t\t\t\tfor (let propName of Object.keys(currRow)) {\n\t\t\t\t\t\t\t\t\tif (notFirst) {\n\t\t\t\t\t\t\t\t\t\tinsQuery += ',';\n\t\t\t\t\t\t\t\t\t\tvalQuery += ',';\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tnotFirst = true;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tinsQuery += '\"' + propName + '\"';\n\t\t\t\t\t\t\t\t\tvalQuery += \"'\" + currRow[propName] + \"'\";\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tinsQuery += ') values (' + valQuery + ');\\n';\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\texported += insQuery;\n\t\t\t\t\t\t}),\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t\tres.json(exported);\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error('Error exporting db', err, err.stack);\n\t\t\t\tres.sendStatus(503);\n\t\t\t}\n\t\t},\n\t);\n\tapp.post(\n\t\t'/backupdb',\n\t\tpermissions.checkPermissionsMiddleware('all'),\n\t\tserverIsOnAir,\n\t\tasync (_req, res) => {\n\t\t\ttry {\n\t\t\t\tawait db.transaction(async (tx) => {\n\t\t\t\t\tconst result = await tx.tableList(\"name NOT LIKE '%_buk'\");\n\t\t\t\t\tawait Promise.all(\n\t\t\t\t\t\tresult.rows.map(async (currRow) => {\n\t\t\t\t\t\t\tconst tableName = currRow.name;\n\t\t\t\t\t\t\tawait tx.dropTable(tableName + '_buk', true);\n\n\t\t\t\t\t\t\tawait tx.executeSql(\n\t\t\t\t\t\t\t\t'ALTER TABLE \"' +\n\t\t\t\t\t\t\t\t\ttableName +\n\t\t\t\t\t\t\t\t\t'\" RENAME TO \"' +\n\t\t\t\t\t\t\t\t\ttableName +\n\t\t\t\t\t\t\t\t\t'_buk\";',\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}),\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t\tres.sendStatus(200);\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error('Error backing up db', err, err.stack);\n\t\t\t\tres.sendStatus(404);\n\t\t\t}\n\t\t},\n\t);\n\tapp.post(\n\t\t'/restoredb',\n\t\tpermissions.checkPermissionsMiddleware('all'),\n\t\tserverIsOnAir,\n\t\tasync (_req, res) => {\n\t\t\ttry {\n\t\t\t\tawait db.transaction(async (tx) => {\n\t\t\t\t\tconst result = await tx.tableList(\"name LIKE '%_buk'\");\n\t\t\t\t\tawait Promise.all(\n\t\t\t\t\t\tresult.rows.map(async (currRow) => {\n\t\t\t\t\t\t\tconst tableName = currRow.name;\n\t\t\t\t\t\t\tawait tx.dropTable(tableName.slice(0, -4), true);\n\t\t\t\t\t\t\tawait tx.executeSql(\n\t\t\t\t\t\t\t\t'ALTER TABLE \"' +\n\t\t\t\t\t\t\t\t\ttableName +\n\t\t\t\t\t\t\t\t\t'\" RENAME TO \"' +\n\t\t\t\t\t\t\t\t\ttableName.slice(0, -4) +\n\t\t\t\t\t\t\t\t\t'\";',\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}),\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t\tres.sendStatus(200);\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error('Error restoring db', err, err.stack);\n\t\t\t\tres.sendStatus(404);\n\t\t\t}\n\t\t},\n\t);\n\n\tapp.all('/data/*', serverIsOnAir, sbvrUtils.handleODataRequest);\n\tapp.get('/Auth/*', serverIsOnAir, sbvrUtils.handleODataRequest);\n\tapp.merge('/ui/*', sbvrUtils.handleODataRequest);\n\tapp.patch('/ui/*', sbvrUtils.handleODataRequest);\n\n\tapp.delete('/', serverIsOnAir, async (_req, res) => {\n\t\tawait Promise.all([\n\t\t\tuiApi.patch({\n\t\t\t\tresource: 'textarea',\n\t\t\t\tpassthrough: { req: permissions.root },\n\t\t\t\tid: {\n\t\t\t\t\tname: 'model_area',\n\t\t\t\t},\n\t\t\t\tbody: {\n\t\t\t\t\ttext: '',\n\t\t\t\t\tis_disabled: false,\n\t\t\t\t},\n\t\t\t}),\n\t\t\tsbvrUtils.deleteModel('data'),\n\t\t]);\n\t\tawait isServerOnAir(false);\n\t\tres.sendStatus(200);\n\t});\n\n\tawait db.transaction(setupModels);\n}\n","import * as _ from 'lodash';\nimport { odataNameToSqlName } from '@balena/odata-to-abstract-sql';\n// @ts-ignore\nconst transactionModel = require('./transaction.sbvr');\n\nexport let config = {\n\tmodels: [\n\t\t{\n\t\t\tapiRoot: 'transaction',\n\t\t\tmodelText: transactionModel,\n\t\t\tcustomServerCode: { setup },\n\t\t\tmigrations: {\n\t\t\t\t'11.0.0-modified-at': `\\\nALTER TABLE \"conditional field\"\nADD COLUMN IF NOT EXISTS \"modified at\" TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL;\nALTER TABLE \"conditional resource\"\nADD COLUMN IF NOT EXISTS \"modified at\" TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL;\nALTER TABLE \"lock\"\nADD COLUMN IF NOT EXISTS \"modified at\" TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL;\nALTER TABLE \"resource\"\nADD COLUMN IF NOT EXISTS \"modified at\" TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL;\nALTER TABLE \"resource-is under-lock\"\nADD COLUMN IF NOT EXISTS \"modified at\" TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL;\nALTER TABLE \"transaction\"\nADD COLUMN IF NOT EXISTS \"modified at\" TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL;\\\n`,\n\t\t\t},\n\t\t},\n\t],\n};\n\n/** @type {(modelName: string) => void} */\nexport let addModelHooks;\n\n/** @type { import('../config-loader/config-loader').SetupFunction } */\nexport function setup(app, sbvrUtils) {\n\taddModelHooks = (modelName) => {\n\t\t// TODO: Add checks on POST/PATCH requests as well.\n\t\tsbvrUtils.addPureHook('PUT', modelName, 'all', {\n\t\t\tasync PRERUN({ tx, request }) {\n\t\t\t\tconst vocab = request.vocabulary;\n\t\t\t\tconst { logger } = sbvrUtils.api[vocab];\n\t\t\t\tconst id = sbvrUtils.getID(vocab, request);\n\t\t\t\tlet result;\n\t\t\t\ttry {\n\t\t\t\t\tresult = await tx.executeSql(\n\t\t\t\t\t\t`\\\nSELECT NOT EXISTS(\n\tSELECT 1\n\tFROM \"resource\" r\n\tJOIN \"resource-is under-lock\" AS rl ON rl.\"resource\" = r.\"id\"\n\tWHERE r.\"resource type\" = ?\n\tAND r.\"resource id\" = ?\n) AS result;`,\n\t\t\t\t\t\t[request.resourceName, id],\n\t\t\t\t\t);\n\t\t\t\t} catch (err) {\n\t\t\t\t\tlogger.error('Unable to check resource locks', err, err.stack);\n\t\t\t\t\tthrow new Error('Unable to check resource locks');\n\t\t\t\t}\n\t\t\t\tif ([false, 0, '0'].includes(result.rows[0].result)) {\n\t\t\t\t\tthrow new Error('The resource is locked and cannot be edited');\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\n\t\tconst endTransaction = (/** @type {number} */ transactionID) =>\n\t\t\tsbvrUtils.db.transaction(async (tx) => {\n\t\t\t\t/** @type {{[key: string]: { promise: Promise<any>, resolve: Function, reject: Function }}} */\n\t\t\t\tconst placeholders = {};\n\t\t\t\tconst getLockedRow = (\n\t\t\t\t\t/** @type {number} */ lockID, // 'GET', '/transaction/resource?$select=resource_id&$filter=resource__is_under__lock/lock eq ?'\n\t\t\t\t) =>\n\t\t\t\t\ttx.executeSql(\n\t\t\t\t\t\t`SELECT \"resource\".\"resource id\" AS \"resource_id\"\nFROM \"resource\",\n\"resource-is under-lock\"\nWHERE \"resource\".\"id\" = \"resource-is under-lock\".\"resource\"\nAND \"resource-is under-lock\".\"lock\" = ?;`,\n\t\t\t\t\t\t[lockID],\n\t\t\t\t\t);\n\t\t\t\tconst getFieldsObject = async (\n\t\t\t\t\t/** @type {number} */ conditionalResourceID,\n\t\t\t\t\t/** @type {import('@balena/abstract-sql-compiler').AbstractSqlTable} */ clientModel, // 'GET', '/transaction/conditional_field?$select=field_name,field_value&$filter=conditional_resource eq ?'\n\t\t\t\t) => {\n\t\t\t\t\tconst fields = await tx.executeSql(\n\t\t\t\t\t\t`SELECT \"conditional field\".\"field name\" AS \"field_name\", \"conditional field\".\"field value\" AS \"field_value\"\nFROM \"conditional field\"\nWHERE \"conditional field\".\"conditional resource\" = ?;`,\n\t\t\t\t\t\t[conditionalResourceID],\n\t\t\t\t\t);\n\t\t\t\t\t/** @type {{[key: string]: any}} */\n\t\t\t\t\tconst fieldsObject = {};\n\t\t\t\t\tawait Promise.all(\n\t\t\t\t\t\tfields.rows.map(async (field) => {\n\t\t\t\t\t\t\tconst fieldName = field.field_name.replace(\n\t\t\t\t\t\t\t\tclientModel.resourceName + '.',\n\t\t\t\t\t\t\t\t'',\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tconst fieldValue = field.field_value;\n\t\t\t\t\t\t\tconst modelField = clientModel.fields.find(\n\t\t\t\t\t\t\t\t(f) => f.fieldName === fieldName,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tif (modelField == null) {\n\t\t\t\t\t\t\t\tthrow new Error(`Invalid field: ${fieldName}`);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\tmodelField.dataType === 'ForeignKey' &&\n\t\t\t\t\t\t\t\tNumber.isNaN(Number(fieldValue))\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\tif (!placeholders.hasOwnProperty(fieldValue)) {\n\t\t\t\t\t\t\t\t\tthrow new Error('Cannot resolve placeholder' + fieldValue);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\tconst resolvedID = await placeholders[fieldValue].promise;\n\t\t\t\t\t\t\t\t\t\tfieldsObject[fieldName] = resolvedID;\n\t\t\t\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\t\t\t\tthrow new Error('Placeholder failed' + fieldValue);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tfieldsObject[fieldName] = fieldValue;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}),\n\t\t\t\t\t);\n\t\t\t\t\treturn fieldsObject;\n\t\t\t\t};\n\n\t\t\t\t// 'GET', '/transaction/conditional_resource?$select=id,lock,resource_type,conditional_type,placeholder&$filter=transaction eq ?'\n\t\t\t\tconst conditionalResources = await tx.executeSql(\n\t\t\t\t\t`\\\nSELECT \"conditional resource\".\"id\", \"conditional resource\".\"lock\", \"conditional resource\".\"resource type\" AS \"resource_type\",\n\"conditional resource\".\"conditional type\" AS \"conditional_type\", \"conditional resource\".\"placeholder\"\nFROM \"conditional resource\"\nWHERE \"conditional resource\".\"transaction\" = ?;\\\n`,\n\t\t\t\t\t[transactionID],\n\t\t\t\t);\n\n\t\t\t\tconditionalResources.rows.forEach((conditionalResource) => {\n\t\t\t\t\tconst { placeholder } = conditionalResource;\n\t\t\t\t\tif (placeholder != null && placeholder.length > 0) {\n\t\t\t\t\t\t/** @type {Function} */\n\t\t\t\t\t\tlet resolve;\n\t\t\t\t\t\t/** @type {Function} */\n\t\t\t\t\t\tlet reject;\n\t\t\t\t\t\tconst promise = new Promise(($resolve, $reject) => {\n\t\t\t\t\t\t\tresolve = $resolve;\n\t\t\t\t\t\t\treject = $reject;\n\t\t\t\t\t\t});\n\t\t\t\t\t\t// @ts-ignore\n\t\t\t\t\t\tplaceholders[placeholder] = { promise, resolve, reject };\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// get conditional resources (if exist)\n\t\t\t\tawait Promise.all(\n\t\t\t\t\tconditionalResources.rows.map(async (conditionalResource) => {\n\t\t\t\t\t\tconst { placeholder } = conditionalResource;\n\t\t\t\t\t\tconst lockID = conditionalResource.lock;\n\t\t\t\t\t\tconst doCleanup = () =>\n\t\t\t\t\t\t\tPromise.all([\n\t\t\t\t\t\t\t\ttx.executeSql(\n\t\t\t\t\t\t\t\t\t'DELETE FROM \"conditional field\" WHERE \"conditional resource\" = ?;',\n\t\t\t\t\t\t\t\t\t[conditionalResource.id],\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\ttx.executeSql(\n\t\t\t\t\t\t\t\t\t'DELETE FROM \"conditional resource\" WHERE \"lock\" = ?;',\n\t\t\t\t\t\t\t\t\t[lockID],\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\ttx.executeSql(\n\t\t\t\t\t\t\t\t\t'DELETE FROM \"resource-is under-lock\" WHERE \"lock\" = ?;',\n\t\t\t\t\t\t\t\t\t[lockID],\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\ttx.executeSql('DELETE FROM \"lock\" WHERE \"id\" = ?;', [lockID]),\n\t\t\t\t\t\t\t]);\n\n\t\t\t\t\t\tconst passthrough = { tx };\n\n\t\t\t\t\t\tconst clientModel = sbvrUtils.getAbstractSqlModel({\n\t\t\t\t\t\t\tvocabulary: modelName,\n\t\t\t\t\t\t}).tables[odataNameToSqlName(conditionalResource.resource_type)];\n\t\t\t\t\t\tlet url = modelName + '/' + conditionalResource.resource_type;\n\t\t\t\t\t\tswitch (conditionalResource.conditional_type) {\n\t\t\t\t\t\t\tcase 'DELETE': {\n\t\t\t\t\t\t\t\tconst lockedResult = await getLockedRow(lockID);\n\t\t\t\t\t\t\t\tconst lockedRow = lockedResult.rows[0];\n\t\t\t\t\t\t\t\turl =\n\t\t\t\t\t\t\t\t\turl +\n\t\t\t\t\t\t\t\t\t'?$filter=' +\n\t\t\t\t\t\t\t\t\tclientModel.idField +\n\t\t\t\t\t\t\t\t\t' eq ' +\n\t\t\t\t\t\t\t\t\tlockedRow.resource_id;\n\t\t\t\t\t\t\t\tawait sbvrUtils.PinejsClient.prototype.delete({\n\t\t\t\t\t\t\t\t\turl,\n\t\t\t\t\t\t\t\t\tpassthrough,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tawait doCleanup();\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tcase 'EDIT': {\n\t\t\t\t\t\t\t\tconst lockedResult = await getLockedRow(lockID);\n\t\t\t\t\t\t\t\tconst lockedRow = lockedResult.rows[0];\n\t\t\t\t\t\t\t\tconst body = await getFieldsObject(\n\t\t\t\t\t\t\t\t\tconditionalResource.id,\n\t\t\t\t\t\t\t\t\tclientModel,\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tbody[clientModel.idField] = lockedRow.resource_id;\n\t\t\t\t\t\t\t\tawait sbvrUtils.PinejsClient.prototype.put({\n\t\t\t\t\t\t\t\t\turl,\n\t\t\t\t\t\t\t\t\tbody,\n\t\t\t\t\t\t\t\t\tpassthrough,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tawait doCleanup();\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tcase 'ADD': {\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\tconst body = await getFieldsObject(\n\t\t\t\t\t\t\t\t\t\tconditionalResource.id,\n\t\t\t\t\t\t\t\t\t\tclientModel,\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t/** @type { {[key: string]: any} } */\n\t\t\t\t\t\t\t\t\tconst result = await sbvrUtils.PinejsClient.prototype.post({\n\t\t\t\t\t\t\t\t\t\turl,\n\t\t\t\t\t\t\t\t\t\tbody,\n\t\t\t\t\t\t\t\t\t\tpassthrough,\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tplaceholders[placeholder].resolve(\n\t\t\t\t\t\t\t\t\t\tresult[clientModel.idField],\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\tawait doCleanup();\n\t\t\t\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t\t\t\tplaceholders[placeholder].reject(err);\n\t\t\t\t\t\t\t\t\tthrow err;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t);\n\t\t\t\tawait tx.executeSql('DELETE FROM \"transaction\" WHERE \"id\" = ?;', [\n\t\t\t\t\ttransactionID,\n\t\t\t\t]);\n\t\t\t\tawait sbvrUtils.validateModel(tx, modelName);\n\t\t\t});\n\n\t\t// TODO: these really should be specific to the model - currently they will only work for the first model added\n\t\tapp.post('/transaction/execute', async (req, res) => {\n\t\t\tconst id = Number(req.body.id);\n\t\t\tif (Number.isNaN(id)) {\n\t\t\t\tres.sendStatus(404);\n\t\t\t} else {\n\t\t\t\ttry {\n\t\t\t\t\tawait endTransaction(id);\n\n\t\t\t\t\tres.sendStatus(200);\n\t\t\t\t} catch (err) {\n\t\t\t\t\tconsole.error('Error ending transaction', err, err.stack);\n\t\t\t\t\tres.status(404).json(err);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tapp.get('/transaction', (_req, res) => {\n\t\t\tres.json({\n\t\t\t\ttransactionURI: '/transaction/transaction',\n\t\t\t\tconditionalResourceURI: '/transaction/conditional_resource',\n\t\t\t\tconditionalFieldURI: '/transaction/conditional_field',\n\t\t\t\tlockURI: '/transaction/lock',\n\t\t\t\ttransactionLockURI: '/transaction/lock__belongs_to__transaction',\n\t\t\t\tresourceURI: '/transaction/resource',\n\t\t\t\tlockResourceURI: '/transaction/resource__is_under__lock',\n\t\t\t\texclusiveLockURI: '/transaction/lock__is_exclusive',\n\t\t\t\tcommitTransactionURI: '/transaction/execute',\n\t\t\t});\n\t\t});\n\t\tapp.all('/transaction/*', sbvrUtils.handleODataRequest);\n\t};\n}\n","module.exports = \"Vocabulary: transaction\\r\\n\\r\\nTerm:       resource id\\r\\n\\tConcept type: Text (Type)\\r\\nTerm:       resource type\\r\\n\\tConcept type: Text (Type)\\r\\nTerm:       field name\\r\\n\\tConcept type: Text (Type)\\r\\nTerm:       field value\\r\\n\\tConcept type: Text (Type)\\r\\nTerm:       placeholder\\r\\n\\tConcept type: Short Text (Type)\\r\\n\\r\\nTerm:       resource\\r\\n\\tReference Scheme: resource id\\r\\nFact type: resource has resource id\\r\\n\\tNecessity: Each resource has exactly 1 resource id.\\r\\nFact type: resource has resource type\\r\\n\\tNecessity: Each resource has exactly 1 resource type.\\r\\n\\r\\nTerm:       transaction\\r\\n\\r\\nTerm:       lock\\r\\nFact type:  lock is exclusive\\r\\nFact type:  lock belongs to transaction\\r\\n\\tNecessity: Each lock belongs to exactly 1 transaction.\\r\\nFact type:  resource is under lock\\r\\n\\tSynonymous Form: lock is on resource\\r\\nRule:       It is obligatory that each resource that is under a lock that is exclusive, is under at most 1 lock.\\r\\n\\r\\nTerm:       conditional type\\r\\n\\tConcept Type: Short Text (Type)\\r\\n\\tDefinition: \\\"ADD\\\", \\\"EDIT\\\" or \\\"DELETE\\\"\\r\\n\\r\\nTerm:       conditional resource\\r\\nFact type:  conditional resource belongs to transaction\\r\\n\\tNecessity: Each conditional resource belongs to exactly 1 transaction.\\r\\nFact type:  conditional resource has lock\\r\\n\\tNecessity: Each conditional resource has at most 1 lock.\\r\\nFact type:  conditional resource has resource type\\r\\n\\tNecessity: Each conditional resource has exactly 1 resource type.\\r\\nFact type:  conditional resource has conditional type\\r\\n\\tNecessity: Each conditional resource has exactly 1 conditional type.\\r\\nFact type:  conditional resource has placeholder\\r\\n\\tNecessity: Each conditional resource has at most 1 placeholder.\\r\\n--Rule:       It is obligatory that each conditional resource that has a placeholder, has a conditional type that is of \\\"ADD\\\".\\r\\n\\r\\nTerm:       conditional field\\r\\n\\tReference Scheme: field name\\r\\nFact type:  conditional field has field name\\r\\n\\tNecessity: Each conditional field has exactly 1 field name.\\r\\nFact type:  conditional field has field value\\r\\n\\tNecessity: Each conditional field has at most 1 field value.\\r\\nFact type:  conditional field is of conditional resource\\r\\n\\tNecessity: Each conditional field is of exactly 1 conditional resource.\\r\\n\\r\\n--Rule:       It is obligatory that each conditional resource that has a conditional type that is of \\\"EDIT\\\" or \\\"DELETE\\\", has a lock that is exclusive\\r\\nRule:       It is obligatory that each conditional resource that has a lock, has a resource type that is of a resource that the lock is on.\\r\\nRule:       It is obligatory that each conditional resource that has a lock, belongs to a transaction that the lock belongs to.\\r\\n\";","import type * as Express from 'express';\nimport type * as Passport from 'passport';\nimport type * as PassportLocal from 'passport-local';\nimport type * as ConfigLoader from '../config-loader/config-loader';\n\nimport * as permissions from '../sbvr-api/permissions';\n\n// Returns a middleware that will handle logging in using `username` and `password` body properties\nexport let login: (\n\tfn: (\n\t\terr: any,\n\t\tuser: {} | undefined,\n\t\treq: Express.Request,\n\t\tres: Express.Response,\n\t\tnext: Express.NextFunction,\n\t) => void,\n) => Express.RequestHandler;\n\n// Returns a middleware that logs the user out and then calls next()\nexport let logout: Express.RequestHandler;\n\nexport const checkPassword: PassportLocal.VerifyFunction = async (\n\tusername,\n\tpassword,\n\tdone: (error: undefined, user?: any) => void,\n) => {\n\ttry {\n\t\tconst result = await permissions.checkPassword(username, password);\n\t\tdone(undefined, result);\n\t} catch {\n\t\tdone(undefined, false);\n\t}\n};\n\nconst setup: ConfigLoader.SetupFunction = async (app: Express.Application) => {\n\tif (!process.browser) {\n\t\tconst passport: typeof Passport = require('passport');\n\t\tapp.use(passport.initialize());\n\t\tapp.use(passport.session());\n\n\t\tconst {\n\t\t\tStrategy: LocalStrategy,\n\t\t}: typeof PassportLocal = require('passport-local');\n\n\t\tpassport.serializeUser((user, done) => {\n\t\t\tdone(null, user);\n\t\t});\n\n\t\tpassport.deserializeUser((user, done) => {\n\t\t\tdone(null, user);\n\t\t});\n\n\t\tpassport.use(new LocalStrategy(checkPassword));\n\n\t\tlogin = (fn) => (req, res, next) =>\n\t\t\tpassport.authenticate('local', (err: any, user?: {}) => {\n\t\t\t\tif (err || user == null) {\n\t\t\t\t\tfn(err, user, req, res, next);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\treq.login(user, (error) => {\n\t\t\t\t\tfn(error, user, req, res, next);\n\t\t\t\t});\n\t\t\t})(req, res, next);\n\n\t\tlogout = (req, _res, next) => {\n\t\t\treq.logout();\n\t\t\tnext();\n\t\t};\n\t} else {\n\t\tlet loggedIn = false;\n\t\tlet loggedInUser: any = null;\n\t\tapp.use((req, _res, next) => {\n\t\t\tif (loggedIn === false) {\n\t\t\t\treq.user = loggedInUser;\n\t\t\t}\n\t\t\tnext();\n\t\t});\n\n\t\tlogin = (fn) => (req, res, next) =>\n\t\t\tcheckPassword(req.body.username, req.body.password, (err, user) => {\n\t\t\t\tif (user) {\n\t\t\t\t\tloggedIn = true;\n\t\t\t\t\tloggedInUser = user;\n\t\t\t\t}\n\t\t\t\tfn(err, user, req, res, next);\n\t\t\t});\n\n\t\tlogout = (req, _res, next) => {\n\t\t\treq.user = null;\n\t\t\tloggedIn = false;\n\t\t\tloggedInUser = null;\n\t\t\tnext();\n\t\t};\n\t}\n};\n\nexport const config: ConfigLoader.Config = {\n\tmodels: [\n\t\t{\n\t\t\tcustomServerCode: { setup },\n\t\t},\n\t],\n};\n","import * as _ from 'lodash';\n\n/**\n * @typedef {Partial<Window> & {GLOBAL_PERMISSIONS?: string[]}} ExtendedWindow\n */\n\n/** @type {ExtendedWindow} */\nconst w = typeof window !== 'undefined' && window !== null ? window : {};\n\nw.GLOBAL_PERMISSIONS = ['resource.all'];\n\nconst app = (function () {\n\t/** @type Function */\n\tlet ready;\n\tconst enabled = new Promise((resolve) => {\n\t\tready = resolve;\n\t});\n\t/** @type {{[key: string]: any}} */\n\tconst appVars = { env: 'development' };\n\t/** @type {{[key: string]: any}} */\n\tconst handlers = {\n\t\t// USE is a list of middleware to run before any request.\n\t\tUSE: [],\n\t\tPOST: [],\n\t\tPUT: [],\n\t\tDELETE: [],\n\t\tGET: [],\n\t\tPATCH: [],\n\t\tMERGE: [],\n\t\tOPTIONS: [],\n\t};\n\tconst addHandler = function (\n\t\t/** @type string */ handlerName,\n\t\t/** @type {string} */ match,\n\t\t/** @type import('express').Handler[] */ ...middleware\n\t) {\n\t\t//Strip wildcard\n\t\tlet paramName;\n\t\tmatch = match.toLowerCase();\n\t\tconst newMatch = match.replace(/[\\/\\*]*$/, '');\n\t\tif (newMatch !== match) {\n\t\t\tmatch = newMatch;\n\t\t\tparamName = '*';\n\t\t} else {\n\t\t\tconst paramMatch = /:(.*)$/.exec(match);\n\t\t\tparamName = paramMatch?.[1];\n\t\t}\n\t\thandlers[handlerName].push({\n\t\t\tmatch,\n\t\t\tparamName,\n\t\t\t// Flatten middleware list to handle arrays of middleware in the arg list.\n\t\t\tmiddleware: _.flattenDeep(middleware),\n\t\t});\n\t};\n\tconst process = async function (\n\t\t/** @type string */ method,\n\t\t/** @type string */ uri,\n\t\t/** @type {{[key: string]: any}} */ headers,\n\t\t/** @type any */ body,\n\t) {\n\t\tbody ??= '';\n\t\tif (!handlers[method]) {\n\t\t\tthrow [404, null, null];\n\t\t}\n\t\tconst req = {\n\t\t\t// Have a default user for in-browser with all permissions\n\t\t\tuser: {\n\t\t\t\tpermissions: w.GLOBAL_PERMISSIONS,\n\t\t\t},\n\t\t\tmethod,\n\t\t\tbody,\n\t\t\theaders,\n\t\t\turl: uri,\n\t\t\t/** @type {{[key: string]: any}} */\n\t\t\tparams: {},\n\t\t\tquery: {},\n\t\t\tlogin(/** @type any */ _user, /** @type Function */ callback) {\n\t\t\t\tcallback();\n\t\t\t},\n\t\t};\n\t\tconsole.log(method, uri, body);\n\t\tif (uri.slice(-1) === '/') {\n\t\t\turi = uri.slice(0, uri.length - 1);\n\t\t}\n\t\turi = uri.toLowerCase();\n\t\treturn await new Promise(function (resolve, reject) {\n\t\t\tconst res = {\n\t\t\t\tstatusCode: 200,\n\t\t\t\tstatus(/** @type number */ statusCode) {\n\t\t\t\t\tthis.statusCode = statusCode;\n\t\t\t\t\treturn this;\n\t\t\t\t},\n\t\t\t\tjson(/** @type any */ obj) {\n\t\t\t\t\t// Stringify and parse to emulate passing over network.\n\t\t\t\t\tobj = JSON.parse(JSON.stringify(obj));\n\t\t\t\t\tif (this.statusCode >= 400) {\n\t\t\t\t\t\treject([this.statusCode, obj, null]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresolve([this.statusCode, obj, null]);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsend(/** @type any */ data) {\n\t\t\t\t\tdata = _.cloneDeep(data);\n\t\t\t\t\tif (this.statusCode >= 400) {\n\t\t\t\t\t\treject([this.statusCode, data, null]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresolve([this.statusCode, data, null]);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsendStatus(/** @type undefined | number */ statusCode) {\n\t\t\t\t\tstatusCode ??= this.statusCode;\n\t\t\t\t\tif (statusCode >= 400) {\n\t\t\t\t\t\treject([statusCode, null, null]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresolve([statusCode, null, null]);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tredirect() {\n\t\t\t\t\treject([307]);\n\t\t\t\t},\n\t\t\t\tset() {\n\t\t\t\t\t// noop\n\t\t\t\t},\n\t\t\t\ttype() {\n\t\t\t\t\t// noop\n\t\t\t\t},\n\t\t\t};\n\n\t\t\tconst methodHandlers = handlers.USE.concat(handlers[method]);\n\t\t\tlet i = -1;\n\t\t\tlet j = -1;\n\n\t\t\tconst next = function (/** @type {undefined | 'route'} */ route) {\n\t\t\t\tj++;\n\t\t\t\tif (route === 'route' || j >= methodHandlers[i].middleware.length) {\n\t\t\t\t\tcheckMethodHandlers();\n\t\t\t\t} else {\n\t\t\t\t\tmethodHandlers[i].middleware[j](req, res, next);\n\t\t\t\t}\n\t\t\t};\n\t\t\tconst checkMethodHandlers = () => {\n\t\t\t\ti++;\n\t\t\t\tif (i < methodHandlers.length) {\n\t\t\t\t\tif (\n\t\t\t\t\t\turi.slice(0, methodHandlers[i].match.length) ===\n\t\t\t\t\t\tmethodHandlers[i].match\n\t\t\t\t\t) {\n\t\t\t\t\t\tj = -1;\n\t\t\t\t\t\t// Reset params that may have been added on previous routes that failed in middleware\n\t\t\t\t\t\treq.params = {};\n\t\t\t\t\t\tif (methodHandlers[i].paramName != null) {\n\t\t\t\t\t\t\treq.params[methodHandlers[i].paramName] = uri.slice(\n\t\t\t\t\t\t\t\tmethodHandlers[i].match.length,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tnext();\n\t\t\t\t\t\t} else if (uri.length !== methodHandlers[i].match.length) {\n\t\t\t\t\t\t\t// Not an exact match and no parameter matching\n\t\t\t\t\t\t\tcheckMethodHandlers();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tnext();\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcheckMethodHandlers();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tres.sendStatus(404);\n\t\t\t\t}\n\t\t\t};\n\t\t\tcheckMethodHandlers();\n\t\t});\n\t};\n\treturn {\n\t\tuse: _.partial(addHandler, 'USE', '/*'),\n\t\tget(/** @type string */ name) {\n\t\t\tconst callback = arguments[arguments.length - 1];\n\t\t\tif (typeof callback === 'function') {\n\t\t\t\taddHandler('GET', ...arguments);\n\t\t\t} else {\n\t\t\t\treturn appVars[name];\n\t\t\t}\n\t\t},\n\t\tpost: _.partial(addHandler, 'POST'),\n\t\tput: _.partial(addHandler, 'PUT'),\n\t\tdelete: _.partial(addHandler, 'DELETE'),\n\t\tpatch: _.partial(addHandler, 'PATCH'),\n\t\tmerge: _.partial(addHandler, 'MERGE'),\n\t\toptions: _.partial(addHandler, 'OPTIONS'),\n\t\tall(/** @type any[] */ ...args) {\n\t\t\tthis.post(...args);\n\t\t\tthis.get(...args);\n\t\t\tthis.put(...args);\n\t\t\tthis.delete(...args);\n\t\t},\n\t\tprocess(/** @type any[] */ ...args) {\n\t\t\t// The promise will run the real process function asynchronously once the app is enabled,\n\t\t\t// which matches somewhat more closely to an AJAX call than doing it synchronously.\n\t\t\treturn enabled.then(() => process(...args));\n\t\t},\n\t\tlisten() {\n\t\t\tconst callback = arguments[arguments.length - 1];\n\t\t\tready();\n\t\t\tif (typeof callback === 'function') {\n\t\t\t\treturn enabled.then(callback);\n\t\t\t}\n\t\t},\n\t\tset(/** @type string */ name, /** @type any */ value) {\n\t\t\tappVars[name] = value;\n\t\t},\n\t};\n})();\n\nconst express = () => app;\n\nmodule.exports = express;\n"],"sourceRoot":""}